/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */
const t="164",e=1,i=2,n=3,s=0,r=1,o=2,a=100,h=101,c=102,l=200,A=201,u=202,d=203,f=204,g=205,p=206,m=207,v=208,b=209,E=210,C=211,I=212,w=213,_=214,B=0,S=1,M=2,x=0,y=1,Q=2,T=3,D=4,L=5,R=6,P=7,U="attached",N=301,k=302,F=303,O=306,G=1e3,H=1001,V=1002,z=1003,q=1004,W=1005,j=1006,J=1007,Y=1008,K=1009,X=1012,Z=1013,$=1014,tt=1015,et=1016,it=1020,nt=1023,st=1026,rt=1027,ot=1028,at=1030,ht=1031,ct=33776,lt=33777,At=33778,ut=33779,dt=35840,ft=35842,gt=36196,pt=37492,mt=37496,vt=37808,bt=37812,Et=36492,Ct=2201,It=2300,wt=2301,_t=2302,Bt=2400,St=2401,Mt=2402,xt=2500,yt="",Qt="srgb",Tt="srgb-linear",Dt="display-p3",Lt="display-p3-linear",Rt="linear",Pt="srgb",Ut="rec709",Nt="p3",kt=7680,Ft=512,Ot=513,Gt=514,Ht=515,Vt=516,zt=517,qt=518,Wt=519,jt=35044,Jt="300 es",Yt=2e3,Kt=2001;class Xt{addEventListener(t,e){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0===this._listeners)return;const i=this._listeners[t];if(void 0!==i){const t=i.indexOf(e);-1!==t&&i.splice(t,1)}}dispatchEvent(t){if(void 0===this._listeners)return;const e=this._listeners[t.type];if(void 0!==e){t.target=this;const i=e.slice(0);for(let e=0,n=i.length;e<n;e++)i[e].call(this,t);t.target=null}}}const Zt=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let $t=1234567;const te=Math.PI/180,ee=180/Math.PI;function ie(){const t=4294967295*Math.random()|0,e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Zt[255&t]+Zt[t>>8&255]+Zt[t>>16&255]+Zt[t>>24&255]+"-"+Zt[255&e]+Zt[e>>8&255]+"-"+Zt[e>>16&15|64]+Zt[e>>24&255]+"-"+Zt[63&i|128]+Zt[i>>8&255]+"-"+Zt[i>>16&255]+Zt[i>>24&255]+Zt[255&n]+Zt[n>>8&255]+Zt[n>>16&255]+Zt[n>>24&255]).toLowerCase()}function ne(t,e,i){return Math.max(e,Math.min(i,t))}function se(t,e){return(t%e+e)%e}function re(t,e,i){return(1-i)*t+i*e}function oe(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function ae(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(4294967295*t);case Uint16Array:return Math.round(65535*t);case Uint8Array:return Math.round(255*t);case Int32Array:return Math.round(2147483647*t);case Int16Array:return Math.round(32767*t);case Int8Array:return Math.round(127*t);default:throw new Error("Invalid component type.")}}const he={DEG2RAD:te,RAD2DEG:ee,generateUUID:ie,clamp:ne,euclideanModulo:se,mapLinear:function(t,e,i,n,s){return n+(t-e)*(s-n)/(i-e)},inverseLerp:function(t,e,i){return t!==e?(i-t)/(e-t):0},lerp:re,damp:function(t,e,i,n){return re(t,e,1-Math.exp(-i*n))},pingpong:function(t,e=1){return e-Math.abs(se(t,2*e)-e)},smoothstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*(3-2*t)},smootherstep:function(t,e,i){return t<=e?0:t>=i?1:(t=(t-e)/(i-e))*t*t*(t*(6*t-15)+10)},randInt:function(t,e){return t+Math.floor(Math.random()*(e-t+1))},randFloat:function(t,e){return t+Math.random()*(e-t)},randFloatSpread:function(t){return t*(.5-Math.random())},seededRandom:function(t){void 0!==t&&($t=t);let e=$t+=1831565813;return e=Math.imul(e^e>>>15,1|e),e^=e+Math.imul(e^e>>>7,61|e),((e^e>>>14)>>>0)/4294967296},degToRad:function(t){return t*te},radToDeg:function(t){return t*ee},isPowerOfTwo:function(t){return!(t&t-1)&&0!==t},ceilPowerOfTwo:function(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},floorPowerOfTwo:function(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},setQuaternionFromProperEuler:function(t,e,i,n,s){const r=Math.cos,o=Math.sin,a=r(i/2),h=o(i/2),c=r((e+n)/2),l=o((e+n)/2),A=r((e-n)/2),u=o((e-n)/2),d=r((n-e)/2),f=o((n-e)/2);switch(s){case"XYX":t.set(a*l,h*A,h*u,a*c);break;case"YZY":t.set(h*u,a*l,h*A,a*c);break;case"ZXZ":t.set(h*A,h*u,a*l,a*c);break;case"XZX":t.set(a*l,h*f,h*d,a*c);break;case"YXY":t.set(h*d,a*l,h*f,a*c);break;case"ZYZ":t.set(h*f,h*d,a*l,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}},normalize:ae,denormalize:oe};class ce{constructor(t=0,e=0){ce.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,i=this.y,n=t.elements;return this.x=n[0]*e+n[3]*i+n[6],this.y=n[1]*e+n[4]*i+n[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(ne(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y;return e*e+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const i=Math.cos(e),n=Math.sin(e),s=this.x-t.x,r=this.y-t.y;return this.x=s*i-r*n+t.x,this.y=s*n+r*i+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class le{constructor(t,e,i,n,s,r,o,a,h){le.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],void 0!==t&&this.set(t,e,i,n,s,r,o,a,h)}set(t,e,i,n,s,r,o,a,h){const c=this.elements;return c[0]=t,c[1]=n,c[2]=o,c[3]=e,c[4]=s,c[5]=a,c[6]=i,c[7]=r,c[8]=h,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this}extractBasis(t,e,i){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,s=this.elements,r=i[0],o=i[3],a=i[6],h=i[1],c=i[4],l=i[7],A=i[2],u=i[5],d=i[8],f=n[0],g=n[3],p=n[6],m=n[1],v=n[4],b=n[7],E=n[2],C=n[5],I=n[8];return s[0]=r*f+o*m+a*E,s[3]=r*g+o*v+a*C,s[6]=r*p+o*b+a*I,s[1]=h*f+c*m+l*E,s[4]=h*g+c*v+l*C,s[7]=h*p+c*b+l*I,s[2]=A*f+u*m+d*E,s[5]=A*g+u*v+d*C,s[8]=A*p+u*b+d*I,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],h=t[7],c=t[8];return e*r*c-e*o*h-i*s*c+i*o*a+n*s*h-n*r*a}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],h=t[7],c=t[8],l=c*r-o*h,A=o*a-c*s,u=h*s-r*a,d=e*l+i*A+n*u;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);const f=1/d;return t[0]=l*f,t[1]=(n*h-c*i)*f,t[2]=(o*i-n*r)*f,t[3]=A*f,t[4]=(c*e-n*a)*f,t[5]=(n*s-o*e)*f,t[6]=u*f,t[7]=(i*a-h*e)*f,t[8]=(r*e-i*s)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,i,n,s,r,o){const a=Math.cos(s),h=Math.sin(s);return this.set(i*a,i*h,-i*(a*r+h*o)+r+t,-n*h,n*a,-n*(-h*r+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Ae.makeScale(t,e)),this}rotate(t){return this.premultiply(Ae.makeRotation(-t)),this}translate(t,e){return this.premultiply(Ae.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,i,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<9;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<9;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t}clone(){return(new this.constructor).fromArray(this.elements)}}const Ae=new le;function ue(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function de(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function fe(){const t=de("canvas");return t.style.display="block",t}const ge={};function pe(t){t in ge||(ge[t]=!0,console.warn(t))}const me=(new le).set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),ve=(new le).set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),be={[Tt]:{transfer:Rt,primaries:Ut,toReference:t=>t,fromReference:t=>t},[Qt]:{transfer:Pt,primaries:Ut,toReference:t=>t.convertSRGBToLinear(),fromReference:t=>t.convertLinearToSRGB()},[Lt]:{transfer:Rt,primaries:Nt,toReference:t=>t.applyMatrix3(ve),fromReference:t=>t.applyMatrix3(me)},[Dt]:{transfer:Pt,primaries:Nt,toReference:t=>t.convertSRGBToLinear().applyMatrix3(ve),fromReference:t=>t.applyMatrix3(me).convertLinearToSRGB()}},Ee=new Set([Tt,Lt]),Ce={enabled:!0,_workingColorSpace:Tt,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!Ee.has(t))throw new Error(`Unsupported working color space, "${t}".`);this._workingColorSpace=t},convert:function(t,e,i){if(!1===this.enabled||e===i||!e||!i)return t;const n=be[e].toReference;return(0,be[i].fromReference)(n(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return be[t].primaries},getTransfer:function(t){return t===yt?Rt:be[t].transfer}};function Ie(t){return t<.04045?.0773993808*t:Math.pow(.9478672986*t+.0521327014,2.4)}function we(t){return t<.0031308?12.92*t:1.055*Math.pow(t,.41666)-.055}let _e;class Be{static getDataURL(t){if(/^data:/i.test(t.src))return t.src;if("undefined"==typeof HTMLCanvasElement)return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{void 0===_e&&(_e=de("canvas")),_e.width=t.width,_e.height=t.height;const i=_e.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),e=_e}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap){const e=de("canvas");e.width=t.width,e.height=t.height;const i=e.getContext("2d");i.drawImage(t,0,0,t.width,t.height);const n=i.getImageData(0,0,t.width,t.height),s=n.data;for(let t=0;t<s.length;t++)s[t]=255*Ie(s[t]/255);return i.putImageData(n,0,0),e}if(t.data){const e=t.data.slice(0);for(let t=0;t<e.length;t++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[t]=Math.floor(255*Ie(e[t]/255)):e[t]=Ie(e[t]);return{data:e,width:t.width,height:t.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let Se=0;class Me{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Se++}),this.uuid=ie(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){!0===t&&this.version++}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.images[this.uuid])return t.images[this.uuid];const i={uuid:this.uuid,url:""},n=this.data;if(null!==n){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(xe(n[e].image)):t.push(xe(n[e]))}else t=xe(n);i.url=t}return e||(t.images[this.uuid]=i),i}}function xe(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?Be.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let ye=0;class Qe extends Xt{constructor(t=Qe.DEFAULT_IMAGE,e=Qe.DEFAULT_MAPPING,i=1001,n=1001,s=1006,r=1008,o=nt,a=1009,h=Qe.DEFAULT_ANISOTROPY,c=yt){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ye++}),this.uuid=ie(),this.name="",this.source=new Me(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=i,this.wrapT=n,this.magFilter=s,this.minFilter=r,this.anisotropy=h,this.format=o,this.internalFormat=null,this.type=a,this.offset=new ce(0,0),this.repeat=new ce(1,1),this.center=new ce(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new le,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=void 0===t||"string"==typeof t;if(!e&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),e||(t.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case G:t.x=t.x-Math.floor(t.x);break;case H:t.x=t.x<0?0:1;break;case V:1===Math.abs(Math.floor(t.x)%2)?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case G:t.y=t.y-Math.floor(t.y);break;case H:t.y=t.y<0?0:1;break;case V:1===Math.abs(Math.floor(t.y)%2)?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){!0===t&&this.pmremVersion++}}Qe.DEFAULT_IMAGE=null,Qe.DEFAULT_MAPPING=300,Qe.DEFAULT_ANISOTROPY=1;class Te{constructor(t=0,e=0,i=0,n=1){Te.prototype.isVector4=!0,this.x=t,this.y=e,this.z=i,this.w=n}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,i,n){return this.x=t,this.y=e,this.z=i,this.w=n,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=void 0!==t.w?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,s=this.w,r=t.elements;return this.x=r[0]*e+r[4]*i+r[8]*n+r[12]*s,this.y=r[1]*e+r[5]*i+r[9]*n+r[13]*s,this.z=r[2]*e+r[6]*i+r[10]*n+r[14]*s,this.w=r[3]*e+r[7]*i+r[11]*n+r[15]*s,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,i,n,s;const r=.01,o=.1,a=t.elements,h=a[0],c=a[4],l=a[8],A=a[1],u=a[5],d=a[9],f=a[2],g=a[6],p=a[10];if(Math.abs(c-A)<r&&Math.abs(l-f)<r&&Math.abs(d-g)<r){if(Math.abs(c+A)<o&&Math.abs(l+f)<o&&Math.abs(d+g)<o&&Math.abs(h+u+p-3)<o)return this.set(1,0,0,0),this;e=Math.PI;const t=(h+1)/2,a=(u+1)/2,m=(p+1)/2,v=(c+A)/4,b=(l+f)/4,E=(d+g)/4;return t>a&&t>m?t<r?(i=0,n=.707106781,s=.707106781):(i=Math.sqrt(t),n=v/i,s=b/i):a>m?a<r?(i=.707106781,n=0,s=.707106781):(n=Math.sqrt(a),i=v/n,s=E/n):m<r?(i=.707106781,n=.707106781,s=0):(s=Math.sqrt(m),i=b/s,n=E/s),this.set(i,n,s,e),this}let m=Math.sqrt((g-d)*(g-d)+(l-f)*(l-f)+(A-c)*(A-c));return Math.abs(m)<.001&&(m=1),this.x=(g-d)/m,this.y=(l-f)/m,this.z=(A-c)/m,this.w=Math.acos((h+u+p-1)/2),this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this.w=Math.max(t.w,Math.min(e.w,this.w)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this.w=Math.max(t,Math.min(e,this.w)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this.w=t.w+(e.w-t.w)*i,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class De extends Xt{constructor(t=1,e=1,i={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new Te(0,0,t,e),this.scissorTest=!1,this.viewport=new Te(0,0,t,e);const n={width:t,height:e,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:j,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},i);const s=new Qe(n,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);s.flipY=!1,s.generateMipmaps=i.generateMipmaps,s.internalFormat=i.internalFormat,this.textures=[];const r=i.count;for(let t=0;t<r;t++)this.textures[t]=s.clone(),this.textures[t].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.resolveDepthBuffer=i.resolveDepthBuffer,this.resolveStencilBuffer=i.resolveStencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(t,e,i=1){if(this.width!==t||this.height!==e||this.depth!==i){this.width=t,this.height=e,this.depth=i;for(let n=0,s=this.textures.length;n<s;n++)this.textures[n].image.width=t,this.textures[n].image.height=e,this.textures[n].image.depth=i;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return(new this.constructor).copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let e=0,i=t.textures.length;e<i;e++)this.textures[e]=t.textures[e].clone(),this.textures[e].isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new Me(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,null!==t.depthTexture&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Le extends De{constructor(t=1,e=1,i={}){super(t,e,i),this.isWebGLRenderTarget=!0}}class Re extends Qe{constructor(t=null,e=1,i=1,n=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:i,depth:n},this.magFilter=z,this.minFilter=z,this.wrapR=H,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Pe extends Qe{constructor(t=null,e=1,i=1,n=1){super(null),this.isData3DTexture=!0,this.image={data:t,width:e,height:i,depth:n},this.magFilter=z,this.minFilter=z,this.wrapR=H,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ue{constructor(t=0,e=0,i=0,n=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=i,this._w=n}static slerpFlat(t,e,i,n,s,r,o){let a=i[n+0],h=i[n+1],c=i[n+2],l=i[n+3];const A=s[r+0],u=s[r+1],d=s[r+2],f=s[r+3];if(0===o)return t[e+0]=a,t[e+1]=h,t[e+2]=c,void(t[e+3]=l);if(1===o)return t[e+0]=A,t[e+1]=u,t[e+2]=d,void(t[e+3]=f);if(l!==f||a!==A||h!==u||c!==d){let t=1-o;const e=a*A+h*u+c*d+l*f,i=e>=0?1:-1,n=1-e*e;if(n>Number.EPSILON){const s=Math.sqrt(n),r=Math.atan2(s,e*i);t=Math.sin(t*r)/s,o=Math.sin(o*r)/s}const s=o*i;if(a=a*t+A*s,h=h*t+u*s,c=c*t+d*s,l=l*t+f*s,t===1-o){const t=1/Math.sqrt(a*a+h*h+c*c+l*l);a*=t,h*=t,c*=t,l*=t}}t[e]=a,t[e+1]=h,t[e+2]=c,t[e+3]=l}static multiplyQuaternionsFlat(t,e,i,n,s,r){const o=i[n],a=i[n+1],h=i[n+2],c=i[n+3],l=s[r],A=s[r+1],u=s[r+2],d=s[r+3];return t[e]=o*d+c*l+a*u-h*A,t[e+1]=a*d+c*A+h*l-o*u,t[e+2]=h*d+c*u+o*A-a*l,t[e+3]=c*d-o*l-a*A-h*u,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,i,n){return this._x=t,this._y=e,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const i=t._x,n=t._y,s=t._z,r=t._order,o=Math.cos,a=Math.sin,h=o(i/2),c=o(n/2),l=o(s/2),A=a(i/2),u=a(n/2),d=a(s/2);switch(r){case"XYZ":this._x=A*c*l+h*u*d,this._y=h*u*l-A*c*d,this._z=h*c*d+A*u*l,this._w=h*c*l-A*u*d;break;case"YXZ":this._x=A*c*l+h*u*d,this._y=h*u*l-A*c*d,this._z=h*c*d-A*u*l,this._w=h*c*l+A*u*d;break;case"ZXY":this._x=A*c*l-h*u*d,this._y=h*u*l+A*c*d,this._z=h*c*d+A*u*l,this._w=h*c*l-A*u*d;break;case"ZYX":this._x=A*c*l-h*u*d,this._y=h*u*l+A*c*d,this._z=h*c*d-A*u*l,this._w=h*c*l+A*u*d;break;case"YZX":this._x=A*c*l+h*u*d,this._y=h*u*l+A*c*d,this._z=h*c*d-A*u*l,this._w=h*c*l-A*u*d;break;case"XZY":this._x=A*c*l-h*u*d,this._y=h*u*l-A*c*d,this._z=h*c*d+A*u*l,this._w=h*c*l+A*u*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!0===e&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const i=e/2,n=Math.sin(i);return this._x=t.x*n,this._y=t.y*n,this._z=t.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,i=e[0],n=e[4],s=e[8],r=e[1],o=e[5],a=e[9],h=e[2],c=e[6],l=e[10],A=i+o+l;if(A>0){const t=.5/Math.sqrt(A+1);this._w=.25/t,this._x=(c-a)*t,this._y=(s-h)*t,this._z=(r-n)*t}else if(i>o&&i>l){const t=2*Math.sqrt(1+i-o-l);this._w=(c-a)/t,this._x=.25*t,this._y=(n+r)/t,this._z=(s+h)/t}else if(o>l){const t=2*Math.sqrt(1+o-i-l);this._w=(s-h)/t,this._x=(n+r)/t,this._y=.25*t,this._z=(a+c)/t}else{const t=2*Math.sqrt(1+l-i-o);this._w=(r-n)/t,this._x=(s+h)/t,this._y=(a+c)/t,this._z=.25*t}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let i=t.dot(e)+1;return i<Number.EPSILON?(i=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=i):(this._x=0,this._y=-t.z,this._z=t.y,this._w=i)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=i),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ne(this.dot(t),-1,1)))}rotateTowards(t,e){const i=this.angleTo(t);if(0===i)return this;const n=Math.min(1,e/i);return this.slerp(t,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return 0===t?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const i=t._x,n=t._y,s=t._z,r=t._w,o=e._x,a=e._y,h=e._z,c=e._w;return this._x=i*c+r*o+n*h-s*a,this._y=n*c+r*a+s*o-i*h,this._z=s*c+r*h+i*a-n*o,this._w=r*c-i*o-n*a-s*h,this._onChangeCallback(),this}slerp(t,e){if(0===e)return this;if(1===e)return this.copy(t);const i=this._x,n=this._y,s=this._z,r=this._w;let o=r*t._w+i*t._x+n*t._y+s*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=r,this._x=i,this._y=n,this._z=s,this;const a=1-o*o;if(a<=Number.EPSILON){const t=1-e;return this._w=t*r+e*this._w,this._x=t*i+e*this._x,this._y=t*n+e*this._y,this._z=t*s+e*this._z,this.normalize(),this}const h=Math.sqrt(a),c=Math.atan2(h,o),l=Math.sin((1-e)*c)/h,A=Math.sin(e*c)/h;return this._w=r*l+this._w*A,this._x=i*l+this._x*A,this._y=n*l+this._y*A,this._z=s*l+this._z*A,this._onChangeCallback(),this}slerpQuaternions(t,e,i){return this.copy(t).slerp(e,i)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),i=Math.random(),n=Math.sqrt(1-i),s=Math.sqrt(i);return this.set(n*Math.sin(t),n*Math.cos(t),s*Math.sin(e),s*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Ne{constructor(t=0,e=0,i=0){Ne.prototype.isVector3=!0,this.x=t,this.y=e,this.z=i}set(t,e,i){return void 0===i&&(i=this.z),this.x=t,this.y=e,this.z=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Fe.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Fe.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[3]*i+s[6]*n,this.y=s[1]*e+s[4]*i+s[7]*n,this.z=s[2]*e+s[5]*i+s[8]*n,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,i=this.y,n=this.z,s=t.elements,r=1/(s[3]*e+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*e+s[4]*i+s[8]*n+s[12])*r,this.y=(s[1]*e+s[5]*i+s[9]*n+s[13])*r,this.z=(s[2]*e+s[6]*i+s[10]*n+s[14])*r,this}applyQuaternion(t){const e=this.x,i=this.y,n=this.z,s=t.x,r=t.y,o=t.z,a=t.w,h=2*(r*n-o*i),c=2*(o*e-s*n),l=2*(s*i-r*e);return this.x=e+a*h+r*l-o*c,this.y=i+a*c+o*h-s*l,this.z=n+a*l+s*c-r*h,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,i=this.y,n=this.z,s=t.elements;return this.x=s[0]*e+s[4]*i+s[8]*n,this.y=s[1]*e+s[5]*i+s[9]*n,this.z=s[2]*e+s[6]*i+s[10]*n,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=Math.max(t.x,Math.min(e.x,this.x)),this.y=Math.max(t.y,Math.min(e.y,this.y)),this.z=Math.max(t.z,Math.min(e.z,this.z)),this}clampScalar(t,e){return this.x=Math.max(t,Math.min(e,this.x)),this.y=Math.max(t,Math.min(e,this.y)),this.z=Math.max(t,Math.min(e,this.z)),this}clampLength(t,e){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(t,Math.min(e,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,i){return this.x=t.x+(e.x-t.x)*i,this.y=t.y+(e.y-t.y)*i,this.z=t.z+(e.z-t.z)*i,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const i=t.x,n=t.y,s=t.z,r=e.x,o=e.y,a=e.z;return this.x=n*a-s*o,this.y=s*r-i*a,this.z=i*o-n*r,this}projectOnVector(t){const e=t.lengthSq();if(0===e)return this.set(0,0,0);const i=t.dot(this)/e;return this.copy(t).multiplyScalar(i)}projectOnPlane(t){return ke.copy(this).projectOnVector(t),this.sub(ke)}reflect(t){return this.sub(ke.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(0===e)return Math.PI/2;const i=this.dot(t)/e;return Math.acos(ne(i,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,i=this.y-t.y,n=this.z-t.z;return e*e+i*i+n*n}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,i){const n=Math.sin(e)*t;return this.x=n*Math.sin(i),this.y=Math.cos(e)*t,this.z=n*Math.cos(i),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,i){return this.x=t*Math.sin(e),this.y=i,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),i=this.setFromMatrixColumn(t,1).length(),n=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=i,this.z=n,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,4*e)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,3*e)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=2*Math.random()-1,i=Math.sqrt(1-e*e);return this.x=i*Math.cos(t),this.y=e,this.z=i*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const ke=new Ne,Fe=new Ue;class Oe{constructor(t=new Ne(1/0,1/0,1/0),e=new Ne(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e+=3)this.expandByPoint(He.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,i=t.count;e<i;e++)this.expandByPoint(He.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,i=t.length;e<i;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const i=He.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return(new this.constructor).copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const i=t.geometry;if(void 0!==i){const n=i.getAttribute("position");if(!0===e&&void 0!==n&&!0!==t.isInstancedMesh)for(let e=0,i=n.count;e<i;e++)!0===t.isMesh?t.getVertexPosition(e,He):He.fromBufferAttribute(n,e),He.applyMatrix4(t.matrixWorld),this.expandByPoint(He);else void 0!==t.boundingBox?(null===t.boundingBox&&t.computeBoundingBox(),Ve.copy(t.boundingBox)):(null===i.boundingBox&&i.computeBoundingBox(),Ve.copy(i.boundingBox)),Ve.applyMatrix4(t.matrixWorld),this.union(Ve)}const n=t.children;for(let t=0,i=n.length;t<i;t++)this.expandByObject(n[t],e);return this}containsPoint(t){return!(t.x<this.min.x||t.x>this.max.x||t.y<this.min.y||t.y>this.max.y||t.z<this.min.z||t.z>this.max.z)}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return!(t.max.x<this.min.x||t.min.x>this.max.x||t.max.y<this.min.y||t.min.y>this.max.y||t.max.z<this.min.z||t.min.z>this.max.z)}intersectsSphere(t){return this.clampPoint(t.center,He),He.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,i;return t.normal.x>0?(e=t.normal.x*this.min.x,i=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,i=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,i+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,i+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,i+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,i+=t.normal.z*this.min.z),e<=-t.constant&&i>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Ke),Xe.subVectors(this.max,Ke),ze.subVectors(t.a,Ke),qe.subVectors(t.b,Ke),We.subVectors(t.c,Ke),je.subVectors(qe,ze),Je.subVectors(We,qe),Ye.subVectors(ze,We);let e=[0,-je.z,je.y,0,-Je.z,Je.y,0,-Ye.z,Ye.y,je.z,0,-je.x,Je.z,0,-Je.x,Ye.z,0,-Ye.x,-je.y,je.x,0,-Je.y,Je.x,0,-Ye.y,Ye.x,0];return!!ti(e,ze,qe,We,Xe)&&(e=[1,0,0,0,1,0,0,0,1],!!ti(e,ze,qe,We,Xe)&&(Ze.crossVectors(je,Je),e=[Ze.x,Ze.y,Ze.z],ti(e,ze,qe,We,Xe)))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,He).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=.5*this.getSize(He).length()),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()||(Ge[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Ge[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Ge[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Ge[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Ge[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Ge[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Ge[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Ge[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Ge)),this}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Ge=[new Ne,new Ne,new Ne,new Ne,new Ne,new Ne,new Ne,new Ne],He=new Ne,Ve=new Oe,ze=new Ne,qe=new Ne,We=new Ne,je=new Ne,Je=new Ne,Ye=new Ne,Ke=new Ne,Xe=new Ne,Ze=new Ne,$e=new Ne;function ti(t,e,i,n,s){for(let r=0,o=t.length-3;r<=o;r+=3){$e.fromArray(t,r);const o=s.x*Math.abs($e.x)+s.y*Math.abs($e.y)+s.z*Math.abs($e.z),a=e.dot($e),h=i.dot($e),c=n.dot($e);if(Math.max(-Math.max(a,h,c),Math.min(a,h,c))>o)return!1}return!0}const ei=new Oe,ii=new Ne,ni=new Ne;class si{constructor(t=new Ne,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const i=this.center;void 0!==e?i.copy(e):ei.setFromPoints(t).getCenter(i);let n=0;for(let e=0,s=t.length;e<s;e++)n=Math.max(n,i.distanceToSquared(t[e]));return this.radius=Math.sqrt(n),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const i=this.center.distanceToSquared(t);return e.copy(t),i>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;ii.subVectors(t,this.center);const e=ii.lengthSq();if(e>this.radius*this.radius){const t=Math.sqrt(e),i=.5*(t-this.radius);this.center.addScaledVector(ii,i/t),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(!0===this.center.equals(t.center)?this.radius=Math.max(this.radius,t.radius):(ni.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(ii.copy(t.center).add(ni)),this.expandByPoint(ii.copy(t.center).sub(ni))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const ri=new Ne,oi=new Ne,ai=new Ne,hi=new Ne,ci=new Ne,li=new Ne,Ai=new Ne;class ui{constructor(t=new Ne,e=new Ne(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,ri)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const i=e.dot(this.direction);return i<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=ri.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(ri.copy(this.origin).addScaledVector(this.direction,e),ri.distanceToSquared(t))}distanceSqToSegment(t,e,i,n){oi.copy(t).add(e).multiplyScalar(.5),ai.copy(e).sub(t).normalize(),hi.copy(this.origin).sub(oi);const s=.5*t.distanceTo(e),r=-this.direction.dot(ai),o=hi.dot(this.direction),a=-hi.dot(ai),h=hi.lengthSq(),c=Math.abs(1-r*r);let l,A,u,d;if(c>0)if(l=r*a-o,A=r*o-a,d=s*c,l>=0)if(A>=-d)if(A<=d){const t=1/c;l*=t,A*=t,u=l*(l+r*A+2*o)+A*(r*l+A+2*a)+h}else A=s,l=Math.max(0,-(r*A+o)),u=-l*l+A*(A+2*a)+h;else A=-s,l=Math.max(0,-(r*A+o)),u=-l*l+A*(A+2*a)+h;else A<=-d?(l=Math.max(0,-(-r*s+o)),A=l>0?-s:Math.min(Math.max(-s,-a),s),u=-l*l+A*(A+2*a)+h):A<=d?(l=0,A=Math.min(Math.max(-s,-a),s),u=A*(A+2*a)+h):(l=Math.max(0,-(r*s+o)),A=l>0?s:Math.min(Math.max(-s,-a),s),u=-l*l+A*(A+2*a)+h);else A=r>0?-s:s,l=Math.max(0,-(r*A+o)),u=-l*l+A*(A+2*a)+h;return i&&i.copy(this.origin).addScaledVector(this.direction,l),n&&n.copy(oi).addScaledVector(ai,A),u}intersectSphere(t,e){ri.subVectors(t.center,this.origin);const i=ri.dot(this.direction),n=ri.dot(ri)-i*i,s=t.radius*t.radius;if(n>s)return null;const r=Math.sqrt(s-n),o=i-r,a=i+r;return a<0?null:o<0?this.at(a,e):this.at(o,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(t.normal)+t.constant)/e;return i>=0?i:null}intersectPlane(t,e){const i=this.distanceToPlane(t);return null===i?null:this.at(i,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);if(0===e)return!0;return t.normal.dot(this.direction)*e<0}intersectBox(t,e){let i,n,s,r,o,a;const h=1/this.direction.x,c=1/this.direction.y,l=1/this.direction.z,A=this.origin;return h>=0?(i=(t.min.x-A.x)*h,n=(t.max.x-A.x)*h):(i=(t.max.x-A.x)*h,n=(t.min.x-A.x)*h),c>=0?(s=(t.min.y-A.y)*c,r=(t.max.y-A.y)*c):(s=(t.max.y-A.y)*c,r=(t.min.y-A.y)*c),i>r||s>n?null:((s>i||isNaN(i))&&(i=s),(r<n||isNaN(n))&&(n=r),l>=0?(o=(t.min.z-A.z)*l,a=(t.max.z-A.z)*l):(o=(t.max.z-A.z)*l,a=(t.min.z-A.z)*l),i>a||o>n?null:((o>i||i!=i)&&(i=o),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,e)))}intersectsBox(t){return null!==this.intersectBox(t,ri)}intersectTriangle(t,e,i,n,s){ci.subVectors(e,t),li.subVectors(i,t),Ai.crossVectors(ci,li);let r,o=this.direction.dot(Ai);if(o>0){if(n)return null;r=1}else{if(!(o<0))return null;r=-1,o=-o}hi.subVectors(this.origin,t);const a=r*this.direction.dot(li.crossVectors(hi,li));if(a<0)return null;const h=r*this.direction.dot(ci.cross(hi));if(h<0)return null;if(a+h>o)return null;const c=-r*hi.dot(Ai);return c<0?null:this.at(c/o,s)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class di{constructor(t,e,i,n,s,r,o,a,h,c,l,A,u,d,f,g){di.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],void 0!==t&&this.set(t,e,i,n,s,r,o,a,h,c,l,A,u,d,f,g)}set(t,e,i,n,s,r,o,a,h,c,l,A,u,d,f,g){const p=this.elements;return p[0]=t,p[4]=e,p[8]=i,p[12]=n,p[1]=s,p[5]=r,p[9]=o,p[13]=a,p[2]=h,p[6]=c,p[10]=l,p[14]=A,p[3]=u,p[7]=d,p[11]=f,p[15]=g,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new di).fromArray(this.elements)}copy(t){const e=this.elements,i=t.elements;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this}copyPosition(t){const e=this.elements,i=t.elements;return e[12]=i[12],e[13]=i[13],e[14]=i[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,i){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(t,e,i){return this.set(t.x,e.x,i.x,0,t.y,e.y,i.y,0,t.z,e.z,i.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,i=t.elements,n=1/fi.setFromMatrixColumn(t,0).length(),s=1/fi.setFromMatrixColumn(t,1).length(),r=1/fi.setFromMatrixColumn(t,2).length();return e[0]=i[0]*n,e[1]=i[1]*n,e[2]=i[2]*n,e[3]=0,e[4]=i[4]*s,e[5]=i[5]*s,e[6]=i[6]*s,e[7]=0,e[8]=i[8]*r,e[9]=i[9]*r,e[10]=i[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,i=t.x,n=t.y,s=t.z,r=Math.cos(i),o=Math.sin(i),a=Math.cos(n),h=Math.sin(n),c=Math.cos(s),l=Math.sin(s);if("XYZ"===t.order){const t=r*c,i=r*l,n=o*c,s=o*l;e[0]=a*c,e[4]=-a*l,e[8]=h,e[1]=i+n*h,e[5]=t-s*h,e[9]=-o*a,e[2]=s-t*h,e[6]=n+i*h,e[10]=r*a}else if("YXZ"===t.order){const t=a*c,i=a*l,n=h*c,s=h*l;e[0]=t+s*o,e[4]=n*o-i,e[8]=r*h,e[1]=r*l,e[5]=r*c,e[9]=-o,e[2]=i*o-n,e[6]=s+t*o,e[10]=r*a}else if("ZXY"===t.order){const t=a*c,i=a*l,n=h*c,s=h*l;e[0]=t-s*o,e[4]=-r*l,e[8]=n+i*o,e[1]=i+n*o,e[5]=r*c,e[9]=s-t*o,e[2]=-r*h,e[6]=o,e[10]=r*a}else if("ZYX"===t.order){const t=r*c,i=r*l,n=o*c,s=o*l;e[0]=a*c,e[4]=n*h-i,e[8]=t*h+s,e[1]=a*l,e[5]=s*h+t,e[9]=i*h-n,e[2]=-h,e[6]=o*a,e[10]=r*a}else if("YZX"===t.order){const t=r*a,i=r*h,n=o*a,s=o*h;e[0]=a*c,e[4]=s-t*l,e[8]=n*l+i,e[1]=l,e[5]=r*c,e[9]=-o*c,e[2]=-h*c,e[6]=i*l+n,e[10]=t-s*l}else if("XZY"===t.order){const t=r*a,i=r*h,n=o*a,s=o*h;e[0]=a*c,e[4]=-l,e[8]=h*c,e[1]=t*l+s,e[5]=r*c,e[9]=i*l-n,e[2]=n*l-i,e[6]=o*c,e[10]=s*l+t}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(pi,t,mi)}lookAt(t,e,i){const n=this.elements;return Ei.subVectors(t,e),0===Ei.lengthSq()&&(Ei.z=1),Ei.normalize(),vi.crossVectors(i,Ei),0===vi.lengthSq()&&(1===Math.abs(i.z)?Ei.x+=1e-4:Ei.z+=1e-4,Ei.normalize(),vi.crossVectors(i,Ei)),vi.normalize(),bi.crossVectors(Ei,vi),n[0]=vi.x,n[4]=bi.x,n[8]=Ei.x,n[1]=vi.y,n[5]=bi.y,n[9]=Ei.y,n[2]=vi.z,n[6]=bi.z,n[10]=Ei.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const i=t.elements,n=e.elements,s=this.elements,r=i[0],o=i[4],a=i[8],h=i[12],c=i[1],l=i[5],A=i[9],u=i[13],d=i[2],f=i[6],g=i[10],p=i[14],m=i[3],v=i[7],b=i[11],E=i[15],C=n[0],I=n[4],w=n[8],_=n[12],B=n[1],S=n[5],M=n[9],x=n[13],y=n[2],Q=n[6],T=n[10],D=n[14],L=n[3],R=n[7],P=n[11],U=n[15];return s[0]=r*C+o*B+a*y+h*L,s[4]=r*I+o*S+a*Q+h*R,s[8]=r*w+o*M+a*T+h*P,s[12]=r*_+o*x+a*D+h*U,s[1]=c*C+l*B+A*y+u*L,s[5]=c*I+l*S+A*Q+u*R,s[9]=c*w+l*M+A*T+u*P,s[13]=c*_+l*x+A*D+u*U,s[2]=d*C+f*B+g*y+p*L,s[6]=d*I+f*S+g*Q+p*R,s[10]=d*w+f*M+g*T+p*P,s[14]=d*_+f*x+g*D+p*U,s[3]=m*C+v*B+b*y+E*L,s[7]=m*I+v*S+b*Q+E*R,s[11]=m*w+v*M+b*T+E*P,s[15]=m*_+v*x+b*D+E*U,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],i=t[4],n=t[8],s=t[12],r=t[1],o=t[5],a=t[9],h=t[13],c=t[2],l=t[6],A=t[10],u=t[14];return t[3]*(+s*a*l-n*h*l-s*o*A+i*h*A+n*o*u-i*a*u)+t[7]*(+e*a*u-e*h*A+s*r*A-n*r*u+n*h*c-s*a*c)+t[11]*(+e*h*l-e*o*u-s*r*l+i*r*u+s*o*c-i*h*c)+t[15]*(-n*o*c-e*a*l+e*o*A+n*r*l-i*r*A+i*a*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,i){const n=this.elements;return t.isVector3?(n[12]=t.x,n[13]=t.y,n[14]=t.z):(n[12]=t,n[13]=e,n[14]=i),this}invert(){const t=this.elements,e=t[0],i=t[1],n=t[2],s=t[3],r=t[4],o=t[5],a=t[6],h=t[7],c=t[8],l=t[9],A=t[10],u=t[11],d=t[12],f=t[13],g=t[14],p=t[15],m=l*g*h-f*A*h+f*a*u-o*g*u-l*a*p+o*A*p,v=d*A*h-c*g*h-d*a*u+r*g*u+c*a*p-r*A*p,b=c*f*h-d*l*h+d*o*u-r*f*u-c*o*p+r*l*p,E=d*l*a-c*f*a-d*o*A+r*f*A+c*o*g-r*l*g,C=e*m+i*v+n*b+s*E;if(0===C)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const I=1/C;return t[0]=m*I,t[1]=(f*A*s-l*g*s-f*n*u+i*g*u+l*n*p-i*A*p)*I,t[2]=(o*g*s-f*a*s+f*n*h-i*g*h-o*n*p+i*a*p)*I,t[3]=(l*a*s-o*A*s-l*n*h+i*A*h+o*n*u-i*a*u)*I,t[4]=v*I,t[5]=(c*g*s-d*A*s+d*n*u-e*g*u-c*n*p+e*A*p)*I,t[6]=(d*a*s-r*g*s-d*n*h+e*g*h+r*n*p-e*a*p)*I,t[7]=(r*A*s-c*a*s+c*n*h-e*A*h-r*n*u+e*a*u)*I,t[8]=b*I,t[9]=(d*l*s-c*f*s-d*i*u+e*f*u+c*i*p-e*l*p)*I,t[10]=(r*f*s-d*o*s+d*i*h-e*f*h-r*i*p+e*o*p)*I,t[11]=(c*o*s-r*l*s-c*i*h+e*l*h+r*i*u-e*o*u)*I,t[12]=E*I,t[13]=(c*f*n-d*l*n+d*i*A-e*f*A-c*i*g+e*l*g)*I,t[14]=(d*o*n-r*f*n-d*i*a+e*f*a+r*i*g-e*o*g)*I,t[15]=(r*l*n-c*o*n+c*i*a-e*l*a-r*i*A+e*o*A)*I,this}scale(t){const e=this.elements,i=t.x,n=t.y,s=t.z;return e[0]*=i,e[4]*=n,e[8]*=s,e[1]*=i,e[5]*=n,e[9]*=s,e[2]*=i,e[6]*=n,e[10]*=s,e[3]*=i,e[7]*=n,e[11]*=s,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],i=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],n=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,i,n))}makeTranslation(t,e,i){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,i,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),i=Math.sin(t);return this.set(1,0,0,0,0,e,-i,0,0,i,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,0,i,0,0,1,0,0,-i,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),i=Math.sin(t);return this.set(e,-i,0,0,i,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const i=Math.cos(e),n=Math.sin(e),s=1-i,r=t.x,o=t.y,a=t.z,h=s*r,c=s*o;return this.set(h*r+i,h*o-n*a,h*a+n*o,0,h*o+n*a,c*o+i,c*a-n*r,0,h*a-n*o,c*a+n*r,s*a*a+i,0,0,0,0,1),this}makeScale(t,e,i){return this.set(t,0,0,0,0,e,0,0,0,0,i,0,0,0,0,1),this}makeShear(t,e,i,n,s,r){return this.set(1,i,s,0,t,1,r,0,e,n,1,0,0,0,0,1),this}compose(t,e,i){const n=this.elements,s=e._x,r=e._y,o=e._z,a=e._w,h=s+s,c=r+r,l=o+o,A=s*h,u=s*c,d=s*l,f=r*c,g=r*l,p=o*l,m=a*h,v=a*c,b=a*l,E=i.x,C=i.y,I=i.z;return n[0]=(1-(f+p))*E,n[1]=(u+b)*E,n[2]=(d-v)*E,n[3]=0,n[4]=(u-b)*C,n[5]=(1-(A+p))*C,n[6]=(g+m)*C,n[7]=0,n[8]=(d+v)*I,n[9]=(g-m)*I,n[10]=(1-(A+f))*I,n[11]=0,n[12]=t.x,n[13]=t.y,n[14]=t.z,n[15]=1,this}decompose(t,e,i){const n=this.elements;let s=fi.set(n[0],n[1],n[2]).length();const r=fi.set(n[4],n[5],n[6]).length(),o=fi.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),t.x=n[12],t.y=n[13],t.z=n[14],gi.copy(this);const a=1/s,h=1/r,c=1/o;return gi.elements[0]*=a,gi.elements[1]*=a,gi.elements[2]*=a,gi.elements[4]*=h,gi.elements[5]*=h,gi.elements[6]*=h,gi.elements[8]*=c,gi.elements[9]*=c,gi.elements[10]*=c,e.setFromRotationMatrix(gi),i.x=s,i.y=r,i.z=o,this}makePerspective(t,e,i,n,s,r,o=2e3){const a=this.elements,h=2*s/(e-t),c=2*s/(i-n),l=(e+t)/(e-t),A=(i+n)/(i-n);let u,d;if(o===Yt)u=-(r+s)/(r-s),d=-2*r*s/(r-s);else{if(o!==Kt)throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);u=-r/(r-s),d=-r*s/(r-s)}return a[0]=h,a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=c,a[9]=A,a[13]=0,a[2]=0,a[6]=0,a[10]=u,a[14]=d,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,i,n,s,r,o=2e3){const a=this.elements,h=1/(e-t),c=1/(i-n),l=1/(r-s),A=(e+t)*h,u=(i+n)*c;let d,f;if(o===Yt)d=(r+s)*l,f=-2*l;else{if(o!==Kt)throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);d=s*l,f=-1*l}return a[0]=2*h,a[4]=0,a[8]=0,a[12]=-A,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-u,a[2]=0,a[6]=0,a[10]=f,a[14]=-d,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,i=t.elements;for(let t=0;t<16;t++)if(e[t]!==i[t])return!1;return!0}fromArray(t,e=0){for(let i=0;i<16;i++)this.elements[i]=t[i+e];return this}toArray(t=[],e=0){const i=this.elements;return t[e]=i[0],t[e+1]=i[1],t[e+2]=i[2],t[e+3]=i[3],t[e+4]=i[4],t[e+5]=i[5],t[e+6]=i[6],t[e+7]=i[7],t[e+8]=i[8],t[e+9]=i[9],t[e+10]=i[10],t[e+11]=i[11],t[e+12]=i[12],t[e+13]=i[13],t[e+14]=i[14],t[e+15]=i[15],t}}const fi=new Ne,gi=new di,pi=new Ne(0,0,0),mi=new Ne(1,1,1),vi=new Ne,bi=new Ne,Ei=new Ne,Ci=new di,Ii=new Ue;class wi{constructor(t=0,e=0,i=0,n=wi.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=i,this._order=n}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,i,n=this._order){return this._x=t,this._y=e,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,i=!0){const n=t.elements,s=n[0],r=n[4],o=n[8],a=n[1],h=n[5],c=n[9],l=n[2],A=n[6],u=n[10];switch(e){case"XYZ":this._y=Math.asin(ne(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,u),this._z=Math.atan2(-r,s)):(this._x=Math.atan2(A,h),this._z=0);break;case"YXZ":this._x=Math.asin(-ne(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,u),this._z=Math.atan2(a,h)):(this._y=Math.atan2(-l,s),this._z=0);break;case"ZXY":this._x=Math.asin(ne(A,-1,1)),Math.abs(A)<.9999999?(this._y=Math.atan2(-l,u),this._z=Math.atan2(-r,h)):(this._y=0,this._z=Math.atan2(a,s));break;case"ZYX":this._y=Math.asin(-ne(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(A,u),this._z=Math.atan2(a,s)):(this._x=0,this._z=Math.atan2(-r,h));break;case"YZX":this._z=Math.asin(ne(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,h),this._y=Math.atan2(-l,s)):(this._x=0,this._y=Math.atan2(o,u));break;case"XZY":this._z=Math.asin(-ne(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(A,h),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-c,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,!0===i&&this._onChangeCallback(),this}setFromQuaternion(t,e,i){return Ci.makeRotationFromQuaternion(t),this.setFromRotationMatrix(Ci,e,i)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return Ii.setFromEuler(this),this.setFromQuaternion(Ii,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}wi.DEFAULT_ORDER="XYZ";class _i{constructor(){this.mask=1}set(t){this.mask=1<<t>>>0}enable(t){this.mask|=1<<t}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t}disable(t){this.mask&=~(1<<t)}disableAll(){this.mask=0}test(t){return!!(this.mask&t.mask)}isEnabled(t){return!!(this.mask&1<<t)}}let Bi=0;const Si=new Ne,Mi=new Ue,xi=new di,yi=new Ne,Qi=new Ne,Ti=new Ne,Di=new Ue,Li=new Ne(1,0,0),Ri=new Ne(0,1,0),Pi=new Ne(0,0,1),Ui={type:"added"},Ni={type:"removed"},ki={type:"childadded",child:null},Fi={type:"childremoved",child:null};class Oi extends Xt{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Bi++}),this.uuid=ie(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Oi.DEFAULT_UP.clone();const t=new Ne,e=new wi,i=new Ue,n=new Ne(1,1,1);e._onChange((function(){i.setFromEuler(e,!1)})),i._onChange((function(){e.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new di},normalMatrix:{value:new le}}),this.matrix=new di,this.matrixWorld=new di,this.matrixAutoUpdate=Oi.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Oi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new _i,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return Mi.setFromAxisAngle(t,e),this.quaternion.multiply(Mi),this}rotateOnWorldAxis(t,e){return Mi.setFromAxisAngle(t,e),this.quaternion.premultiply(Mi),this}rotateX(t){return this.rotateOnAxis(Li,t)}rotateY(t){return this.rotateOnAxis(Ri,t)}rotateZ(t){return this.rotateOnAxis(Pi,t)}translateOnAxis(t,e){return Si.copy(t).applyQuaternion(this.quaternion),this.position.add(Si.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Li,t)}translateY(t){return this.translateOnAxis(Ri,t)}translateZ(t){return this.translateOnAxis(Pi,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(xi.copy(this.matrixWorld).invert())}lookAt(t,e,i){t.isVector3?yi.copy(t):yi.set(t,e,i);const n=this.parent;this.updateWorldMatrix(!0,!1),Qi.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?xi.lookAt(Qi,yi,this.up):xi.lookAt(yi,Qi,this.up),this.quaternion.setFromRotationMatrix(xi),n&&(xi.extractRotation(n.matrixWorld),Mi.setFromRotationMatrix(xi),this.quaternion.premultiply(Mi.invert()))}add(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(Ui),ki.child=t,this.dispatchEvent(ki),ki.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}const e=this.children.indexOf(t);return-1!==e&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Ni),Fi.child=t,this.dispatchEvent(Fi),Fi.child=null),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),xi.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),xi.multiply(t.parent.matrixWorld)),t.applyMatrix4(xi),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(Ui),ki.child=t,this.dispatchEvent(ki),ki.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(t,e);if(void 0!==n)return n}}getObjectsByProperty(t,e,i=[]){this[t]===e&&i.push(this);const n=this.children;for(let s=0,r=n.length;s<r;s++)n[s].getObjectsByProperty(t,e,i);return i}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qi,t,Ti),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Qi,Di,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const e=this.children;for(let i=0,n=e.length;i<n;i++)e[i].traverseVisible(t)}traverseAncestors(t){const e=this.parent;null!==e&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let i=0,n=e.length;i<n;i++){const n=e[i];!0!==n.matrixWorldAutoUpdate&&!0!==t||n.updateMatrixWorld(t)}}updateWorldMatrix(t,e){const i=this.parent;if(!0===t&&null!==i&&!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===e){const t=this.children;for(let e=0,i=t.length;e<i;e++){const i=t[e];!0===i.matrixWorldAutoUpdate&&i.updateWorldMatrix(!1,!0)}}}toJSON(t){const e=void 0===t||"string"==typeof t,i={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const n={};function s(e,i){return void 0===e[i.uuid]&&(e[i.uuid]=i.toJSON(t)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),n.up=this.up.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(n.type="BatchedMesh",n.perObjectFrustumCulled=this.perObjectFrustumCulled,n.sortObjects=this.sortObjects,n.drawRanges=this._drawRanges,n.reservedRanges=this._reservedRanges,n.visibility=this._visibility,n.active=this._active,n.bounds=this._bounds.map((t=>({boxInitialized:t.boxInitialized,boxMin:t.box.min.toArray(),boxMax:t.box.max.toArray(),sphereInitialized:t.sphereInitialized,sphereRadius:t.sphere.radius,sphereCenter:t.sphere.center.toArray()}))),n.maxGeometryCount=this._maxGeometryCount,n.maxVertexCount=this._maxVertexCount,n.maxIndexCount=this._maxIndexCount,n.geometryInitialized=this._geometryInitialized,n.geometryCount=this._geometryCount,n.matricesTexture=this._matricesTexture.toJSON(t),null!==this.boundingSphere&&(n.boundingSphere={center:n.boundingSphere.center.toArray(),radius:n.boundingSphere.radius}),null!==this.boundingBox&&(n.boundingBox={min:n.boundingBox.min.toArray(),max:n.boundingBox.max.toArray()})),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(n.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(t.geometries,this.geometry);const e=this.geometry.parameters;if(void 0!==e&&void 0!==e.shapes){const i=e.shapes;if(Array.isArray(i))for(let e=0,n=i.length;e<n;e++){const n=i[e];s(t.shapes,n)}else s(t.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(s(t.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const e=[];for(let i=0,n=this.material.length;i<n;i++)e.push(s(t.materials,this.material[i]));n.material=e}else n.material=s(t.materials,this.material);if(this.children.length>0){n.children=[];for(let e=0;e<this.children.length;e++)n.children.push(this.children[e].toJSON(t).object)}if(this.animations.length>0){n.animations=[];for(let e=0;e<this.animations.length;e++){const i=this.animations[e];n.animations.push(s(t.animations,i))}}if(e){const e=r(t.geometries),n=r(t.materials),s=r(t.textures),o=r(t.images),a=r(t.shapes),h=r(t.skeletons),c=r(t.animations),l=r(t.nodes);e.length>0&&(i.geometries=e),n.length>0&&(i.materials=n),s.length>0&&(i.textures=s),o.length>0&&(i.images=o),a.length>0&&(i.shapes=a),h.length>0&&(i.skeletons=h),c.length>0&&(i.animations=c),l.length>0&&(i.nodes=l)}return i.object=n,i;function r(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}}clone(t){return(new this.constructor).copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),!0===e)for(let e=0;e<t.children.length;e++){const i=t.children[e];this.add(i.clone())}return this}}Oi.DEFAULT_UP=new Ne(0,1,0),Oi.DEFAULT_MATRIX_AUTO_UPDATE=!0,Oi.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Gi=new Ne,Hi=new Ne,Vi=new Ne,zi=new Ne,qi=new Ne,Wi=new Ne,ji=new Ne,Ji=new Ne,Yi=new Ne,Ki=new Ne;class Xi{constructor(t=new Ne,e=new Ne,i=new Ne){this.a=t,this.b=e,this.c=i}static getNormal(t,e,i,n){n.subVectors(i,e),Gi.subVectors(t,e),n.cross(Gi);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(t,e,i,n,s){Gi.subVectors(n,e),Hi.subVectors(i,e),Vi.subVectors(t,e);const r=Gi.dot(Gi),o=Gi.dot(Hi),a=Gi.dot(Vi),h=Hi.dot(Hi),c=Hi.dot(Vi),l=r*h-o*o;if(0===l)return s.set(0,0,0),null;const A=1/l,u=(h*a-o*c)*A,d=(r*c-o*a)*A;return s.set(1-u-d,d,u)}static containsPoint(t,e,i,n){return null!==this.getBarycoord(t,e,i,n,zi)&&(zi.x>=0&&zi.y>=0&&zi.x+zi.y<=1)}static getInterpolation(t,e,i,n,s,r,o,a){return null===this.getBarycoord(t,e,i,n,zi)?(a.x=0,a.y=0,"z"in a&&(a.z=0),"w"in a&&(a.w=0),null):(a.setScalar(0),a.addScaledVector(s,zi.x),a.addScaledVector(r,zi.y),a.addScaledVector(o,zi.z),a)}static isFrontFacing(t,e,i,n){return Gi.subVectors(i,e),Hi.subVectors(t,e),Gi.cross(Hi).dot(n)<0}set(t,e,i){return this.a.copy(t),this.b.copy(e),this.c.copy(i),this}setFromPointsAndIndices(t,e,i,n){return this.a.copy(t[e]),this.b.copy(t[i]),this.c.copy(t[n]),this}setFromAttributeAndIndices(t,e,i,n){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,i),this.c.fromBufferAttribute(t,n),this}clone(){return(new this.constructor).copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Gi.subVectors(this.c,this.b),Hi.subVectors(this.a,this.b),.5*Gi.cross(Hi).length()}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Xi.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Xi.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,i,n,s){return Xi.getInterpolation(t,this.a,this.b,this.c,e,i,n,s)}containsPoint(t){return Xi.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Xi.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const i=this.a,n=this.b,s=this.c;let r,o;qi.subVectors(n,i),Wi.subVectors(s,i),Ji.subVectors(t,i);const a=qi.dot(Ji),h=Wi.dot(Ji);if(a<=0&&h<=0)return e.copy(i);Yi.subVectors(t,n);const c=qi.dot(Yi),l=Wi.dot(Yi);if(c>=0&&l<=c)return e.copy(n);const A=a*l-c*h;if(A<=0&&a>=0&&c<=0)return r=a/(a-c),e.copy(i).addScaledVector(qi,r);Ki.subVectors(t,s);const u=qi.dot(Ki),d=Wi.dot(Ki);if(d>=0&&u<=d)return e.copy(s);const f=u*h-a*d;if(f<=0&&h>=0&&d<=0)return o=h/(h-d),e.copy(i).addScaledVector(Wi,o);const g=c*d-u*l;if(g<=0&&l-c>=0&&u-d>=0)return ji.subVectors(s,n),o=(l-c)/(l-c+(u-d)),e.copy(n).addScaledVector(ji,o);const p=1/(g+f+A);return r=f*p,o=A*p,e.copy(i).addScaledVector(qi,r).addScaledVector(Wi,o)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const Zi={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},$i={h:0,s:0,l:0},tn={h:0,s:0,l:0};function en(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+6*(e-t)*(2/3-i):t}class nn{constructor(t,e,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,i)}set(t,e,i){if(void 0===e&&void 0===i){const e=t;e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e)}else this.setRGB(t,e,i);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=Qt){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Ce.toWorkingColorSpace(this,e),this}setRGB(t,e,i,n=Ce.workingColorSpace){return this.r=t,this.g=e,this.b=i,Ce.toWorkingColorSpace(this,n),this}setHSL(t,e,i,n=Ce.workingColorSpace){if(t=se(t,1),e=ne(e,0,1),i=ne(i,0,1),0===e)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+e):i+e-i*e,s=2*i-n;this.r=en(s,n,t+1/3),this.g=en(s,n,t),this.b=en(s,n,t-1/3)}return Ce.toWorkingColorSpace(this,n),this}setStyle(t,e=Qt){function i(e){void 0!==e&&parseFloat(e)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let n;if(n=/^(\w+)\(([^\)]*)\)/.exec(t)){let s;const r=n[1],o=n[2];switch(r){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,e);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,e);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(t)){const i=n[1],s=i.length;if(3===s)return this.setRGB(parseInt(i.charAt(0),16)/15,parseInt(i.charAt(1),16)/15,parseInt(i.charAt(2),16)/15,e);if(6===s)return this.setHex(parseInt(i,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=Qt){const i=Zi[t.toLowerCase()];return void 0!==i?this.setHex(i,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Ie(t.r),this.g=Ie(t.g),this.b=Ie(t.b),this}copyLinearToSRGB(t){return this.r=we(t.r),this.g=we(t.g),this.b=we(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Qt){return Ce.fromWorkingColorSpace(sn.copy(this),t),65536*Math.round(ne(255*sn.r,0,255))+256*Math.round(ne(255*sn.g,0,255))+Math.round(ne(255*sn.b,0,255))}getHexString(t=Qt){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=Ce.workingColorSpace){Ce.fromWorkingColorSpace(sn.copy(this),e);const i=sn.r,n=sn.g,s=sn.b,r=Math.max(i,n,s),o=Math.min(i,n,s);let a,h;const c=(o+r)/2;if(o===r)a=0,h=0;else{const t=r-o;switch(h=c<=.5?t/(r+o):t/(2-r-o),r){case i:a=(n-s)/t+(n<s?6:0);break;case n:a=(s-i)/t+2;break;case s:a=(i-n)/t+4}a/=6}return t.h=a,t.s=h,t.l=c,t}getRGB(t,e=Ce.workingColorSpace){return Ce.fromWorkingColorSpace(sn.copy(this),e),t.r=sn.r,t.g=sn.g,t.b=sn.b,t}getStyle(t=Qt){Ce.fromWorkingColorSpace(sn.copy(this),t);const e=sn.r,i=sn.g,n=sn.b;return t!==Qt?`color(${t} ${e.toFixed(3)} ${i.toFixed(3)} ${n.toFixed(3)})`:`rgb(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*n)})`}offsetHSL(t,e,i){return this.getHSL($i),this.setHSL($i.h+t,$i.s+e,$i.l+i)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,i){return this.r=t.r+(e.r-t.r)*i,this.g=t.g+(e.g-t.g)*i,this.b=t.b+(e.b-t.b)*i,this}lerpHSL(t,e){this.getHSL($i),t.getHSL(tn);const i=re($i.h,tn.h,e),n=re($i.s,tn.s,e),s=re($i.l,tn.l,e);return this.setHSL(i,n,s),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,i=this.g,n=this.b,s=t.elements;return this.r=s[0]*e+s[3]*i+s[6]*n,this.g=s[1]*e+s[4]*i+s[7]*n,this.b=s[2]*e+s[5]*i+s[8]*n,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const sn=new nn;nn.NAMES=Zi;let rn=0;class on extends Xt{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:rn++}),this.uuid=ie(),this.name="",this.type="Material",this.blending=1,this.side=s,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=f,this.blendDst=205,this.blendEquation=a,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new nn(0,0,0),this.blendAlpha=0,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=kt,this.stencilZFail=kt,this.stencilZPass=kt,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(void 0!==t)for(const e in t){const i=t[e];if(void 0===i){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const n=this[e];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[e]=i:console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`)}}toJSON(t){const e=void 0===t||"string"==typeof t;e&&(t={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};function n(t){const e=[];for(const i in t){const n=t[i];delete n.metadata,e.push(n)}return e}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),void 0!==this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.dispersion&&(i.dispersion=this.dispersion),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),void 0!==this.anisotropy&&(i.anisotropy=this.anisotropy),void 0!==this.anisotropyRotation&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(t).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(t).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(t).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(t).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(t).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(t).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapRotation&&(i.envMapRotation=this.envMapRotation.toArray()),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(t).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(t).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(t).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),this.side!==s&&(i.side=this.side),!0===this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=!0),this.blendSrc!==f&&(i.blendSrc=this.blendSrc),205!==this.blendDst&&(i.blendDst=this.blendDst),this.blendEquation!==a&&(i.blendEquation=this.blendEquation),null!==this.blendSrcAlpha&&(i.blendSrcAlpha=this.blendSrcAlpha),null!==this.blendDstAlpha&&(i.blendDstAlpha=this.blendDstAlpha),null!==this.blendEquationAlpha&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),0!==this.blendAlpha&&(i.blendAlpha=this.blendAlpha),3!==this.depthFunc&&(i.depthFunc=this.depthFunc),!1===this.depthTest&&(i.depthTest=this.depthTest),!1===this.depthWrite&&(i.depthWrite=this.depthWrite),!1===this.colorWrite&&(i.colorWrite=this.colorWrite),255!==this.stencilWriteMask&&(i.stencilWriteMask=this.stencilWriteMask),519!==this.stencilFunc&&(i.stencilFunc=this.stencilFunc),0!==this.stencilRef&&(i.stencilRef=this.stencilRef),255!==this.stencilFuncMask&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==kt&&(i.stencilFail=this.stencilFail),this.stencilZFail!==kt&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==kt&&(i.stencilZPass=this.stencilZPass),!0===this.stencilWrite&&(i.stencilWrite=this.stencilWrite),void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaHash&&(i.alphaHash=!0),!0===this.alphaToCoverage&&(i.alphaToCoverage=!0),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=!0),!0===this.forceSinglePass&&(i.forceSinglePass=!0),!0===this.wireframe&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=!0),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData),e){const e=n(t.textures),s=n(t.images);e.length>0&&(i.textures=e),s.length>0&&(i.images=s)}return i}clone(){return(new this.constructor).copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let i=null;if(null!==e){const t=e.length;i=new Array(t);for(let n=0;n!==t;++n)i[n]=e[n].clone()}return this.clippingPlanes=i,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){!0===t&&this.version++}}class an extends on{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new nn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new wi,this.combine=B,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const hn=cn();function cn(){const t=new ArrayBuffer(4),e=new Float32Array(t),i=new Uint32Array(t),n=new Uint32Array(512),s=new Uint32Array(512);for(let t=0;t<256;++t){const e=t-127;e<-27?(n[t]=0,n[256|t]=32768,s[t]=24,s[256|t]=24):e<-14?(n[t]=1024>>-e-14,n[256|t]=1024>>-e-14|32768,s[t]=-e-1,s[256|t]=-e-1):e<=15?(n[t]=e+15<<10,n[256|t]=e+15<<10|32768,s[t]=13,s[256|t]=13):e<128?(n[t]=31744,n[256|t]=64512,s[t]=24,s[256|t]=24):(n[t]=31744,n[256|t]=64512,s[t]=13,s[256|t]=13)}const r=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let t=1;t<1024;++t){let e=t<<13,i=0;for(;!(8388608&e);)e<<=1,i-=8388608;e&=-8388609,i+=947912704,r[t]=e|i}for(let t=1024;t<2048;++t)r[t]=939524096+(t-1024<<13);for(let t=1;t<31;++t)o[t]=t<<23;o[31]=1199570944,o[32]=2147483648;for(let t=33;t<63;++t)o[t]=2147483648+(t-32<<23);o[63]=3347054592;for(let t=1;t<64;++t)32!==t&&(a[t]=1024);return{floatView:e,uint32View:i,baseTable:n,shiftTable:s,mantissaTable:r,exponentTable:o,offsetTable:a}}const ln={toHalfFloat:function(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=ne(t,-65504,65504),hn.floatView[0]=t;const e=hn.uint32View[0],i=e>>23&511;return hn.baseTable[i]+((8388607&e)>>hn.shiftTable[i])},fromHalfFloat:function(t){const e=t>>10;return hn.uint32View[0]=hn.mantissaTable[hn.offsetTable[e]+(1023&t)]+hn.exponentTable[e],hn.floatView[0]}},An=new Ne,un=new ce;class dn{constructor(t,e,i=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=void 0!==t?t.length/e:0,this.normalized=i,this.usage=jt,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=tt,this.version=0}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){return pe("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,i){t*=this.itemSize,i*=e.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[t+n]=e.array[i+n];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(2===this.itemSize)for(let e=0,i=this.count;e<i;e++)un.fromBufferAttribute(this,e),un.applyMatrix3(t),this.setXY(e,un.x,un.y);else if(3===this.itemSize)for(let e=0,i=this.count;e<i;e++)An.fromBufferAttribute(this,e),An.applyMatrix3(t),this.setXYZ(e,An.x,An.y,An.z);return this}applyMatrix4(t){for(let e=0,i=this.count;e<i;e++)An.fromBufferAttribute(this,e),An.applyMatrix4(t),this.setXYZ(e,An.x,An.y,An.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)An.fromBufferAttribute(this,e),An.applyNormalMatrix(t),this.setXYZ(e,An.x,An.y,An.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)An.fromBufferAttribute(this,e),An.transformDirection(t),this.setXYZ(e,An.x,An.y,An.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let i=this.array[t*this.itemSize+e];return this.normalized&&(i=oe(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=ae(i,this.array)),this.array[t*this.itemSize+e]=i,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=oe(e,this.array)),e}setX(t,e){return this.normalized&&(e=ae(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=oe(e,this.array)),e}setY(t,e){return this.normalized&&(e=ae(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=oe(e,this.array)),e}setZ(t,e){return this.normalized&&(e=ae(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=oe(e,this.array)),e}setW(t,e){return this.normalized&&(e=ae(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,i){return t*=this.itemSize,this.normalized&&(e=ae(e,this.array),i=ae(i,this.array)),this.array[t+0]=e,this.array[t+1]=i,this}setXYZ(t,e,i,n){return t*=this.itemSize,this.normalized&&(e=ae(e,this.array),i=ae(i,this.array),n=ae(n,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this}setXYZW(t,e,i,n,s){return t*=this.itemSize,this.normalized&&(e=ae(e,this.array),i=ae(i,this.array),n=ae(n,this.array),s=ae(s,this.array)),this.array[t+0]=e,this.array[t+1]=i,this.array[t+2]=n,this.array[t+3]=s,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(t.name=this.name),this.usage!==jt&&(t.usage=this.usage),t}}class fn extends dn{constructor(t,e,i){super(new Uint16Array(t),e,i)}}class gn extends dn{constructor(t,e,i){super(new Uint32Array(t),e,i)}}class pn extends dn{constructor(t,e,i){super(new Float32Array(t),e,i)}}let mn=0;const vn=new di,bn=new Oi,En=new Ne,Cn=new Oe,In=new Oe,wn=new Ne;class _n extends Xt{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:mn++}),this.uuid=ie(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(ue(t)?gn:fn)(t,1):this.index=t,this}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return void 0!==this.attributes[t]}addGroup(t,e,i=0){this.groups.push({start:t,count:e,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;void 0!==e&&(e.applyMatrix4(t),e.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const e=(new le).getNormalMatrix(t);i.applyNormalMatrix(e),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(t),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(t){return vn.makeRotationFromQuaternion(t),this.applyMatrix4(vn),this}rotateX(t){return vn.makeRotationX(t),this.applyMatrix4(vn),this}rotateY(t){return vn.makeRotationY(t),this.applyMatrix4(vn),this}rotateZ(t){return vn.makeRotationZ(t),this.applyMatrix4(vn),this}translate(t,e,i){return vn.makeTranslation(t,e,i),this.applyMatrix4(vn),this}scale(t,e,i){return vn.makeScale(t,e,i),this.applyMatrix4(vn),this}lookAt(t){return bn.lookAt(t),bn.updateMatrix(),this.applyMatrix4(bn.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(En).negate(),this.translate(En.x,En.y,En.z),this}setFromPoints(t){const e=[];for(let i=0,n=t.length;i<n;i++){const n=t[i];e.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new pn(e,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Oe);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),void this.boundingBox.set(new Ne(-1/0,-1/0,-1/0),new Ne(1/0,1/0,1/0));if(void 0!==t){if(this.boundingBox.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];Cn.setFromBufferAttribute(i),this.morphTargetsRelative?(wn.addVectors(this.boundingBox.min,Cn.min),this.boundingBox.expandByPoint(wn),wn.addVectors(this.boundingBox.max,Cn.max),this.boundingBox.expandByPoint(wn)):(this.boundingBox.expandByPoint(Cn.min),this.boundingBox.expandByPoint(Cn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new si);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute)return console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),void this.boundingSphere.set(new Ne,1/0);if(t){const i=this.boundingSphere.center;if(Cn.setFromBufferAttribute(t),e)for(let t=0,i=e.length;t<i;t++){const i=e[t];In.setFromBufferAttribute(i),this.morphTargetsRelative?(wn.addVectors(Cn.min,In.min),Cn.expandByPoint(wn),wn.addVectors(Cn.max,In.max),Cn.expandByPoint(wn)):(Cn.expandByPoint(In.min),Cn.expandByPoint(In.max))}Cn.getCenter(i);let n=0;for(let e=0,s=t.count;e<s;e++)wn.fromBufferAttribute(t,e),n=Math.max(n,i.distanceToSquared(wn));if(e)for(let s=0,r=e.length;s<r;s++){const r=e[s],o=this.morphTargetsRelative;for(let e=0,s=r.count;e<s;e++)wn.fromBufferAttribute(r,e),o&&(En.fromBufferAttribute(t,e),wn.add(En)),n=Math.max(n,i.distanceToSquared(wn))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(null===t||void 0===e.position||void 0===e.normal||void 0===e.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.position,n=e.normal,s=e.uv;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new dn(new Float32Array(4*i.count),4));const r=this.getAttribute("tangent"),o=[],a=[];for(let t=0;t<i.count;t++)o[t]=new Ne,a[t]=new Ne;const h=new Ne,c=new Ne,l=new Ne,A=new ce,u=new ce,d=new ce,f=new Ne,g=new Ne;function p(t,e,n){h.fromBufferAttribute(i,t),c.fromBufferAttribute(i,e),l.fromBufferAttribute(i,n),A.fromBufferAttribute(s,t),u.fromBufferAttribute(s,e),d.fromBufferAttribute(s,n),c.sub(h),l.sub(h),u.sub(A),d.sub(A);const r=1/(u.x*d.y-d.x*u.y);isFinite(r)&&(f.copy(c).multiplyScalar(d.y).addScaledVector(l,-u.y).multiplyScalar(r),g.copy(l).multiplyScalar(u.x).addScaledVector(c,-d.x).multiplyScalar(r),o[t].add(f),o[e].add(f),o[n].add(f),a[t].add(g),a[e].add(g),a[n].add(g))}let m=this.groups;0===m.length&&(m=[{start:0,count:t.count}]);for(let e=0,i=m.length;e<i;++e){const i=m[e],n=i.start;for(let e=n,s=n+i.count;e<s;e+=3)p(t.getX(e+0),t.getX(e+1),t.getX(e+2))}const v=new Ne,b=new Ne,E=new Ne,C=new Ne;function I(t){E.fromBufferAttribute(n,t),C.copy(E);const e=o[t];v.copy(e),v.sub(E.multiplyScalar(E.dot(e))).normalize(),b.crossVectors(C,e);const i=b.dot(a[t])<0?-1:1;r.setXYZW(t,v.x,v.y,v.z,i)}for(let e=0,i=m.length;e<i;++e){const i=m[e],n=i.start;for(let e=n,s=n+i.count;e<s;e+=3)I(t.getX(e+0)),I(t.getX(e+1)),I(t.getX(e+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(void 0!==e){let i=this.getAttribute("normal");if(void 0===i)i=new dn(new Float32Array(3*e.count),3),this.setAttribute("normal",i);else for(let t=0,e=i.count;t<e;t++)i.setXYZ(t,0,0,0);const n=new Ne,s=new Ne,r=new Ne,o=new Ne,a=new Ne,h=new Ne,c=new Ne,l=new Ne;if(t)for(let A=0,u=t.count;A<u;A+=3){const u=t.getX(A+0),d=t.getX(A+1),f=t.getX(A+2);n.fromBufferAttribute(e,u),s.fromBufferAttribute(e,d),r.fromBufferAttribute(e,f),c.subVectors(r,s),l.subVectors(n,s),c.cross(l),o.fromBufferAttribute(i,u),a.fromBufferAttribute(i,d),h.fromBufferAttribute(i,f),o.add(c),a.add(c),h.add(c),i.setXYZ(u,o.x,o.y,o.z),i.setXYZ(d,a.x,a.y,a.z),i.setXYZ(f,h.x,h.y,h.z)}else for(let t=0,o=e.count;t<o;t+=3)n.fromBufferAttribute(e,t+0),s.fromBufferAttribute(e,t+1),r.fromBufferAttribute(e,t+2),c.subVectors(r,s),l.subVectors(n,s),c.cross(l),i.setXYZ(t+0,c.x,c.y,c.z),i.setXYZ(t+1,c.x,c.y,c.z),i.setXYZ(t+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,i=t.count;e<i;e++)wn.fromBufferAttribute(t,e),wn.normalize(),t.setXYZ(e,wn.x,wn.y,wn.z)}toNonIndexed(){function t(t,e){const i=t.array,n=t.itemSize,s=t.normalized,r=new i.constructor(e.length*n);let o=0,a=0;for(let s=0,h=e.length;s<h;s++){o=t.isInterleavedBufferAttribute?e[s]*t.data.stride+t.offset:e[s]*n;for(let t=0;t<n;t++)r[a++]=i[o++]}return new dn(r,n,s)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new _n,i=this.index.array,n=this.attributes;for(const s in n){const r=t(n[s],i);e.setAttribute(s,r)}const s=this.morphAttributes;for(const n in s){const r=[],o=s[n];for(let e=0,n=o.length;e<n;e++){const n=t(o[e],i);r.push(n)}e.morphAttributes[n]=r}e.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let t=0,i=r.length;t<i;t++){const i=r[t];e.addGroup(i.start,i.count,i.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,""!==this.name&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),void 0!==this.parameters){const e=this.parameters;for(const i in e)void 0!==e[i]&&(t[i]=e[i]);return t}t.data={attributes:{}};const e=this.index;null!==e&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const i=this.attributes;for(const e in i){const n=i[e];t.data.attributes[e]=n.toJSON(t.data)}const n={};let s=!1;for(const e in this.morphAttributes){const i=this.morphAttributes[e],r=[];for(let e=0,n=i.length;e<n;e++){const n=i[e];r.push(n.toJSON(t.data))}r.length>0&&(n[e]=r,s=!0)}s&&(t.data.morphAttributes=n,t.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(t.data.groups=JSON.parse(JSON.stringify(r)));const o=this.boundingSphere;return null!==o&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return(new this.constructor).copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const i=t.index;null!==i&&this.setIndex(i.clone(e));const n=t.attributes;for(const t in n){const i=n[t];this.setAttribute(t,i.clone(e))}const s=t.morphAttributes;for(const t in s){const i=[],n=s[t];for(let t=0,s=n.length;t<s;t++)i.push(n[t].clone(e));this.morphAttributes[t]=i}this.morphTargetsRelative=t.morphTargetsRelative;const r=t.groups;for(let t=0,e=r.length;t<e;t++){const e=r[t];this.addGroup(e.start,e.count,e.materialIndex)}const o=t.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=t.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Bn=new di,Sn=new ui,Mn=new si,xn=new Ne,yn=new Ne,Qn=new Ne,Tn=new Ne,Dn=new Ne,Ln=new Ne,Rn=new ce,Pn=new ce,Un=new ce,Nn=new Ne,kn=new Ne,Fn=new Ne,On=new Ne,Gn=new Ne;class Hn extends Oi{constructor(t=new _n,e=new an){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),void 0!==t.morphTargetInfluences&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),void 0!==t.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}getVertexPosition(t,e){const i=this.geometry,n=i.attributes.position,s=i.morphAttributes.position,r=i.morphTargetsRelative;e.fromBufferAttribute(n,t);const o=this.morphTargetInfluences;if(s&&o){Ln.set(0,0,0);for(let i=0,n=s.length;i<n;i++){const n=o[i],a=s[i];0!==n&&(Dn.fromBufferAttribute(a,t),r?Ln.addScaledVector(Dn,n):Ln.addScaledVector(Dn.sub(e),n))}e.add(Ln)}return e}raycast(t,e){const i=this.geometry,n=this.material,s=this.matrixWorld;if(void 0!==n){if(null===i.boundingSphere&&i.computeBoundingSphere(),Mn.copy(i.boundingSphere),Mn.applyMatrix4(s),Sn.copy(t.ray).recast(t.near),!1===Mn.containsPoint(Sn.origin)){if(null===Sn.intersectSphere(Mn,xn))return;if(Sn.origin.distanceToSquared(xn)>(t.far-t.near)**2)return}Bn.copy(s).invert(),Sn.copy(t.ray).applyMatrix4(Bn),null!==i.boundingBox&&!1===Sn.intersectsBox(i.boundingBox)||this._computeIntersections(t,e,Sn)}}_computeIntersections(t,e,i){let n;const s=this.geometry,r=this.material,o=s.index,a=s.attributes.position,h=s.attributes.uv,c=s.attributes.uv1,l=s.attributes.normal,A=s.groups,u=s.drawRange;if(null!==o)if(Array.isArray(r))for(let s=0,a=A.length;s<a;s++){const a=A[s],d=r[a.materialIndex];for(let s=Math.max(a.start,u.start),r=Math.min(o.count,Math.min(a.start+a.count,u.start+u.count));s<r;s+=3){n=Vn(this,d,t,i,h,c,l,o.getX(s),o.getX(s+1),o.getX(s+2)),n&&(n.faceIndex=Math.floor(s/3),n.face.materialIndex=a.materialIndex,e.push(n))}}else{for(let s=Math.max(0,u.start),a=Math.min(o.count,u.start+u.count);s<a;s+=3){n=Vn(this,r,t,i,h,c,l,o.getX(s),o.getX(s+1),o.getX(s+2)),n&&(n.faceIndex=Math.floor(s/3),e.push(n))}}else if(void 0!==a)if(Array.isArray(r))for(let s=0,o=A.length;s<o;s++){const o=A[s],d=r[o.materialIndex];for(let s=Math.max(o.start,u.start),r=Math.min(a.count,Math.min(o.start+o.count,u.start+u.count));s<r;s+=3){n=Vn(this,d,t,i,h,c,l,s,s+1,s+2),n&&(n.faceIndex=Math.floor(s/3),n.face.materialIndex=o.materialIndex,e.push(n))}}else{for(let s=Math.max(0,u.start),o=Math.min(a.count,u.start+u.count);s<o;s+=3){n=Vn(this,r,t,i,h,c,l,s,s+1,s+2),n&&(n.faceIndex=Math.floor(s/3),e.push(n))}}}}function Vn(t,e,i,n,o,a,h,c,l,A){t.getVertexPosition(c,yn),t.getVertexPosition(l,Qn),t.getVertexPosition(A,Tn);const u=function(t,e,i,n,o,a,h,c){let l;if(l=e.side===r?n.intersectTriangle(h,a,o,!0,c):n.intersectTriangle(o,a,h,e.side===s,c),null===l)return null;Gn.copy(c),Gn.applyMatrix4(t.matrixWorld);const A=i.ray.origin.distanceTo(Gn);return A<i.near||A>i.far?null:{distance:A,point:Gn.clone(),object:t}}(t,e,i,n,yn,Qn,Tn,On);if(u){o&&(Rn.fromBufferAttribute(o,c),Pn.fromBufferAttribute(o,l),Un.fromBufferAttribute(o,A),u.uv=Xi.getInterpolation(On,yn,Qn,Tn,Rn,Pn,Un,new ce)),a&&(Rn.fromBufferAttribute(a,c),Pn.fromBufferAttribute(a,l),Un.fromBufferAttribute(a,A),u.uv1=Xi.getInterpolation(On,yn,Qn,Tn,Rn,Pn,Un,new ce)),h&&(Nn.fromBufferAttribute(h,c),kn.fromBufferAttribute(h,l),Fn.fromBufferAttribute(h,A),u.normal=Xi.getInterpolation(On,yn,Qn,Tn,Nn,kn,Fn,new Ne),u.normal.dot(n.direction)>0&&u.normal.multiplyScalar(-1));const t={a:c,b:l,c:A,normal:new Ne,materialIndex:0};Xi.getNormal(yn,Qn,Tn,t.normal),u.face=t}return u}class zn extends _n{constructor(t=1,e=1,i=1,n=1,s=1,r=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:i,widthSegments:n,heightSegments:s,depthSegments:r};const o=this;n=Math.floor(n),s=Math.floor(s),r=Math.floor(r);const a=[],h=[],c=[],l=[];let A=0,u=0;function d(t,e,i,n,s,r,d,f,g,p,m){const v=r/g,b=d/p,E=r/2,C=d/2,I=f/2,w=g+1,_=p+1;let B=0,S=0;const M=new Ne;for(let r=0;r<_;r++){const o=r*b-C;for(let a=0;a<w;a++){const A=a*v-E;M[t]=A*n,M[e]=o*s,M[i]=I,h.push(M.x,M.y,M.z),M[t]=0,M[e]=0,M[i]=f>0?1:-1,c.push(M.x,M.y,M.z),l.push(a/g),l.push(1-r/p),B+=1}}for(let t=0;t<p;t++)for(let e=0;e<g;e++){const i=A+e+w*t,n=A+e+w*(t+1),s=A+(e+1)+w*(t+1),r=A+(e+1)+w*t;a.push(i,n,r),a.push(n,s,r),S+=6}o.addGroup(u,S,m),u+=S,A+=B}d("z","y","x",-1,-1,i,e,t,r,s,0),d("z","y","x",1,-1,i,e,-t,r,s,1),d("x","z","y",1,1,t,i,e,n,r,2),d("x","z","y",1,-1,t,i,-e,n,r,3),d("x","y","z",1,-1,t,e,i,n,s,4),d("x","y","z",-1,-1,t,e,-i,n,s,5),this.setIndex(a),this.setAttribute("position",new pn(h,3)),this.setAttribute("normal",new pn(c,3)),this.setAttribute("uv",new pn(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new zn(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function qn(t){const e={};for(const i in t){e[i]={};for(const n in t[i]){const s=t[i][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[i][n]=null):e[i][n]=s.clone():Array.isArray(s)?e[i][n]=s.slice():e[i][n]=s}}return e}function Wn(t){const e={};for(let i=0;i<t.length;i++){const n=qn(t[i]);for(const t in n)e[t]=n[t]}return e}function jn(t){const e=t.getRenderTarget();return null===e?t.outputColorSpace:!0===e.isXRRenderTarget?e.texture.colorSpace:Ce.workingColorSpace}const Jn={clone:qn,merge:Wn};class Yn extends on{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==t&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=qn(t.uniforms),this.uniformsGroups=function(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].clone());return e}(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?e.uniforms[i]={type:"t",value:n.toJSON(t).uuid}:n&&n.isColor?e.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?e.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?e.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?e.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?e.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?e.uniforms[i]={type:"m4",value:n.toArray()}:e.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const i={};for(const t in this.extensions)!0===this.extensions[t]&&(i[t]=!0);return Object.keys(i).length>0&&(e.extensions=i),e}}class Kn extends Oi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new di,this.projectionMatrix=new di,this.projectionMatrixInverse=new di,this.coordinateSystem=Yt}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}const Xn=new Ne,Zn=new ce,$n=new ce;class ts extends Kn{constructor(t=50,e=1,i=.1,n=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=null===t.view?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=2*ee*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(.5*te*this.fov);return.5*this.getFilmHeight()/t}getEffectiveFOV(){return 2*ee*Math.atan(Math.tan(.5*te*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,i){Xn.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Xn.x,Xn.y).multiplyScalar(-t/Xn.z),Xn.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Xn.x,Xn.y).multiplyScalar(-t/Xn.z)}getViewSize(t,e){return this.getViewBounds(t,Zn,$n),e.subVectors($n,Zn)}setViewOffset(t,e,i,n,s,r){this.aspect=t/e,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(.5*te*this.fov)/this.zoom,i=2*e,n=this.aspect*i,s=-.5*n;const r=this.view;if(null!==this.view&&this.view.enabled){const t=r.fullWidth,o=r.fullHeight;s+=r.offsetX*n/t,e-=r.offsetY*i/o,n*=r.width/t,i*=r.height/o}const o=this.filmOffset;0!==o&&(s+=t*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,e,e-i,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,null!==this.view&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const es=-90;class is extends Oi{constructor(t,e,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const n=new ts(es,1,t,e);n.layers=this.layers,this.add(n);const s=new ts(es,1,t,e);s.layers=this.layers,this.add(s);const r=new ts(es,1,t,e);r.layers=this.layers,this.add(r);const o=new ts(es,1,t,e);o.layers=this.layers,this.add(o);const a=new ts(es,1,t,e);a.layers=this.layers,this.add(a);const h=new ts(es,1,t,e);h.layers=this.layers,this.add(h)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[i,n,s,r,o,a]=e;for(const t of e)this.remove(t);if(t===Yt)i.up.set(0,1,0),i.lookAt(1,0,0),n.up.set(0,1,0),n.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),r.up.set(0,0,1),r.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),a.up.set(0,1,0),a.lookAt(0,0,-1);else{if(t!==Kt)throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);i.up.set(0,-1,0),i.lookAt(-1,0,0),n.up.set(0,-1,0),n.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),r.up.set(0,0,-1),r.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),a.up.set(0,-1,0),a.lookAt(0,0,-1)}for(const t of e)this.add(t),t.updateMatrixWorld()}update(t,e){null===this.parent&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:n}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[s,r,o,a,h,c]=this.children,l=t.getRenderTarget(),A=t.getActiveCubeFace(),u=t.getActiveMipmapLevel(),d=t.xr.enabled;t.xr.enabled=!1;const f=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,t.setRenderTarget(i,0,n),t.render(e,s),t.setRenderTarget(i,1,n),t.render(e,r),t.setRenderTarget(i,2,n),t.render(e,o),t.setRenderTarget(i,3,n),t.render(e,a),t.setRenderTarget(i,4,n),t.render(e,h),i.texture.generateMipmaps=f,t.setRenderTarget(i,5,n),t.render(e,c),t.setRenderTarget(l,A,u),t.xr.enabled=d,i.texture.needsPMREMUpdate=!0}}class ns extends Qe{constructor(t,e,i,n,s,r,o,a,h,c){super(t=void 0!==t?t:[],e=void 0!==e?e:N,i,n,s,r,o,a,h,c),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class ss extends Le{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const i={width:t,height:t,depth:1},n=[i,i,i,i,i,i];this.texture=new ns(n,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==e.generateMipmaps&&e.generateMipmaps,this.texture.minFilter=void 0!==e.minFilter?e.minFilter:j}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new zn(5,5,5),s=new Yn({name:"CubemapFromEquirect",uniforms:qn(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:r,blending:0});s.uniforms.tEquirect.value=e;const o=new Hn(n,s),a=e.minFilter;e.minFilter===Y&&(e.minFilter=j);return new is(1,10,this).update(t,o),e.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(t,e,i,n){const s=t.getRenderTarget();for(let s=0;s<6;s++)t.setRenderTarget(this,s),t.clear(e,i,n);t.setRenderTarget(s)}}const rs=new Ne,os=new Ne,as=new le;class hs{constructor(t=new Ne(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,i,n){return this.normal.set(t,e,i),this.constant=n,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,i){const n=rs.subVectors(i,e).cross(os.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(n,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const i=t.delta(rs),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(t.start)?e.copy(t.start):null;const s=-(t.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:e.copy(t.start).addScaledVector(i,s)}intersectsLine(t){const e=this.distanceToPoint(t.start),i=this.distanceToPoint(t.end);return e<0&&i>0||i<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const i=e||as.getNormalMatrix(t),n=this.coplanarPoint(rs).applyMatrix4(t),s=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(s),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const cs=new si,ls=new Ne;class As{constructor(t=new hs,e=new hs,i=new hs,n=new hs,s=new hs,r=new hs){this.planes=[t,e,i,n,s,r]}set(t,e,i,n,s,r){const o=this.planes;return o[0].copy(t),o[1].copy(e),o[2].copy(i),o[3].copy(n),o[4].copy(s),o[5].copy(r),this}copy(t){const e=this.planes;for(let i=0;i<6;i++)e[i].copy(t.planes[i]);return this}setFromProjectionMatrix(t,e=2e3){const i=this.planes,n=t.elements,s=n[0],r=n[1],o=n[2],a=n[3],h=n[4],c=n[5],l=n[6],A=n[7],u=n[8],d=n[9],f=n[10],g=n[11],p=n[12],m=n[13],v=n[14],b=n[15];if(i[0].setComponents(a-s,A-h,g-u,b-p).normalize(),i[1].setComponents(a+s,A+h,g+u,b+p).normalize(),i[2].setComponents(a+r,A+c,g+d,b+m).normalize(),i[3].setComponents(a-r,A-c,g-d,b-m).normalize(),i[4].setComponents(a-o,A-l,g-f,b-v).normalize(),e===Yt)i[5].setComponents(a+o,A+l,g+f,b+v).normalize();else{if(e!==Kt)throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);i[5].setComponents(o,l,f,v).normalize()}return this}intersectsObject(t){if(void 0!==t.boundingSphere)null===t.boundingSphere&&t.computeBoundingSphere(),cs.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;null===e.boundingSphere&&e.computeBoundingSphere(),cs.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(cs)}intersectsSprite(t){return cs.center.set(0,0,0),cs.radius=.7071067811865476,cs.applyMatrix4(t.matrixWorld),this.intersectsSphere(cs)}intersectsSphere(t){const e=this.planes,i=t.center,n=-t.radius;for(let t=0;t<6;t++){if(e[t].distanceToPoint(i)<n)return!1}return!0}intersectsBox(t){const e=this.planes;for(let i=0;i<6;i++){const n=e[i];if(ls.x=n.normal.x>0?t.max.x:t.min.x,ls.y=n.normal.y>0?t.max.y:t.min.y,ls.z=n.normal.z>0?t.max.z:t.min.z,n.distanceToPoint(ls)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let i=0;i<6;i++)if(e[i].distanceToPoint(t)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function us(){let t=null,e=!1,i=null,n=null;function s(e,r){i(e,r),n=t.requestAnimationFrame(s)}return{start:function(){!0!==e&&null!==i&&(n=t.requestAnimationFrame(s),e=!0)},stop:function(){t.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(t){i=t},setContext:function(e){t=e}}}function ds(t){const e=new WeakMap;return{get:function(t){return t.isInterleavedBufferAttribute&&(t=t.data),e.get(t)},remove:function(i){i.isInterleavedBufferAttribute&&(i=i.data);const n=e.get(i);n&&(t.deleteBuffer(n.buffer),e.delete(i))},update:function(i,n){if(i.isGLBufferAttribute){const t=e.get(i);return void((!t||t.version<i.version)&&e.set(i,{buffer:i.buffer,type:i.type,bytesPerElement:i.elementSize,version:i.version}))}i.isInterleavedBufferAttribute&&(i=i.data);const s=e.get(i);if(void 0===s)e.set(i,function(e,i){const n=e.array,s=e.usage,r=n.byteLength,o=t.createBuffer();let a;if(t.bindBuffer(i,o),t.bufferData(i,n,s),e.onUploadCallback(),n instanceof Float32Array)a=t.FLOAT;else if(n instanceof Uint16Array)a=e.isFloat16BufferAttribute?t.HALF_FLOAT:t.UNSIGNED_SHORT;else if(n instanceof Int16Array)a=t.SHORT;else if(n instanceof Uint32Array)a=t.UNSIGNED_INT;else if(n instanceof Int32Array)a=t.INT;else if(n instanceof Int8Array)a=t.BYTE;else if(n instanceof Uint8Array)a=t.UNSIGNED_BYTE;else{if(!(n instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+n);a=t.UNSIGNED_BYTE}return{buffer:o,type:a,bytesPerElement:n.BYTES_PER_ELEMENT,version:e.version,size:r}}(i,n));else if(s.version<i.version){if(s.size!==i.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");!function(e,i,n){const s=i.array,r=i._updateRange,o=i.updateRanges;if(t.bindBuffer(n,e),-1===r.count&&0===o.length&&t.bufferSubData(n,0,s),0!==o.length){for(let e=0,i=o.length;e<i;e++){const i=o[e];t.bufferSubData(n,i.start*s.BYTES_PER_ELEMENT,s,i.start,i.count)}i.clearUpdateRanges()}-1!==r.count&&(t.bufferSubData(n,r.offset*s.BYTES_PER_ELEMENT,s,r.offset,r.count),r.count=-1),i.onUploadCallback()}(s.buffer,i,n),s.version=i.version}}}}class fs extends _n{constructor(t=1,e=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:i,heightSegments:n};const s=t/2,r=e/2,o=Math.floor(i),a=Math.floor(n),h=o+1,c=a+1,l=t/o,A=e/a,u=[],d=[],f=[],g=[];for(let t=0;t<c;t++){const e=t*A-r;for(let i=0;i<h;i++){const n=i*l-s;d.push(n,-e,0),f.push(0,0,1),g.push(i/o),g.push(1-t/a)}}for(let t=0;t<a;t++)for(let e=0;e<o;e++){const i=e+h*t,n=e+h*(t+1),s=e+1+h*(t+1),r=e+1+h*t;u.push(i,n,r),u.push(n,s,r)}this.setIndex(u),this.setAttribute("position",new pn(d,3)),this.setAttribute("normal",new pn(f,3)),this.setAttribute("uv",new pn(g,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new fs(t.width,t.height,t.widthSegments,t.heightSegments)}}const gs={alphahash_fragment:"#ifdef USE_ALPHAHASH\n\tif ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;\n#endif",alphahash_pars_fragment:"#ifdef USE_ALPHAHASH\n\tconst float ALPHA_HASH_SCALE = 0.05;\n\tfloat hash2D( vec2 value ) {\n\t\treturn fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );\n\t}\n\tfloat hash3D( vec3 value ) {\n\t\treturn hash2D( vec2( hash2D( value.xy ), value.z ) );\n\t}\n\tfloat getAlphaHashThreshold( vec3 position ) {\n\t\tfloat maxDeriv = max(\n\t\t\tlength( dFdx( position.xyz ) ),\n\t\t\tlength( dFdy( position.xyz ) )\n\t\t);\n\t\tfloat pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );\n\t\tvec2 pixScales = vec2(\n\t\t\texp2( floor( log2( pixScale ) ) ),\n\t\t\texp2( ceil( log2( pixScale ) ) )\n\t\t);\n\t\tvec2 alpha = vec2(\n\t\t\thash3D( floor( pixScales.x * position.xyz ) ),\n\t\t\thash3D( floor( pixScales.y * position.xyz ) )\n\t\t);\n\t\tfloat lerpFactor = fract( log2( pixScale ) );\n\t\tfloat x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;\n\t\tfloat a = min( lerpFactor, 1.0 - lerpFactor );\n\t\tvec3 cases = vec3(\n\t\t\tx * x / ( 2.0 * a * ( 1.0 - a ) ),\n\t\t\t( x - 0.5 * a ) / ( 1.0 - a ),\n\t\t\t1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )\n\t\t);\n\t\tfloat threshold = ( x < ( 1.0 - a ) )\n\t\t\t? ( ( x < a ) ? cases.x : cases.y )\n\t\t\t: cases.z;\n\t\treturn clamp( threshold , 1.0e-6, 1.0 );\n\t}\n#endif",alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\t#ifdef ALPHA_TO_COVERAGE\n\tdiffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );\n\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\tif ( diffuseColor.a < alphaTest ) discard;\n\t#endif\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_CLEARCOAT ) \n\t\tclearcoatSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_SHEEN ) \n\t\tsheenSpecularIndirect *= ambientOcclusion;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometryNormal, geometryViewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",batching_pars_vertex:"#ifdef USE_BATCHING\n\tattribute float batchId;\n\tuniform highp sampler2D batchingTexture;\n\tmat4 getBatchingMatrix( const in float i ) {\n\t\tint size = textureSize( batchingTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",batching_vertex:"#ifdef USE_BATCHING\n\tmat4 batchingMatrix = getBatchingMatrix( batchId );\n#endif",begin_vertex:"vec3 transformed = vec3( position );\n#ifdef USE_ALPHAHASH\n\tvPosition = vec3( position );\n#endif",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"float G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n} // validated",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\treturn vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vBumpMapUv );\n\t\tvec2 dSTdy = dFdy( vBumpMapUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );\n\t\tvec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#ifdef ALPHA_TO_COVERAGE\n\t\tfloat distanceToPlane, distanceGradient;\n\t\tfloat clipOpacity = 1.0;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\tclipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\tif ( clipOpacity == 0.0 ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tfloat unionClipOpacity = 1.0;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tdistanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;\n\t\t\t\tdistanceGradient = fwidth( distanceToPlane ) / 2.0;\n\t\t\t\tunionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tclipOpacity *= 1.0 - unionClipOpacity;\n\t\t#endif\n\t\tdiffuseColor.a *= clipOpacity;\n\t\tif ( diffuseColor.a == 0.0 ) discard;\n\t#else\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\t\tbool clipped = true;\n\t\t\t#pragma unroll_loop_start\n\t\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\t\tplane = clippingPlanes[ i ];\n\t\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t\t}\n\t\t\t#pragma unroll_loop_end\n\t\t\tif ( clipped ) discard;\n\t\t#endif\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\n#ifdef USE_ALPHAHASH\n\tvarying vec3 vPosition;\n#endif\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}\nvec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n} // validated",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\thighp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = objectTangent;\n#endif\n#ifdef USE_BATCHING\n\tmat3 bm = mat3( batchingMatrix );\n\ttransformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );\n\ttransformedNormal = bm * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = bm * transformedTangent;\n\t#endif\n#endif\n#ifdef USE_INSTANCING\n\tmat3 im = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );\n\ttransformedNormal = im * transformedNormal;\n\t#ifdef USE_TANGENT\n\t\ttransformedTangent = im * transformedTangent;\n\t#endif\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\ttransformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",colorspace_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",colorspace_pars_fragment:"\nconst mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(\n\tvec3( 0.8224621, 0.177538, 0.0 ),\n\tvec3( 0.0331941, 0.9668058, 0.0 ),\n\tvec3( 0.0170827, 0.0723974, 0.9105199 )\n);\nconst mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.2249401, - 0.2249404, 0.0 ),\n\tvec3( - 0.0420569, 1.0420571, 0.0 ),\n\tvec3( - 0.0196376, - 0.0786361, 1.0982735 )\n);\nvec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );\n}\nvec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {\n\treturn vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );\n}\nvec4 LinearTransferOETF( in vec4 value ) {\n\treturn value;\n}\nvec4 sRGBTransferOETF( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn sRGBTransferOETF( value );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform mat3 envMapRotation;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#ifdef USE_ENVMAP\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\t#ifdef USE_ANISOTROPY\n\t\tvec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {\n\t\t\t#ifdef ENVMAP_TYPE_CUBE_UV\n\t\t\t\tvec3 bentNormal = cross( bitangent, viewDir );\n\t\t\t\tbentNormal = normalize( cross( bentNormal, bitangent ) );\n\t\t\t\tbentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );\n\t\t\t\treturn getIBLRadiance( viewDir, bentNormal, roughness );\n\t\t\t#else\n\t\t\t\treturn vec3( 0.0 );\n\t\t\t#endif\n\t\t}\n\t#endif\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\n#if defined( USE_LIGHT_PROBES )\n\tuniform vec3 lightProbe[ 9 ];\n#endif\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( LEGACY_LIGHTS )\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#else\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometryPosition;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef USE_SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULAR_COLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;\n\t\t#endif\n\t\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_DISPERSION\n\tmaterial.dispersion = dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\t#ifdef USE_ANISOTROPYMAP\n\t\tmat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );\n\t\tvec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;\n\t\tvec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;\n\t#else\n\t\tvec2 anisotropyV = anisotropyVector;\n\t#endif\n\tmaterial.anisotropy = length( anisotropyV );\n\tif( material.anisotropy == 0.0 ) {\n\t\tanisotropyV = vec2( 1.0, 0.0 );\n\t} else {\n\t\tanisotropyV /= material.anisotropy;\n\t\tmaterial.anisotropy = saturate( material.anisotropy );\n\t}\n\tmaterial.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );\n\tmaterial.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;\n\tmaterial.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\tfloat dispersion;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat anisotropy;\n\t\tfloat alphaT;\n\t\tvec3 anisotropyT;\n\t\tvec3 anisotropyB;\n\t#endif\n};\nvec3 clearcoatSpecularDirect = vec3( 0.0 );\nvec3 clearcoatSpecularIndirect = vec3( 0.0 );\nvec3 sheenSpecularDirect = vec3( 0.0 );\nvec3 sheenSpecularIndirect = vec3(0.0 );\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\n#ifdef USE_ANISOTROPY\n\tfloat V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {\n\t\tfloat gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );\n\t\tfloat gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );\n\t\tfloat v = 0.5 / ( gv + gl );\n\t\treturn saturate(v);\n\t}\n\tfloat D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {\n\t\tfloat a2 = alphaT * alphaB;\n\t\thighp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );\n\t\thighp float v2 = dot( v, v );\n\t\tfloat w2 = a2 / v2;\n\t\treturn RECIPROCAL_PI * a2 * pow2 ( w2 );\n\t}\n#endif\n#ifdef USE_CLEARCOAT\n\tvec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {\n\t\tvec3 f0 = material.clearcoatF0;\n\t\tfloat f90 = material.clearcoatF90;\n\t\tfloat roughness = material.clearcoatRoughness;\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {\n\tvec3 f0 = material.specularColor;\n\tfloat f90 = material.specularF90;\n\tfloat roughness = material.roughness;\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\t#ifdef USE_IRIDESCENCE\n\t\tF = mix( F, material.iridescenceFresnel, material.iridescence );\n\t#endif\n\t#ifdef USE_ANISOTROPY\n\t\tfloat dotTL = dot( material.anisotropyT, lightDir );\n\t\tfloat dotTV = dot( material.anisotropyT, viewDir );\n\t\tfloat dotTH = dot( material.anisotropyT, halfDir );\n\t\tfloat dotBL = dot( material.anisotropyB, lightDir );\n\t\tfloat dotBV = dot( material.anisotropyB, viewDir );\n\t\tfloat dotBH = dot( material.anisotropyB, halfDir );\n\t\tfloat V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );\n\t\tfloat D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );\n\t#else\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t#endif\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometryNormal;\n\t\tvec3 viewDir = geometryViewDir;\n\t\tvec3 position = geometryPosition;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometryNormal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nvec3 geometryPosition = - vViewPosition;\nvec3 geometryNormal = normal;\nvec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\nvec3 geometryClearcoatNormal = vec3( 0.0 );\n#ifdef USE_CLEARCOAT\n\tgeometryClearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometryViewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometryPosition, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometryPosition, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#if defined( USE_LIGHT_PROBES )\n\t\tirradiance += getLightProbeIrradiance( lightProbe, geometryNormal );\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometryNormal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\t#ifdef USE_ANISOTROPY\n\t\tradiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );\n\t#else\n\t\tradiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tgl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\tvFragDepth = 1.0 + gl_Position.w;\n\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vMapUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t#if defined( USE_POINTS_UV )\n\t\tvec2 uv = vUv;\n\t#else\n\t\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_POINTS_UV )\n\tvarying vec2 vUv;\n#else\n\t#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\t\tuniform mat3 uvTransform;\n\t#endif\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphinstance_vertex:"#ifdef USE_INSTANCING_MORPH\n\tfloat morphTargetInfluences[MORPHTARGETS_COUNT];\n\tfloat morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\tmorphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;\n\t}\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\t#ifndef USE_INSTANCING_MORPH\n\t\tuniform float morphTargetBaseInfluence;\n\t#endif\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\t#ifndef USE_INSTANCING_MORPH\n\t\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\t#endif\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal *= faceDirection;\n\t#endif\n#endif\n#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn = getTangentFrame( - vViewPosition, normal,\n\t\t#if defined( USE_NORMALMAP )\n\t\t\tvNormalMapUv\n\t\t#elif defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tvClearcoatNormalMapUv\n\t\t#else\n\t\t\tvUv\n\t\t#endif\n\t\t);\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn[0] *= faceDirection;\n\t\ttbn[1] *= faceDirection;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\t#ifdef USE_TANGENT\n\t\tmat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );\n\t#else\n\t\tmat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );\n\t#endif\n\t#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )\n\t\ttbn2[0] *= faceDirection;\n\t\ttbn2[1] *= faceDirection;\n\t#endif\n#endif\nvec3 nonPerturbedNormal = normal;",normal_fragment_maps:"#ifdef USE_NORMALMAP_OBJECTSPACE\n\tnormal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( USE_NORMALMAP_TANGENTSPACE )\n\tvec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\tnormal = normalize( tbn * mapN );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )\n\tmat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( uv.st );\n\t\tvec2 st1 = dFdy( uv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );\n\t\treturn mat3( T * scale, B * scale, N );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = nonPerturbedNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\tclearcoatNormal = normalize( tbn2 * clearcoatMapN );\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",opaque_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn depth * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * depth - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_BATCHING\n\tmvPosition = batchingMatrix * mvPosition;\n#endif\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n\tuniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;\n\t\tbool frustumTest = inFrustum && shadowCoord.z <= 1.0;\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tfloat shadow = 1.0;\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\t\n\t\tfloat lightToPositionLength = length( lightToPosition );\n\t\tif ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {\n\t\t\tfloat dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\t\tdp += shadowBias;\n\t\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\t\tshadow = (\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t\t) * ( 1.0 / 9.0 );\n\t\t\t#else\n\t\t\t\tshadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n\tuniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n\tvarying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\tvec4 shadowWorldPosition;\n#endif\n#if defined( USE_SHADOWMAP )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tint size = textureSize( boneTexture, 0 ).x;\n\t\tint j = int( i ) * 4;\n\t\tint x = j % size;\n\t\tint y = j / size;\n\t\tvec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );\n\t\tvec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );\n\t\tvec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );\n\t\tvec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );\n\t\treturn mat4( v1, v2, v3, v4 );\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn saturate( toneMappingExposure * color );\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nconst mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(\n\tvec3( 1.6605, - 0.1246, - 0.0182 ),\n\tvec3( - 0.5876, 1.1329, - 0.1006 ),\n\tvec3( - 0.0728, - 0.0083, 1.1187 )\n);\nconst mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(\n\tvec3( 0.6274, 0.0691, 0.0164 ),\n\tvec3( 0.3293, 0.9195, 0.0880 ),\n\tvec3( 0.0433, 0.0113, 0.8956 )\n);\nvec3 agxDefaultContrastApprox( vec3 x ) {\n\tvec3 x2 = x * x;\n\tvec3 x4 = x2 * x2;\n\treturn + 15.5 * x4 * x2\n\t\t- 40.14 * x4 * x\n\t\t+ 31.96 * x4\n\t\t- 6.868 * x2 * x\n\t\t+ 0.4298 * x2\n\t\t+ 0.1191 * x\n\t\t- 0.00232;\n}\nvec3 AgXToneMapping( vec3 color ) {\n\tconst mat3 AgXInsetMatrix = mat3(\n\t\tvec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),\n\t\tvec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),\n\t\tvec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )\n\t);\n\tconst mat3 AgXOutsetMatrix = mat3(\n\t\tvec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),\n\t\tvec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),\n\t\tvec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )\n\t);\n\tconst float AgxMinEv = - 12.47393;\tconst float AgxMaxEv = 4.026069;\n\tcolor *= toneMappingExposure;\n\tcolor = LINEAR_SRGB_TO_LINEAR_REC2020 * color;\n\tcolor = AgXInsetMatrix * color;\n\tcolor = max( color, 1e-10 );\tcolor = log2( color );\n\tcolor = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );\n\tcolor = clamp( color, 0.0, 1.0 );\n\tcolor = agxDefaultContrastApprox( color );\n\tcolor = AgXOutsetMatrix * color;\n\tcolor = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );\n\tcolor = LINEAR_REC2020_TO_LINEAR_SRGB * color;\n\tcolor = clamp( color, 0.0, 1.0 );\n\treturn color;\n}\nvec3 NeutralToneMapping( vec3 color ) {\n\tconst float StartCompression = 0.8 - 0.04;\n\tconst float Desaturation = 0.15;\n\tcolor *= toneMappingExposure;\n\tfloat x = min( color.r, min( color.g, color.b ) );\n\tfloat offset = x < 0.08 ? x - 6.25 * x * x : 0.04;\n\tcolor -= offset;\n\tfloat peak = max( color.r, max( color.g, color.b ) );\n\tif ( peak < StartCompression ) return color;\n\tfloat d = 1. - StartCompression;\n\tfloat newPeak = 1. - d * d / ( peak + d - StartCompression );\n\tcolor *= newPeak / peak;\n\tfloat g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );\n\treturn mix( color, vec3( newPeak ), g );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmitted = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tfloat w0( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );\n\t}\n\tfloat w1( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );\n\t}\n\tfloat w2( float a ){\n\t\treturn ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );\n\t}\n\tfloat w3( float a ) {\n\t\treturn ( 1.0 / 6.0 ) * ( a * a * a );\n\t}\n\tfloat g0( float a ) {\n\t\treturn w0( a ) + w1( a );\n\t}\n\tfloat g1( float a ) {\n\t\treturn w2( a ) + w3( a );\n\t}\n\tfloat h0( float a ) {\n\t\treturn - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );\n\t}\n\tfloat h1( float a ) {\n\t\treturn 1.0 + w3( a ) / ( w2( a ) + w3( a ) );\n\t}\n\tvec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {\n\t\tuv = uv * texelSize.zw + 0.5;\n\t\tvec2 iuv = floor( uv );\n\t\tvec2 fuv = fract( uv );\n\t\tfloat g0x = g0( fuv.x );\n\t\tfloat g1x = g1( fuv.x );\n\t\tfloat h0x = h0( fuv.x );\n\t\tfloat h1x = h1( fuv.x );\n\t\tfloat h0y = h0( fuv.y );\n\t\tfloat h1y = h1( fuv.y );\n\t\tvec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\tvec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;\n\t\treturn g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +\n\t\t\tg1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );\n\t}\n\tvec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {\n\t\tvec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );\n\t\tvec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );\n\t\tvec2 fLodSizeInv = 1.0 / fLodSize;\n\t\tvec2 cLodSizeInv = 1.0 / cLodSize;\n\t\tvec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );\n\t\tvec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );\n\t\treturn mix( fSample, cSample, fract( lod ) );\n\t}\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\treturn textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );\n\t}\n\tvec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn vec3( 1.0 );\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec4 transmittedLight;\n\t\tvec3 transmittance;\n\t\t#ifdef USE_DISPERSION\n\t\t\tfloat halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;\n\t\t\tvec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );\n\t\t\tfor ( int i = 0; i < 3; i ++ ) {\n\t\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );\n\t\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\n\t\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\t\trefractionCoords += 1.0;\n\t\t\t\trefractionCoords /= 2.0;\n\t\t\n\t\t\t\tvec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );\n\t\t\t\ttransmittedLight[ i ] = transmissionSample[ i ];\n\t\t\t\ttransmittedLight.a += transmissionSample.a;\n\t\t\t\ttransmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];\n\t\t\t}\n\t\t\ttransmittedLight.a /= 3.0;\n\t\t\n\t\t#else\n\t\t\n\t\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\t\trefractionCoords += 1.0;\n\t\t\trefractionCoords /= 2.0;\n\t\t\ttransmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\t\ttransmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\t\n\t\t#endif\n\t\tvec3 attenuatedColor = transmittance * transmittedLight.rgb;\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\tfloat transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );\n\t}\n#endif",uv_pars_fragment:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_pars_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\n\tuniform mat3 mapTransform;\n\tvarying vec2 vMapUv;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform mat3 alphaMapTransform;\n\tvarying vec2 vAlphaMapUv;\n#endif\n#ifdef USE_LIGHTMAP\n\tuniform mat3 lightMapTransform;\n\tvarying vec2 vLightMapUv;\n#endif\n#ifdef USE_AOMAP\n\tuniform mat3 aoMapTransform;\n\tvarying vec2 vAoMapUv;\n#endif\n#ifdef USE_BUMPMAP\n\tuniform mat3 bumpMapTransform;\n\tvarying vec2 vBumpMapUv;\n#endif\n#ifdef USE_NORMALMAP\n\tuniform mat3 normalMapTransform;\n\tvarying vec2 vNormalMapUv;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tuniform mat3 displacementMapTransform;\n\tvarying vec2 vDisplacementMapUv;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tuniform mat3 emissiveMapTransform;\n\tvarying vec2 vEmissiveMapUv;\n#endif\n#ifdef USE_METALNESSMAP\n\tuniform mat3 metalnessMapTransform;\n\tvarying vec2 vMetalnessMapUv;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tuniform mat3 roughnessMapTransform;\n\tvarying vec2 vRoughnessMapUv;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tuniform mat3 anisotropyMapTransform;\n\tvarying vec2 vAnisotropyMapUv;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tuniform mat3 clearcoatMapTransform;\n\tvarying vec2 vClearcoatMapUv;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform mat3 clearcoatNormalMapTransform;\n\tvarying vec2 vClearcoatNormalMapUv;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform mat3 clearcoatRoughnessMapTransform;\n\tvarying vec2 vClearcoatRoughnessMapUv;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tuniform mat3 sheenColorMapTransform;\n\tvarying vec2 vSheenColorMapUv;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tuniform mat3 sheenRoughnessMapTransform;\n\tvarying vec2 vSheenRoughnessMapUv;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tuniform mat3 iridescenceMapTransform;\n\tvarying vec2 vIridescenceMapUv;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform mat3 iridescenceThicknessMapTransform;\n\tvarying vec2 vIridescenceThicknessMapUv;\n#endif\n#ifdef USE_SPECULARMAP\n\tuniform mat3 specularMapTransform;\n\tvarying vec2 vSpecularMapUv;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tuniform mat3 specularColorMapTransform;\n\tvarying vec2 vSpecularColorMapUv;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tuniform mat3 specularIntensityMapTransform;\n\tvarying vec2 vSpecularIntensityMapUv;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tuniform mat3 transmissionMapTransform;\n\tvarying vec2 vTransmissionMapUv;\n#endif\n#ifdef USE_THICKNESSMAP\n\tuniform mat3 thicknessMapTransform;\n\tvarying vec2 vThicknessMapUv;\n#endif",uv_vertex:"#if defined( USE_UV ) || defined( USE_ANISOTROPY )\n\tvUv = vec3( uv, 1 ).xy;\n#endif\n#ifdef USE_MAP\n\tvMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ALPHAMAP\n\tvAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_LIGHTMAP\n\tvLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_AOMAP\n\tvAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_BUMPMAP\n\tvBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_NORMALMAP\n\tvNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_DISPLACEMENTMAP\n\tvDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_EMISSIVEMAP\n\tvEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_METALNESSMAP\n\tvMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ROUGHNESSMAP\n\tvRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_ANISOTROPYMAP\n\tvAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOATMAP\n\tvClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tvClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tvClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCEMAP\n\tvIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tvIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_COLORMAP\n\tvSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SHEEN_ROUGHNESSMAP\n\tvSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULARMAP\n\tvSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_COLORMAP\n\tvSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_SPECULAR_INTENSITYMAP\n\tvSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_TRANSMISSIONMAP\n\tvTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;\n#endif\n#ifdef USE_THICKNESSMAP\n\tvThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_BATCHING\n\t\tworldPosition = batchingMatrix * worldPosition;\n\t#endif\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nuniform mat3 backgroundRotation;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",depth_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <skinbase_vertex>\n\t#include <morphinstance_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <clipping_planes_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vLightMapUv );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define USE_SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef USE_SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULAR_COLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n\t#ifdef USE_SPECULAR_INTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_DISPERSION\n\tuniform float dispersion;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEEN_COLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEEN_ROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\n#ifdef USE_ANISOTROPY\n\tuniform vec2 anisotropyVector;\n\t#ifdef USE_ANISOTROPYMAP\n\t\tuniform sampler2D anisotropyMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;\n\t#endif\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <batching_pars_vertex>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\n#ifdef USE_POINTS_UV\n\tvarying vec2 vUv;\n\tuniform mat3 uvTransform;\n#endif\nvoid main() {\n\t#ifdef USE_POINTS_UV\n\t\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\t#endif\n\t#include <color_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <batching_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <batching_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphinstance_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <logdepthbuf_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <alphahash_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <alphahash_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <opaque_fragment>\n\t#include <tonemapping_fragment>\n\t#include <colorspace_fragment>\n\t#include <fog_fragment>\n}"},ps={common:{diffuse:{value:new nn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new le},alphaMap:{value:null},alphaMapTransform:{value:new le},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new le}},envmap:{envMap:{value:null},envMapRotation:{value:new le},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new le}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new le}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new le},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new le},normalScale:{value:new ce(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new le},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new le}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new le}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new le}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new nn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new nn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new le},alphaTest:{value:0},uvTransform:{value:new le}},sprite:{diffuse:{value:new nn(16777215)},opacity:{value:1},center:{value:new ce(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new le},alphaMap:{value:null},alphaMapTransform:{value:new le},alphaTest:{value:0}}},ms={basic:{uniforms:Wn([ps.common,ps.specularmap,ps.envmap,ps.aomap,ps.lightmap,ps.fog]),vertexShader:gs.meshbasic_vert,fragmentShader:gs.meshbasic_frag},lambert:{uniforms:Wn([ps.common,ps.specularmap,ps.envmap,ps.aomap,ps.lightmap,ps.emissivemap,ps.bumpmap,ps.normalmap,ps.displacementmap,ps.fog,ps.lights,{emissive:{value:new nn(0)}}]),vertexShader:gs.meshlambert_vert,fragmentShader:gs.meshlambert_frag},phong:{uniforms:Wn([ps.common,ps.specularmap,ps.envmap,ps.aomap,ps.lightmap,ps.emissivemap,ps.bumpmap,ps.normalmap,ps.displacementmap,ps.fog,ps.lights,{emissive:{value:new nn(0)},specular:{value:new nn(1118481)},shininess:{value:30}}]),vertexShader:gs.meshphong_vert,fragmentShader:gs.meshphong_frag},standard:{uniforms:Wn([ps.common,ps.envmap,ps.aomap,ps.lightmap,ps.emissivemap,ps.bumpmap,ps.normalmap,ps.displacementmap,ps.roughnessmap,ps.metalnessmap,ps.fog,ps.lights,{emissive:{value:new nn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:gs.meshphysical_vert,fragmentShader:gs.meshphysical_frag},toon:{uniforms:Wn([ps.common,ps.aomap,ps.lightmap,ps.emissivemap,ps.bumpmap,ps.normalmap,ps.displacementmap,ps.gradientmap,ps.fog,ps.lights,{emissive:{value:new nn(0)}}]),vertexShader:gs.meshtoon_vert,fragmentShader:gs.meshtoon_frag},matcap:{uniforms:Wn([ps.common,ps.bumpmap,ps.normalmap,ps.displacementmap,ps.fog,{matcap:{value:null}}]),vertexShader:gs.meshmatcap_vert,fragmentShader:gs.meshmatcap_frag},points:{uniforms:Wn([ps.points,ps.fog]),vertexShader:gs.points_vert,fragmentShader:gs.points_frag},dashed:{uniforms:Wn([ps.common,ps.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:gs.linedashed_vert,fragmentShader:gs.linedashed_frag},depth:{uniforms:Wn([ps.common,ps.displacementmap]),vertexShader:gs.depth_vert,fragmentShader:gs.depth_frag},normal:{uniforms:Wn([ps.common,ps.bumpmap,ps.normalmap,ps.displacementmap,{opacity:{value:1}}]),vertexShader:gs.meshnormal_vert,fragmentShader:gs.meshnormal_frag},sprite:{uniforms:Wn([ps.sprite,ps.fog]),vertexShader:gs.sprite_vert,fragmentShader:gs.sprite_frag},background:{uniforms:{uvTransform:{value:new le},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:gs.background_vert,fragmentShader:gs.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new le}},vertexShader:gs.backgroundCube_vert,fragmentShader:gs.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:gs.cube_vert,fragmentShader:gs.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:gs.equirect_vert,fragmentShader:gs.equirect_frag},distanceRGBA:{uniforms:Wn([ps.common,ps.displacementmap,{referencePosition:{value:new Ne},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:gs.distanceRGBA_vert,fragmentShader:gs.distanceRGBA_frag},shadow:{uniforms:Wn([ps.lights,ps.fog,{color:{value:new nn(0)},opacity:{value:1}}]),vertexShader:gs.shadow_vert,fragmentShader:gs.shadow_frag}};ms.physical={uniforms:Wn([ms.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new le},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new le},clearcoatNormalScale:{value:new ce(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new le},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new le},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new le},sheen:{value:0},sheenColor:{value:new nn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new le},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new le},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new le},transmissionSamplerSize:{value:new ce},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new le},attenuationDistance:{value:0},attenuationColor:{value:new nn(0)},specularColor:{value:new nn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new le},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new le},anisotropyVector:{value:new ce},anisotropyMap:{value:null},anisotropyMapTransform:{value:new le}}]),vertexShader:gs.meshphysical_vert,fragmentShader:gs.meshphysical_frag};const vs={r:0,b:0,g:0},bs=new wi,Es=new di;function Cs(t,e,i,n,o,a,h){const c=new nn(0);let l,A,u=!0===a?0:1,d=null,f=0,g=null;function p(t){let n=!0===t.isScene?t.background:null;if(n&&n.isTexture){n=(t.backgroundBlurriness>0?i:e).get(n)}return n}function m(e,i){e.getRGB(vs,jn(t)),n.buffers.color.setClear(vs.r,vs.g,vs.b,i,h)}return{getClearColor:function(){return c},setClearColor:function(t,e=1){c.set(t),u=e,m(c,u)},getClearAlpha:function(){return u},setClearAlpha:function(t){u=t,m(c,u)},render:function(e){let i=!1;const s=p(e);null===s?m(c,u):s&&s.isColor&&(m(s,1),i=!0);const r=t.xr.getEnvironmentBlendMode();"additive"===r?n.buffers.color.setClear(0,0,0,1,h):"alpha-blend"===r&&n.buffers.color.setClear(0,0,0,0,h),(t.autoClear||i)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil)},addToRenderList:function(e,i){const n=p(i);n&&(n.isCubeTexture||n.mapping===O)?(void 0===A&&(A=new Hn(new zn(1,1,1),new Yn({name:"BackgroundCubeMaterial",uniforms:qn(ms.backgroundCube.uniforms),vertexShader:ms.backgroundCube.vertexShader,fragmentShader:ms.backgroundCube.fragmentShader,side:r,depthTest:!1,depthWrite:!1,fog:!1})),A.geometry.deleteAttribute("normal"),A.geometry.deleteAttribute("uv"),A.onBeforeRender=function(t,e,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(A.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(A)),bs.copy(i.backgroundRotation),bs.x*=-1,bs.y*=-1,bs.z*=-1,n.isCubeTexture&&!1===n.isRenderTargetTexture&&(bs.y*=-1,bs.z*=-1),A.material.uniforms.envMap.value=n,A.material.uniforms.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,A.material.uniforms.backgroundBlurriness.value=i.backgroundBlurriness,A.material.uniforms.backgroundIntensity.value=i.backgroundIntensity,A.material.uniforms.backgroundRotation.value.setFromMatrix4(Es.makeRotationFromEuler(bs)),A.material.toneMapped=Ce.getTransfer(n.colorSpace)!==Pt,d===n&&f===n.version&&g===t.toneMapping||(A.material.needsUpdate=!0,d=n,f=n.version,g=t.toneMapping),A.layers.enableAll(),e.unshift(A,A.geometry,A.material,0,0,null)):n&&n.isTexture&&(void 0===l&&(l=new Hn(new fs(2,2),new Yn({name:"BackgroundMaterial",uniforms:qn(ms.background.uniforms),vertexShader:ms.background.vertexShader,fragmentShader:ms.background.fragmentShader,side:s,depthTest:!1,depthWrite:!1,fog:!1})),l.geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(l)),l.material.uniforms.t2D.value=n,l.material.uniforms.backgroundIntensity.value=i.backgroundIntensity,l.material.toneMapped=Ce.getTransfer(n.colorSpace)!==Pt,!0===n.matrixAutoUpdate&&n.updateMatrix(),l.material.uniforms.uvTransform.value.copy(n.matrix),d===n&&f===n.version&&g===t.toneMapping||(l.material.needsUpdate=!0,d=n,f=n.version,g=t.toneMapping),l.layers.enableAll(),e.unshift(l,l.geometry,l.material,0,0,null))}}}function Is(t,e){const i=t.getParameter(t.MAX_VERTEX_ATTRIBS),n={},s=c(null);let r=s,o=!1;function a(e){return t.bindVertexArray(e)}function h(e){return t.deleteVertexArray(e)}function c(t){const e=[],n=[],s=[];for(let t=0;t<i;t++)e[t]=0,n[t]=0,s[t]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:e,enabledAttributes:n,attributeDivisors:s,object:t,attributes:{},index:null}}function l(){const t=r.newAttributes;for(let e=0,i=t.length;e<i;e++)t[e]=0}function A(t){u(t,0)}function u(e,i){const n=r.newAttributes,s=r.enabledAttributes,o=r.attributeDivisors;n[e]=1,0===s[e]&&(t.enableVertexAttribArray(e),s[e]=1),o[e]!==i&&(t.vertexAttribDivisor(e,i),o[e]=i)}function d(){const e=r.newAttributes,i=r.enabledAttributes;for(let n=0,s=i.length;n<s;n++)i[n]!==e[n]&&(t.disableVertexAttribArray(n),i[n]=0)}function f(e,i,n,s,r,o,a){!0===a?t.vertexAttribIPointer(e,i,n,r,o):t.vertexAttribPointer(e,i,n,s,r,o)}function g(){p(),o=!0,r!==s&&(r=s,a(r.object))}function p(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:function(i,s,h,g,p){let m=!1;const v=function(e,i,s){const r=!0===s.wireframe;let o=n[e.id];void 0===o&&(o={},n[e.id]=o);let a=o[i.id];void 0===a&&(a={},o[i.id]=a);let h=a[r];void 0===h&&(h=c(t.createVertexArray()),a[r]=h);return h}(g,h,s);r!==v&&(r=v,a(r.object)),m=function(t,e,i,n){const s=r.attributes,o=e.attributes;let a=0;const h=i.getAttributes();for(const e in h){if(h[e].location>=0){const i=s[e];let n=o[e];if(void 0===n&&("instanceMatrix"===e&&t.instanceMatrix&&(n=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(n=t.instanceColor)),void 0===i)return!0;if(i.attribute!==n)return!0;if(n&&i.data!==n.data)return!0;a++}}return r.attributesNum!==a||r.index!==n}(i,g,h,p),m&&function(t,e,i,n){const s={},o=e.attributes;let a=0;const h=i.getAttributes();for(const e in h){if(h[e].location>=0){let i=o[e];void 0===i&&("instanceMatrix"===e&&t.instanceMatrix&&(i=t.instanceMatrix),"instanceColor"===e&&t.instanceColor&&(i=t.instanceColor));const n={};n.attribute=i,i&&i.data&&(n.data=i.data),s[e]=n,a++}}r.attributes=s,r.attributesNum=a,r.index=n}(i,g,h,p),null!==p&&e.update(p,t.ELEMENT_ARRAY_BUFFER),(m||o)&&(o=!1,function(i,n,s,r){l();const o=r.attributes,a=s.getAttributes(),h=n.defaultAttributeValues;for(const n in a){const s=a[n];if(s.location>=0){let a=o[n];if(void 0===a&&("instanceMatrix"===n&&i.instanceMatrix&&(a=i.instanceMatrix),"instanceColor"===n&&i.instanceColor&&(a=i.instanceColor)),void 0!==a){const n=a.normalized,o=a.itemSize,h=e.get(a);if(void 0===h)continue;const c=h.buffer,l=h.type,d=h.bytesPerElement,g=l===t.INT||l===t.UNSIGNED_INT||a.gpuType===Z;if(a.isInterleavedBufferAttribute){const e=a.data,h=e.stride,p=a.offset;if(e.isInstancedInterleavedBuffer){for(let t=0;t<s.locationSize;t++)u(s.location+t,e.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===r._maxInstanceCount&&(r._maxInstanceCount=e.meshPerAttribute*e.count)}else for(let t=0;t<s.locationSize;t++)A(s.location+t);t.bindBuffer(t.ARRAY_BUFFER,c);for(let t=0;t<s.locationSize;t++)f(s.location+t,o/s.locationSize,l,n,h*d,(p+o/s.locationSize*t)*d,g)}else{if(a.isInstancedBufferAttribute){for(let t=0;t<s.locationSize;t++)u(s.location+t,a.meshPerAttribute);!0!==i.isInstancedMesh&&void 0===r._maxInstanceCount&&(r._maxInstanceCount=a.meshPerAttribute*a.count)}else for(let t=0;t<s.locationSize;t++)A(s.location+t);t.bindBuffer(t.ARRAY_BUFFER,c);for(let t=0;t<s.locationSize;t++)f(s.location+t,o/s.locationSize,l,n,o*d,o/s.locationSize*t*d,g)}}else if(void 0!==h){const e=h[n];if(void 0!==e)switch(e.length){case 2:t.vertexAttrib2fv(s.location,e);break;case 3:t.vertexAttrib3fv(s.location,e);break;case 4:t.vertexAttrib4fv(s.location,e);break;default:t.vertexAttrib1fv(s.location,e)}}}}d()}(i,s,h,g),null!==p&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(p).buffer))},reset:g,resetDefaultState:p,dispose:function(){g();for(const t in n){const e=n[t];for(const t in e){const i=e[t];for(const t in i)h(i[t].object),delete i[t];delete e[t]}delete n[t]}},releaseStatesOfGeometry:function(t){if(void 0===n[t.id])return;const e=n[t.id];for(const t in e){const i=e[t];for(const t in i)h(i[t].object),delete i[t];delete e[t]}delete n[t.id]},releaseStatesOfProgram:function(t){for(const e in n){const i=n[e];if(void 0===i[t.id])continue;const s=i[t.id];for(const t in s)h(s[t].object),delete s[t];delete i[t.id]}},initAttributes:l,enableAttribute:A,disableUnusedAttributes:d}}function ws(t,e,i){let n;function s(e,s,r){0!==r&&(t.drawArraysInstanced(n,e,s,r),i.update(s,n,r))}this.setMode=function(t){n=t},this.render=function(e,s){t.drawArrays(n,e,s),i.update(s,n,1)},this.renderInstances=s,this.renderMultiDraw=function(t,s,r){if(0===r)return;const o=e.get("WEBGL_multi_draw");if(null===o)for(let e=0;e<r;e++)this.render(t[e],s[e]);else{o.multiDrawArraysWEBGL(n,t,0,s,0,r);let e=0;for(let t=0;t<r;t++)e+=s[t];i.update(e,n,1)}},this.renderMultiDrawInstances=function(t,r,o,a){if(0===o)return;const h=e.get("WEBGL_multi_draw");if(null===h)for(let e=0;e<t.length;e++)s(t[e],r[e],a[e]);else{h.multiDrawArraysInstancedWEBGL(n,t,0,r,0,a,0,o);let e=0;for(let t=0;t<o;t++)e+=r[t];for(let t=0;t<a.length;t++)i.update(e,n,a[t])}}}function _s(t,e,i,n){let s;function r(e){if("highp"===e){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";e="mediump"}return"mediump"===e&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let o=void 0!==i.precision?i.precision:"highp";const a=r(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const h=!0===i.logarithmicDepthBuffer,c=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),l=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS);return{isWebGL2:!0,getMaxAnisotropy:function(){if(void 0!==s)return s;if(!0===e.has("EXT_texture_filter_anisotropic")){const i=e.get("EXT_texture_filter_anisotropic");s=t.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s},getMaxPrecision:r,textureFormatReadable:function(e){return e===nt||n.convert(e)===t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT)},textureTypeReadable:function(i){const s=i===et&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(i!==K&&n.convert(i)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&i!==tt&&!s)},precision:o,logarithmicDepthBuffer:h,maxTextures:c,maxVertexTextures:l,maxTextureSize:t.getParameter(t.MAX_TEXTURE_SIZE),maxCubemapSize:t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes:t.getParameter(t.MAX_VERTEX_ATTRIBS),maxVertexUniforms:t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings:t.getParameter(t.MAX_VARYING_VECTORS),maxFragmentUniforms:t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures:l>0,maxSamples:t.getParameter(t.MAX_SAMPLES)}}function Bs(t){const e=this;let i=null,n=0,s=!1,r=!1;const o=new hs,a=new le,h={value:null,needsUpdate:!1};function c(t,i,n,s){const r=null!==t?t.length:0;let c=null;if(0!==r){if(c=h.value,!0!==s||null===c){const e=n+4*r,s=i.matrixWorldInverse;a.getNormalMatrix(s),(null===c||c.length<e)&&(c=new Float32Array(e));for(let e=0,i=n;e!==r;++e,i+=4)o.copy(t[e]).applyMatrix4(s,a),o.normal.toArray(c,i),c[i+3]=o.constant}h.value=c,h.needsUpdate=!0}return e.numPlanes=r,e.numIntersection=0,c}this.uniform=h,this.numPlanes=0,this.numIntersection=0,this.init=function(t,e){const i=0!==t.length||e||0!==n||s;return s=e,n=t.length,i},this.beginShadows=function(){r=!0,c(null)},this.endShadows=function(){r=!1},this.setGlobalState=function(t,e){i=c(t,e,0)},this.setState=function(o,a,l){const A=o.clippingPlanes,u=o.clipIntersection,d=o.clipShadows,f=t.get(o);if(!s||null===A||0===A.length||r&&!d)r?c(null):function(){h.value!==i&&(h.value=i,h.needsUpdate=n>0);e.numPlanes=n,e.numIntersection=0}();else{const t=r?0:n,e=4*t;let s=f.clippingState||null;h.value=s,s=c(A,a,e,l);for(let t=0;t!==e;++t)s[t]=i[t];f.clippingState=s,this.numIntersection=u?this.numPlanes:0,this.numPlanes+=t}}}function Ss(t){let e=new WeakMap;function i(t,e){return e===F?t.mapping=N:304===e&&(t.mapping=k),t}function n(t){const i=t.target;i.removeEventListener("dispose",n);const s=e.get(i);void 0!==s&&(e.delete(i),s.dispose())}return{get:function(s){if(s&&s.isTexture){const r=s.mapping;if(r===F||304===r){if(e.has(s)){return i(e.get(s).texture,s.mapping)}{const r=s.image;if(r&&r.height>0){const o=new ss(r.height);return o.fromEquirectangularTexture(t,s),e.set(s,o),s.addEventListener("dispose",n),i(o.texture,s.mapping)}return null}}}return s},dispose:function(){e=new WeakMap}}}class Ms extends Kn{constructor(t=-1,e=1,i=1,n=-1,s=.1,r=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=i,this.bottom=n,this.near=s,this.far=r,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=null===t.view?null:Object.assign({},t.view),this}setViewOffset(t,e,i,n,s,r){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=i-t,r=i+t,o=n+e,a=n-e;if(null!==this.view&&this.view.enabled){const t=(this.right-this.left)/this.view.fullWidth/this.zoom,e=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=t*this.view.offsetX,r=s+t*this.view.width,o-=e*this.view.offsetY,a=o-e*this.view.height}this.projectionMatrix.makeOrthographic(s,r,o,a,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,null!==this.view&&(e.object.view=Object.assign({},this.view)),e}}const xs=[.125,.215,.35,.446,.526,.582],ys=20,Qs=new Ms,Ts=new nn;let Ds=null,Ls=0,Rs=0,Ps=!1;const Us=(1+Math.sqrt(5))/2,Ns=1/Us,ks=[new Ne(-Us,Ns,0),new Ne(Us,Ns,0),new Ne(-Ns,0,Us),new Ne(Ns,0,Us),new Ne(0,Us,-Ns),new Ne(0,Us,Ns),new Ne(-1,1,-1),new Ne(1,1,-1),new Ne(-1,1,1),new Ne(1,1,1)];class Fs{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(t,e=0,i=.1,n=100){Ds=this._renderer.getRenderTarget(),Ls=this._renderer.getActiveCubeFace(),Rs=this._renderer.getActiveMipmapLevel(),Ps=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(t,i,n,s),e>0&&this._blur(s,0,0,e),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(t,e=null){return this._fromTexture(t,e)}fromCubemap(t,e=null){return this._fromTexture(t,e)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=Vs(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=Hs(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Ds,Ls,Rs),this._renderer.xr.enabled=Ps,t.scissorTest=!1,Gs(t,0,0,t.width,t.height)}_fromTexture(t,e){t.mapping===N||t.mapping===k?this._setSize(0===t.image.length?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4),Ds=this._renderer.getRenderTarget(),Ls=this._renderer.getActiveCubeFace(),Rs=this._renderer.getActiveMipmapLevel(),Ps=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=e||this._allocateTargets();return this._textureToCubeUV(t,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,i={magFilter:j,minFilter:j,generateMipmaps:!1,type:et,format:nt,colorSpace:Tt,depthBuffer:!1},n=Os(t,e,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=Os(t,e,i);const{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function(t){const e=[],i=[],n=[];let s=t;const r=t-4+1+xs.length;for(let o=0;o<r;o++){const r=Math.pow(2,s);i.push(r);let a=1/r;o>t-4?a=xs[o-t+4-1]:0===o&&(a=0),n.push(a);const h=1/(r-2),c=-h,l=1+h,A=[c,c,l,c,l,l,c,c,l,l,c,l],u=6,d=6,f=3,g=2,p=1,m=new Float32Array(f*d*u),v=new Float32Array(g*d*u),b=new Float32Array(p*d*u);for(let t=0;t<u;t++){const e=t%3*2/3-1,i=t>2?0:-1,n=[e,i,0,e+2/3,i,0,e+2/3,i+1,0,e,i,0,e+2/3,i+1,0,e,i+1,0];m.set(n,f*d*t),v.set(A,g*d*t);const s=[t,t,t,t,t,t];b.set(s,p*d*t)}const E=new _n;E.setAttribute("position",new dn(m,f)),E.setAttribute("uv",new dn(v,g)),E.setAttribute("faceIndex",new dn(b,p)),e.push(E),s>4&&s--}return{lodPlanes:e,sizeLods:i,sigmas:n}}(n)),this._blurMaterial=function(t,e,i){const n=new Float32Array(ys),s=new Ne(0,1,0),r=new Yn({name:"SphericalGaussianBlur",defines:{n:ys,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/i,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:zs(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1});return r}(n,t,e)}return n}_compileMaterial(t){const e=new Hn(this._lodPlanes[0],t);this._renderer.compile(e,Qs)}_sceneToCubeUV(t,e,i,n){const s=new ts(90,1,e,i),o=[1,-1,1,1,1,1],a=[1,1,1,-1,-1,-1],h=this._renderer,c=h.autoClear,l=h.toneMapping;h.getClearColor(Ts),h.toneMapping=x,h.autoClear=!1;const A=new an({name:"PMREM.Background",side:r,depthWrite:!1,depthTest:!1}),u=new Hn(new zn,A);let d=!1;const f=t.background;f?f.isColor&&(A.color.copy(f),t.background=null,d=!0):(A.color.copy(Ts),d=!0);for(let e=0;e<6;e++){const i=e%3;0===i?(s.up.set(0,o[e],0),s.lookAt(a[e],0,0)):1===i?(s.up.set(0,0,o[e]),s.lookAt(0,a[e],0)):(s.up.set(0,o[e],0),s.lookAt(0,0,a[e]));const r=this._cubeSize;Gs(n,i*r,e>2?r:0,r,r),h.setRenderTarget(n),d&&h.render(u,s),h.render(t,s)}u.geometry.dispose(),u.material.dispose(),h.toneMapping=l,h.autoClear=c,t.background=f}_textureToCubeUV(t,e){const i=this._renderer,n=t.mapping===N||t.mapping===k;n?(null===this._cubemapMaterial&&(this._cubemapMaterial=Vs()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===t.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=Hs());const s=n?this._cubemapMaterial:this._equirectMaterial,r=new Hn(this._lodPlanes[0],s);s.uniforms.envMap.value=t;const o=this._cubeSize;Gs(e,0,0,3*o,2*o),i.setRenderTarget(e),i.render(r,Qs)}_applyPMREM(t){const e=this._renderer,i=e.autoClear;e.autoClear=!1;const n=this._lodPlanes.length;for(let e=1;e<n;e++){const i=Math.sqrt(this._sigmas[e]*this._sigmas[e]-this._sigmas[e-1]*this._sigmas[e-1]),s=ks[(n-e-1)%ks.length];this._blur(t,e-1,e,i,s)}e.autoClear=i}_blur(t,e,i,n,s){const r=this._pingPongRenderTarget;this._halfBlur(t,r,e,i,n,"latitudinal",s),this._halfBlur(r,t,i,i,n,"longitudinal",s)}_halfBlur(t,e,i,n,s,r,o){const a=this._renderer,h=this._blurMaterial;"latitudinal"!==r&&"longitudinal"!==r&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Hn(this._lodPlanes[n],h),l=h.uniforms,A=this._sizeLods[i]-1,u=isFinite(s)?Math.PI/(2*A):2*Math.PI/39,d=s/u,f=isFinite(s)?1+Math.floor(3*d):ys;f>ys&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${f} samples when the maximum is set to 20`);const g=[];let p=0;for(let t=0;t<ys;++t){const e=t/d,i=Math.exp(-e*e/2);g.push(i),0===t?p+=i:t<f&&(p+=2*i)}for(let t=0;t<g.length;t++)g[t]=g[t]/p;l.envMap.value=t.texture,l.samples.value=f,l.weights.value=g,l.latitudinal.value="latitudinal"===r,o&&(l.poleAxis.value=o);const{_lodMax:m}=this;l.dTheta.value=u,l.mipInt.value=m-i;const v=this._sizeLods[n];Gs(e,3*v*(n>m-4?n-m+4:0),4*(this._cubeSize-v),3*v,2*v),a.setRenderTarget(e),a.render(c,Qs)}}function Os(t,e,i){const n=new Le(t,e,i);return n.texture.mapping=O,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function Gs(t,e,i,n,s){t.viewport.set(e,i,n,s),t.scissor.set(e,i,n,s)}function Hs(){return new Yn({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:zs(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function Vs(){return new Yn({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:zs(),fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function zs(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function qs(t){let e=new WeakMap,i=null;function n(t){const i=t.target;i.removeEventListener("dispose",n);const s=e.get(i);void 0!==s&&(e.delete(i),s.dispose())}return{get:function(s){if(s&&s.isTexture){const r=s.mapping,o=r===F||304===r,a=r===N||r===k;if(o||a){let r=e.get(s);const h=void 0!==r?r.texture.pmremVersion:0;if(s.isRenderTargetTexture&&s.pmremVersion!==h)return null===i&&(i=new Fs(t)),r=o?i.fromEquirectangular(s,r):i.fromCubemap(s,r),r.texture.pmremVersion=s.pmremVersion,e.set(s,r),r.texture;if(void 0!==r)return r.texture;{const h=s.image;return o&&h&&h.height>0||a&&h&&function(t){let e=0;const i=6;for(let n=0;n<i;n++)void 0!==t[n]&&e++;return e===i}(h)?(null===i&&(i=new Fs(t)),r=o?i.fromEquirectangular(s):i.fromCubemap(s),r.texture.pmremVersion=s.pmremVersion,e.set(s,r),s.addEventListener("dispose",n),r.texture):null}}}return s},dispose:function(){e=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function Ws(t){const e={};function i(i){if(void 0!==e[i])return e[i];let n;switch(i){case"WEBGL_depth_texture":n=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=t.getExtension(i)}return e[i]=n,n}return{has:function(t){return null!==i(t)},init:function(){i("EXT_color_buffer_float"),i("WEBGL_clip_cull_distance"),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float"),i("WEBGL_multisampled_render_to_texture"),i("WEBGL_render_shared_exponent")},get:function(t){const e=i(t);return null===e&&console.warn("THREE.WebGLRenderer: "+t+" extension not supported."),e}}}function js(t,e,i,n){const s={},r=new WeakMap;function o(t){const a=t.target;null!==a.index&&e.remove(a.index);for(const t in a.attributes)e.remove(a.attributes[t]);for(const t in a.morphAttributes){const i=a.morphAttributes[t];for(let t=0,n=i.length;t<n;t++)e.remove(i[t])}a.removeEventListener("dispose",o),delete s[a.id];const h=r.get(a);h&&(e.remove(h),r.delete(a)),n.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(t){const i=[],n=t.index,s=t.attributes.position;let o=0;if(null!==n){const t=n.array;o=n.version;for(let e=0,n=t.length;e<n;e+=3){const n=t[e+0],s=t[e+1],r=t[e+2];i.push(n,s,s,r,r,n)}}else{if(void 0===s)return;{const t=s.array;o=s.version;for(let e=0,n=t.length/3-1;e<n;e+=3){const t=e+0,n=e+1,s=e+2;i.push(t,n,n,s,s,t)}}}const a=new(ue(i)?gn:fn)(i,1);a.version=o;const h=r.get(t);h&&e.remove(h),r.set(t,a)}return{get:function(t,e){return!0===s[e.id]||(e.addEventListener("dispose",o),s[e.id]=!0,i.memory.geometries++),e},update:function(i){const n=i.attributes;for(const i in n)e.update(n[i],t.ARRAY_BUFFER);const s=i.morphAttributes;for(const i in s){const n=s[i];for(let i=0,s=n.length;i<s;i++)e.update(n[i],t.ARRAY_BUFFER)}},getWireframeAttribute:function(t){const e=r.get(t);if(e){const i=t.index;null!==i&&e.version<i.version&&a(t)}else a(t);return r.get(t)}}}function Js(t,e,i){let n,s,r;function o(e,o,a){0!==a&&(t.drawElementsInstanced(n,o,s,e*r,a),i.update(o,n,a))}this.setMode=function(t){n=t},this.setIndex=function(t){s=t.type,r=t.bytesPerElement},this.render=function(e,o){t.drawElements(n,o,s,e*r),i.update(o,n,1)},this.renderInstances=o,this.renderMultiDraw=function(t,o,a){if(0===a)return;const h=e.get("WEBGL_multi_draw");if(null===h)for(let e=0;e<a;e++)this.render(t[e]/r,o[e]);else{h.multiDrawElementsWEBGL(n,o,0,s,t,0,a);let e=0;for(let t=0;t<a;t++)e+=o[t];i.update(e,n,1)}},this.renderMultiDrawInstances=function(t,a,h,c){if(0===h)return;const l=e.get("WEBGL_multi_draw");if(null===l)for(let e=0;e<t.length;e++)o(t[e]/r,a[e],c[e]);else{l.multiDrawElementsInstancedWEBGL(n,a,0,s,t,0,c,0,h);let e=0;for(let t=0;t<h;t++)e+=a[t];for(let t=0;t<c.length;t++)i.update(e,n,c[t])}}}function Ys(t){const e={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:e,programs:null,autoReset:!0,reset:function(){e.calls=0,e.triangles=0,e.points=0,e.lines=0},update:function(i,n,s){switch(e.calls++,n){case t.TRIANGLES:e.triangles+=s*(i/3);break;case t.LINES:e.lines+=s*(i/2);break;case t.LINE_STRIP:e.lines+=s*(i-1);break;case t.LINE_LOOP:e.lines+=s*i;break;case t.POINTS:e.points+=s*i;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function Ks(t,e,i){const n=new WeakMap,s=new Te;return{update:function(r,o,a){const h=r.morphTargetInfluences,c=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,l=void 0!==c?c.length:0;let A=n.get(o);if(void 0===A||A.count!==l){void 0!==A&&A.texture.dispose();const u=void 0!==o.morphAttributes.position,d=void 0!==o.morphAttributes.normal,f=void 0!==o.morphAttributes.color,g=o.morphAttributes.position||[],p=o.morphAttributes.normal||[],m=o.morphAttributes.color||[];let v=0;!0===u&&(v=1),!0===d&&(v=2),!0===f&&(v=3);let b=o.attributes.position.count*v,E=1;b>e.maxTextureSize&&(E=Math.ceil(b/e.maxTextureSize),b=e.maxTextureSize);const C=new Float32Array(b*E*4*l),I=new Re(C,b,E,l);I.type=tt,I.needsUpdate=!0;const w=4*v;for(let B=0;B<l;B++){const S=g[B],M=p[B],x=m[B],y=b*E*4*B;for(let Q=0;Q<S.count;Q++){const T=Q*w;!0===u&&(s.fromBufferAttribute(S,Q),C[y+T+0]=s.x,C[y+T+1]=s.y,C[y+T+2]=s.z,C[y+T+3]=0),!0===d&&(s.fromBufferAttribute(M,Q),C[y+T+4]=s.x,C[y+T+5]=s.y,C[y+T+6]=s.z,C[y+T+7]=0),!0===f&&(s.fromBufferAttribute(x,Q),C[y+T+8]=s.x,C[y+T+9]=s.y,C[y+T+10]=s.z,C[y+T+11]=4===x.itemSize?s.w:1)}}function _(){I.dispose(),n.delete(o),o.removeEventListener("dispose",_)}A={count:l,texture:I,size:new ce(b,E)},n.set(o,A),o.addEventListener("dispose",_)}if(!0===r.isInstancedMesh&&null!==r.morphTexture)a.getUniforms().setValue(t,"morphTexture",r.morphTexture,i);else{let D=0;for(let R=0;R<h.length;R++)D+=h[R];const L=o.morphTargetsRelative?1:1-D;a.getUniforms().setValue(t,"morphTargetBaseInfluence",L),a.getUniforms().setValue(t,"morphTargetInfluences",h)}a.getUniforms().setValue(t,"morphTargetsTexture",A.texture,i),a.getUniforms().setValue(t,"morphTargetsTextureSize",A.size)}}}function Xs(t,e,i,n){let s=new WeakMap;function r(t){const e=t.target;e.removeEventListener("dispose",r),i.remove(e.instanceMatrix),null!==e.instanceColor&&i.remove(e.instanceColor)}return{update:function(o){const a=n.render.frame,h=o.geometry,c=e.get(o,h);if(s.get(c)!==a&&(e.update(c),s.set(c,a)),o.isInstancedMesh&&(!1===o.hasEventListener("dispose",r)&&o.addEventListener("dispose",r),s.get(o)!==a&&(i.update(o.instanceMatrix,t.ARRAY_BUFFER),null!==o.instanceColor&&i.update(o.instanceColor,t.ARRAY_BUFFER),s.set(o,a))),o.isSkinnedMesh){const t=o.skeleton;s.get(t)!==a&&(t.update(),s.set(t,a))}return c},dispose:function(){s=new WeakMap}}}class Zs extends Qe{constructor(t,e,i,n,s,r,o,a,h,c){if((c=void 0!==c?c:st)!==st&&c!==rt)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===st&&(i=$),void 0===i&&c===rt&&(i=it),super(null,n,s,r,o,a,c,i,h),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=void 0!==o?o:z,this.minFilter=void 0!==a?a:z,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return null!==this.compareFunction&&(e.compareFunction=this.compareFunction),e}}const $s=new Qe,tr=new Zs(1,1);tr.compareFunction=515;const er=new Re,ir=new Pe,nr=new ns,sr=[],rr=[],or=new Float32Array(16),ar=new Float32Array(9),hr=new Float32Array(4);function cr(t,e,i){const n=t[0];if(n<=0||n>0)return t;const s=e*i;let r=sr[s];if(void 0===r&&(r=new Float32Array(s),sr[s]=r),0!==e){n.toArray(r,0);for(let n=1,s=0;n!==e;++n)s+=i,t[n].toArray(r,s)}return r}function lr(t,e){if(t.length!==e.length)return!1;for(let i=0,n=t.length;i<n;i++)if(t[i]!==e[i])return!1;return!0}function Ar(t,e){for(let i=0,n=e.length;i<n;i++)t[i]=e[i]}function ur(t,e){let i=rr[e];void 0===i&&(i=new Int32Array(e),rr[e]=i);for(let n=0;n!==e;++n)i[n]=t.allocateTextureUnit();return i}function dr(t,e){const i=this.cache;i[0]!==e&&(t.uniform1f(this.addr,e),i[0]=e)}function fr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2f(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(lr(i,e))return;t.uniform2fv(this.addr,e),Ar(i,e)}}function gr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3f(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else if(void 0!==e.r)i[0]===e.r&&i[1]===e.g&&i[2]===e.b||(t.uniform3f(this.addr,e.r,e.g,e.b),i[0]=e.r,i[1]=e.g,i[2]=e.b);else{if(lr(i,e))return;t.uniform3fv(this.addr,e),Ar(i,e)}}function pr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(lr(i,e))return;t.uniform4fv(this.addr,e),Ar(i,e)}}function mr(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(lr(i,e))return;t.uniformMatrix2fv(this.addr,!1,e),Ar(i,e)}else{if(lr(i,n))return;hr.set(n),t.uniformMatrix2fv(this.addr,!1,hr),Ar(i,n)}}function vr(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(lr(i,e))return;t.uniformMatrix3fv(this.addr,!1,e),Ar(i,e)}else{if(lr(i,n))return;ar.set(n),t.uniformMatrix3fv(this.addr,!1,ar),Ar(i,n)}}function br(t,e){const i=this.cache,n=e.elements;if(void 0===n){if(lr(i,e))return;t.uniformMatrix4fv(this.addr,!1,e),Ar(i,e)}else{if(lr(i,n))return;or.set(n),t.uniformMatrix4fv(this.addr,!1,or),Ar(i,n)}}function Er(t,e){const i=this.cache;i[0]!==e&&(t.uniform1i(this.addr,e),i[0]=e)}function Cr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2i(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(lr(i,e))return;t.uniform2iv(this.addr,e),Ar(i,e)}}function Ir(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3i(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(lr(i,e))return;t.uniform3iv(this.addr,e),Ar(i,e)}}function wr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(lr(i,e))return;t.uniform4iv(this.addr,e),Ar(i,e)}}function _r(t,e){const i=this.cache;i[0]!==e&&(t.uniform1ui(this.addr,e),i[0]=e)}function Br(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y||(t.uniform2ui(this.addr,e.x,e.y),i[0]=e.x,i[1]=e.y);else{if(lr(i,e))return;t.uniform2uiv(this.addr,e),Ar(i,e)}}function Sr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z||(t.uniform3ui(this.addr,e.x,e.y,e.z),i[0]=e.x,i[1]=e.y,i[2]=e.z);else{if(lr(i,e))return;t.uniform3uiv(this.addr,e),Ar(i,e)}}function Mr(t,e){const i=this.cache;if(void 0!==e.x)i[0]===e.x&&i[1]===e.y&&i[2]===e.z&&i[3]===e.w||(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),i[0]=e.x,i[1]=e.y,i[2]=e.z,i[3]=e.w);else{if(lr(i,e))return;t.uniform4uiv(this.addr,e),Ar(i,e)}}function xr(t,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(t.uniform1i(this.addr,s),n[0]=s);const r=this.type===t.SAMPLER_2D_SHADOW?tr:$s;i.setTexture2D(e||r,s)}function yr(t,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(t.uniform1i(this.addr,s),n[0]=s),i.setTexture3D(e||ir,s)}function Qr(t,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(t.uniform1i(this.addr,s),n[0]=s),i.setTextureCube(e||nr,s)}function Tr(t,e,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(t.uniform1i(this.addr,s),n[0]=s),i.setTexture2DArray(e||er,s)}function Dr(t,e){t.uniform1fv(this.addr,e)}function Lr(t,e){const i=cr(e,this.size,2);t.uniform2fv(this.addr,i)}function Rr(t,e){const i=cr(e,this.size,3);t.uniform3fv(this.addr,i)}function Pr(t,e){const i=cr(e,this.size,4);t.uniform4fv(this.addr,i)}function Ur(t,e){const i=cr(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,i)}function Nr(t,e){const i=cr(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,i)}function kr(t,e){const i=cr(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,i)}function Fr(t,e){t.uniform1iv(this.addr,e)}function Or(t,e){t.uniform2iv(this.addr,e)}function Gr(t,e){t.uniform3iv(this.addr,e)}function Hr(t,e){t.uniform4iv(this.addr,e)}function Vr(t,e){t.uniform1uiv(this.addr,e)}function zr(t,e){t.uniform2uiv(this.addr,e)}function qr(t,e){t.uniform3uiv(this.addr,e)}function Wr(t,e){t.uniform4uiv(this.addr,e)}function jr(t,e,i){const n=this.cache,s=e.length,r=ur(i,s);lr(n,r)||(t.uniform1iv(this.addr,r),Ar(n,r));for(let t=0;t!==s;++t)i.setTexture2D(e[t]||$s,r[t])}function Jr(t,e,i){const n=this.cache,s=e.length,r=ur(i,s);lr(n,r)||(t.uniform1iv(this.addr,r),Ar(n,r));for(let t=0;t!==s;++t)i.setTexture3D(e[t]||ir,r[t])}function Yr(t,e,i){const n=this.cache,s=e.length,r=ur(i,s);lr(n,r)||(t.uniform1iv(this.addr,r),Ar(n,r));for(let t=0;t!==s;++t)i.setTextureCube(e[t]||nr,r[t])}function Kr(t,e,i){const n=this.cache,s=e.length,r=ur(i,s);lr(n,r)||(t.uniform1iv(this.addr,r),Ar(n,r));for(let t=0;t!==s;++t)i.setTexture2DArray(e[t]||er,r[t])}class Xr{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.type=e.type,this.setValue=function(t){switch(t){case 5126:return dr;case 35664:return fr;case 35665:return gr;case 35666:return pr;case 35674:return mr;case 35675:return vr;case 35676:return br;case 5124:case 35670:return Er;case 35667:case 35671:return Cr;case 35668:case 35672:return Ir;case 35669:case 35673:return wr;case 5125:return _r;case 36294:return Br;case 36295:return Sr;case 36296:return Mr;case 35678:case 36198:case 36298:case 36306:case 35682:return xr;case 35679:case 36299:case 36307:return yr;case 35680:case 36300:case 36308:case 36293:return Qr;case 36289:case 36303:case 36311:case 36292:return Tr}}(e.type)}}class Zr{constructor(t,e,i){this.id=t,this.addr=i,this.cache=[],this.type=e.type,this.size=e.size,this.setValue=function(t){switch(t){case 5126:return Dr;case 35664:return Lr;case 35665:return Rr;case 35666:return Pr;case 35674:return Ur;case 35675:return Nr;case 35676:return kr;case 5124:case 35670:return Fr;case 35667:case 35671:return Or;case 35668:case 35672:return Gr;case 35669:case 35673:return Hr;case 5125:return Vr;case 36294:return zr;case 36295:return qr;case 36296:return Wr;case 35678:case 36198:case 36298:case 36306:case 35682:return jr;case 35679:case 36299:case 36307:return Jr;case 35680:case 36300:case 36308:case 36293:return Yr;case 36289:case 36303:case 36311:case 36292:return Kr}}(e.type)}}class $r{constructor(t){this.id=t,this.seq=[],this.map={}}setValue(t,e,i){const n=this.seq;for(let s=0,r=n.length;s!==r;++s){const r=n[s];r.setValue(t,e[r.id],i)}}}const to=/(\w+)(\])?(\[|\.)?/g;function eo(t,e){t.seq.push(e),t.map[e.id]=e}function io(t,e,i){const n=t.name,s=n.length;for(to.lastIndex=0;;){const r=to.exec(n),o=to.lastIndex;let a=r[1];const h="]"===r[2],c=r[3];if(h&&(a|=0),void 0===c||"["===c&&o+2===s){eo(i,void 0===c?new Xr(a,t,e):new Zr(a,t,e));break}{let t=i.map[a];void 0===t&&(t=new $r(a),eo(i,t)),i=t}}}class no{constructor(t,e){this.seq=[],this.map={};const i=t.getProgramParameter(e,t.ACTIVE_UNIFORMS);for(let n=0;n<i;++n){const i=t.getActiveUniform(e,n);io(i,t.getUniformLocation(e,i.name),this)}}setValue(t,e,i,n){const s=this.map[e];void 0!==s&&s.setValue(t,i,n)}setOptional(t,e,i){const n=e[i];void 0!==n&&this.setValue(t,i,n)}static upload(t,e,i,n){for(let s=0,r=e.length;s!==r;++s){const r=e[s],o=i[r.id];!1!==o.needsUpdate&&r.setValue(t,o.value,n)}}static seqWithValue(t,e){const i=[];for(let n=0,s=t.length;n!==s;++n){const s=t[n];s.id in e&&i.push(s)}return i}}function so(t,e,i){const n=t.createShader(e);return t.shaderSource(n,i),t.compileShader(n),n}const ro=37297;let oo=0;function ao(t,e,i){const n=t.getShaderParameter(e,t.COMPILE_STATUS),s=t.getShaderInfoLog(e).trim();if(n&&""===s)return"";const r=/ERROR: 0:(\d+)/.exec(s);if(r){const n=parseInt(r[1]);return i.toUpperCase()+"\n\n"+s+"\n\n"+function(t,e){const i=t.split("\n"),n=[],s=Math.max(e-6,0),r=Math.min(e+6,i.length);for(let t=s;t<r;t++){const s=t+1;n.push(`${s===e?">":" "} ${s}: ${i[t]}`)}return n.join("\n")}(t.getShaderSource(e),n)}return s}function ho(t,e){const i=function(t){const e=Ce.getPrimaries(Ce.workingColorSpace),i=Ce.getPrimaries(t);let n;switch(e===i?n="":e===Nt&&i===Ut?n="LinearDisplayP3ToLinearSRGB":e===Ut&&i===Nt&&(n="LinearSRGBToLinearDisplayP3"),t){case Tt:case Lt:return[n,"LinearTransferOETF"];case Qt:case Dt:return[n,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",t),[n,"LinearTransferOETF"]}}(e);return`vec4 ${t}( vec4 value ) { return ${i[0]}( ${i[1]}( value ) ); }`}function co(t,e){let i;switch(e){case y:i="Linear";break;case Q:i="Reinhard";break;case T:i="OptimizedCineon";break;case D:i="ACESFilmic";break;case R:i="AgX";break;case P:i="Neutral";break;case L:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),i="Linear"}return"vec3 "+t+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function lo(t){return""!==t}function Ao(t,e){const i=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,i).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function uo(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const fo=/^[ \t]*#include +<([\w\d./]+)>/gm;function go(t){return t.replace(fo,mo)}const po=new Map;function mo(t,e){let i=gs[e];if(void 0===i){const t=po.get(e);if(void 0===t)throw new Error("Can not resolve #include <"+e+">");i=gs[t],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,t)}return go(i)}const vo=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function bo(t){return t.replace(vo,Eo)}function Eo(t,e,i,n){let s="";for(let t=parseInt(e);t<parseInt(i);t++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+t+" ]").replace(/UNROLLED_LOOP_INDEX/g,t);return s}function Co(t){let e=`precision ${t.precision} float;\n\tprecision ${t.precision} int;\n\tprecision ${t.precision} sampler2D;\n\tprecision ${t.precision} samplerCube;\n\tprecision ${t.precision} sampler3D;\n\tprecision ${t.precision} sampler2DArray;\n\tprecision ${t.precision} sampler2DShadow;\n\tprecision ${t.precision} samplerCubeShadow;\n\tprecision ${t.precision} sampler2DArrayShadow;\n\tprecision ${t.precision} isampler2D;\n\tprecision ${t.precision} isampler3D;\n\tprecision ${t.precision} isamplerCube;\n\tprecision ${t.precision} isampler2DArray;\n\tprecision ${t.precision} usampler2D;\n\tprecision ${t.precision} usampler3D;\n\tprecision ${t.precision} usamplerCube;\n\tprecision ${t.precision} usampler2DArray;\n\t`;return"highp"===t.precision?e+="\n#define HIGH_PRECISION":"mediump"===t.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===t.precision&&(e+="\n#define LOW_PRECISION"),e}function Io(t,s,r,o){const a=t.getContext(),h=r.defines;let c=r.vertexShader,l=r.fragmentShader;const A=function(t){let s="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===e?s="SHADOWMAP_TYPE_PCF":t.shadowMapType===i?s="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===n&&(s="SHADOWMAP_TYPE_VSM"),s}(r),u=function(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case N:case k:e="ENVMAP_TYPE_CUBE";break;case O:e="ENVMAP_TYPE_CUBE_UV"}return e}(r),d=function(t){let e="ENVMAP_MODE_REFLECTION";t.envMap&&t.envMapMode===k&&(e="ENVMAP_MODE_REFRACTION");return e}(r),f=function(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case B:e="ENVMAP_BLENDING_MULTIPLY";break;case S:e="ENVMAP_BLENDING_MIX";break;case M:e="ENVMAP_BLENDING_ADD"}return e}(r),g=function(t){const e=t.envMapCubeUVHeight;if(null===e)return null;const i=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,i),112)),texelHeight:n,maxMip:i}}(r),p=function(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(lo).join("\n")}(r),m=function(t){const e=[];for(const i in t){const n=t[i];!1!==n&&e.push("#define "+i+" "+n)}return e.join("\n")}(h),v=a.createProgram();let b,E,C=r.glslVersion?"#version "+r.glslVersion+"\n":"";r.isRawShaderMaterial?(b=["#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,m].filter(lo).join("\n"),b.length>0&&(b+="\n"),E=["#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,m].filter(lo).join("\n"),E.length>0&&(E+="\n")):(b=[Co(r),"#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,m,r.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",r.batching?"#define USE_BATCHING":"",r.instancing?"#define USE_INSTANCING":"",r.instancingColor?"#define USE_INSTANCING_COLOR":"",r.instancingMorph?"#define USE_INSTANCING_MORPH":"",r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+d:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",r.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",r.displacementMap?"#define USE_DISPLACEMENTMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.anisotropy?"#define USE_ANISOTROPY":"",r.anisotropyMap?"#define USE_ANISOTROPYMAP":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",r.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",r.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.alphaHash?"#define USE_ALPHAHASH":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",r.mapUv?"#define MAP_UV "+r.mapUv:"",r.alphaMapUv?"#define ALPHAMAP_UV "+r.alphaMapUv:"",r.lightMapUv?"#define LIGHTMAP_UV "+r.lightMapUv:"",r.aoMapUv?"#define AOMAP_UV "+r.aoMapUv:"",r.emissiveMapUv?"#define EMISSIVEMAP_UV "+r.emissiveMapUv:"",r.bumpMapUv?"#define BUMPMAP_UV "+r.bumpMapUv:"",r.normalMapUv?"#define NORMALMAP_UV "+r.normalMapUv:"",r.displacementMapUv?"#define DISPLACEMENTMAP_UV "+r.displacementMapUv:"",r.metalnessMapUv?"#define METALNESSMAP_UV "+r.metalnessMapUv:"",r.roughnessMapUv?"#define ROUGHNESSMAP_UV "+r.roughnessMapUv:"",r.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+r.anisotropyMapUv:"",r.clearcoatMapUv?"#define CLEARCOATMAP_UV "+r.clearcoatMapUv:"",r.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+r.clearcoatNormalMapUv:"",r.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+r.clearcoatRoughnessMapUv:"",r.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+r.iridescenceMapUv:"",r.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+r.iridescenceThicknessMapUv:"",r.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+r.sheenColorMapUv:"",r.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+r.sheenRoughnessMapUv:"",r.specularMapUv?"#define SPECULARMAP_UV "+r.specularMapUv:"",r.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+r.specularColorMapUv:"",r.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+r.specularIntensityMapUv:"",r.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+r.transmissionMapUv:"",r.thicknessMapUv?"#define THICKNESSMAP_UV "+r.thicknessMapUv:"",r.vertexTangents&&!1===r.flatShading?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUv1s?"#define USE_UV1":"",r.vertexUv2s?"#define USE_UV2":"",r.vertexUv3s?"#define USE_UV3":"",r.pointsUvs?"#define USE_POINTS_UV":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&!1===r.flatShading?"#define USE_MORPHNORMALS":"",r.morphColors?"#define USE_MORPHCOLORS":"",r.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE":"",r.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+r.morphTextureStride:"",r.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+r.morphTargetsCount:"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+A:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.numLightProbes>0?"#define USE_LIGHT_PROBES":"",r.useLegacyLights?"#define LEGACY_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","\tuniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","\tattribute vec2 uv1;","#endif","#ifdef USE_UV2","\tattribute vec2 uv2;","#endif","#ifdef USE_UV3","\tattribute vec2 uv3;","#endif","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(lo).join("\n"),E=[Co(r),"#define SHADER_TYPE "+r.shaderType,"#define SHADER_NAME "+r.shaderName,m,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+u:"",r.envMap?"#define "+d:"",r.envMap?"#define "+f:"",g?"#define CUBEUV_TEXEL_WIDTH "+g.texelWidth:"",g?"#define CUBEUV_TEXEL_HEIGHT "+g.texelHeight:"",g?"#define CUBEUV_MAX_MIP "+g.maxMip+".0":"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",r.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.anisotropy?"#define USE_ANISOTROPY":"",r.anisotropyMap?"#define USE_ANISOTROPYMAP":"",r.clearcoat?"#define USE_CLEARCOAT":"",r.clearcoatMap?"#define USE_CLEARCOATMAP":"",r.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.dispersion?"#define USE_DISPERSION":"",r.iridescence?"#define USE_IRIDESCENCE":"",r.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",r.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",r.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.alphaTest?"#define USE_ALPHATEST":"",r.alphaHash?"#define USE_ALPHAHASH":"",r.sheen?"#define USE_SHEEN":"",r.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",r.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",r.transmission?"#define USE_TRANSMISSION":"",r.transmissionMap?"#define USE_TRANSMISSIONMAP":"",r.thicknessMap?"#define USE_THICKNESSMAP":"",r.vertexTangents&&!1===r.flatShading?"#define USE_TANGENT":"",r.vertexColors||r.instancingColor?"#define USE_COLOR":"",r.vertexAlphas?"#define USE_COLOR_ALPHA":"",r.vertexUv1s?"#define USE_UV1":"",r.vertexUv2s?"#define USE_UV2":"",r.vertexUv3s?"#define USE_UV3":"",r.pointsUvs?"#define USE_POINTS_UV":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+A:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.numLightProbes>0?"#define USE_LIGHT_PROBES":"",r.useLegacyLights?"#define LEGACY_LIGHTS":"",r.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",r.toneMapping!==x?"#define TONE_MAPPING":"",r.toneMapping!==x?gs.tonemapping_pars_fragment:"",r.toneMapping!==x?co("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.opaque?"#define OPAQUE":"",gs.colorspace_pars_fragment,ho("linearToOutputTexel",r.outputColorSpace),r.useDepthPacking?"#define DEPTH_PACKING "+r.depthPacking:"","\n"].filter(lo).join("\n")),c=go(c),c=Ao(c,r),c=uo(c,r),l=go(l),l=Ao(l,r),l=uo(l,r),c=bo(c),l=bo(l),!0!==r.isRawShaderMaterial&&(C="#version 300 es\n",b=[p,"#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+b,E=["#define varying in",r.glslVersion===Jt?"":"layout(location = 0) out highp vec4 pc_fragColor;",r.glslVersion===Jt?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+E);const I=C+b+c,w=C+E+l,_=so(a,a.VERTEX_SHADER,I),y=so(a,a.FRAGMENT_SHADER,w);function Q(e){if(t.debug.checkShaderErrors){const i=a.getProgramInfoLog(v).trim(),n=a.getShaderInfoLog(_).trim(),s=a.getShaderInfoLog(y).trim();let r=!0,o=!0;if(!1===a.getProgramParameter(v,a.LINK_STATUS))if(r=!1,"function"==typeof t.debug.onShaderError)t.debug.onShaderError(a,v,_,y);else{const t=ao(a,_,"vertex"),n=ao(a,y,"fragment");console.error("THREE.WebGLProgram: Shader Error "+a.getError()+" - VALIDATE_STATUS "+a.getProgramParameter(v,a.VALIDATE_STATUS)+"\n\nMaterial Name: "+e.name+"\nMaterial Type: "+e.type+"\n\nProgram Info Log: "+i+"\n"+t+"\n"+n)}else""!==i?console.warn("THREE.WebGLProgram: Program Info Log:",i):""!==n&&""!==s||(o=!1);o&&(e.diagnostics={runnable:r,programLog:i,vertexShader:{log:n,prefix:b},fragmentShader:{log:s,prefix:E}})}a.deleteShader(_),a.deleteShader(y),T=new no(a,v),D=function(t,e){const i={},n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let s=0;s<n;s++){const n=t.getActiveAttrib(e,s),r=n.name;let o=1;n.type===t.FLOAT_MAT2&&(o=2),n.type===t.FLOAT_MAT3&&(o=3),n.type===t.FLOAT_MAT4&&(o=4),i[r]={type:n.type,location:t.getAttribLocation(e,r),locationSize:o}}return i}(a,v)}let T,D;a.attachShader(v,_),a.attachShader(v,y),void 0!==r.index0AttributeName?a.bindAttribLocation(v,0,r.index0AttributeName):!0===r.morphTargets&&a.bindAttribLocation(v,0,"position"),a.linkProgram(v),this.getUniforms=function(){return void 0===T&&Q(this),T},this.getAttributes=function(){return void 0===D&&Q(this),D};let L=!1===r.rendererExtensionParallelShaderCompile;return this.isReady=function(){return!1===L&&(L=a.getProgramParameter(v,ro)),L},this.destroy=function(){o.releaseStatesOfProgram(this),a.deleteProgram(v),this.program=void 0},this.type=r.shaderType,this.name=r.shaderName,this.id=oo++,this.cacheKey=s,this.usedTimes=1,this.program=v,this.vertexShader=_,this.fragmentShader=y,this}let wo=0;class _o{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(t){const e=t.vertexShader,i=t.fragmentShader,n=this._getShaderStage(e),s=this._getShaderStage(i),r=this._getShaderCacheForMaterial(t);return!1===r.has(n)&&(r.add(n),n.usedTimes++),!1===r.has(s)&&(r.add(s),s.usedTimes++),this}remove(t){const e=this.materialCache.get(t);for(const t of e)t.usedTimes--,0===t.usedTimes&&this.shaderCache.delete(t.code);return this.materialCache.delete(t),this}getVertexShaderID(t){return this._getShaderStage(t.vertexShader).id}getFragmentShaderID(t){return this._getShaderStage(t.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(t){const e=this.materialCache;let i=e.get(t);return void 0===i&&(i=new Set,e.set(t,i)),i}_getShaderStage(t){const e=this.shaderCache;let i=e.get(t);return void 0===i&&(i=new Bo(t),e.set(t,i)),i}}class Bo{constructor(t){this.id=wo++,this.code=t,this.usedTimes=0}}function So(t,e,i,n,s,o,a){const h=new _i,c=new _o,l=new Set,A=[],u=s.logarithmicDepthBuffer,d=s.vertexTextures;let f=s.precision;const g={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function p(t){return l.add(t),0===t?"uv":`uv${t}`}return{getParameters:function(o,h,A,m,v){const b=m.fog,E=v.geometry,C=o.isMeshStandardMaterial?m.environment:null,I=(o.isMeshStandardMaterial?i:e).get(o.envMap||C),w=I&&I.mapping===O?I.image.height:null,_=g[o.type];null!==o.precision&&(f=s.getMaxPrecision(o.precision),f!==o.precision&&console.warn("THREE.WebGLProgram.getParameters:",o.precision,"not supported, using",f,"instead."));const B=E.morphAttributes.position||E.morphAttributes.normal||E.morphAttributes.color,S=void 0!==B?B.length:0;let M,y,Q,T,D=0;if(void 0!==E.morphAttributes.position&&(D=1),void 0!==E.morphAttributes.normal&&(D=2),void 0!==E.morphAttributes.color&&(D=3),_){const t=ms[_];M=t.vertexShader,y=t.fragmentShader}else M=o.vertexShader,y=o.fragmentShader,c.update(o),Q=c.getVertexShaderID(o),T=c.getFragmentShaderID(o);const L=t.getRenderTarget(),R=!0===v.isInstancedMesh,P=!0===v.isBatchedMesh,U=!!o.map,N=!!o.matcap,k=!!I,F=!!o.aoMap,G=!!o.lightMap,H=!!o.bumpMap,V=!!o.normalMap,z=!!o.displacementMap,q=!!o.emissiveMap,W=!!o.metalnessMap,j=!!o.roughnessMap,J=o.anisotropy>0,Y=o.clearcoat>0,K=o.dispersion>0,X=o.iridescence>0,Z=o.sheen>0,$=o.transmission>0,tt=J&&!!o.anisotropyMap,et=Y&&!!o.clearcoatMap,it=Y&&!!o.clearcoatNormalMap,nt=Y&&!!o.clearcoatRoughnessMap,st=X&&!!o.iridescenceMap,rt=X&&!!o.iridescenceThicknessMap,ot=Z&&!!o.sheenColorMap,at=Z&&!!o.sheenRoughnessMap,ht=!!o.specularMap,ct=!!o.specularColorMap,lt=!!o.specularIntensityMap,At=$&&!!o.transmissionMap,ut=$&&!!o.thicknessMap,dt=!!o.gradientMap,ft=!!o.alphaMap,gt=o.alphaTest>0,pt=!!o.alphaHash,mt=!!o.extensions;let vt=x;o.toneMapped&&(null!==L&&!0!==L.isXRRenderTarget||(vt=t.toneMapping));const bt={shaderID:_,shaderType:o.type,shaderName:o.name,vertexShader:M,fragmentShader:y,defines:o.defines,customVertexShaderID:Q,customFragmentShaderID:T,isRawShaderMaterial:!0===o.isRawShaderMaterial,glslVersion:o.glslVersion,precision:f,batching:P,instancing:R,instancingColor:R&&null!==v.instanceColor,instancingMorph:R&&null!==v.morphTexture,supportsVertexTextures:d,outputColorSpace:null===L?t.outputColorSpace:!0===L.isXRRenderTarget?L.texture.colorSpace:Tt,alphaToCoverage:!!o.alphaToCoverage,map:U,matcap:N,envMap:k,envMapMode:k&&I.mapping,envMapCubeUVHeight:w,aoMap:F,lightMap:G,bumpMap:H,normalMap:V,displacementMap:d&&z,emissiveMap:q,normalMapObjectSpace:V&&1===o.normalMapType,normalMapTangentSpace:V&&0===o.normalMapType,metalnessMap:W,roughnessMap:j,anisotropy:J,anisotropyMap:tt,clearcoat:Y,clearcoatMap:et,clearcoatNormalMap:it,clearcoatRoughnessMap:nt,dispersion:K,iridescence:X,iridescenceMap:st,iridescenceThicknessMap:rt,sheen:Z,sheenColorMap:ot,sheenRoughnessMap:at,specularMap:ht,specularColorMap:ct,specularIntensityMap:lt,transmission:$,transmissionMap:At,thicknessMap:ut,gradientMap:dt,opaque:!1===o.transparent&&1===o.blending&&!1===o.alphaToCoverage,alphaMap:ft,alphaTest:gt,alphaHash:pt,combine:o.combine,mapUv:U&&p(o.map.channel),aoMapUv:F&&p(o.aoMap.channel),lightMapUv:G&&p(o.lightMap.channel),bumpMapUv:H&&p(o.bumpMap.channel),normalMapUv:V&&p(o.normalMap.channel),displacementMapUv:z&&p(o.displacementMap.channel),emissiveMapUv:q&&p(o.emissiveMap.channel),metalnessMapUv:W&&p(o.metalnessMap.channel),roughnessMapUv:j&&p(o.roughnessMap.channel),anisotropyMapUv:tt&&p(o.anisotropyMap.channel),clearcoatMapUv:et&&p(o.clearcoatMap.channel),clearcoatNormalMapUv:it&&p(o.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:nt&&p(o.clearcoatRoughnessMap.channel),iridescenceMapUv:st&&p(o.iridescenceMap.channel),iridescenceThicknessMapUv:rt&&p(o.iridescenceThicknessMap.channel),sheenColorMapUv:ot&&p(o.sheenColorMap.channel),sheenRoughnessMapUv:at&&p(o.sheenRoughnessMap.channel),specularMapUv:ht&&p(o.specularMap.channel),specularColorMapUv:ct&&p(o.specularColorMap.channel),specularIntensityMapUv:lt&&p(o.specularIntensityMap.channel),transmissionMapUv:At&&p(o.transmissionMap.channel),thicknessMapUv:ut&&p(o.thicknessMap.channel),alphaMapUv:ft&&p(o.alphaMap.channel),vertexTangents:!!E.attributes.tangent&&(V||J),vertexColors:o.vertexColors,vertexAlphas:!0===o.vertexColors&&!!E.attributes.color&&4===E.attributes.color.itemSize,pointsUvs:!0===v.isPoints&&!!E.attributes.uv&&(U||ft),fog:!!b,useFog:!0===o.fog,fogExp2:!!b&&b.isFogExp2,flatShading:!0===o.flatShading,sizeAttenuation:!0===o.sizeAttenuation,logarithmicDepthBuffer:u,skinning:!0===v.isSkinnedMesh,morphTargets:void 0!==E.morphAttributes.position,morphNormals:void 0!==E.morphAttributes.normal,morphColors:void 0!==E.morphAttributes.color,morphTargetsCount:S,morphTextureStride:D,numDirLights:h.directional.length,numPointLights:h.point.length,numSpotLights:h.spot.length,numSpotLightMaps:h.spotLightMap.length,numRectAreaLights:h.rectArea.length,numHemiLights:h.hemi.length,numDirLightShadows:h.directionalShadowMap.length,numPointLightShadows:h.pointShadowMap.length,numSpotLightShadows:h.spotShadowMap.length,numSpotLightShadowsWithMaps:h.numSpotLightShadowsWithMaps,numLightProbes:h.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:o.dithering,shadowMapEnabled:t.shadowMap.enabled&&A.length>0,shadowMapType:t.shadowMap.type,toneMapping:vt,useLegacyLights:t._useLegacyLights,decodeVideoTexture:U&&!0===o.map.isVideoTexture&&Ce.getTransfer(o.map.colorSpace)===Pt,premultipliedAlpha:o.premultipliedAlpha,doubleSided:2===o.side,flipSided:o.side===r,useDepthPacking:o.depthPacking>=0,depthPacking:o.depthPacking||0,index0AttributeName:o.index0AttributeName,extensionClipCullDistance:mt&&!0===o.extensions.clipCullDistance&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:mt&&!0===o.extensions.multiDraw&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:o.customProgramCacheKey()};return bt.vertexUv1s=l.has(1),bt.vertexUv2s=l.has(2),bt.vertexUv3s=l.has(3),l.clear(),bt},getProgramCacheKey:function(e){const i=[];if(e.shaderID?i.push(e.shaderID):(i.push(e.customVertexShaderID),i.push(e.customFragmentShaderID)),void 0!==e.defines)for(const t in e.defines)i.push(t),i.push(e.defines[t]);return!1===e.isRawShaderMaterial&&(!function(t,e){t.push(e.precision),t.push(e.outputColorSpace),t.push(e.envMapMode),t.push(e.envMapCubeUVHeight),t.push(e.mapUv),t.push(e.alphaMapUv),t.push(e.lightMapUv),t.push(e.aoMapUv),t.push(e.bumpMapUv),t.push(e.normalMapUv),t.push(e.displacementMapUv),t.push(e.emissiveMapUv),t.push(e.metalnessMapUv),t.push(e.roughnessMapUv),t.push(e.anisotropyMapUv),t.push(e.clearcoatMapUv),t.push(e.clearcoatNormalMapUv),t.push(e.clearcoatRoughnessMapUv),t.push(e.iridescenceMapUv),t.push(e.iridescenceThicknessMapUv),t.push(e.sheenColorMapUv),t.push(e.sheenRoughnessMapUv),t.push(e.specularMapUv),t.push(e.specularColorMapUv),t.push(e.specularIntensityMapUv),t.push(e.transmissionMapUv),t.push(e.thicknessMapUv),t.push(e.combine),t.push(e.fogExp2),t.push(e.sizeAttenuation),t.push(e.morphTargetsCount),t.push(e.morphAttributeCount),t.push(e.numDirLights),t.push(e.numPointLights),t.push(e.numSpotLights),t.push(e.numSpotLightMaps),t.push(e.numHemiLights),t.push(e.numRectAreaLights),t.push(e.numDirLightShadows),t.push(e.numPointLightShadows),t.push(e.numSpotLightShadows),t.push(e.numSpotLightShadowsWithMaps),t.push(e.numLightProbes),t.push(e.shadowMapType),t.push(e.toneMapping),t.push(e.numClippingPlanes),t.push(e.numClipIntersection),t.push(e.depthPacking)}(i,e),function(t,e){h.disableAll(),e.supportsVertexTextures&&h.enable(0);e.instancing&&h.enable(1);e.instancingColor&&h.enable(2);e.instancingMorph&&h.enable(3);e.matcap&&h.enable(4);e.envMap&&h.enable(5);e.normalMapObjectSpace&&h.enable(6);e.normalMapTangentSpace&&h.enable(7);e.clearcoat&&h.enable(8);e.iridescence&&h.enable(9);e.alphaTest&&h.enable(10);e.vertexColors&&h.enable(11);e.vertexAlphas&&h.enable(12);e.vertexUv1s&&h.enable(13);e.vertexUv2s&&h.enable(14);e.vertexUv3s&&h.enable(15);e.vertexTangents&&h.enable(16);e.anisotropy&&h.enable(17);e.alphaHash&&h.enable(18);e.batching&&h.enable(19);e.dispersion&&h.enable(20);t.push(h.mask),h.disableAll(),e.fog&&h.enable(0);e.useFog&&h.enable(1);e.flatShading&&h.enable(2);e.logarithmicDepthBuffer&&h.enable(3);e.skinning&&h.enable(4);e.morphTargets&&h.enable(5);e.morphNormals&&h.enable(6);e.morphColors&&h.enable(7);e.premultipliedAlpha&&h.enable(8);e.shadowMapEnabled&&h.enable(9);e.useLegacyLights&&h.enable(10);e.doubleSided&&h.enable(11);e.flipSided&&h.enable(12);e.useDepthPacking&&h.enable(13);e.dithering&&h.enable(14);e.transmission&&h.enable(15);e.sheen&&h.enable(16);e.opaque&&h.enable(17);e.pointsUvs&&h.enable(18);e.decodeVideoTexture&&h.enable(19);e.alphaToCoverage&&h.enable(20);t.push(h.mask)}(i,e),i.push(t.outputColorSpace)),i.push(e.customProgramCacheKey),i.join()},getUniforms:function(t){const e=g[t.type];let i;if(e){const t=ms[e];i=Jn.clone(t.uniforms)}else i=t.uniforms;return i},acquireProgram:function(e,i){let n;for(let t=0,e=A.length;t<e;t++){const e=A[t];if(e.cacheKey===i){n=e,++n.usedTimes;break}}return void 0===n&&(n=new Io(t,i,e,o),A.push(n)),n},releaseProgram:function(t){if(0==--t.usedTimes){const e=A.indexOf(t);A[e]=A[A.length-1],A.pop(),t.destroy()}},releaseShaderCache:function(t){c.remove(t)},programs:A,dispose:function(){c.dispose()}}}function Mo(){let t=new WeakMap;return{get:function(e){let i=t.get(e);return void 0===i&&(i={},t.set(e,i)),i},remove:function(e){t.delete(e)},update:function(e,i,n){t.get(e)[i]=n},dispose:function(){t=new WeakMap}}}function xo(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function yo(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function Qo(){const t=[];let e=0;const i=[],n=[],s=[];function r(i,n,s,r,o,a){let h=t[e];return void 0===h?(h={id:i.id,object:i,geometry:n,material:s,groupOrder:r,renderOrder:i.renderOrder,z:o,group:a},t[e]=h):(h.id=i.id,h.object=i,h.geometry=n,h.material=s,h.groupOrder=r,h.renderOrder=i.renderOrder,h.z=o,h.group=a),e++,h}return{opaque:i,transmissive:n,transparent:s,init:function(){e=0,i.length=0,n.length=0,s.length=0},push:function(t,e,o,a,h,c){const l=r(t,e,o,a,h,c);o.transmission>0?n.push(l):!0===o.transparent?s.push(l):i.push(l)},unshift:function(t,e,o,a,h,c){const l=r(t,e,o,a,h,c);o.transmission>0?n.unshift(l):!0===o.transparent?s.unshift(l):i.unshift(l)},finish:function(){for(let i=e,n=t.length;i<n;i++){const e=t[i];if(null===e.id)break;e.id=null,e.object=null,e.geometry=null,e.material=null,e.group=null}},sort:function(t,e){i.length>1&&i.sort(t||xo),n.length>1&&n.sort(e||yo),s.length>1&&s.sort(e||yo)}}}function To(){let t=new WeakMap;return{get:function(e,i){const n=t.get(e);let s;return void 0===n?(s=new Qo,t.set(e,[s])):i>=n.length?(s=new Qo,n.push(s)):s=n[i],s},dispose:function(){t=new WeakMap}}}function Do(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":i={direction:new Ne,color:new nn};break;case"SpotLight":i={position:new Ne,direction:new Ne,color:new nn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Ne,color:new nn,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Ne,skyColor:new nn,groundColor:new nn};break;case"RectAreaLight":i={color:new nn,position:new Ne,halfWidth:new Ne,halfHeight:new Ne}}return t[e.id]=i,i}}}let Lo=0;function Ro(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function Po(t){const e=new Do,i=function(){const t={};return{get:function(e){if(void 0!==t[e.id])return t[e.id];let i;switch(e.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ce};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ce,shadowCameraNear:1,shadowCameraFar:1e3}}return t[e.id]=i,i}}}(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let t=0;t<9;t++)n.probe.push(new Ne);const s=new Ne,r=new di,o=new di;return{setup:function(s,r){let o=0,a=0,h=0;for(let t=0;t<9;t++)n.probe[t].set(0,0,0);let c=0,l=0,A=0,u=0,d=0,f=0,g=0,p=0,m=0,v=0,b=0;s.sort(Ro);const E=!0===r?Math.PI:1;for(let t=0,r=s.length;t<r;t++){const r=s[t],C=r.color,I=r.intensity,w=r.distance,_=r.shadow&&r.shadow.map?r.shadow.map.texture:null;if(r.isAmbientLight)o+=C.r*I*E,a+=C.g*I*E,h+=C.b*I*E;else if(r.isLightProbe){for(let t=0;t<9;t++)n.probe[t].addScaledVector(r.sh.coefficients[t],I);b++}else if(r.isDirectionalLight){const t=e.get(r);if(t.color.copy(r.color).multiplyScalar(r.intensity*E),r.castShadow){const t=r.shadow,e=i.get(r);e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,n.directionalShadow[c]=e,n.directionalShadowMap[c]=_,n.directionalShadowMatrix[c]=r.shadow.matrix,f++}n.directional[c]=t,c++}else if(r.isSpotLight){const t=e.get(r);t.position.setFromMatrixPosition(r.matrixWorld),t.color.copy(C).multiplyScalar(I*E),t.distance=w,t.coneCos=Math.cos(r.angle),t.penumbraCos=Math.cos(r.angle*(1-r.penumbra)),t.decay=r.decay,n.spot[A]=t;const s=r.shadow;if(r.map&&(n.spotLightMap[m]=r.map,m++,s.updateMatrices(r),r.castShadow&&v++),n.spotLightMatrix[A]=s.matrix,r.castShadow){const t=i.get(r);t.shadowBias=s.bias,t.shadowNormalBias=s.normalBias,t.shadowRadius=s.radius,t.shadowMapSize=s.mapSize,n.spotShadow[A]=t,n.spotShadowMap[A]=_,p++}A++}else if(r.isRectAreaLight){const t=e.get(r);t.color.copy(C).multiplyScalar(I),t.halfWidth.set(.5*r.width,0,0),t.halfHeight.set(0,.5*r.height,0),n.rectArea[u]=t,u++}else if(r.isPointLight){const t=e.get(r);if(t.color.copy(r.color).multiplyScalar(r.intensity*E),t.distance=r.distance,t.decay=r.decay,r.castShadow){const t=r.shadow,e=i.get(r);e.shadowBias=t.bias,e.shadowNormalBias=t.normalBias,e.shadowRadius=t.radius,e.shadowMapSize=t.mapSize,e.shadowCameraNear=t.camera.near,e.shadowCameraFar=t.camera.far,n.pointShadow[l]=e,n.pointShadowMap[l]=_,n.pointShadowMatrix[l]=r.shadow.matrix,g++}n.point[l]=t,l++}else if(r.isHemisphereLight){const t=e.get(r);t.skyColor.copy(r.color).multiplyScalar(I*E),t.groundColor.copy(r.groundColor).multiplyScalar(I*E),n.hemi[d]=t,d++}}u>0&&(!0===t.has("OES_texture_float_linear")?(n.rectAreaLTC1=ps.LTC_FLOAT_1,n.rectAreaLTC2=ps.LTC_FLOAT_2):(n.rectAreaLTC1=ps.LTC_HALF_1,n.rectAreaLTC2=ps.LTC_HALF_2)),n.ambient[0]=o,n.ambient[1]=a,n.ambient[2]=h;const C=n.hash;C.directionalLength===c&&C.pointLength===l&&C.spotLength===A&&C.rectAreaLength===u&&C.hemiLength===d&&C.numDirectionalShadows===f&&C.numPointShadows===g&&C.numSpotShadows===p&&C.numSpotMaps===m&&C.numLightProbes===b||(n.directional.length=c,n.spot.length=A,n.rectArea.length=u,n.point.length=l,n.hemi.length=d,n.directionalShadow.length=f,n.directionalShadowMap.length=f,n.pointShadow.length=g,n.pointShadowMap.length=g,n.spotShadow.length=p,n.spotShadowMap.length=p,n.directionalShadowMatrix.length=f,n.pointShadowMatrix.length=g,n.spotLightMatrix.length=p+m-v,n.spotLightMap.length=m,n.numSpotLightShadowsWithMaps=v,n.numLightProbes=b,C.directionalLength=c,C.pointLength=l,C.spotLength=A,C.rectAreaLength=u,C.hemiLength=d,C.numDirectionalShadows=f,C.numPointShadows=g,C.numSpotShadows=p,C.numSpotMaps=m,C.numLightProbes=b,n.version=Lo++)},setupView:function(t,e){let i=0,a=0,h=0,c=0,l=0;const A=e.matrixWorldInverse;for(let e=0,u=t.length;e<u;e++){const u=t[e];if(u.isDirectionalLight){const t=n.directional[i];t.direction.setFromMatrixPosition(u.matrixWorld),s.setFromMatrixPosition(u.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(A),i++}else if(u.isSpotLight){const t=n.spot[h];t.position.setFromMatrixPosition(u.matrixWorld),t.position.applyMatrix4(A),t.direction.setFromMatrixPosition(u.matrixWorld),s.setFromMatrixPosition(u.target.matrixWorld),t.direction.sub(s),t.direction.transformDirection(A),h++}else if(u.isRectAreaLight){const t=n.rectArea[c];t.position.setFromMatrixPosition(u.matrixWorld),t.position.applyMatrix4(A),o.identity(),r.copy(u.matrixWorld),r.premultiply(A),o.extractRotation(r),t.halfWidth.set(.5*u.width,0,0),t.halfHeight.set(0,.5*u.height,0),t.halfWidth.applyMatrix4(o),t.halfHeight.applyMatrix4(o),c++}else if(u.isPointLight){const t=n.point[a];t.position.setFromMatrixPosition(u.matrixWorld),t.position.applyMatrix4(A),a++}else if(u.isHemisphereLight){const t=n.hemi[l];t.direction.setFromMatrixPosition(u.matrixWorld),t.direction.transformDirection(A),l++}}},state:n}}function Uo(t){const e=new Po(t),i=[],n=[];const s={lightsArray:i,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:function(t){s.camera=t,i.length=0,n.length=0},state:s,setupLights:function(t){e.setup(i,t)},setupLightsView:function(t){e.setupView(i,t)},pushLight:function(t){i.push(t)},pushShadow:function(t){n.push(t)}}}function No(t){let e=new WeakMap;return{get:function(i,n=0){const s=e.get(i);let r;return void 0===s?(r=new Uo(t),e.set(i,[r])):n>=s.length?(r=new Uo(t),s.push(r)):r=s[n],r},dispose:function(){e=new WeakMap}}}class ko extends on{constructor(t){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(t)}copy(t){return super.copy(t),this.depthPacking=t.depthPacking,this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this}}class Fo extends on{constructor(t){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(t)}copy(t){return super.copy(t),this.map=t.map,this.alphaMap=t.alphaMap,this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this}}function Oo(t,i,a){let h=new As;const c=new ce,l=new ce,A=new Te,u=new ko({depthPacking:3201}),d=new Fo,f={},g=a.maxTextureSize,p={[s]:r,[r]:s,[o]:2},m=new Yn({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new ce},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),v=m.clone();v.defines.HORIZONTAL_PASS=1;const b=new _n;b.setAttribute("position",new dn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const E=new Hn(b,m),C=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=e;let I=this.type;function w(e,n){const s=i.update(E);m.defines.VSM_SAMPLES!==e.blurSamples&&(m.defines.VSM_SAMPLES=e.blurSamples,v.defines.VSM_SAMPLES=e.blurSamples,m.needsUpdate=!0,v.needsUpdate=!0),null===e.mapPass&&(e.mapPass=new Le(c.x,c.y)),m.uniforms.shadow_pass.value=e.map.texture,m.uniforms.resolution.value=e.mapSize,m.uniforms.radius.value=e.radius,t.setRenderTarget(e.mapPass),t.clear(),t.renderBufferDirect(n,null,s,m,E,null),v.uniforms.shadow_pass.value=e.mapPass.texture,v.uniforms.resolution.value=e.mapSize,v.uniforms.radius.value=e.radius,t.setRenderTarget(e.map),t.clear(),t.renderBufferDirect(n,null,s,v,E,null)}function _(e,i,s,r){let o=null;const a=!0===s.isPointLight?e.customDistanceMaterial:e.customDepthMaterial;if(void 0!==a)o=a;else if(o=!0===s.isPointLight?d:u,t.localClippingEnabled&&!0===i.clipShadows&&Array.isArray(i.clippingPlanes)&&0!==i.clippingPlanes.length||i.displacementMap&&0!==i.displacementScale||i.alphaMap&&i.alphaTest>0||i.map&&i.alphaTest>0){const t=o.uuid,e=i.uuid;let n=f[t];void 0===n&&(n={},f[t]=n);let s=n[e];void 0===s&&(s=o.clone(),n[e]=s,i.addEventListener("dispose",S)),o=s}if(o.visible=i.visible,o.wireframe=i.wireframe,o.side=r===n?null!==i.shadowSide?i.shadowSide:i.side:null!==i.shadowSide?i.shadowSide:p[i.side],o.alphaMap=i.alphaMap,o.alphaTest=i.alphaTest,o.map=i.map,o.clipShadows=i.clipShadows,o.clippingPlanes=i.clippingPlanes,o.clipIntersection=i.clipIntersection,o.displacementMap=i.displacementMap,o.displacementScale=i.displacementScale,o.displacementBias=i.displacementBias,o.wireframeLinewidth=i.wireframeLinewidth,o.linewidth=i.linewidth,!0===s.isPointLight&&!0===o.isMeshDistanceMaterial){t.properties.get(o).light=s}return o}function B(e,s,r,o,a){if(!1===e.visible)return;if(e.layers.test(s.layers)&&(e.isMesh||e.isLine||e.isPoints)&&(e.castShadow||e.receiveShadow&&a===n)&&(!e.frustumCulled||h.intersectsObject(e))){e.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,e.matrixWorld);const n=i.update(e),h=e.material;if(Array.isArray(h)){const i=n.groups;for(let c=0,l=i.length;c<l;c++){const l=i[c],A=h[l.materialIndex];if(A&&A.visible){const i=_(e,A,o,a);e.onBeforeShadow(t,e,s,r,n,i,l),t.renderBufferDirect(r,null,n,i,e,l),e.onAfterShadow(t,e,s,r,n,i,l)}}}else if(h.visible){const i=_(e,h,o,a);e.onBeforeShadow(t,e,s,r,n,i,null),t.renderBufferDirect(r,null,n,i,e,null),e.onAfterShadow(t,e,s,r,n,i,null)}}const c=e.children;for(let t=0,e=c.length;t<e;t++)B(c[t],s,r,o,a)}function S(t){t.target.removeEventListener("dispose",S);for(const e in f){const i=f[e],n=t.target.uuid;if(n in i){i[n].dispose(),delete i[n]}}}this.render=function(e,i,s){if(!1===C.enabled)return;if(!1===C.autoUpdate&&!1===C.needsUpdate)return;if(0===e.length)return;const r=t.getRenderTarget(),o=t.getActiveCubeFace(),a=t.getActiveMipmapLevel(),u=t.state;u.setBlending(0),u.buffers.color.setClear(1,1,1,1),u.buffers.depth.setTest(!0),u.setScissorTest(!1);const d=I!==n&&this.type===n,f=I===n&&this.type!==n;for(let r=0,o=e.length;r<o;r++){const o=e[r],a=o.shadow;if(void 0===a){console.warn("THREE.WebGLShadowMap:",o,"has no shadow.");continue}if(!1===a.autoUpdate&&!1===a.needsUpdate)continue;c.copy(a.mapSize);const p=a.getFrameExtents();if(c.multiply(p),l.copy(a.mapSize),(c.x>g||c.y>g)&&(c.x>g&&(l.x=Math.floor(g/p.x),c.x=l.x*p.x,a.mapSize.x=l.x),c.y>g&&(l.y=Math.floor(g/p.y),c.y=l.y*p.y,a.mapSize.y=l.y)),null===a.map||!0===d||!0===f){const t=this.type!==n?{minFilter:z,magFilter:z}:{};null!==a.map&&a.map.dispose(),a.map=new Le(c.x,c.y,t),a.map.texture.name=o.name+".shadowMap",a.camera.updateProjectionMatrix()}t.setRenderTarget(a.map),t.clear();const m=a.getViewportCount();for(let t=0;t<m;t++){const e=a.getViewport(t);A.set(l.x*e.x,l.y*e.y,l.x*e.z,l.y*e.w),u.viewport(A),a.updateMatrices(o,t),h=a.getFrustum(),B(i,s,a.camera,o,this.type)}!0!==a.isPointLightShadow&&this.type===n&&w(a,s),a.needsUpdate=!1}I=this.type,C.needsUpdate=!1,t.setRenderTarget(r,o,a)}}function Go(t){const e=new function(){let e=!1;const i=new Te;let n=null;const s=new Te(0,0,0,0);return{setMask:function(i){n===i||e||(t.colorMask(i,i,i,i),n=i)},setLocked:function(t){e=t},setClear:function(e,n,r,o,a){!0===a&&(e*=o,n*=o,r*=o),i.set(e,n,r,o),!1===s.equals(i)&&(t.clearColor(e,n,r,o),s.copy(i))},reset:function(){e=!1,n=null,s.set(-1,0,0,0)}}},i=new function(){let e=!1,i=null,n=null,s=null;return{setTest:function(e){e?st(t.DEPTH_TEST):rt(t.DEPTH_TEST)},setMask:function(n){i===n||e||(t.depthMask(n),i=n)},setFunc:function(e){if(n!==e){switch(e){case 0:t.depthFunc(t.NEVER);break;case 1:t.depthFunc(t.ALWAYS);break;case 2:t.depthFunc(t.LESS);break;case 3:default:t.depthFunc(t.LEQUAL);break;case 4:t.depthFunc(t.EQUAL);break;case 5:t.depthFunc(t.GEQUAL);break;case 6:t.depthFunc(t.GREATER);break;case 7:t.depthFunc(t.NOTEQUAL)}n=e}},setLocked:function(t){e=t},setClear:function(e){s!==e&&(t.clearDepth(e),s=e)},reset:function(){e=!1,i=null,n=null,s=null}}},n=new function(){let e=!1,i=null,n=null,s=null,r=null,o=null,a=null,h=null,c=null;return{setTest:function(i){e||(i?st(t.STENCIL_TEST):rt(t.STENCIL_TEST))},setMask:function(n){i===n||e||(t.stencilMask(n),i=n)},setFunc:function(e,i,o){n===e&&s===i&&r===o||(t.stencilFunc(e,i,o),n=e,s=i,r=o)},setOp:function(e,i,n){o===e&&a===i&&h===n||(t.stencilOp(e,i,n),o=e,a=i,h=n)},setLocked:function(t){e=t},setClear:function(e){c!==e&&(t.clearStencil(e),c=e)},reset:function(){e=!1,i=null,n=null,s=null,r=null,o=null,a=null,h=null,c=null}}},s=new WeakMap,o=new WeakMap;let B={},S={},M=new WeakMap,x=[],y=null,Q=!1,T=null,D=null,L=null,R=null,P=null,U=null,N=null,k=new nn(0,0,0),F=0,O=!1,G=null,H=null,V=null,z=null,q=null;const W=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let j=!1,J=0;const Y=t.getParameter(t.VERSION);-1!==Y.indexOf("WebGL")?(J=parseFloat(/^WebGL (\d)/.exec(Y)[1]),j=J>=1):-1!==Y.indexOf("OpenGL ES")&&(J=parseFloat(/^OpenGL ES (\d)/.exec(Y)[1]),j=J>=2);let K=null,X={};const Z=t.getParameter(t.SCISSOR_BOX),$=t.getParameter(t.VIEWPORT),tt=(new Te).fromArray(Z),et=(new Te).fromArray($);function it(e,i,n,s){const r=new Uint8Array(4),o=t.createTexture();t.bindTexture(e,o),t.texParameteri(e,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(e,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let o=0;o<n;o++)e===t.TEXTURE_3D||e===t.TEXTURE_2D_ARRAY?t.texImage3D(i,0,t.RGBA,1,1,s,0,t.RGBA,t.UNSIGNED_BYTE,r):t.texImage2D(i+o,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,r);return o}const nt={};function st(e){!0!==B[e]&&(t.enable(e),B[e]=!0)}function rt(e){!1!==B[e]&&(t.disable(e),B[e]=!1)}nt[t.TEXTURE_2D]=it(t.TEXTURE_2D,t.TEXTURE_2D,1),nt[t.TEXTURE_CUBE_MAP]=it(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),nt[t.TEXTURE_2D_ARRAY]=it(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),nt[t.TEXTURE_3D]=it(t.TEXTURE_3D,t.TEXTURE_3D,1,1),e.setClear(0,0,0,1),i.setClear(1),n.setClear(0),st(t.DEPTH_TEST),i.setFunc(3),ct(!1),lt(1),st(t.CULL_FACE),ht(0);const ot={[a]:t.FUNC_ADD,[h]:t.FUNC_SUBTRACT,[c]:t.FUNC_REVERSE_SUBTRACT};ot[103]=t.MIN,ot[104]=t.MAX;const at={[l]:t.ZERO,[A]:t.ONE,[u]:t.SRC_COLOR,[f]:t.SRC_ALPHA,[E]:t.SRC_ALPHA_SATURATE,[v]:t.DST_COLOR,[p]:t.DST_ALPHA,[d]:t.ONE_MINUS_SRC_COLOR,[g]:t.ONE_MINUS_SRC_ALPHA,[b]:t.ONE_MINUS_DST_COLOR,[m]:t.ONE_MINUS_DST_ALPHA,[C]:t.CONSTANT_COLOR,[I]:t.ONE_MINUS_CONSTANT_COLOR,[w]:t.CONSTANT_ALPHA,[_]:t.ONE_MINUS_CONSTANT_ALPHA};function ht(e,i,n,s,r,o,h,c,l,A){if(0!==e){if(!1===Q&&(st(t.BLEND),Q=!0),5===e)r=r||i,o=o||n,h=h||s,i===D&&r===P||(t.blendEquationSeparate(ot[i],ot[r]),D=i,P=r),n===L&&s===R&&o===U&&h===N||(t.blendFuncSeparate(at[n],at[s],at[o],at[h]),L=n,R=s,U=o,N=h),!1!==c.equals(k)&&l===F||(t.blendColor(c.r,c.g,c.b,l),k.copy(c),F=l),T=e,O=!1;else if(e!==T||A!==O){if(D===a&&P===a||(t.blendEquation(t.FUNC_ADD),D=a,P=a),A)switch(e){case 1:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.ONE,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}else switch(e){case 1:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case 2:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case 3:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case 4:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e)}L=null,R=null,U=null,N=null,k.set(0,0,0),F=0,T=e,O=A}}else!0===Q&&(rt(t.BLEND),Q=!1)}function ct(e){G!==e&&(e?t.frontFace(t.CW):t.frontFace(t.CCW),G=e)}function lt(e){0!==e?(st(t.CULL_FACE),e!==H&&(1===e?t.cullFace(t.BACK):2===e?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):rt(t.CULL_FACE),H=e}function At(e,i,n){e?(st(t.POLYGON_OFFSET_FILL),z===i&&q===n||(t.polygonOffset(i,n),z=i,q=n)):rt(t.POLYGON_OFFSET_FILL)}return{buffers:{color:e,depth:i,stencil:n},enable:st,disable:rt,bindFramebuffer:function(e,i){return S[e]!==i&&(t.bindFramebuffer(e,i),S[e]=i,e===t.DRAW_FRAMEBUFFER&&(S[t.FRAMEBUFFER]=i),e===t.FRAMEBUFFER&&(S[t.DRAW_FRAMEBUFFER]=i),!0)},drawBuffers:function(e,i){let n=x,s=!1;if(e){n=M.get(i),void 0===n&&(n=[],M.set(i,n));const r=e.textures;if(n.length!==r.length||n[0]!==t.COLOR_ATTACHMENT0){for(let e=0,i=r.length;e<i;e++)n[e]=t.COLOR_ATTACHMENT0+e;n.length=r.length,s=!0}}else n[0]!==t.BACK&&(n[0]=t.BACK,s=!0);s&&t.drawBuffers(n)},useProgram:function(e){return y!==e&&(t.useProgram(e),y=e,!0)},setBlending:ht,setMaterial:function(s,o){2===s.side?rt(t.CULL_FACE):st(t.CULL_FACE);let a=s.side===r;o&&(a=!a),ct(a),1===s.blending&&!1===s.transparent?ht(0):ht(s.blending,s.blendEquation,s.blendSrc,s.blendDst,s.blendEquationAlpha,s.blendSrcAlpha,s.blendDstAlpha,s.blendColor,s.blendAlpha,s.premultipliedAlpha),i.setFunc(s.depthFunc),i.setTest(s.depthTest),i.setMask(s.depthWrite),e.setMask(s.colorWrite);const h=s.stencilWrite;n.setTest(h),h&&(n.setMask(s.stencilWriteMask),n.setFunc(s.stencilFunc,s.stencilRef,s.stencilFuncMask),n.setOp(s.stencilFail,s.stencilZFail,s.stencilZPass)),At(s.polygonOffset,s.polygonOffsetFactor,s.polygonOffsetUnits),!0===s.alphaToCoverage?st(t.SAMPLE_ALPHA_TO_COVERAGE):rt(t.SAMPLE_ALPHA_TO_COVERAGE)},setFlipSided:ct,setCullFace:lt,setLineWidth:function(e){e!==V&&(j&&t.lineWidth(e),V=e)},setPolygonOffset:At,setScissorTest:function(e){e?st(t.SCISSOR_TEST):rt(t.SCISSOR_TEST)},activeTexture:function(e){void 0===e&&(e=t.TEXTURE0+W-1),K!==e&&(t.activeTexture(e),K=e)},bindTexture:function(e,i,n){void 0===n&&(n=null===K?t.TEXTURE0+W-1:K);let s=X[n];void 0===s&&(s={type:void 0,texture:void 0},X[n]=s),s.type===e&&s.texture===i||(K!==n&&(t.activeTexture(n),K=n),t.bindTexture(e,i||nt[e]),s.type=e,s.texture=i)},unbindTexture:function(){const e=X[K];void 0!==e&&void 0!==e.type&&(t.bindTexture(e.type,null),e.type=void 0,e.texture=void 0)},compressedTexImage2D:function(){try{t.compressedTexImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexImage3D:function(){try{t.compressedTexImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{t.texImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{t.texImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},updateUBOMapping:function(e,i){let n=o.get(i);void 0===n&&(n=new WeakMap,o.set(i,n));let s=n.get(e);void 0===s&&(s=t.getUniformBlockIndex(i,e.name),n.set(e,s))},uniformBlockBinding:function(e,i){const n=o.get(i).get(e);s.get(i)!==n&&(t.uniformBlockBinding(i,n,e.__bindingPointIndex),s.set(i,n))},texStorage2D:function(){try{t.texStorage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{t.texStorage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{t.texSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{t.texSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage3D:function(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(e){!1===tt.equals(e)&&(t.scissor(e.x,e.y,e.z,e.w),tt.copy(e))},viewport:function(e){!1===et.equals(e)&&(t.viewport(e.x,e.y,e.z,e.w),et.copy(e))},reset:function(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),B={},K=null,X={},S={},M=new WeakMap,x=[],y=null,Q=!1,T=null,D=null,L=null,R=null,P=null,U=null,N=null,k=new nn(0,0,0),F=0,O=!1,G=null,H=null,V=null,z=null,q=null,tt.set(0,0,t.canvas.width,t.canvas.height),et.set(0,0,t.canvas.width,t.canvas.height),e.reset(),i.reset(),n.reset()}}}function Ho(t,e,i,n,s,r,o){const a=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,h="undefined"!=typeof navigator&&/OculusBrowser/g.test(navigator.userAgent),c=new ce,l=new WeakMap;let A;const u=new WeakMap;let d=!1;try{d="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(t){}function f(t,e){return d?new OffscreenCanvas(t,e):de("canvas")}function g(t,e,i){let n=1;const s=F(t);if((s.width>i||s.height>i)&&(n=i/Math.max(s.width,s.height)),n<1){if("undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&t instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof VideoFrame&&t instanceof VideoFrame){const i=Math.floor(n*s.width),r=Math.floor(n*s.height);void 0===A&&(A=f(i,r));const o=e?f(i,r):A;o.width=i,o.height=r;return o.getContext("2d").drawImage(t,0,0,i,r),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+s.width+"x"+s.height+") to ("+i+"x"+r+")."),o}return"data"in t&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+s.width+"x"+s.height+")."),t}return t}function p(t){return t.generateMipmaps&&t.minFilter!==z&&t.minFilter!==j}function m(e){t.generateMipmap(e)}function v(i,n,s,r,o=!1){if(null!==i){if(void 0!==t[i])return t[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let a=n;if(n===t.RED&&(s===t.FLOAT&&(a=t.R32F),s===t.HALF_FLOAT&&(a=t.R16F),s===t.UNSIGNED_BYTE&&(a=t.R8)),n===t.RED_INTEGER&&(s===t.UNSIGNED_BYTE&&(a=t.R8UI),s===t.UNSIGNED_SHORT&&(a=t.R16UI),s===t.UNSIGNED_INT&&(a=t.R32UI),s===t.BYTE&&(a=t.R8I),s===t.SHORT&&(a=t.R16I),s===t.INT&&(a=t.R32I)),n===t.RG&&(s===t.FLOAT&&(a=t.RG32F),s===t.HALF_FLOAT&&(a=t.RG16F),s===t.UNSIGNED_BYTE&&(a=t.RG8)),n===t.RG_INTEGER&&(s===t.UNSIGNED_BYTE&&(a=t.RG8UI),s===t.UNSIGNED_SHORT&&(a=t.RG16UI),s===t.UNSIGNED_INT&&(a=t.RG32UI),s===t.BYTE&&(a=t.RG8I),s===t.SHORT&&(a=t.RG16I),s===t.INT&&(a=t.RG32I)),n===t.RGB&&s===t.UNSIGNED_INT_5_9_9_9_REV&&(a=t.RGB9_E5),n===t.RGBA){const e=o?Rt:Ce.getTransfer(r);s===t.FLOAT&&(a=t.RGBA32F),s===t.HALF_FLOAT&&(a=t.RGBA16F),s===t.UNSIGNED_BYTE&&(a=e===Pt?t.SRGB8_ALPHA8:t.RGBA8),s===t.UNSIGNED_SHORT_4_4_4_4&&(a=t.RGBA4),s===t.UNSIGNED_SHORT_5_5_5_1&&(a=t.RGB5_A1)}return a!==t.R16F&&a!==t.R32F&&a!==t.RG16F&&a!==t.RG32F&&a!==t.RGBA16F&&a!==t.RGBA32F||e.get("EXT_color_buffer_float"),a}function b(t,e){return!0===p(t)||t.isFramebufferTexture&&t.minFilter!==z&&t.minFilter!==j?Math.log2(Math.max(e.width,e.height))+1:void 0!==t.mipmaps&&t.mipmaps.length>0?t.mipmaps.length:t.isCompressedTexture&&Array.isArray(t.image)?e.mipmaps.length:1}function E(t){const e=t.target;e.removeEventListener("dispose",E),function(t){const e=n.get(t);if(void 0===e.__webglInit)return;const i=t.source,s=u.get(i);if(s){const n=s[e.__cacheKey];n.usedTimes--,0===n.usedTimes&&I(t),0===Object.keys(s).length&&u.delete(i)}n.remove(t)}(e),e.isVideoTexture&&l.delete(e)}function C(e){const i=e.target;i.removeEventListener("dispose",C),function(e){const i=n.get(e);e.depthTexture&&e.depthTexture.dispose();if(e.isWebGLCubeRenderTarget)for(let e=0;e<6;e++){if(Array.isArray(i.__webglFramebuffer[e]))for(let n=0;n<i.__webglFramebuffer[e].length;n++)t.deleteFramebuffer(i.__webglFramebuffer[e][n]);else t.deleteFramebuffer(i.__webglFramebuffer[e]);i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer[e])}else{if(Array.isArray(i.__webglFramebuffer))for(let e=0;e<i.__webglFramebuffer.length;e++)t.deleteFramebuffer(i.__webglFramebuffer[e]);else t.deleteFramebuffer(i.__webglFramebuffer);if(i.__webglDepthbuffer&&t.deleteRenderbuffer(i.__webglDepthbuffer),i.__webglMultisampledFramebuffer&&t.deleteFramebuffer(i.__webglMultisampledFramebuffer),i.__webglColorRenderbuffer)for(let e=0;e<i.__webglColorRenderbuffer.length;e++)i.__webglColorRenderbuffer[e]&&t.deleteRenderbuffer(i.__webglColorRenderbuffer[e]);i.__webglDepthRenderbuffer&&t.deleteRenderbuffer(i.__webglDepthRenderbuffer)}const s=e.textures;for(let e=0,i=s.length;e<i;e++){const i=n.get(s[e]);i.__webglTexture&&(t.deleteTexture(i.__webglTexture),o.memory.textures--),n.remove(s[e])}n.remove(e)}(i)}function I(e){const i=n.get(e);t.deleteTexture(i.__webglTexture);const s=e.source;delete u.get(s)[i.__cacheKey],o.memory.textures--}let w=0;function _(e,s){const r=n.get(e);if(e.isVideoTexture&&function(t){const e=o.render.frame;l.get(t)!==e&&(l.set(t,e),t.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&r.__version!==e.version){const t=e.image;if(null===t)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==t.complete)return void Q(r,e,s);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.bindTexture(t.TEXTURE_2D,r.__webglTexture,t.TEXTURE0+s)}const B={[G]:t.REPEAT,[H]:t.CLAMP_TO_EDGE,[V]:t.MIRRORED_REPEAT},S={[z]:t.NEAREST,[q]:t.NEAREST_MIPMAP_NEAREST,[W]:t.NEAREST_MIPMAP_LINEAR,[j]:t.LINEAR,[J]:t.LINEAR_MIPMAP_NEAREST,[Y]:t.LINEAR_MIPMAP_LINEAR},M={[Ft]:t.NEVER,[Wt]:t.ALWAYS,[Ot]:t.LESS,[Ht]:t.LEQUAL,[Gt]:t.EQUAL,[qt]:t.GEQUAL,[Vt]:t.GREATER,[zt]:t.NOTEQUAL};function x(i,r){if(r.type!==tt||!1!==e.has("OES_texture_float_linear")||r.magFilter!==j&&r.magFilter!==J&&r.magFilter!==W&&r.magFilter!==Y&&r.minFilter!==j&&r.minFilter!==J&&r.minFilter!==W&&r.minFilter!==Y||console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(i,t.TEXTURE_WRAP_S,B[r.wrapS]),t.texParameteri(i,t.TEXTURE_WRAP_T,B[r.wrapT]),i!==t.TEXTURE_3D&&i!==t.TEXTURE_2D_ARRAY||t.texParameteri(i,t.TEXTURE_WRAP_R,B[r.wrapR]),t.texParameteri(i,t.TEXTURE_MAG_FILTER,S[r.magFilter]),t.texParameteri(i,t.TEXTURE_MIN_FILTER,S[r.minFilter]),r.compareFunction&&(t.texParameteri(i,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(i,t.TEXTURE_COMPARE_FUNC,M[r.compareFunction])),!0===e.has("EXT_texture_filter_anisotropic")){if(r.magFilter===z)return;if(r.minFilter!==W&&r.minFilter!==Y)return;if(r.type===tt&&!1===e.has("OES_texture_float_linear"))return;if(r.anisotropy>1||n.get(r).__currentAnisotropy){const o=e.get("EXT_texture_filter_anisotropic");t.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r.anisotropy,s.getMaxAnisotropy())),n.get(r).__currentAnisotropy=r.anisotropy}}}function y(e,i){let n=!1;void 0===e.__webglInit&&(e.__webglInit=!0,i.addEventListener("dispose",E));const s=i.source;let r=u.get(s);void 0===r&&(r={},u.set(s,r));const a=function(t){const e=[];return e.push(t.wrapS),e.push(t.wrapT),e.push(t.wrapR||0),e.push(t.magFilter),e.push(t.minFilter),e.push(t.anisotropy),e.push(t.internalFormat),e.push(t.format),e.push(t.type),e.push(t.generateMipmaps),e.push(t.premultiplyAlpha),e.push(t.flipY),e.push(t.unpackAlignment),e.push(t.colorSpace),e.join()}(i);if(a!==e.__cacheKey){void 0===r[a]&&(r[a]={texture:t.createTexture(),usedTimes:0},o.memory.textures++,n=!0),r[a].usedTimes++;const s=r[e.__cacheKey];void 0!==s&&(r[e.__cacheKey].usedTimes--,0===s.usedTimes&&I(i)),e.__cacheKey=a,e.__webglTexture=r[a].texture}return n}function Q(e,o,a){let h=t.TEXTURE_2D;(o.isDataArrayTexture||o.isCompressedArrayTexture)&&(h=t.TEXTURE_2D_ARRAY),o.isData3DTexture&&(h=t.TEXTURE_3D);const c=y(e,o),l=o.source;i.bindTexture(h,e.__webglTexture,t.TEXTURE0+a);const A=n.get(l);if(l.version!==A.__version||!0===c){i.activeTexture(t.TEXTURE0+a);const e=Ce.getPrimaries(Ce.workingColorSpace),n=o.colorSpace===yt?null:Ce.getPrimaries(o.colorSpace),u=o.colorSpace===yt||e===n?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,o.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,u);let d=g(o.image,!1,s.maxTextureSize);d=k(o,d);const f=r.convert(o.format,o.colorSpace),E=r.convert(o.type);let C,I=v(o.internalFormat,f,E,o.colorSpace,o.isVideoTexture);x(h,o);const w=o.mipmaps,_=!0!==o.isVideoTexture,B=void 0===A.__version||!0===c,S=l.dataReady,M=b(o,d);if(o.isDepthTexture)I=t.DEPTH_COMPONENT16,o.type===tt?I=t.DEPTH_COMPONENT32F:o.type===$?I=t.DEPTH_COMPONENT24:o.type===it&&(I=t.DEPTH24_STENCIL8),B&&(_?i.texStorage2D(t.TEXTURE_2D,1,I,d.width,d.height):i.texImage2D(t.TEXTURE_2D,0,I,d.width,d.height,0,f,E,null));else if(o.isDataTexture)if(w.length>0){_&&B&&i.texStorage2D(t.TEXTURE_2D,M,I,w[0].width,w[0].height);for(let e=0,n=w.length;e<n;e++)C=w[e],_?S&&i.texSubImage2D(t.TEXTURE_2D,e,0,0,C.width,C.height,f,E,C.data):i.texImage2D(t.TEXTURE_2D,e,I,C.width,C.height,0,f,E,C.data);o.generateMipmaps=!1}else _?(B&&i.texStorage2D(t.TEXTURE_2D,M,I,d.width,d.height),S&&i.texSubImage2D(t.TEXTURE_2D,0,0,0,d.width,d.height,f,E,d.data)):i.texImage2D(t.TEXTURE_2D,0,I,d.width,d.height,0,f,E,d.data);else if(o.isCompressedTexture)if(o.isCompressedArrayTexture){_&&B&&i.texStorage3D(t.TEXTURE_2D_ARRAY,M,I,w[0].width,w[0].height,d.depth);for(let e=0,n=w.length;e<n;e++)C=w[e],o.format!==nt?null!==f?_?S&&i.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,C.width,C.height,d.depth,f,C.data,0,0):i.compressedTexImage3D(t.TEXTURE_2D_ARRAY,e,I,C.width,C.height,d.depth,0,C.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_?S&&i.texSubImage3D(t.TEXTURE_2D_ARRAY,e,0,0,0,C.width,C.height,d.depth,f,E,C.data):i.texImage3D(t.TEXTURE_2D_ARRAY,e,I,C.width,C.height,d.depth,0,f,E,C.data)}else{_&&B&&i.texStorage2D(t.TEXTURE_2D,M,I,w[0].width,w[0].height);for(let e=0,n=w.length;e<n;e++)C=w[e],o.format!==nt?null!==f?_?S&&i.compressedTexSubImage2D(t.TEXTURE_2D,e,0,0,C.width,C.height,f,C.data):i.compressedTexImage2D(t.TEXTURE_2D,e,I,C.width,C.height,0,C.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):_?S&&i.texSubImage2D(t.TEXTURE_2D,e,0,0,C.width,C.height,f,E,C.data):i.texImage2D(t.TEXTURE_2D,e,I,C.width,C.height,0,f,E,C.data)}else if(o.isDataArrayTexture)_?(B&&i.texStorage3D(t.TEXTURE_2D_ARRAY,M,I,d.width,d.height,d.depth),S&&i.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,d.width,d.height,d.depth,f,E,d.data)):i.texImage3D(t.TEXTURE_2D_ARRAY,0,I,d.width,d.height,d.depth,0,f,E,d.data);else if(o.isData3DTexture)_?(B&&i.texStorage3D(t.TEXTURE_3D,M,I,d.width,d.height,d.depth),S&&i.texSubImage3D(t.TEXTURE_3D,0,0,0,0,d.width,d.height,d.depth,f,E,d.data)):i.texImage3D(t.TEXTURE_3D,0,I,d.width,d.height,d.depth,0,f,E,d.data);else if(o.isFramebufferTexture){if(B)if(_)i.texStorage2D(t.TEXTURE_2D,M,I,d.width,d.height);else{let e=d.width,n=d.height;for(let s=0;s<M;s++)i.texImage2D(t.TEXTURE_2D,s,I,e,n,0,f,E,null),e>>=1,n>>=1}}else if(w.length>0){if(_&&B){const e=F(w[0]);i.texStorage2D(t.TEXTURE_2D,M,I,e.width,e.height)}for(let e=0,n=w.length;e<n;e++)C=w[e],_?S&&i.texSubImage2D(t.TEXTURE_2D,e,0,0,f,E,C):i.texImage2D(t.TEXTURE_2D,e,I,f,E,C);o.generateMipmaps=!1}else if(_){if(B){const e=F(d);i.texStorage2D(t.TEXTURE_2D,M,I,e.width,e.height)}S&&i.texSubImage2D(t.TEXTURE_2D,0,0,0,f,E,d)}else i.texImage2D(t.TEXTURE_2D,0,I,f,E,d);p(o)&&m(h),A.__version=l.version,o.onUpdate&&o.onUpdate(o)}e.__version=o.version}function T(e,s,o,h,c,l){const A=r.convert(o.format,o.colorSpace),u=r.convert(o.type),d=v(o.internalFormat,A,u,o.colorSpace);if(!n.get(s).__hasExternalTextures){const e=Math.max(1,s.width>>l),n=Math.max(1,s.height>>l);c===t.TEXTURE_3D||c===t.TEXTURE_2D_ARRAY?i.texImage3D(c,l,d,e,n,s.depth,0,A,u,null):i.texImage2D(c,l,d,e,n,0,A,u,null)}i.bindFramebuffer(t.FRAMEBUFFER,e),N(s)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,h,c,n.get(o).__webglTexture,0,U(s)):(c===t.TEXTURE_2D||c>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&c<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,h,c,n.get(o).__webglTexture,l),i.bindFramebuffer(t.FRAMEBUFFER,null)}function D(e,i,n){if(t.bindRenderbuffer(t.RENDERBUFFER,e),i.depthBuffer&&!i.stencilBuffer){let s=t.DEPTH_COMPONENT24;if(n||N(i)){const e=i.depthTexture;e&&e.isDepthTexture&&(e.type===tt?s=t.DEPTH_COMPONENT32F:e.type===$&&(s=t.DEPTH_COMPONENT24));const n=U(i);N(i)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,n,s,i.width,i.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,n,s,i.width,i.height)}else t.renderbufferStorage(t.RENDERBUFFER,s,i.width,i.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e)}else if(i.depthBuffer&&i.stencilBuffer){const s=U(i);n&&!1===N(i)?t.renderbufferStorageMultisample(t.RENDERBUFFER,s,t.DEPTH24_STENCIL8,i.width,i.height):N(i)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,s,t.DEPTH24_STENCIL8,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,i.width,i.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,e)}else{const e=i.textures;for(let s=0;s<e.length;s++){const o=e[s],h=r.convert(o.format,o.colorSpace),c=r.convert(o.type),l=v(o.internalFormat,h,c,o.colorSpace),A=U(i);n&&!1===N(i)?t.renderbufferStorageMultisample(t.RENDERBUFFER,A,l,i.width,i.height):N(i)?a.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,A,l,i.width,i.height):t.renderbufferStorage(t.RENDERBUFFER,l,i.width,i.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function L(e){const s=n.get(e),r=!0===e.isWebGLCubeRenderTarget;if(e.depthTexture&&!s.__autoAllocateDepthBuffer){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(e,s){if(s&&s.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(t.FRAMEBUFFER,e),!s.depthTexture||!s.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(s.depthTexture).__webglTexture&&s.depthTexture.image.width===s.width&&s.depthTexture.image.height===s.height||(s.depthTexture.image.width=s.width,s.depthTexture.image.height=s.height,s.depthTexture.needsUpdate=!0),_(s.depthTexture,0);const r=n.get(s.depthTexture).__webglTexture,o=U(s);if(s.depthTexture.format===st)N(s)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,r,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,r,0);else{if(s.depthTexture.format!==rt)throw new Error("Unknown depthTexture format");N(s)?a.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,r,0,o):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,r,0)}}(s.__webglFramebuffer,e)}else if(r){s.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(t.FRAMEBUFFER,s.__webglFramebuffer[n]),s.__webglDepthbuffer[n]=t.createRenderbuffer(),D(s.__webglDepthbuffer[n],e,!1)}else i.bindFramebuffer(t.FRAMEBUFFER,s.__webglFramebuffer),s.__webglDepthbuffer=t.createRenderbuffer(),D(s.__webglDepthbuffer,e,!1);i.bindFramebuffer(t.FRAMEBUFFER,null)}const R=[],P=[];function U(t){return Math.min(s.maxSamples,t.samples)}function N(t){const i=n.get(t);return t.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==i.__useRenderToTexture}function k(t,e){const i=t.colorSpace,n=t.format,s=t.type;return!0===t.isCompressedTexture||!0===t.isVideoTexture||i!==Tt&&i!==yt&&(Ce.getTransfer(i)===Pt?n===nt&&s===K||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",i)),e}function F(t){return"undefined"!=typeof HTMLImageElement&&t instanceof HTMLImageElement?(c.width=t.naturalWidth||t.width,c.height=t.naturalHeight||t.height):"undefined"!=typeof VideoFrame&&t instanceof VideoFrame?(c.width=t.displayWidth,c.height=t.displayHeight):(c.width=t.width,c.height=t.height),c}this.allocateTextureUnit=function(){const t=w;return t>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+t+" texture units while this GPU supports only "+s.maxTextures),w+=1,t},this.resetTextureUnits=function(){w=0},this.setTexture2D=_,this.setTexture2DArray=function(e,s){const r=n.get(e);e.version>0&&r.__version!==e.version?Q(r,e,s):i.bindTexture(t.TEXTURE_2D_ARRAY,r.__webglTexture,t.TEXTURE0+s)},this.setTexture3D=function(e,s){const r=n.get(e);e.version>0&&r.__version!==e.version?Q(r,e,s):i.bindTexture(t.TEXTURE_3D,r.__webglTexture,t.TEXTURE0+s)},this.setTextureCube=function(e,o){const a=n.get(e);e.version>0&&a.__version!==e.version?function(e,o,a){if(6!==o.image.length)return;const h=y(e,o),c=o.source;i.bindTexture(t.TEXTURE_CUBE_MAP,e.__webglTexture,t.TEXTURE0+a);const l=n.get(c);if(c.version!==l.__version||!0===h){i.activeTexture(t.TEXTURE0+a);const e=Ce.getPrimaries(Ce.workingColorSpace),n=o.colorSpace===yt?null:Ce.getPrimaries(o.colorSpace),A=o.colorSpace===yt||e===n?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,o.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,o.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,A);const u=o.isCompressedTexture||o.image[0].isCompressedTexture,d=o.image[0]&&o.image[0].isDataTexture,f=[];for(let t=0;t<6;t++)f[t]=u||d?d?o.image[t].image:o.image[t]:g(o.image[t],!0,s.maxCubemapSize),f[t]=k(o,f[t]);const E=f[0],C=r.convert(o.format,o.colorSpace),I=r.convert(o.type),w=v(o.internalFormat,C,I,o.colorSpace),_=!0!==o.isVideoTexture,B=void 0===l.__version||!0===h,S=c.dataReady;let M,y=b(o,E);if(x(t.TEXTURE_CUBE_MAP,o),u){_&&B&&i.texStorage2D(t.TEXTURE_CUBE_MAP,y,w,E.width,E.height);for(let e=0;e<6;e++){M=f[e].mipmaps;for(let n=0;n<M.length;n++){const s=M[n];o.format!==nt?null!==C?_?S&&i.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,0,0,s.width,s.height,C,s.data):i.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,w,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):_?S&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,0,0,s.width,s.height,C,I,s.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n,w,s.width,s.height,0,C,I,s.data)}}}else{if(M=o.mipmaps,_&&B){M.length>0&&y++;const e=F(f[0]);i.texStorage2D(t.TEXTURE_CUBE_MAP,y,w,e.width,e.height)}for(let e=0;e<6;e++)if(d){_?S&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,f[e].width,f[e].height,C,I,f[e].data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,w,f[e].width,f[e].height,0,C,I,f[e].data);for(let n=0;n<M.length;n++){const s=M[n].image[e].image;_?S&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,0,0,s.width,s.height,C,I,s.data):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,w,s.width,s.height,0,C,I,s.data)}}else{_?S&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,0,0,C,I,f[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,w,C,I,f[e]);for(let n=0;n<M.length;n++){const s=M[n];_?S&&i.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,0,0,C,I,s.image[e]):i.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+e,n+1,w,C,I,s.image[e])}}}p(o)&&m(t.TEXTURE_CUBE_MAP),l.__version=c.version,o.onUpdate&&o.onUpdate(o)}e.__version=o.version}(a,e,o):i.bindTexture(t.TEXTURE_CUBE_MAP,a.__webglTexture,t.TEXTURE0+o)},this.rebindTextures=function(e,i,s){const r=n.get(e);void 0!==i&&T(r.__webglFramebuffer,e,e.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),void 0!==s&&L(e)},this.setupRenderTarget=function(e){const s=e.texture,a=n.get(e),h=n.get(s);e.addEventListener("dispose",C);const c=e.textures,l=!0===e.isWebGLCubeRenderTarget,A=c.length>1;if(A||(void 0===h.__webglTexture&&(h.__webglTexture=t.createTexture()),h.__version=s.version,o.memory.textures++),l){a.__webglFramebuffer=[];for(let e=0;e<6;e++)if(s.mipmaps&&s.mipmaps.length>0){a.__webglFramebuffer[e]=[];for(let i=0;i<s.mipmaps.length;i++)a.__webglFramebuffer[e][i]=t.createFramebuffer()}else a.__webglFramebuffer[e]=t.createFramebuffer()}else{if(s.mipmaps&&s.mipmaps.length>0){a.__webglFramebuffer=[];for(let e=0;e<s.mipmaps.length;e++)a.__webglFramebuffer[e]=t.createFramebuffer()}else a.__webglFramebuffer=t.createFramebuffer();if(A)for(let e=0,i=c.length;e<i;e++){const i=n.get(c[e]);void 0===i.__webglTexture&&(i.__webglTexture=t.createTexture(),o.memory.textures++)}if(e.samples>0&&!1===N(e)){a.__webglMultisampledFramebuffer=t.createFramebuffer(),a.__webglColorRenderbuffer=[],i.bindFramebuffer(t.FRAMEBUFFER,a.__webglMultisampledFramebuffer);for(let i=0;i<c.length;i++){const n=c[i];a.__webglColorRenderbuffer[i]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,a.__webglColorRenderbuffer[i]);const s=r.convert(n.format,n.colorSpace),o=r.convert(n.type),h=v(n.internalFormat,s,o,n.colorSpace,!0===e.isXRRenderTarget),l=U(e);t.renderbufferStorageMultisample(t.RENDERBUFFER,l,h,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+i,t.RENDERBUFFER,a.__webglColorRenderbuffer[i])}t.bindRenderbuffer(t.RENDERBUFFER,null),e.depthBuffer&&(a.__webglDepthRenderbuffer=t.createRenderbuffer(),D(a.__webglDepthRenderbuffer,e,!0)),i.bindFramebuffer(t.FRAMEBUFFER,null)}}if(l){i.bindTexture(t.TEXTURE_CUBE_MAP,h.__webglTexture),x(t.TEXTURE_CUBE_MAP,s);for(let i=0;i<6;i++)if(s.mipmaps&&s.mipmaps.length>0)for(let n=0;n<s.mipmaps.length;n++)T(a.__webglFramebuffer[i][n],e,s,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+i,n);else T(a.__webglFramebuffer[i],e,s,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+i,0);p(s)&&m(t.TEXTURE_CUBE_MAP),i.unbindTexture()}else if(A){for(let s=0,r=c.length;s<r;s++){const r=c[s],o=n.get(r);i.bindTexture(t.TEXTURE_2D,o.__webglTexture),x(t.TEXTURE_2D,r),T(a.__webglFramebuffer,e,r,t.COLOR_ATTACHMENT0+s,t.TEXTURE_2D,0),p(r)&&m(t.TEXTURE_2D)}i.unbindTexture()}else{let n=t.TEXTURE_2D;if((e.isWebGL3DRenderTarget||e.isWebGLArrayRenderTarget)&&(n=e.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),i.bindTexture(n,h.__webglTexture),x(n,s),s.mipmaps&&s.mipmaps.length>0)for(let i=0;i<s.mipmaps.length;i++)T(a.__webglFramebuffer[i],e,s,t.COLOR_ATTACHMENT0,n,i);else T(a.__webglFramebuffer,e,s,t.COLOR_ATTACHMENT0,n,0);p(s)&&m(n),i.unbindTexture()}e.depthBuffer&&L(e)},this.updateRenderTargetMipmap=function(e){const s=e.textures;for(let r=0,o=s.length;r<o;r++){const o=s[r];if(p(o)){const s=e.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,r=n.get(o).__webglTexture;i.bindTexture(s,r),m(s),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(e){if(e.samples>0)if(!1===N(e)){const s=e.textures,r=e.width,o=e.height;let a=t.COLOR_BUFFER_BIT;const c=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,l=n.get(e),A=s.length>1;if(A)for(let e=0;e<s.length;e++)i.bindFramebuffer(t.FRAMEBUFFER,l.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,null),i.bindFramebuffer(t.FRAMEBUFFER,l.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,null,0);i.bindFramebuffer(t.READ_FRAMEBUFFER,l.__webglMultisampledFramebuffer),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,l.__webglFramebuffer);for(let i=0;i<s.length;i++){if(e.resolveDepthBuffer&&(e.depthBuffer&&(a|=t.DEPTH_BUFFER_BIT),e.stencilBuffer&&e.resolveStencilBuffer&&(a|=t.STENCIL_BUFFER_BIT)),A){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,l.__webglColorRenderbuffer[i]);const e=n.get(s[i]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)}t.blitFramebuffer(0,0,r,o,0,0,r,o,a,t.NEAREST),!0===h&&(R.length=0,P.length=0,R.push(t.COLOR_ATTACHMENT0+i),e.depthBuffer&&!1===e.resolveDepthBuffer&&(R.push(c),P.push(c),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,P)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,R))}if(i.bindFramebuffer(t.READ_FRAMEBUFFER,null),i.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),A)for(let e=0;e<s.length;e++){i.bindFramebuffer(t.FRAMEBUFFER,l.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.RENDERBUFFER,l.__webglColorRenderbuffer[e]);const r=n.get(s[e]).__webglTexture;i.bindFramebuffer(t.FRAMEBUFFER,l.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+e,t.TEXTURE_2D,r,0)}i.bindFramebuffer(t.DRAW_FRAMEBUFFER,l.__webglMultisampledFramebuffer)}else if(e.depthBuffer&&!1===e.resolveDepthBuffer&&h){const i=e.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[i])}},this.setupDepthRenderbuffer=L,this.setupFrameBufferTexture=T,this.useMultisampledRTT=N}function Vo(t,e){return{convert:function(i,n=yt){let s;const r=Ce.getTransfer(n);if(i===K)return t.UNSIGNED_BYTE;if(1017===i)return t.UNSIGNED_SHORT_4_4_4_4;if(1018===i)return t.UNSIGNED_SHORT_5_5_5_1;if(35902===i)return t.UNSIGNED_INT_5_9_9_9_REV;if(1010===i)return t.BYTE;if(1011===i)return t.SHORT;if(i===X)return t.UNSIGNED_SHORT;if(i===Z)return t.INT;if(i===$)return t.UNSIGNED_INT;if(i===tt)return t.FLOAT;if(i===et)return t.HALF_FLOAT;if(1021===i)return t.ALPHA;if(1022===i)return t.RGB;if(i===nt)return t.RGBA;if(1024===i)return t.LUMINANCE;if(1025===i)return t.LUMINANCE_ALPHA;if(i===st)return t.DEPTH_COMPONENT;if(i===rt)return t.DEPTH_STENCIL;if(i===ot)return t.RED;if(1029===i)return t.RED_INTEGER;if(i===at)return t.RG;if(i===ht)return t.RG_INTEGER;if(1033===i)return t.RGBA_INTEGER;if(i===ct||i===lt||i===At||i===ut)if(r===Pt){if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===s)return null;if(i===ct)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===lt)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===At)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===ut)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(s=e.get("WEBGL_compressed_texture_s3tc"),null===s)return null;if(i===ct)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===lt)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===At)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===ut)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(i===dt||35841===i||i===ft||35843===i){if(s=e.get("WEBGL_compressed_texture_pvrtc"),null===s)return null;if(i===dt)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===i)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===ft)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===i)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(i===gt||i===pt||i===mt){if(s=e.get("WEBGL_compressed_texture_etc"),null===s)return null;if(i===gt||i===pt)return r===Pt?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(i===mt)return r===Pt?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}if(i===vt||37809===i||37810===i||37811===i||i===bt||37813===i||37814===i||37815===i||37816===i||37817===i||37818===i||37819===i||37820===i||37821===i){if(s=e.get("WEBGL_compressed_texture_astc"),null===s)return null;if(i===vt)return r===Pt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===i)return r===Pt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===i)return r===Pt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===i)return r===Pt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===bt)return r===Pt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===i)return r===Pt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===i)return r===Pt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===i)return r===Pt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===i)return r===Pt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===i)return r===Pt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===i)return r===Pt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===i)return r===Pt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===i)return r===Pt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===i)return r===Pt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}if(i===Et||36494===i||36495===i){if(s=e.get("EXT_texture_compression_bptc"),null===s)return null;if(i===Et)return r===Pt?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(36494===i)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(36495===i)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}if(36283===i||36284===i||36285===i||36286===i){if(s=e.get("EXT_texture_compression_rgtc"),null===s)return null;if(i===Et)return s.COMPRESSED_RED_RGTC1_EXT;if(36284===i)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(36285===i)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(36286===i)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}return i===it?t.UNSIGNED_INT_24_8:void 0!==t[i]?t[i]:null}}}class zo extends ts{constructor(t=[]){super(),this.isArrayCamera=!0,this.cameras=t}}class qo extends Oi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Wo={type:"move"};class jo{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new qo,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new qo,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Ne,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Ne),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new qo,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Ne,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Ne),this._grip}dispatchEvent(t){return null!==this._targetRay&&this._targetRay.dispatchEvent(t),null!==this._grip&&this._grip.dispatchEvent(t),null!==this._hand&&this._hand.dispatchEvent(t),this}connect(t){if(t&&t.hand){const e=this._hand;if(e)for(const i of t.hand.values())this._getHandJoint(e,i)}return this.dispatchEvent({type:"connected",data:t}),this}disconnect(t){return this.dispatchEvent({type:"disconnected",data:t}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(t,e,i){let n=null,s=null,r=null;const o=this._targetRay,a=this._grip,h=this._hand;if(t&&"visible-blurred"!==e.session.visibilityState){if(h&&t.hand){r=!0;for(const n of t.hand.values()){const t=e.getJointPose(n,i),s=this._getHandJoint(h,n);null!==t&&(s.matrix.fromArray(t.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.matrixWorldNeedsUpdate=!0,s.jointRadius=t.radius),s.visible=null!==t}const n=h.joints["index-finger-tip"],s=h.joints["thumb-tip"],o=n.position.distanceTo(s.position),a=.02,c=.005;h.inputState.pinching&&o>a+c?(h.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:t.handedness,target:this})):!h.inputState.pinching&&o<=a-c&&(h.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:t.handedness,target:this}))}else null!==a&&t.gripSpace&&(s=e.getPose(t.gripSpace,i),null!==s&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),a.matrixWorldNeedsUpdate=!0,s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1));null!==o&&(n=e.getPose(t.targetRaySpace,i),null===n&&null!==s&&(n=s),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(Wo)))}return null!==o&&(o.visible=null!==n),null!==a&&(a.visible=null!==s),null!==h&&(h.visible=null!==r),this}_getHandJoint(t,e){if(void 0===t.joints[e.jointName]){const i=new qo;i.matrixAutoUpdate=!1,i.visible=!1,t.joints[e.jointName]=i,t.add(i)}return t.joints[e.jointName]}}class Jo{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(t,e,i){if(null===this.texture){const n=new Qe;t.properties.get(n).__webglTexture=e.texture,e.depthNear==i.depthNear&&e.depthFar==i.depthFar||(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}render(t,e){if(null!==this.texture){if(null===this.mesh){const t=e.cameras[0].viewport,i=new Yn({vertexShader:"\nvoid main() {\n\n\tgl_Position = vec4( position, 1.0 );\n\n}",fragmentShader:"\nuniform sampler2DArray depthColor;\nuniform float depthWidth;\nuniform float depthHeight;\n\nvoid main() {\n\n\tvec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );\n\n\tif ( coord.x >= 1.0 ) {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;\n\n\t} else {\n\n\t\tgl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;\n\n\t}\n\n}",uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new Hn(new fs(20,20),i)}t.render(this.mesh,e)}}reset(){this.texture=null,this.mesh=null}}class Yo extends Xt{constructor(t,e){super();const i=this;let n=null,s=1,r=null,o="local-floor",a=1,h=null,c=null,l=null,A=null,u=null,d=null;const f=new Jo,g=e.getContextAttributes();let p=null,m=null;const v=[],b=[],E=new ce;let C=null;const I=new ts;I.layers.enable(1),I.viewport=new Te;const w=new ts;w.layers.enable(2),w.viewport=new Te;const _=[I,w],B=new zo;B.layers.enable(1),B.layers.enable(2);let S=null,M=null;function x(t){const e=b.indexOf(t.inputSource);if(-1===e)return;const i=v[e];void 0!==i&&(i.update(t.inputSource,t.frame,h||r),i.dispatchEvent({type:t.type,data:t.inputSource}))}function y(){n.removeEventListener("select",x),n.removeEventListener("selectstart",x),n.removeEventListener("selectend",x),n.removeEventListener("squeeze",x),n.removeEventListener("squeezestart",x),n.removeEventListener("squeezeend",x),n.removeEventListener("end",y),n.removeEventListener("inputsourceschange",Q);for(let t=0;t<v.length;t++){const e=b[t];null!==e&&(b[t]=null,v[t].disconnect(e))}S=null,M=null,f.reset(),t.setRenderTarget(p),u=null,A=null,l=null,n=null,m=null,P.stop(),i.isPresenting=!1,t.setPixelRatio(C),t.setSize(E.width,E.height,!1),i.dispatchEvent({type:"sessionend"})}function Q(t){for(let e=0;e<t.removed.length;e++){const i=t.removed[e],n=b.indexOf(i);n>=0&&(b[n]=null,v[n].disconnect(i))}for(let e=0;e<t.added.length;e++){const i=t.added[e];let n=b.indexOf(i);if(-1===n){for(let t=0;t<v.length;t++){if(t>=b.length){b.push(i),n=t;break}if(null===b[t]){b[t]=i,n=t;break}}if(-1===n)break}const s=v[n];s&&s.connect(i)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(t){let e=v[t];return void 0===e&&(e=new jo,v[t]=e),e.getTargetRaySpace()},this.getControllerGrip=function(t){let e=v[t];return void 0===e&&(e=new jo,v[t]=e),e.getGripSpace()},this.getHand=function(t){let e=v[t];return void 0===e&&(e=new jo,v[t]=e),e.getHandSpace()},this.setFramebufferScaleFactor=function(t){s=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(t){o=t,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return h||r},this.setReferenceSpace=function(t){h=t},this.getBaseLayer=function(){return null!==A?A:u},this.getBinding=function(){return l},this.getFrame=function(){return d},this.getSession=function(){return n},this.setSession=async function(c){if(n=c,null!==n){if(p=t.getRenderTarget(),n.addEventListener("select",x),n.addEventListener("selectstart",x),n.addEventListener("selectend",x),n.addEventListener("squeeze",x),n.addEventListener("squeezestart",x),n.addEventListener("squeezeend",x),n.addEventListener("end",y),n.addEventListener("inputsourceschange",Q),!0!==g.xrCompatible&&await e.makeXRCompatible(),C=t.getPixelRatio(),t.getSize(E),void 0===n.renderState.layers){const i={antialias:g.antialias,alpha:!0,depth:g.depth,stencil:g.stencil,framebufferScaleFactor:s};u=new XRWebGLLayer(n,e,i),n.updateRenderState({baseLayer:u}),t.setPixelRatio(1),t.setSize(u.framebufferWidth,u.framebufferHeight,!1),m=new Le(u.framebufferWidth,u.framebufferHeight,{format:nt,type:K,colorSpace:t.outputColorSpace,stencilBuffer:g.stencil})}else{let i=null,r=null,o=null;g.depth&&(o=g.stencil?e.DEPTH24_STENCIL8:e.DEPTH_COMPONENT24,i=g.stencil?rt:st,r=g.stencil?it:$);const a={colorFormat:e.RGBA8,depthFormat:o,scaleFactor:s};l=new XRWebGLBinding(n,e),A=l.createProjectionLayer(a),n.updateRenderState({layers:[A]}),t.setPixelRatio(1),t.setSize(A.textureWidth,A.textureHeight,!1),m=new Le(A.textureWidth,A.textureHeight,{format:nt,type:K,depthTexture:new Zs(A.textureWidth,A.textureHeight,r,void 0,void 0,void 0,void 0,void 0,void 0,i),stencilBuffer:g.stencil,colorSpace:t.outputColorSpace,samples:g.antialias?4:0,resolveDepthBuffer:!1===A.ignoreDepthValues})}m.isXRRenderTarget=!0,this.setFoveation(a),h=null,r=await n.requestReferenceSpace(o),P.setContext(n),P.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(null!==n)return n.environmentBlendMode};const T=new Ne,D=new Ne;function L(t,e){null===e?t.matrixWorld.copy(t.matrix):t.matrixWorld.multiplyMatrices(e.matrixWorld,t.matrix),t.matrixWorldInverse.copy(t.matrixWorld).invert()}this.updateCamera=function(t){if(null===n)return;null!==f.texture&&(t.near=f.depthNear,t.far=f.depthFar),B.near=w.near=I.near=t.near,B.far=w.far=I.far=t.far,S===B.near&&M===B.far||(n.updateRenderState({depthNear:B.near,depthFar:B.far}),S=B.near,M=B.far,I.near=S,I.far=M,w.near=S,w.far=M,I.updateProjectionMatrix(),w.updateProjectionMatrix(),t.updateProjectionMatrix());const e=t.parent,i=B.cameras;L(B,e);for(let t=0;t<i.length;t++)L(i[t],e);2===i.length?function(t,e,i){T.setFromMatrixPosition(e.matrixWorld),D.setFromMatrixPosition(i.matrixWorld);const n=T.distanceTo(D),s=e.projectionMatrix.elements,r=i.projectionMatrix.elements,o=s[14]/(s[10]-1),a=s[14]/(s[10]+1),h=(s[9]+1)/s[5],c=(s[9]-1)/s[5],l=(s[8]-1)/s[0],A=(r[8]+1)/r[0],u=o*l,d=o*A,f=n/(-l+A),g=f*-l;e.matrixWorld.decompose(t.position,t.quaternion,t.scale),t.translateX(g),t.translateZ(f),t.matrixWorld.compose(t.position,t.quaternion,t.scale),t.matrixWorldInverse.copy(t.matrixWorld).invert();const p=o+f,m=a+f,v=u-g,b=d+(n-g),E=h*a/m*p,C=c*a/m*p;t.projectionMatrix.makePerspective(v,b,E,C,p,m),t.projectionMatrixInverse.copy(t.projectionMatrix).invert()}(B,I,w):B.projectionMatrix.copy(I.projectionMatrix),function(t,e,i){null===i?t.matrix.copy(e.matrixWorld):(t.matrix.copy(i.matrixWorld),t.matrix.invert(),t.matrix.multiply(e.matrixWorld));t.matrix.decompose(t.position,t.quaternion,t.scale),t.updateMatrixWorld(!0),t.projectionMatrix.copy(e.projectionMatrix),t.projectionMatrixInverse.copy(e.projectionMatrixInverse),t.isPerspectiveCamera&&(t.fov=2*ee*Math.atan(1/t.projectionMatrix.elements[5]),t.zoom=1)}(t,B,e)},this.getCamera=function(){return B},this.getFoveation=function(){if(null!==A||null!==u)return a},this.setFoveation=function(t){a=t,null!==A&&(A.fixedFoveation=t),null!==u&&void 0!==u.fixedFoveation&&(u.fixedFoveation=t)},this.hasDepthSensing=function(){return null!==f.texture};let R=null;const P=new us;P.setAnimationLoop((function(e,s){if(c=s.getViewerPose(h||r),d=s,null!==c){const e=c.views;null!==u&&(t.setRenderTargetFramebuffer(m,u.framebuffer),t.setRenderTarget(m));let i=!1;e.length!==B.cameras.length&&(B.cameras.length=0,i=!0);for(let n=0;n<e.length;n++){const s=e[n];let r=null;if(null!==u)r=u.getViewport(s);else{const e=l.getViewSubImage(A,s);r=e.viewport,0===n&&(t.setRenderTargetTextures(m,e.colorTexture,A.ignoreDepthValues?void 0:e.depthStencilTexture),t.setRenderTarget(m))}let o=_[n];void 0===o&&(o=new ts,o.layers.enable(n),o.viewport=new Te,_[n]=o),o.matrix.fromArray(s.transform.matrix),o.matrix.decompose(o.position,o.quaternion,o.scale),o.projectionMatrix.fromArray(s.projectionMatrix),o.projectionMatrixInverse.copy(o.projectionMatrix).invert(),o.viewport.set(r.x,r.y,r.width,r.height),0===n&&(B.matrix.copy(o.matrix),B.matrix.decompose(B.position,B.quaternion,B.scale)),!0===i&&B.cameras.push(o)}const s=n.enabledFeatures;if(s&&s.includes("depth-sensing")){const i=l.getDepthInformation(e[0]);i&&i.isValid&&i.texture&&f.init(t,i,n.renderState)}}for(let t=0;t<v.length;t++){const e=b[t],i=v[t];null!==e&&void 0!==i&&i.update(e,s,h||r)}f.render(t,B),R&&R(e,s),s.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:s}),d=null})),this.setAnimationLoop=function(t){R=t},this.dispose=function(){}}}const Ko=new wi,Xo=new di;function Zo(t,e){function i(t,e){!0===t.matrixAutoUpdate&&t.updateMatrix(),e.value.copy(t.matrix)}function n(n,s){n.opacity.value=s.opacity,s.color&&n.diffuse.value.copy(s.color),s.emissive&&n.emissive.value.copy(s.emissive).multiplyScalar(s.emissiveIntensity),s.map&&(n.map.value=s.map,i(s.map,n.mapTransform)),s.alphaMap&&(n.alphaMap.value=s.alphaMap,i(s.alphaMap,n.alphaMapTransform)),s.bumpMap&&(n.bumpMap.value=s.bumpMap,i(s.bumpMap,n.bumpMapTransform),n.bumpScale.value=s.bumpScale,s.side===r&&(n.bumpScale.value*=-1)),s.normalMap&&(n.normalMap.value=s.normalMap,i(s.normalMap,n.normalMapTransform),n.normalScale.value.copy(s.normalScale),s.side===r&&n.normalScale.value.negate()),s.displacementMap&&(n.displacementMap.value=s.displacementMap,i(s.displacementMap,n.displacementMapTransform),n.displacementScale.value=s.displacementScale,n.displacementBias.value=s.displacementBias),s.emissiveMap&&(n.emissiveMap.value=s.emissiveMap,i(s.emissiveMap,n.emissiveMapTransform)),s.specularMap&&(n.specularMap.value=s.specularMap,i(s.specularMap,n.specularMapTransform)),s.alphaTest>0&&(n.alphaTest.value=s.alphaTest);const o=e.get(s),a=o.envMap,h=o.envMapRotation;if(a&&(n.envMap.value=a,Ko.copy(h),Ko.x*=-1,Ko.y*=-1,Ko.z*=-1,a.isCubeTexture&&!1===a.isRenderTargetTexture&&(Ko.y*=-1,Ko.z*=-1),n.envMapRotation.value.setFromMatrix4(Xo.makeRotationFromEuler(Ko)),n.flipEnvMap.value=a.isCubeTexture&&!1===a.isRenderTargetTexture?-1:1,n.reflectivity.value=s.reflectivity,n.ior.value=s.ior,n.refractionRatio.value=s.refractionRatio),s.lightMap){n.lightMap.value=s.lightMap;const e=!0===t._useLegacyLights?Math.PI:1;n.lightMapIntensity.value=s.lightMapIntensity*e,i(s.lightMap,n.lightMapTransform)}s.aoMap&&(n.aoMap.value=s.aoMap,n.aoMapIntensity.value=s.aoMapIntensity,i(s.aoMap,n.aoMapTransform))}return{refreshFogUniforms:function(e,i){i.color.getRGB(e.fogColor.value,jn(t)),i.isFog?(e.fogNear.value=i.near,e.fogFar.value=i.far):i.isFogExp2&&(e.fogDensity.value=i.density)},refreshMaterialUniforms:function(t,s,o,a,h){s.isMeshBasicMaterial||s.isMeshLambertMaterial?n(t,s):s.isMeshToonMaterial?(n(t,s),function(t,e){e.gradientMap&&(t.gradientMap.value=e.gradientMap)}(t,s)):s.isMeshPhongMaterial?(n(t,s),function(t,e){t.specular.value.copy(e.specular),t.shininess.value=Math.max(e.shininess,1e-4)}(t,s)):s.isMeshStandardMaterial?(n(t,s),function(t,e){t.metalness.value=e.metalness,e.metalnessMap&&(t.metalnessMap.value=e.metalnessMap,i(e.metalnessMap,t.metalnessMapTransform));t.roughness.value=e.roughness,e.roughnessMap&&(t.roughnessMap.value=e.roughnessMap,i(e.roughnessMap,t.roughnessMapTransform));e.envMap&&(t.envMapIntensity.value=e.envMapIntensity)}(t,s),s.isMeshPhysicalMaterial&&function(t,e,n){t.ior.value=e.ior,e.sheen>0&&(t.sheenColor.value.copy(e.sheenColor).multiplyScalar(e.sheen),t.sheenRoughness.value=e.sheenRoughness,e.sheenColorMap&&(t.sheenColorMap.value=e.sheenColorMap,i(e.sheenColorMap,t.sheenColorMapTransform)),e.sheenRoughnessMap&&(t.sheenRoughnessMap.value=e.sheenRoughnessMap,i(e.sheenRoughnessMap,t.sheenRoughnessMapTransform)));e.clearcoat>0&&(t.clearcoat.value=e.clearcoat,t.clearcoatRoughness.value=e.clearcoatRoughness,e.clearcoatMap&&(t.clearcoatMap.value=e.clearcoatMap,i(e.clearcoatMap,t.clearcoatMapTransform)),e.clearcoatRoughnessMap&&(t.clearcoatRoughnessMap.value=e.clearcoatRoughnessMap,i(e.clearcoatRoughnessMap,t.clearcoatRoughnessMapTransform)),e.clearcoatNormalMap&&(t.clearcoatNormalMap.value=e.clearcoatNormalMap,i(e.clearcoatNormalMap,t.clearcoatNormalMapTransform),t.clearcoatNormalScale.value.copy(e.clearcoatNormalScale),e.side===r&&t.clearcoatNormalScale.value.negate()));e.dispersion>0&&(t.dispersion.value=e.dispersion);e.iridescence>0&&(t.iridescence.value=e.iridescence,t.iridescenceIOR.value=e.iridescenceIOR,t.iridescenceThicknessMinimum.value=e.iridescenceThicknessRange[0],t.iridescenceThicknessMaximum.value=e.iridescenceThicknessRange[1],e.iridescenceMap&&(t.iridescenceMap.value=e.iridescenceMap,i(e.iridescenceMap,t.iridescenceMapTransform)),e.iridescenceThicknessMap&&(t.iridescenceThicknessMap.value=e.iridescenceThicknessMap,i(e.iridescenceThicknessMap,t.iridescenceThicknessMapTransform)));e.transmission>0&&(t.transmission.value=e.transmission,t.transmissionSamplerMap.value=n.texture,t.transmissionSamplerSize.value.set(n.width,n.height),e.transmissionMap&&(t.transmissionMap.value=e.transmissionMap,i(e.transmissionMap,t.transmissionMapTransform)),t.thickness.value=e.thickness,e.thicknessMap&&(t.thicknessMap.value=e.thicknessMap,i(e.thicknessMap,t.thicknessMapTransform)),t.attenuationDistance.value=e.attenuationDistance,t.attenuationColor.value.copy(e.attenuationColor));e.anisotropy>0&&(t.anisotropyVector.value.set(e.anisotropy*Math.cos(e.anisotropyRotation),e.anisotropy*Math.sin(e.anisotropyRotation)),e.anisotropyMap&&(t.anisotropyMap.value=e.anisotropyMap,i(e.anisotropyMap,t.anisotropyMapTransform)));t.specularIntensity.value=e.specularIntensity,t.specularColor.value.copy(e.specularColor),e.specularColorMap&&(t.specularColorMap.value=e.specularColorMap,i(e.specularColorMap,t.specularColorMapTransform));e.specularIntensityMap&&(t.specularIntensityMap.value=e.specularIntensityMap,i(e.specularIntensityMap,t.specularIntensityMapTransform))}(t,s,h)):s.isMeshMatcapMaterial?(n(t,s),function(t,e){e.matcap&&(t.matcap.value=e.matcap)}(t,s)):s.isMeshDepthMaterial?n(t,s):s.isMeshDistanceMaterial?(n(t,s),function(t,i){const n=e.get(i).light;t.referencePosition.value.setFromMatrixPosition(n.matrixWorld),t.nearDistance.value=n.shadow.camera.near,t.farDistance.value=n.shadow.camera.far}(t,s)):s.isMeshNormalMaterial?n(t,s):s.isLineBasicMaterial?(function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,e.map&&(t.map.value=e.map,i(e.map,t.mapTransform))}(t,s),s.isLineDashedMaterial&&function(t,e){t.dashSize.value=e.dashSize,t.totalSize.value=e.dashSize+e.gapSize,t.scale.value=e.scale}(t,s)):s.isPointsMaterial?function(t,e,n,s){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.size.value=e.size*n,t.scale.value=.5*s,e.map&&(t.map.value=e.map,i(e.map,t.uvTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,i(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,s,o,a):s.isSpriteMaterial?function(t,e){t.diffuse.value.copy(e.color),t.opacity.value=e.opacity,t.rotation.value=e.rotation,e.map&&(t.map.value=e.map,i(e.map,t.mapTransform));e.alphaMap&&(t.alphaMap.value=e.alphaMap,i(e.alphaMap,t.alphaMapTransform));e.alphaTest>0&&(t.alphaTest.value=e.alphaTest)}(t,s):s.isShadowMaterial?(t.color.value.copy(s.color),t.opacity.value=s.opacity):s.isShaderMaterial&&(s.uniformsNeedUpdate=!1)}}}function $o(t,e,i,n){let s={},r={},o=[];const a=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function h(t,e,i,n){const s=t.value,r=e+"_"+i;if(void 0===n[r])return n[r]="number"==typeof s||"boolean"==typeof s?s:s.clone(),!0;{const t=n[r];if("number"==typeof s||"boolean"==typeof s){if(t!==s)return n[r]=s,!0}else if(!1===t.equals(s))return t.copy(s),!0}return!1}function c(t){const e={boundary:0,storage:0};return"number"==typeof t||"boolean"==typeof t?(e.boundary=4,e.storage=4):t.isVector2?(e.boundary=8,e.storage=8):t.isVector3||t.isColor?(e.boundary=16,e.storage=12):t.isVector4?(e.boundary=16,e.storage=16):t.isMatrix3?(e.boundary=48,e.storage=48):t.isMatrix4?(e.boundary=64,e.storage=64):t.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",t),e}function l(e){const i=e.target;i.removeEventListener("dispose",l);const n=o.indexOf(i.__bindingPointIndex);o.splice(n,1),t.deleteBuffer(s[i.id]),delete s[i.id],delete r[i.id]}return{bind:function(t,e){const i=e.program;n.uniformBlockBinding(t,i)},update:function(i,A){let u=s[i.id];void 0===u&&(!function(t){const e=t.uniforms;let i=0;const n=16;for(let t=0,s=e.length;t<s;t++){const s=Array.isArray(e[t])?e[t]:[e[t]];for(let t=0,e=s.length;t<e;t++){const e=s[t],r=Array.isArray(e.value)?e.value:[e.value];for(let t=0,s=r.length;t<s;t++){const s=c(r[t]),o=i%n;0!==o&&n-o<s.boundary&&(i+=n-o),e.__data=new Float32Array(s.storage/Float32Array.BYTES_PER_ELEMENT),e.__offset=i,i+=s.storage}}}const s=i%n;s>0&&(i+=n-s);t.__size=i,t.__cache={}}(i),u=function(e){const i=function(){for(let t=0;t<a;t++)if(-1===o.indexOf(t))return o.push(t),t;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();e.__bindingPointIndex=i;const n=t.createBuffer(),s=e.__size,r=e.usage;return t.bindBuffer(t.UNIFORM_BUFFER,n),t.bufferData(t.UNIFORM_BUFFER,s,r),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,i,n),n}(i),s[i.id]=u,i.addEventListener("dispose",l));const d=A.program;n.updateUBOMapping(i,d);const f=e.render.frame;r[i.id]!==f&&(!function(e){const i=s[e.id],n=e.uniforms,r=e.__cache;t.bindBuffer(t.UNIFORM_BUFFER,i);for(let e=0,i=n.length;e<i;e++){const i=Array.isArray(n[e])?n[e]:[n[e]];for(let n=0,s=i.length;n<s;n++){const s=i[n];if(!0===h(s,e,n,r)){const e=s.__offset,i=Array.isArray(s.value)?s.value:[s.value];let n=0;for(let r=0;r<i.length;r++){const o=i[r],a=c(o);"number"==typeof o||"boolean"==typeof o?(s.__data[0]=o,t.bufferSubData(t.UNIFORM_BUFFER,e+n,s.__data)):o.isMatrix3?(s.__data[0]=o.elements[0],s.__data[1]=o.elements[1],s.__data[2]=o.elements[2],s.__data[3]=0,s.__data[4]=o.elements[3],s.__data[5]=o.elements[4],s.__data[6]=o.elements[5],s.__data[7]=0,s.__data[8]=o.elements[6],s.__data[9]=o.elements[7],s.__data[10]=o.elements[8],s.__data[11]=0):(o.toArray(s.__data,n),n+=a.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,e,s.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}(i),r[i.id]=f)},dispose:function(){for(const e in s)t.deleteBuffer(s[e]);o=[],s={},r={}}}}class ta{constructor(e={}){const{canvas:i=fe(),context:n=null,depth:o=!0,stencil:a=!1,alpha:h=!1,antialias:c=!1,premultipliedAlpha:l=!0,preserveDrawingBuffer:A=!1,powerPreference:u="default",failIfMajorPerformanceCaveat:d=!1}=e;let f;if(this.isWebGLRenderer=!0,null!==n){if("undefined"!=typeof WebGLRenderingContext&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");f=n.getContextAttributes().alpha}else f=h;const g=new Uint32Array(4),p=new Int32Array(4);let m=null,v=null;const b=[],E=[];this.domElement=i,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=Qt,this._useLegacyLights=!1,this.toneMapping=x,this.toneMappingExposure=1;const C=this;let I=!1,w=0,_=0,B=null,S=-1,M=null;const y=new Te,Q=new Te;let T=null;const D=new nn(0);let L=0,R=i.width,P=i.height,U=1,N=null,k=null;const F=new Te(0,0,R,P),O=new Te(0,0,R,P);let G=!1;const H=new As;let V=!1,z=!1;const q=new di,W=new Ne,j={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function J(){return null===B?U:1}let Z,tt,nt,st,rt,ot,at,ct,lt,At,ut,dt,ft,gt,pt,mt,vt,bt,Et,Ct,It,wt,_t,Bt,St=n;function Mt(t,e){return i.getContext(t,e)}try{const e={alpha:!0,depth:o,stencil:a,antialias:c,premultipliedAlpha:l,preserveDrawingBuffer:A,powerPreference:u,failIfMajorPerformanceCaveat:d};if("setAttribute"in i&&i.setAttribute("data-engine",`three.js r${t}`),i.addEventListener("webglcontextlost",Dt,!1),i.addEventListener("webglcontextrestored",Lt,!1),i.addEventListener("webglcontextcreationerror",Rt,!1),null===St){const t="webgl2";if(St=Mt(t,e),null===St)throw Mt(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(t){throw console.error("THREE.WebGLRenderer: "+t.message),t}function xt(){Z=new Ws(St),Z.init(),wt=new Vo(St,Z),tt=new _s(St,Z,e,wt),nt=new Go(St),st=new Ys(St),rt=new Mo,ot=new Ho(St,Z,nt,rt,tt,wt,st),at=new Ss(C),ct=new qs(C),lt=new ds(St),_t=new Is(St,lt),At=new js(St,lt,st,_t),ut=new Xs(St,At,lt,st),Et=new Ks(St,tt,ot),mt=new Bs(rt),dt=new So(C,at,ct,Z,tt,_t,mt),ft=new Zo(C,rt),gt=new To,pt=new No(Z),bt=new Cs(C,at,ct,nt,ut,f,l),vt=new Oo(C,ut,tt),Bt=new $o(St,st,tt,nt),Ct=new ws(St,Z,st),It=new Js(St,Z,st),st.programs=dt.programs,C.capabilities=tt,C.extensions=Z,C.properties=rt,C.renderLists=gt,C.shadowMap=vt,C.state=nt,C.info=st}xt();const yt=new Yo(C,St);function Dt(t){t.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),I=!0}function Lt(){console.log("THREE.WebGLRenderer: Context Restored."),I=!1;const t=st.autoReset,e=vt.enabled,i=vt.autoUpdate,n=vt.needsUpdate,s=vt.type;xt(),st.autoReset=t,vt.enabled=e,vt.autoUpdate=i,vt.needsUpdate=n,vt.type=s}function Rt(t){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",t.statusMessage)}function Pt(t){const e=t.target;e.removeEventListener("dispose",Pt),function(t){(function(t){const e=rt.get(t).programs;void 0!==e&&(e.forEach((function(t){dt.releaseProgram(t)})),t.isShaderMaterial&&dt.releaseShaderCache(t))})(t),rt.remove(t)}(e)}function Ut(t,e,i){!0===t.transparent&&2===t.side&&!1===t.forceSinglePass?(t.side=r,t.needsUpdate=!0,Wt(t,e,i),t.side=s,t.needsUpdate=!0,Wt(t,e,i),t.side=2):Wt(t,e,i)}this.xr=yt,this.getContext=function(){return St},this.getContextAttributes=function(){return St.getContextAttributes()},this.forceContextLoss=function(){const t=Z.get("WEBGL_lose_context");t&&t.loseContext()},this.forceContextRestore=function(){const t=Z.get("WEBGL_lose_context");t&&t.restoreContext()},this.getPixelRatio=function(){return U},this.setPixelRatio=function(t){void 0!==t&&(U=t,this.setSize(R,P,!1))},this.getSize=function(t){return t.set(R,P)},this.setSize=function(t,e,n=!0){yt.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(R=t,P=e,i.width=Math.floor(t*U),i.height=Math.floor(e*U),!0===n&&(i.style.width=t+"px",i.style.height=e+"px"),this.setViewport(0,0,t,e))},this.getDrawingBufferSize=function(t){return t.set(R*U,P*U).floor()},this.setDrawingBufferSize=function(t,e,n){R=t,P=e,U=n,i.width=Math.floor(t*n),i.height=Math.floor(e*n),this.setViewport(0,0,t,e)},this.getCurrentViewport=function(t){return t.copy(y)},this.getViewport=function(t){return t.copy(F)},this.setViewport=function(t,e,i,n){t.isVector4?F.set(t.x,t.y,t.z,t.w):F.set(t,e,i,n),nt.viewport(y.copy(F).multiplyScalar(U).round())},this.getScissor=function(t){return t.copy(O)},this.setScissor=function(t,e,i,n){t.isVector4?O.set(t.x,t.y,t.z,t.w):O.set(t,e,i,n),nt.scissor(Q.copy(O).multiplyScalar(U).round())},this.getScissorTest=function(){return G},this.setScissorTest=function(t){nt.setScissorTest(G=t)},this.setOpaqueSort=function(t){N=t},this.setTransparentSort=function(t){k=t},this.getClearColor=function(t){return t.copy(bt.getClearColor())},this.setClearColor=function(){bt.setClearColor.apply(bt,arguments)},this.getClearAlpha=function(){return bt.getClearAlpha()},this.setClearAlpha=function(){bt.setClearAlpha.apply(bt,arguments)},this.clear=function(t=!0,e=!0,i=!0){let n=0;if(t){let t=!1;if(null!==B){const e=B.texture.format;t=1033===e||e===ht||1029===e}if(t){const t=B.texture.type,e=t===K||t===$||t===X||t===it||1017===t||1018===t,i=bt.getClearColor(),n=bt.getClearAlpha(),s=i.r,r=i.g,o=i.b;e?(g[0]=s,g[1]=r,g[2]=o,g[3]=n,St.clearBufferuiv(St.COLOR,0,g)):(p[0]=s,p[1]=r,p[2]=o,p[3]=n,St.clearBufferiv(St.COLOR,0,p))}else n|=St.COLOR_BUFFER_BIT}e&&(n|=St.DEPTH_BUFFER_BIT),i&&(n|=St.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),St.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){i.removeEventListener("webglcontextlost",Dt,!1),i.removeEventListener("webglcontextrestored",Lt,!1),i.removeEventListener("webglcontextcreationerror",Rt,!1),gt.dispose(),pt.dispose(),rt.dispose(),at.dispose(),ct.dispose(),ut.dispose(),_t.dispose(),Bt.dispose(),dt.dispose(),yt.dispose(),yt.removeEventListener("sessionstart",kt),yt.removeEventListener("sessionend",Ft),Ot.stop()},this.renderBufferDirect=function(t,e,i,n,s,r){null===e&&(e=j);const o=s.isMesh&&s.matrixWorld.determinant()<0,a=function(t,e,i,n,s){!0!==e.isScene&&(e=j);ot.resetTextureUnits();const r=e.fog,o=n.isMeshStandardMaterial?e.environment:null,a=null===B?C.outputColorSpace:!0===B.isXRRenderTarget?B.texture.colorSpace:Tt,h=(n.isMeshStandardMaterial?ct:at).get(n.envMap||o),c=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,l=!!i.attributes.tangent&&(!!n.normalMap||n.anisotropy>0),A=!!i.morphAttributes.position,u=!!i.morphAttributes.normal,d=!!i.morphAttributes.color;let f=x;n.toneMapped&&(null!==B&&!0!==B.isXRRenderTarget||(f=C.toneMapping));const g=i.morphAttributes.position||i.morphAttributes.normal||i.morphAttributes.color,p=void 0!==g?g.length:0,m=rt.get(n),b=v.state.lights;if(!0===V&&(!0===z||t!==M)){const e=t===M&&n.id===S;mt.setState(n,t,e)}let E=!1;n.version===m.__version?m.needsLights&&m.lightsStateVersion!==b.state.version||m.outputColorSpace!==a||s.isBatchedMesh&&!1===m.batching?E=!0:s.isBatchedMesh||!0!==m.batching?s.isInstancedMesh&&!1===m.instancing?E=!0:s.isInstancedMesh||!0!==m.instancing?s.isSkinnedMesh&&!1===m.skinning?E=!0:s.isSkinnedMesh||!0!==m.skinning?s.isInstancedMesh&&!0===m.instancingColor&&null===s.instanceColor||s.isInstancedMesh&&!1===m.instancingColor&&null!==s.instanceColor||s.isInstancedMesh&&!0===m.instancingMorph&&null===s.morphTexture||s.isInstancedMesh&&!1===m.instancingMorph&&null!==s.morphTexture||m.envMap!==h||!0===n.fog&&m.fog!==r?E=!0:void 0===m.numClippingPlanes||m.numClippingPlanes===mt.numPlanes&&m.numIntersection===mt.numIntersection?(m.vertexAlphas!==c||m.vertexTangents!==l||m.morphTargets!==A||m.morphNormals!==u||m.morphColors!==d||m.toneMapping!==f||m.morphTargetsCount!==p)&&(E=!0):E=!0:E=!0:E=!0:E=!0:(E=!0,m.__version=n.version);let I=m.currentProgram;!0===E&&(I=Wt(n,e,s));let w=!1,_=!1,y=!1;const Q=I.getUniforms(),T=m.uniforms;nt.useProgram(I.program)&&(w=!0,_=!0,y=!0);n.id!==S&&(S=n.id,_=!0);if(w||M!==t){Q.setValue(St,"projectionMatrix",t.projectionMatrix),Q.setValue(St,"viewMatrix",t.matrixWorldInverse);const e=Q.map.cameraPosition;void 0!==e&&e.setValue(St,W.setFromMatrixPosition(t.matrixWorld)),tt.logarithmicDepthBuffer&&Q.setValue(St,"logDepthBufFC",2/(Math.log(t.far+1)/Math.LN2)),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&Q.setValue(St,"isOrthographic",!0===t.isOrthographicCamera),M!==t&&(M=t,_=!0,y=!0)}if(s.isSkinnedMesh){Q.setOptional(St,s,"bindMatrix"),Q.setOptional(St,s,"bindMatrixInverse");const t=s.skeleton;t&&(null===t.boneTexture&&t.computeBoneTexture(),Q.setValue(St,"boneTexture",t.boneTexture,ot))}s.isBatchedMesh&&(Q.setOptional(St,s,"batchingTexture"),Q.setValue(St,"batchingTexture",s._matricesTexture,ot));const D=i.morphAttributes;void 0===D.position&&void 0===D.normal&&void 0===D.color||Et.update(s,i,I);(_||m.receiveShadow!==s.receiveShadow)&&(m.receiveShadow=s.receiveShadow,Q.setValue(St,"receiveShadow",s.receiveShadow));n.isMeshGouraudMaterial&&null!==n.envMap&&(T.envMap.value=h,T.flipEnvMap.value=h.isCubeTexture&&!1===h.isRenderTargetTexture?-1:1);n.isMeshStandardMaterial&&null===n.envMap&&null!==e.environment&&(T.envMapIntensity.value=e.environmentIntensity);_&&(Q.setValue(St,"toneMappingExposure",C.toneMappingExposure),m.needsLights&&(R=y,(L=T).ambientLightColor.needsUpdate=R,L.lightProbe.needsUpdate=R,L.directionalLights.needsUpdate=R,L.directionalLightShadows.needsUpdate=R,L.pointLights.needsUpdate=R,L.pointLightShadows.needsUpdate=R,L.spotLights.needsUpdate=R,L.spotLightShadows.needsUpdate=R,L.rectAreaLights.needsUpdate=R,L.hemisphereLights.needsUpdate=R),r&&!0===n.fog&&ft.refreshFogUniforms(T,r),ft.refreshMaterialUniforms(T,n,U,P,v.state.transmissionRenderTarget[t.id]),no.upload(St,jt(m),T,ot));var L,R;n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(no.upload(St,jt(m),T,ot),n.uniformsNeedUpdate=!1);n.isSpriteMaterial&&Q.setValue(St,"center",s.center);if(Q.setValue(St,"modelViewMatrix",s.modelViewMatrix),Q.setValue(St,"normalMatrix",s.normalMatrix),Q.setValue(St,"modelMatrix",s.matrixWorld),n.isShaderMaterial||n.isRawShaderMaterial){const t=n.uniformsGroups;for(let e=0,i=t.length;e<i;e++){const i=t[e];Bt.update(i,I),Bt.bind(i,I)}}return I}(t,e,i,n,s);nt.setMaterial(n,o);let h=i.index,c=1;if(!0===n.wireframe){if(h=At.getWireframeAttribute(i),void 0===h)return;c=2}const l=i.drawRange,A=i.attributes.position;let u=l.start*c,d=(l.start+l.count)*c;null!==r&&(u=Math.max(u,r.start*c),d=Math.min(d,(r.start+r.count)*c)),null!==h?(u=Math.max(u,0),d=Math.min(d,h.count)):null!=A&&(u=Math.max(u,0),d=Math.min(d,A.count));const f=d-u;if(f<0||f===1/0)return;let g;_t.setup(s,n,a,i,h);let p=Ct;if(null!==h&&(g=lt.get(h),p=It,p.setIndex(g)),s.isMesh)!0===n.wireframe?(nt.setLineWidth(n.wireframeLinewidth*J()),p.setMode(St.LINES)):p.setMode(St.TRIANGLES);else if(s.isLine){let t=n.linewidth;void 0===t&&(t=1),nt.setLineWidth(t*J()),s.isLineSegments?p.setMode(St.LINES):s.isLineLoop?p.setMode(St.LINE_LOOP):p.setMode(St.LINE_STRIP)}else s.isPoints?p.setMode(St.POINTS):s.isSprite&&p.setMode(St.TRIANGLES);if(s.isBatchedMesh)null!==s._multiDrawInstances?p.renderMultiDrawInstances(s._multiDrawStarts,s._multiDrawCounts,s._multiDrawCount,s._multiDrawInstances):p.renderMultiDraw(s._multiDrawStarts,s._multiDrawCounts,s._multiDrawCount);else if(s.isInstancedMesh)p.renderInstances(u,f,s.count);else if(i.isInstancedBufferGeometry){const t=void 0!==i._maxInstanceCount?i._maxInstanceCount:1/0,e=Math.min(i.instanceCount,t);p.renderInstances(u,f,e)}else p.render(u,f)},this.compile=function(t,e,i=null){null===i&&(i=t),v=pt.get(i),v.init(e),E.push(v),i.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(v.pushLight(t),t.castShadow&&v.pushShadow(t))})),t!==i&&t.traverseVisible((function(t){t.isLight&&t.layers.test(e.layers)&&(v.pushLight(t),t.castShadow&&v.pushShadow(t))})),v.setupLights(C._useLegacyLights);const n=new Set;return t.traverse((function(t){const e=t.material;if(e)if(Array.isArray(e))for(let s=0;s<e.length;s++){const r=e[s];Ut(r,i,t),n.add(r)}else Ut(e,i,t),n.add(e)})),E.pop(),v=null,n},this.compileAsync=function(t,e,i=null){const n=this.compile(t,e,i);return new Promise((e=>{function i(){n.forEach((function(t){rt.get(t).currentProgram.isReady()&&n.delete(t)})),0!==n.size?setTimeout(i,10):e(t)}null!==Z.get("KHR_parallel_shader_compile")?i():setTimeout(i,10)}))};let Nt=null;function kt(){Ot.stop()}function Ft(){Ot.start()}const Ot=new us;function Gt(t,e,i,n){if(!1===t.visible)return;if(t.layers.test(e.layers))if(t.isGroup)i=t.renderOrder;else if(t.isLOD)!0===t.autoUpdate&&t.update(e);else if(t.isLight)v.pushLight(t),t.castShadow&&v.pushShadow(t);else if(t.isSprite){if(!t.frustumCulled||H.intersectsSprite(t)){n&&W.setFromMatrixPosition(t.matrixWorld).applyMatrix4(q);const e=ut.update(t),s=t.material;s.visible&&m.push(t,e,s,i,W.z,null)}}else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||H.intersectsObject(t))){const e=ut.update(t),s=t.material;if(n&&(void 0!==t.boundingSphere?(null===t.boundingSphere&&t.computeBoundingSphere(),W.copy(t.boundingSphere.center)):(null===e.boundingSphere&&e.computeBoundingSphere(),W.copy(e.boundingSphere.center)),W.applyMatrix4(t.matrixWorld).applyMatrix4(q)),Array.isArray(s)){const n=e.groups;for(let r=0,o=n.length;r<o;r++){const o=n[r],a=s[o.materialIndex];a&&a.visible&&m.push(t,e,a,i,W.z,o)}}else s.visible&&m.push(t,e,s,i,W.z,null)}const s=t.children;for(let t=0,r=s.length;t<r;t++)Gt(s[t],e,i,n)}function Ht(t,e,i,n){const s=t.opaque,r=t.transmissive,o=t.transparent;v.setupLightsView(i),!0===V&&mt.setGlobalState(C.clippingPlanes,i),n&&nt.viewport(y.copy(n)),s.length>0&&zt(s,e,i),r.length>0&&zt(r,e,i),o.length>0&&zt(o,e,i),nt.buffers.depth.setTest(!0),nt.buffers.depth.setMask(!0),nt.buffers.color.setMask(!0),nt.setPolygonOffset(!1)}function Vt(t,e,i,n){if(null!==(!0===i.isScene?i.overrideMaterial:null))return;void 0===v.state.transmissionRenderTarget[n.id]&&(v.state.transmissionRenderTarget[n.id]=new Le(1,1,{generateMipmaps:!0,type:Z.has("EXT_color_buffer_half_float")||Z.has("EXT_color_buffer_float")?et:K,minFilter:Y,samples:4,stencilBuffer:a,resolveDepthBuffer:!1,resolveStencilBuffer:!1}));const s=v.state.transmissionRenderTarget[n.id],o=n.viewport||y;s.setSize(o.z,o.w);const h=C.getRenderTarget();C.setRenderTarget(s),C.getClearColor(D),L=C.getClearAlpha(),L<1&&C.setClearColor(16777215,.5),C.clear();const c=C.toneMapping;C.toneMapping=x;const l=n.viewport;if(void 0!==n.viewport&&(n.viewport=void 0),v.setupLightsView(n),!0===V&&mt.setGlobalState(C.clippingPlanes,n),zt(t,i,n),ot.updateMultisampleRenderTarget(s),ot.updateRenderTargetMipmap(s),!1===Z.has("WEBGL_multisampled_render_to_texture")){let t=!1;for(let s=0,o=e.length;s<o;s++){const o=e[s],a=o.object,h=o.geometry,c=o.material,l=o.group;if(2===c.side&&a.layers.test(n.layers)){const e=c.side;c.side=r,c.needsUpdate=!0,qt(a,i,n,h,c,l),c.side=e,c.needsUpdate=!0,t=!0}}!0===t&&(ot.updateMultisampleRenderTarget(s),ot.updateRenderTargetMipmap(s))}C.setRenderTarget(h),C.setClearColor(D,L),void 0!==l&&(n.viewport=l),C.toneMapping=c}function zt(t,e,i){const n=!0===e.isScene?e.overrideMaterial:null;for(let s=0,r=t.length;s<r;s++){const r=t[s],o=r.object,a=r.geometry,h=null===n?r.material:n,c=r.group;o.layers.test(i.layers)&&qt(o,e,i,a,h,c)}}function qt(t,e,i,n,o,a){t.onBeforeRender(C,e,i,n,o,a),t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix),o.onBeforeRender(C,e,i,n,t,a),!0===o.transparent&&2===o.side&&!1===o.forceSinglePass?(o.side=r,o.needsUpdate=!0,C.renderBufferDirect(i,e,n,o,t,a),o.side=s,o.needsUpdate=!0,C.renderBufferDirect(i,e,n,o,t,a),o.side=2):C.renderBufferDirect(i,e,n,o,t,a),t.onAfterRender(C,e,i,n,o,a)}function Wt(t,e,i){!0!==e.isScene&&(e=j);const n=rt.get(t),s=v.state.lights,r=v.state.shadowsArray,o=s.state.version,a=dt.getParameters(t,s.state,r,e,i),h=dt.getProgramCacheKey(a);let c=n.programs;n.environment=t.isMeshStandardMaterial?e.environment:null,n.fog=e.fog,n.envMap=(t.isMeshStandardMaterial?ct:at).get(t.envMap||n.environment),n.envMapRotation=null!==n.environment&&null===t.envMap?e.environmentRotation:t.envMapRotation,void 0===c&&(t.addEventListener("dispose",Pt),c=new Map,n.programs=c);let l=c.get(h);if(void 0!==l){if(n.currentProgram===l&&n.lightsStateVersion===o)return Jt(t,a),l}else a.uniforms=dt.getUniforms(t),t.onBuild(i,a,C),t.onBeforeCompile(a,C),l=dt.acquireProgram(a,h),c.set(h,l),n.uniforms=a.uniforms;const A=n.uniforms;return(t.isShaderMaterial||t.isRawShaderMaterial)&&!0!==t.clipping||(A.clippingPlanes=mt.uniform),Jt(t,a),n.needsLights=function(t){return t.isMeshLambertMaterial||t.isMeshToonMaterial||t.isMeshPhongMaterial||t.isMeshStandardMaterial||t.isShadowMaterial||t.isShaderMaterial&&!0===t.lights}(t),n.lightsStateVersion=o,n.needsLights&&(A.ambientLightColor.value=s.state.ambient,A.lightProbe.value=s.state.probe,A.directionalLights.value=s.state.directional,A.directionalLightShadows.value=s.state.directionalShadow,A.spotLights.value=s.state.spot,A.spotLightShadows.value=s.state.spotShadow,A.rectAreaLights.value=s.state.rectArea,A.ltc_1.value=s.state.rectAreaLTC1,A.ltc_2.value=s.state.rectAreaLTC2,A.pointLights.value=s.state.point,A.pointLightShadows.value=s.state.pointShadow,A.hemisphereLights.value=s.state.hemi,A.directionalShadowMap.value=s.state.directionalShadowMap,A.directionalShadowMatrix.value=s.state.directionalShadowMatrix,A.spotShadowMap.value=s.state.spotShadowMap,A.spotLightMatrix.value=s.state.spotLightMatrix,A.spotLightMap.value=s.state.spotLightMap,A.pointShadowMap.value=s.state.pointShadowMap,A.pointShadowMatrix.value=s.state.pointShadowMatrix),n.currentProgram=l,n.uniformsList=null,l}function jt(t){if(null===t.uniformsList){const e=t.currentProgram.getUniforms();t.uniformsList=no.seqWithValue(e.seq,t.uniforms)}return t.uniformsList}function Jt(t,e){const i=rt.get(t);i.outputColorSpace=e.outputColorSpace,i.batching=e.batching,i.instancing=e.instancing,i.instancingColor=e.instancingColor,i.instancingMorph=e.instancingMorph,i.skinning=e.skinning,i.morphTargets=e.morphTargets,i.morphNormals=e.morphNormals,i.morphColors=e.morphColors,i.morphTargetsCount=e.morphTargetsCount,i.numClippingPlanes=e.numClippingPlanes,i.numIntersection=e.numClipIntersection,i.vertexAlphas=e.vertexAlphas,i.vertexTangents=e.vertexTangents,i.toneMapping=e.toneMapping}Ot.setAnimationLoop((function(t){Nt&&Nt(t)})),"undefined"!=typeof self&&Ot.setContext(self),this.setAnimationLoop=function(t){Nt=t,yt.setAnimationLoop(t),null===t?Ot.stop():Ot.start()},yt.addEventListener("sessionstart",kt),yt.addEventListener("sessionend",Ft),this.render=function(t,e){if(void 0!==e&&!0!==e.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===I)return;!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),!0===yt.enabled&&!0===yt.isPresenting&&(!0===yt.cameraAutoUpdate&&yt.updateCamera(e),e=yt.getCamera()),!0===t.isScene&&t.onBeforeRender(C,t,e,B),v=pt.get(t,E.length),v.init(e),E.push(v),q.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),H.setFromProjectionMatrix(q),z=this.localClippingEnabled,V=mt.init(this.clippingPlanes,z),m=gt.get(t,b.length),m.init(),b.push(m),Gt(t,e,0,C.sortObjects),m.finish(),!0===C.sortObjects&&m.sort(N,k);const i=!1===yt.enabled||!1===yt.isPresenting||!1===yt.hasDepthSensing();i&&bt.addToRenderList(m,t),this.info.render.frame++,!0===V&&mt.beginShadows();const n=v.state.shadowsArray;vt.render(n,t,e),!0===V&&mt.endShadows(),!0===this.info.autoReset&&this.info.reset();const s=m.opaque,r=m.transmissive;if(v.setupLights(C._useLegacyLights),e.isArrayCamera){const n=e.cameras;if(r.length>0)for(let e=0,i=n.length;e<i;e++){Vt(s,r,t,n[e])}i&&bt.render(t);for(let e=0,i=n.length;e<i;e++){const i=n[e];Ht(m,t,i,i.viewport)}}else r.length>0&&Vt(s,r,t,e),i&&bt.render(t),Ht(m,t,e);null!==B&&(ot.updateMultisampleRenderTarget(B),ot.updateRenderTargetMipmap(B)),!0===t.isScene&&t.onAfterRender(C,t,e),_t.resetDefaultState(),S=-1,M=null,E.pop(),E.length>0?(v=E[E.length-1],!0===V&&mt.setGlobalState(C.clippingPlanes,v.state.camera)):v=null,b.pop(),m=b.length>0?b[b.length-1]:null},this.getActiveCubeFace=function(){return w},this.getActiveMipmapLevel=function(){return _},this.getRenderTarget=function(){return B},this.setRenderTargetTextures=function(t,e,i){rt.get(t.texture).__webglTexture=e,rt.get(t.depthTexture).__webglTexture=i;const n=rt.get(t);n.__hasExternalTextures=!0,n.__autoAllocateDepthBuffer=void 0===i,n.__autoAllocateDepthBuffer||!0===Z.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),n.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(t,e){const i=rt.get(t);i.__webglFramebuffer=e,i.__useDefaultFramebuffer=void 0===e},this.setRenderTarget=function(t,e=0,i=0){B=t,w=e,_=i;let n=!0,s=null,r=!1,o=!1;if(t){const a=rt.get(t);void 0!==a.__useDefaultFramebuffer?(nt.bindFramebuffer(St.FRAMEBUFFER,null),n=!1):void 0===a.__webglFramebuffer?ot.setupRenderTarget(t):a.__hasExternalTextures&&ot.rebindTextures(t,rt.get(t.texture).__webglTexture,rt.get(t.depthTexture).__webglTexture);const h=t.texture;(h.isData3DTexture||h.isDataArrayTexture||h.isCompressedArrayTexture)&&(o=!0);const c=rt.get(t).__webglFramebuffer;t.isWebGLCubeRenderTarget?(s=Array.isArray(c[e])?c[e][i]:c[e],r=!0):s=t.samples>0&&!1===ot.useMultisampledRTT(t)?rt.get(t).__webglMultisampledFramebuffer:Array.isArray(c)?c[i]:c,y.copy(t.viewport),Q.copy(t.scissor),T=t.scissorTest}else y.copy(F).multiplyScalar(U).floor(),Q.copy(O).multiplyScalar(U).floor(),T=G;if(nt.bindFramebuffer(St.FRAMEBUFFER,s)&&n&&nt.drawBuffers(t,s),nt.viewport(y),nt.scissor(Q),nt.setScissorTest(T),r){const n=rt.get(t.texture);St.framebufferTexture2D(St.FRAMEBUFFER,St.COLOR_ATTACHMENT0,St.TEXTURE_CUBE_MAP_POSITIVE_X+e,n.__webglTexture,i)}else if(o){const n=rt.get(t.texture),s=e||0;St.framebufferTextureLayer(St.FRAMEBUFFER,St.COLOR_ATTACHMENT0,n.__webglTexture,i||0,s)}S=-1},this.readRenderTargetPixels=function(t,e,i,n,s,r,o){if(!t||!t.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=rt.get(t).__webglFramebuffer;if(t.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){nt.bindFramebuffer(St.FRAMEBUFFER,a);try{const o=t.texture,a=o.format,h=o.type;if(!tt.textureFormatReadable(a))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!tt.textureTypeReadable(h))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");e>=0&&e<=t.width-n&&i>=0&&i<=t.height-s&&St.readPixels(e,i,n,s,wt.convert(a),wt.convert(h),r)}finally{const t=null!==B?rt.get(B).__webglFramebuffer:null;nt.bindFramebuffer(St.FRAMEBUFFER,t)}}},this.copyFramebufferToTexture=function(t,e,i=0){const n=Math.pow(2,-i),s=Math.floor(e.image.width*n),r=Math.floor(e.image.height*n);ot.setTexture2D(e,0),St.copyTexSubImage2D(St.TEXTURE_2D,i,0,0,t.x,t.y,s,r),nt.unbindTexture()},this.copyTextureToTexture=function(t,e,i,n=0){const s=e.image.width,r=e.image.height,o=wt.convert(i.format),a=wt.convert(i.type);ot.setTexture2D(i,0),St.pixelStorei(St.UNPACK_FLIP_Y_WEBGL,i.flipY),St.pixelStorei(St.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),St.pixelStorei(St.UNPACK_ALIGNMENT,i.unpackAlignment),e.isDataTexture?St.texSubImage2D(St.TEXTURE_2D,n,t.x,t.y,s,r,o,a,e.image.data):e.isCompressedTexture?St.compressedTexSubImage2D(St.TEXTURE_2D,n,t.x,t.y,e.mipmaps[0].width,e.mipmaps[0].height,o,e.mipmaps[0].data):St.texSubImage2D(St.TEXTURE_2D,n,t.x,t.y,o,a,e.image),0===n&&i.generateMipmaps&&St.generateMipmap(St.TEXTURE_2D),nt.unbindTexture()},this.copyTextureToTexture3D=function(t,e,i,n,s=0){const r=t.max.x-t.min.x,o=t.max.y-t.min.y,a=t.max.z-t.min.z,h=wt.convert(n.format),c=wt.convert(n.type);let l;if(n.isData3DTexture)ot.setTexture3D(n,0),l=St.TEXTURE_3D;else{if(!n.isDataArrayTexture&&!n.isCompressedArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");ot.setTexture2DArray(n,0),l=St.TEXTURE_2D_ARRAY}St.pixelStorei(St.UNPACK_FLIP_Y_WEBGL,n.flipY),St.pixelStorei(St.UNPACK_PREMULTIPLY_ALPHA_WEBGL,n.premultiplyAlpha),St.pixelStorei(St.UNPACK_ALIGNMENT,n.unpackAlignment);const A=St.getParameter(St.UNPACK_ROW_LENGTH),u=St.getParameter(St.UNPACK_IMAGE_HEIGHT),d=St.getParameter(St.UNPACK_SKIP_PIXELS),f=St.getParameter(St.UNPACK_SKIP_ROWS),g=St.getParameter(St.UNPACK_SKIP_IMAGES),p=i.isCompressedTexture?i.mipmaps[s]:i.image;St.pixelStorei(St.UNPACK_ROW_LENGTH,p.width),St.pixelStorei(St.UNPACK_IMAGE_HEIGHT,p.height),St.pixelStorei(St.UNPACK_SKIP_PIXELS,t.min.x),St.pixelStorei(St.UNPACK_SKIP_ROWS,t.min.y),St.pixelStorei(St.UNPACK_SKIP_IMAGES,t.min.z),i.isDataTexture||i.isData3DTexture?St.texSubImage3D(l,s,e.x,e.y,e.z,r,o,a,h,c,p.data):n.isCompressedArrayTexture?St.compressedTexSubImage3D(l,s,e.x,e.y,e.z,r,o,a,h,p.data):St.texSubImage3D(l,s,e.x,e.y,e.z,r,o,a,h,c,p),St.pixelStorei(St.UNPACK_ROW_LENGTH,A),St.pixelStorei(St.UNPACK_IMAGE_HEIGHT,u),St.pixelStorei(St.UNPACK_SKIP_PIXELS,d),St.pixelStorei(St.UNPACK_SKIP_ROWS,f),St.pixelStorei(St.UNPACK_SKIP_IMAGES,g),0===s&&n.generateMipmaps&&St.generateMipmap(l),nt.unbindTexture()},this.initTexture=function(t){t.isCubeTexture?ot.setTextureCube(t,0):t.isData3DTexture?ot.setTexture3D(t,0):t.isDataArrayTexture||t.isCompressedArrayTexture?ot.setTexture2DArray(t,0):ot.setTexture2D(t,0),nt.unbindTexture()},this.resetState=function(){w=0,_=0,B=null,nt.reset(),_t.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Yt}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(t){this._outputColorSpace=t;const e=this.getContext();e.drawingBufferColorSpace=t===Dt?"display-p3":"srgb",e.unpackColorSpace=Ce.workingColorSpace===Lt?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(t){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=t}}let ea=class extends Oi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new wi,this.environmentIntensity=1,this.environmentRotation=new wi,this.overrideMaterial=null,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),null!==t.background&&(this.background=t.background.clone()),null!==t.environment&&(this.environment=t.environment.clone()),null!==t.fog&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),null!==t.overrideMaterial&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return null!==this.fog&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),1!==this.environmentIntensity&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}};class ia{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=void 0!==t?t.length/e:0,this.usage=jt,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.version=0,this.uuid=ie()}onUploadCallback(){}set needsUpdate(t){!0===t&&this.version++}get updateRange(){return pe("THREE.InterleavedBuffer: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,i){t*=this.stride,i*=e.stride;for(let n=0,s=this.stride;n<s;n++)this.array[t+n]=e.array[i+n];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ie()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(e,this.stride);return i.setUsage(this.usage),i}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return void 0===t.arrayBuffers&&(t.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=ie()),void 0===t.arrayBuffers[this.array.buffer._uuid]&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const na=new Ne;class sa{constructor(t,e,i,n=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=i,this.normalized=n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,i=this.data.count;e<i;e++)na.fromBufferAttribute(this,e),na.applyMatrix4(t),this.setXYZ(e,na.x,na.y,na.z);return this}applyNormalMatrix(t){for(let e=0,i=this.count;e<i;e++)na.fromBufferAttribute(this,e),na.applyNormalMatrix(t),this.setXYZ(e,na.x,na.y,na.z);return this}transformDirection(t){for(let e=0,i=this.count;e<i;e++)na.fromBufferAttribute(this,e),na.transformDirection(t),this.setXYZ(e,na.x,na.y,na.z);return this}getComponent(t,e){let i=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(i=oe(i,this.array)),i}setComponent(t,e,i){return this.normalized&&(i=ae(i,this.array)),this.data.array[t*this.data.stride+this.offset+e]=i,this}setX(t,e){return this.normalized&&(e=ae(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=ae(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=ae(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=ae(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=oe(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=oe(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=oe(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=oe(e,this.array)),e}setXY(t,e,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=ae(e,this.array),i=ae(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this}setXYZ(t,e,i,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=ae(e,this.array),i=ae(i,this.array),n=ae(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this}setXYZW(t,e,i,n,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=ae(e,this.array),i=ae(i,this.array),n=ae(n,this.array),s=ae(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=i,this.data.array[t+2]=n,this.data.array[t+3]=s,this}clone(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return new dn(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new sa(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let e=0;e<this.count;e++){const i=e*this.data.stride+this.offset;for(let e=0;e<this.itemSize;e++)t.push(this.data.array[i+e])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}const ra=new Ne,oa=new Te,aa=new Te,ha=new Ne,ca=new di,la=new Ne,Aa=new si,ua=new di,da=new ui;class fa extends Hn{constructor(t,e){super(t,e),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=U,this.bindMatrix=new di,this.bindMatrixInverse=new di,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const t=this.geometry;null===this.boundingBox&&(this.boundingBox=new Oe),this.boundingBox.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,la),this.boundingBox.expandByPoint(la)}computeBoundingSphere(){const t=this.geometry;null===this.boundingSphere&&(this.boundingSphere=new si),this.boundingSphere.makeEmpty();const e=t.getAttribute("position");for(let t=0;t<e.count;t++)this.getVertexPosition(t,la),this.boundingSphere.expandByPoint(la)}copy(t,e){return super.copy(t,e),this.bindMode=t.bindMode,this.bindMatrix.copy(t.bindMatrix),this.bindMatrixInverse.copy(t.bindMatrixInverse),this.skeleton=t.skeleton,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}raycast(t,e){const i=this.material,n=this.matrixWorld;void 0!==i&&(null===this.boundingSphere&&this.computeBoundingSphere(),Aa.copy(this.boundingSphere),Aa.applyMatrix4(n),!1!==t.ray.intersectsSphere(Aa)&&(ua.copy(n).invert(),da.copy(t.ray).applyMatrix4(ua),null!==this.boundingBox&&!1===da.intersectsBox(this.boundingBox)||this._computeIntersections(t,e,da)))}getVertexPosition(t,e){return super.getVertexPosition(t,e),this.applyBoneTransform(t,e),e}bind(t,e){this.skeleton=t,void 0===e&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),e=this.matrixWorld),this.bindMatrix.copy(e),this.bindMatrixInverse.copy(e).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const t=new Te,e=this.geometry.attributes.skinWeight;for(let i=0,n=e.count;i<n;i++){t.fromBufferAttribute(e,i);const n=1/t.manhattanLength();n!==1/0?t.multiplyScalar(n):t.set(1,0,0,0),e.setXYZW(i,t.x,t.y,t.z,t.w)}}updateMatrixWorld(t){super.updateMatrixWorld(t),this.bindMode===U?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(t,e){const i=this.skeleton,n=this.geometry;oa.fromBufferAttribute(n.attributes.skinIndex,t),aa.fromBufferAttribute(n.attributes.skinWeight,t),ra.copy(e).applyMatrix4(this.bindMatrix),e.set(0,0,0);for(let t=0;t<4;t++){const n=aa.getComponent(t);if(0!==n){const s=oa.getComponent(t);ca.multiplyMatrices(i.bones[s].matrixWorld,i.boneInverses[s]),e.addScaledVector(ha.copy(ra).applyMatrix4(ca),n)}}return e.applyMatrix4(this.bindMatrixInverse)}}class ga extends Oi{constructor(){super(),this.isBone=!0,this.type="Bone"}}class pa extends Qe{constructor(t=null,e=1,i=1,n,s,r,o,a,h=1003,c=1003,l,A){super(null,r,o,a,h,c,n,s,l,A),this.isDataTexture=!0,this.image={data:t,width:e,height:i},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const ma=new di,va=new di;class ba{constructor(t=[],e=[]){this.uuid=ie(),this.bones=t.slice(0),this.boneInverses=e,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const t=this.bones,e=this.boneInverses;if(this.boneMatrices=new Float32Array(16*t.length),0===e.length)this.calculateInverses();else if(t.length!==e.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let t=0,e=this.bones.length;t<e;t++)this.boneInverses.push(new di)}}calculateInverses(){this.boneInverses.length=0;for(let t=0,e=this.bones.length;t<e;t++){const e=new di;this.bones[t]&&e.copy(this.bones[t].matrixWorld).invert(),this.boneInverses.push(e)}}pose(){for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&e.matrixWorld.copy(this.boneInverses[t]).invert()}for(let t=0,e=this.bones.length;t<e;t++){const e=this.bones[t];e&&(e.parent&&e.parent.isBone?(e.matrix.copy(e.parent.matrixWorld).invert(),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))}}update(){const t=this.bones,e=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,s=t.length;n<s;n++){const s=t[n]?t[n].matrixWorld:va;ma.multiplyMatrices(s,e[n]),ma.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new ba(this.bones,this.boneInverses)}computeBoneTexture(){let t=Math.sqrt(4*this.bones.length);t=4*Math.ceil(t/4),t=Math.max(t,4);const e=new Float32Array(t*t*4);e.set(this.boneMatrices);const i=new pa(e,t,t,nt,tt);return i.needsUpdate=!0,this.boneMatrices=e,this.boneTexture=i,this}getBoneByName(t){for(let e=0,i=this.bones.length;e<i;e++){const i=this.bones[e];if(i.name===t)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(t,e){this.uuid=t.uuid;for(let i=0,n=t.bones.length;i<n;i++){const n=t.bones[i];let s=e[n];void 0===s&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),s=new ga),this.bones.push(s),this.boneInverses.push((new di).fromArray(t.boneInverses[i]))}return this.init(),this}toJSON(){const t={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};t.uuid=this.uuid;const e=this.bones,i=this.boneInverses;for(let n=0,s=e.length;n<s;n++){const s=e[n];t.bones.push(s.uuid);const r=i[n];t.boneInverses.push(r.toArray())}return t}}class Ea extends dn{constructor(t,e,i,n=1){super(t,e,i),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=n}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Ca=new di,Ia=new di,wa=[],_a=new Oe,Ba=new di,Sa=new Hn,Ma=new si;class xa extends Hn{constructor(t,e,i){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new Ea(new Float32Array(16*i),16),this.instanceColor=null,this.morphTexture=null,this.count=i,this.boundingBox=null,this.boundingSphere=null;for(let t=0;t<i;t++)this.setMatrixAt(t,Ba)}computeBoundingBox(){const t=this.geometry,e=this.count;null===this.boundingBox&&(this.boundingBox=new Oe),null===t.boundingBox&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,Ca),_a.copy(t.boundingBox).applyMatrix4(Ca),this.boundingBox.union(_a)}computeBoundingSphere(){const t=this.geometry,e=this.count;null===this.boundingSphere&&(this.boundingSphere=new si),null===t.boundingSphere&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let i=0;i<e;i++)this.getMatrixAt(i,Ca),Ma.copy(t.boundingSphere).applyMatrix4(Ca),this.boundingSphere.union(Ma)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),null!==t.morphTexture&&(this.morphTexture=t.morphTexture.clone()),null!==t.instanceColor&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone()),null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,3*t)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,16*t)}getMorphAt(t,e){const i=e.morphTargetInfluences,n=this.morphTexture.source.data.data,s=t*(i.length+1)+1;for(let t=0;t<i.length;t++)i[t]=n[s+t]}raycast(t,e){const i=this.matrixWorld,n=this.count;if(Sa.geometry=this.geometry,Sa.material=this.material,void 0!==Sa.material&&(null===this.boundingSphere&&this.computeBoundingSphere(),Ma.copy(this.boundingSphere),Ma.applyMatrix4(i),!1!==t.ray.intersectsSphere(Ma)))for(let s=0;s<n;s++){this.getMatrixAt(s,Ca),Ia.multiplyMatrices(i,Ca),Sa.matrixWorld=Ia,Sa.raycast(t,wa);for(let t=0,i=wa.length;t<i;t++){const i=wa[t];i.instanceId=s,i.object=this,e.push(i)}wa.length=0}}setColorAt(t,e){null===this.instanceColor&&(this.instanceColor=new Ea(new Float32Array(3*this.instanceMatrix.count),3)),e.toArray(this.instanceColor.array,3*t)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,16*t)}setMorphAt(t,e){const i=e.morphTargetInfluences,n=i.length+1;null===this.morphTexture&&(this.morphTexture=new pa(new Float32Array(n*this.count),n,this.count,ot,tt));const s=this.morphTexture.source.data.data;let r=0;for(let t=0;t<i.length;t++)r+=i[t];const o=this.geometry.morphTargetsRelative?1:1-r,a=n*t;s[a]=o,s.set(i,a+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),null!==this.morphTexture&&(this.morphTexture.dispose(),this.morphTexture=null),this}}class ya extends on{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new nn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}const Qa=new Ne,Ta=new Ne,Da=new di,La=new ui,Ra=new si,Pa=new Ne,Ua=new Ne;class Na extends Oi{constructor(t=new _n,e=new ya){super(),this.isLine=!0,this.type="Line",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,i=[0];for(let t=1,n=e.count;t<n;t++)Qa.fromBufferAttribute(e,t-1),Ta.fromBufferAttribute(e,t),i[t]=i[t-1],i[t]+=Qa.distanceTo(Ta);t.setAttribute("lineDistance",new pn(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,s=t.params.Line.threshold,r=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Ra.copy(i.boundingSphere),Ra.applyMatrix4(n),Ra.radius+=s,!1===t.ray.intersectsSphere(Ra))return;Da.copy(n).invert(),La.copy(t.ray).applyMatrix4(Da);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,h=this.isLineSegments?2:1,c=i.index,l=i.attributes.position;if(null!==c){const i=Math.max(0,r.start),n=Math.min(c.count,r.start+r.count);for(let s=i,r=n-1;s<r;s+=h){const i=c.getX(s),n=c.getX(s+1),r=ka(this,t,La,a,i,n);r&&e.push(r)}if(this.isLineLoop){const s=c.getX(n-1),r=c.getX(i),o=ka(this,t,La,a,s,r);o&&e.push(o)}}else{const i=Math.max(0,r.start),n=Math.min(l.count,r.start+r.count);for(let s=i,r=n-1;s<r;s+=h){const i=ka(this,t,La,a,s,s+1);i&&e.push(i)}if(this.isLineLoop){const s=ka(this,t,La,a,n-1,i);s&&e.push(s)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function ka(t,e,i,n,s,r){const o=t.geometry.attributes.position;Qa.fromBufferAttribute(o,s),Ta.fromBufferAttribute(o,r);if(i.distanceSqToSegment(Qa,Ta,Pa,Ua)>n)return;Pa.applyMatrix4(t.matrixWorld);const a=e.ray.origin.distanceTo(Pa);return a<e.near||a>e.far?void 0:{distance:a,point:Ua.clone().applyMatrix4(t.matrixWorld),index:s,face:null,faceIndex:null,object:t}}const Fa=new Ne,Oa=new Ne;class Ga extends Na{constructor(t,e){super(t,e),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const t=this.geometry;if(null===t.index){const e=t.attributes.position,i=[];for(let t=0,n=e.count;t<n;t+=2)Fa.fromBufferAttribute(e,t),Oa.fromBufferAttribute(e,t+1),i[t]=0===t?0:i[t-1],i[t+1]=i[t]+Fa.distanceTo(Oa);t.setAttribute("lineDistance",new pn(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class Ha extends Na{constructor(t,e){super(t,e),this.isLineLoop=!0,this.type="LineLoop"}}class Va extends on{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new nn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const za=new di,qa=new ui,Wa=new si,ja=new Ne;class Ja extends Oi{constructor(t=new _n,e=new Va){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const i=this.geometry,n=this.matrixWorld,s=t.params.Points.threshold,r=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),Wa.copy(i.boundingSphere),Wa.applyMatrix4(n),Wa.radius+=s,!1===t.ray.intersectsSphere(Wa))return;za.copy(n).invert(),qa.copy(t.ray).applyMatrix4(za);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,h=i.index,c=i.attributes.position;if(null!==h){for(let i=Math.max(0,r.start),s=Math.min(h.count,r.start+r.count);i<s;i++){const s=h.getX(i);ja.fromBufferAttribute(c,s),Ya(ja,s,a,n,t,e,this)}}else{for(let i=Math.max(0,r.start),s=Math.min(c.count,r.start+r.count);i<s;i++)ja.fromBufferAttribute(c,i),Ya(ja,i,a,n,t,e,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,e=Object.keys(t);if(e.length>0){const i=t[e[0]];if(void 0!==i){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,e=i.length;t<e;t++){const e=i[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[e]=t}}}}}function Ya(t,e,i,n,s,r,o){const a=qa.distanceSqToPoint(t);if(a<i){const i=new Ne;qa.closestPointToPoint(t,i),i.applyMatrix4(n);const h=s.ray.origin.distanceTo(i);if(h<s.near||h>s.far)return;r.push({distance:h,distanceToRay:Math.sqrt(a),point:i,index:e,face:null,object:o})}}class Ka extends Qe{constructor(t,e,i,n,s,r,o,a,h,c,l,A){super(null,r,o,a,h,c,n,s,l,A),this.isCompressedTexture=!0,this.image={width:e,height:i},this.mipmaps=t,this.flipY=!1,this.generateMipmaps=!1}}class Xa extends Ka{constructor(t,e,i,n,s,r){super(t,e,i,s,r),this.isCompressedArrayTexture=!0,this.image.depth=n,this.wrapR=H}}class Za extends Ka{constructor(t,e,i){super(void 0,t[0].width,t[0].height,e,i,N),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=t}}class $a{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const i=this.getUtoTmapping(t);return this.getPoint(i,e)}getPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return e}getSpacedPoints(t=5){const e=[];for(let i=0;i<=t;i++)e.push(this.getPointAt(i/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let i,n=this.getPoint(0),s=0;e.push(0);for(let r=1;r<=t;r++)i=this.getPoint(r/t),s+=i.distanceTo(n),e.push(s),n=i;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const i=this.getLengths();let n=0;const s=i.length;let r;r=e||t*i[s-1];let o,a=0,h=s-1;for(;a<=h;)if(n=Math.floor(a+(h-a)/2),o=i[n]-r,o<0)a=n+1;else{if(!(o>0)){h=n;break}h=n-1}if(n=h,i[n]===r)return n/(s-1);const c=i[n];return(n+(r-c)/(i[n+1]-c))/(s-1)}getTangent(t,e){const i=1e-4;let n=t-i,s=t+i;n<0&&(n=0),s>1&&(s=1);const r=this.getPoint(n),o=this.getPoint(s),a=e||(r.isVector2?new ce:new Ne);return a.copy(o).sub(r).normalize(),a}getTangentAt(t,e){const i=this.getUtoTmapping(t);return this.getTangent(i,e)}computeFrenetFrames(t,e){const i=new Ne,n=[],s=[],r=[],o=new Ne,a=new di;for(let e=0;e<=t;e++){const i=e/t;n[e]=this.getTangentAt(i,new Ne)}s[0]=new Ne,r[0]=new Ne;let h=Number.MAX_VALUE;const c=Math.abs(n[0].x),l=Math.abs(n[0].y),A=Math.abs(n[0].z);c<=h&&(h=c,i.set(1,0,0)),l<=h&&(h=l,i.set(0,1,0)),A<=h&&i.set(0,0,1),o.crossVectors(n[0],i).normalize(),s[0].crossVectors(n[0],o),r[0].crossVectors(n[0],s[0]);for(let e=1;e<=t;e++){if(s[e]=s[e-1].clone(),r[e]=r[e-1].clone(),o.crossVectors(n[e-1],n[e]),o.length()>Number.EPSILON){o.normalize();const t=Math.acos(ne(n[e-1].dot(n[e]),-1,1));s[e].applyMatrix4(a.makeRotationAxis(o,t))}r[e].crossVectors(n[e],s[e])}if(!0===e){let e=Math.acos(ne(s[0].dot(s[t]),-1,1));e/=t,n[0].dot(o.crossVectors(s[0],s[t]))>0&&(e=-e);for(let i=1;i<=t;i++)s[i].applyMatrix4(a.makeRotationAxis(n[i],e*i)),r[i].crossVectors(n[i],s[i])}return{tangents:n,normals:s,binormals:r}}clone(){return(new this.constructor).copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class th extends $a{constructor(t=0,e=0,i=1,n=1,s=0,r=2*Math.PI,o=!1,a=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=i,this.yRadius=n,this.aStartAngle=s,this.aEndAngle=r,this.aClockwise=o,this.aRotation=a}getPoint(t,e=new ce){const i=e,n=2*Math.PI;let s=this.aEndAngle-this.aStartAngle;const r=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(s=r?0:n),!0!==this.aClockwise||r||(s===n?s=-n:s-=n);const o=this.aStartAngle+t*s;let a=this.aX+this.xRadius*Math.cos(o),h=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const t=Math.cos(this.aRotation),e=Math.sin(this.aRotation),i=a-this.aX,n=h-this.aY;a=i*t-n*e+this.aX,h=i*e+n*t+this.aY}return i.set(a,h)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}function eh(){let t=0,e=0,i=0,n=0;function s(s,r,o,a){t=s,e=o,i=-3*s+3*r-2*o-a,n=2*s-2*r+o+a}return{initCatmullRom:function(t,e,i,n,r){s(e,i,r*(i-t),r*(n-e))},initNonuniformCatmullRom:function(t,e,i,n,r,o,a){let h=(e-t)/r-(i-t)/(r+o)+(i-e)/o,c=(i-e)/o-(n-e)/(o+a)+(n-i)/a;h*=o,c*=o,s(e,i,h,c)},calc:function(s){const r=s*s;return t+e*s+i*r+n*(r*s)}}}const ih=new Ne,nh=new eh,sh=new eh,rh=new eh;function oh(t,e,i,n,s){const r=.5*(n-e),o=.5*(s-i),a=t*t;return(2*i-2*n+r+o)*(t*a)+(-3*i+3*n-2*r-o)*a+r*t+i}function ah(t,e,i,n){return function(t,e){const i=1-t;return i*i*e}(t,e)+function(t,e){return 2*(1-t)*t*e}(t,i)+function(t,e){return t*t*e}(t,n)}function hh(t,e,i,n,s){return function(t,e){const i=1-t;return i*i*i*e}(t,e)+function(t,e){const i=1-t;return 3*i*i*t*e}(t,i)+function(t,e){return 3*(1-t)*t*t*e}(t,n)+function(t,e){return t*t*t*e}(t,s)}class ch extends $a{constructor(t=new ce,e=new ce,i=new ce,n=new ce){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new ce){const i=e,n=this.v0,s=this.v1,r=this.v2,o=this.v3;return i.set(hh(t,n.x,s.x,r.x,o.x),hh(t,n.y,s.y,r.y,o.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class lh extends $a{constructor(t=new ce,e=new ce){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new ce){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new ce){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Ah extends $a{constructor(t=new ce,e=new ce,i=new ce){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new ce){const i=e,n=this.v0,s=this.v1,r=this.v2;return i.set(ah(t,n.x,s.x,r.x),ah(t,n.y,s.y,r.y)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class uh extends $a{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new ce){const i=e,n=this.points,s=(n.length-1)*t,r=Math.floor(s),o=s-r,a=n[0===r?r:r-1],h=n[r],c=n[r>n.length-2?n.length-1:r+1],l=n[r>n.length-3?n.length-1:r+2];return i.set(oh(o,a.x,h.x,c.x,l.x),oh(o,a.y,h.y,c.y,l.y)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new ce).fromArray(i))}return this}}var dh=Object.freeze({__proto__:null,ArcCurve:class extends th{constructor(t,e,i,n,s,r){super(t,e,i,i,n,s,r),this.isArcCurve=!0,this.type="ArcCurve"}},CatmullRomCurve3:class extends $a{constructor(t=[],e=!1,i="centripetal",n=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=i,this.tension=n}getPoint(t,e=new Ne){const i=e,n=this.points,s=n.length,r=(s-(this.closed?0:1))*t;let o,a,h=Math.floor(r),c=r-h;this.closed?h+=h>0?0:(Math.floor(Math.abs(h)/s)+1)*s:0===c&&h===s-1&&(h=s-2,c=1),this.closed||h>0?o=n[(h-1)%s]:(ih.subVectors(n[0],n[1]).add(n[0]),o=ih);const l=n[h%s],A=n[(h+1)%s];if(this.closed||h+2<s?a=n[(h+2)%s]:(ih.subVectors(n[s-1],n[s-2]).add(n[s-1]),a=ih),"centripetal"===this.curveType||"chordal"===this.curveType){const t="chordal"===this.curveType?.5:.25;let e=Math.pow(o.distanceToSquared(l),t),i=Math.pow(l.distanceToSquared(A),t),n=Math.pow(A.distanceToSquared(a),t);i<1e-4&&(i=1),e<1e-4&&(e=i),n<1e-4&&(n=i),nh.initNonuniformCatmullRom(o.x,l.x,A.x,a.x,e,i,n),sh.initNonuniformCatmullRom(o.y,l.y,A.y,a.y,e,i,n),rh.initNonuniformCatmullRom(o.z,l.z,A.z,a.z,e,i,n)}else"catmullrom"===this.curveType&&(nh.initCatmullRom(o.x,l.x,A.x,a.x,this.tension),sh.initCatmullRom(o.y,l.y,A.y,a.y,this.tension),rh.initCatmullRom(o.z,l.z,A.z,a.z,this.tension));return i.set(nh.calc(c),sh.calc(c),rh.calc(c)),i}copy(t){super.copy(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,i=this.points.length;e<i;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,i=t.points.length;e<i;e++){const i=t.points[e];this.points.push((new Ne).fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}},CubicBezierCurve:ch,CubicBezierCurve3:class extends $a{constructor(t=new Ne,e=new Ne,i=new Ne,n=new Ne){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=i,this.v3=n}getPoint(t,e=new Ne){const i=e,n=this.v0,s=this.v1,r=this.v2,o=this.v3;return i.set(hh(t,n.x,s.x,r.x,o.x),hh(t,n.y,s.y,r.y,o.y),hh(t,n.z,s.z,r.z,o.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}},EllipseCurve:th,LineCurve:lh,LineCurve3:class extends $a{constructor(t=new Ne,e=new Ne){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new Ne){const i=e;return 1===t?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(t).add(this.v1)),i}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new Ne){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},QuadraticBezierCurve:Ah,QuadraticBezierCurve3:class extends $a{constructor(t=new Ne,e=new Ne,i=new Ne){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=i}getPoint(t,e=new Ne){const i=e,n=this.v0,s=this.v1,r=this.v2;return i.set(ah(t,n.x,s.x,r.x),ah(t,n.y,s.y,r.y),ah(t,n.z,s.z,r.z)),i}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}},SplineCurve:uh});class fh extends $a{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const i=!0===t.isVector2?"LineCurve":"LineCurve3";this.curves.push(new dh[i](e,t))}return this}getPoint(t,e){const i=t*this.getLength(),n=this.getCurveLengths();let s=0;for(;s<n.length;){if(n[s]>=i){const t=n[s]-i,r=this.curves[s],o=r.getLength(),a=0===o?0:1-t/o;return r.getPointAt(a,e)}s++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let i=0,n=this.curves.length;i<n;i++)e+=this.curves[i].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let i=0;i<=t;i++)e.push(this.getPoint(i/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let i;for(let n=0,s=this.curves;n<s.length;n++){const r=s[n],o=r.isEllipseCurve?2*t:r.isLineCurve||r.isLineCurve3?1:r.isSplineCurve?t*r.points.length:t,a=r.getPoints(o);for(let t=0;t<a.length;t++){const n=a[t];i&&i.equals(n)||(e.push(n),i=n)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,i=this.curves.length;e<i;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,i=t.curves.length;e<i;e++){const i=t.curves[e];this.curves.push((new dh[i.type]).fromJSON(i))}return this}}class gh extends fh{constructor(t){super(),this.type="Path",this.currentPoint=new ce,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,i=t.length;e<i;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const i=new lh(this.currentPoint.clone(),new ce(t,e));return this.curves.push(i),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,i,n){const s=new Ah(this.currentPoint.clone(),new ce(t,e),new ce(i,n));return this.curves.push(s),this.currentPoint.set(i,n),this}bezierCurveTo(t,e,i,n,s,r){const o=new ch(this.currentPoint.clone(),new ce(t,e),new ce(i,n),new ce(s,r));return this.curves.push(o),this.currentPoint.set(s,r),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),i=new uh(e);return this.curves.push(i),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,i,n,s,r){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(t+o,e+a,i,n,s,r),this}absarc(t,e,i,n,s,r){return this.absellipse(t,e,i,i,n,s,r),this}ellipse(t,e,i,n,s,r,o,a){const h=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(t+h,e+c,i,n,s,r,o,a),this}absellipse(t,e,i,n,s,r,o,a){const h=new th(t,e,i,n,s,r,o,a);if(this.curves.length>0){const t=h.getPoint(0);t.equals(this.currentPoint)||this.lineTo(t.x,t.y)}this.curves.push(h);const c=h.getPoint(1);return this.currentPoint.copy(c),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class ph extends gh{constructor(t){super(t),this.uuid=ie(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let i=0,n=this.holes.length;i<n;i++)e[i]=this.holes[i].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,i=this.holes.length;e<i;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,i=t.holes.length;e<i;e++){const i=t.holes[e];this.holes.push((new gh).fromJSON(i))}return this}}const mh=function(t,e,i=2){const n=e&&e.length,s=n?e[0]*i:t.length;let r=vh(t,0,s,i,!0);const o=[];if(!r||r.next===r.prev)return o;let a,h,c,l,A,u,d;if(n&&(r=function(t,e,i,n){const s=[];let r,o,a,h,c;for(r=0,o=e.length;r<o;r++)a=e[r]*n,h=r<o-1?e[r+1]*n:t.length,c=vh(t,a,h,n,!1),c===c.next&&(c.steiner=!0),s.push(yh(c));for(s.sort(Bh),r=0;r<s.length;r++)i=Sh(s[r],i);return i}(t,e,r,i)),t.length>80*i){a=c=t[0],h=l=t[1];for(let e=i;e<s;e+=i)A=t[e],u=t[e+1],A<a&&(a=A),u<h&&(h=u),A>c&&(c=A),u>l&&(l=u);d=Math.max(c-a,l-h),d=0!==d?32767/d:0}return Eh(r,o,i,a,h,d,0),o};function vh(t,e,i,n,s){let r,o;if(s===function(t,e,i,n){let s=0;for(let r=e,o=i-n;r<i;r+=n)s+=(t[o]-t[r])*(t[r+1]+t[o+1]),o=r;return s}(t,e,i,n)>0)for(r=e;r<i;r+=n)o=Fh(r,t[r],t[r+1],o);else for(r=i-n;r>=e;r-=n)o=Fh(r,t[r],t[r+1],o);return o&&Lh(o,o.next)&&(Oh(o),o=o.next),o}function bh(t,e){if(!t)return t;e||(e=t);let i,n=t;do{if(i=!1,n.steiner||!Lh(n,n.next)&&0!==Dh(n.prev,n,n.next))n=n.next;else{if(Oh(n),n=e=n.prev,n===n.next)break;i=!0}}while(i||n!==e);return e}function Eh(t,e,i,n,s,r,o){if(!t)return;!o&&r&&function(t,e,i,n){let s=t;do{0===s.z&&(s.z=xh(s.x,s.y,e,i,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==t);s.prevZ.nextZ=null,s.prevZ=null,function(t){let e,i,n,s,r,o,a,h,c=1;do{for(i=t,t=null,r=null,o=0;i;){for(o++,n=i,a=0,e=0;e<c&&(a++,n=n.nextZ,n);e++);for(h=c;a>0||h>0&&n;)0!==a&&(0===h||!n||i.z<=n.z)?(s=i,i=i.nextZ,a--):(s=n,n=n.nextZ,h--),r?r.nextZ=s:t=s,s.prevZ=r,r=s;i=n}r.nextZ=null,c*=2}while(o>1)}(s)}(t,n,s,r);let a,h,c=t;for(;t.prev!==t.next;)if(a=t.prev,h=t.next,r?Ih(t,n,s,r):Ch(t))e.push(a.i/i|0),e.push(t.i/i|0),e.push(h.i/i|0),Oh(t),t=h.next,c=h.next;else if((t=h)===c){o?1===o?Eh(t=wh(bh(t),e,i),e,i,n,s,r,2):2===o&&_h(t,e,i,n,s,r):Eh(bh(t),e,i,n,s,r,1);break}}function Ch(t){const e=t.prev,i=t,n=t.next;if(Dh(e,i,n)>=0)return!1;const s=e.x,r=i.x,o=n.x,a=e.y,h=i.y,c=n.y,l=s<r?s<o?s:o:r<o?r:o,A=a<h?a<c?a:c:h<c?h:c,u=s>r?s>o?s:o:r>o?r:o,d=a>h?a>c?a:c:h>c?h:c;let f=n.next;for(;f!==e;){if(f.x>=l&&f.x<=u&&f.y>=A&&f.y<=d&&Qh(s,a,r,h,o,c,f.x,f.y)&&Dh(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Ih(t,e,i,n){const s=t.prev,r=t,o=t.next;if(Dh(s,r,o)>=0)return!1;const a=s.x,h=r.x,c=o.x,l=s.y,A=r.y,u=o.y,d=a<h?a<c?a:c:h<c?h:c,f=l<A?l<u?l:u:A<u?A:u,g=a>h?a>c?a:c:h>c?h:c,p=l>A?l>u?l:u:A>u?A:u,m=xh(d,f,e,i,n),v=xh(g,p,e,i,n);let b=t.prevZ,E=t.nextZ;for(;b&&b.z>=m&&E&&E.z<=v;){if(b.x>=d&&b.x<=g&&b.y>=f&&b.y<=p&&b!==s&&b!==o&&Qh(a,l,h,A,c,u,b.x,b.y)&&Dh(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,E.x>=d&&E.x<=g&&E.y>=f&&E.y<=p&&E!==s&&E!==o&&Qh(a,l,h,A,c,u,E.x,E.y)&&Dh(E.prev,E,E.next)>=0)return!1;E=E.nextZ}for(;b&&b.z>=m;){if(b.x>=d&&b.x<=g&&b.y>=f&&b.y<=p&&b!==s&&b!==o&&Qh(a,l,h,A,c,u,b.x,b.y)&&Dh(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;E&&E.z<=v;){if(E.x>=d&&E.x<=g&&E.y>=f&&E.y<=p&&E!==s&&E!==o&&Qh(a,l,h,A,c,u,E.x,E.y)&&Dh(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function wh(t,e,i){let n=t;do{const s=n.prev,r=n.next.next;!Lh(s,r)&&Rh(s,n,n.next,r)&&Nh(s,r)&&Nh(r,s)&&(e.push(s.i/i|0),e.push(n.i/i|0),e.push(r.i/i|0),Oh(n),Oh(n.next),n=t=r),n=n.next}while(n!==t);return bh(n)}function _h(t,e,i,n,s,r){let o=t;do{let t=o.next.next;for(;t!==o.prev;){if(o.i!==t.i&&Th(o,t)){let a=kh(o,t);return o=bh(o,o.next),a=bh(a,a.next),Eh(o,e,i,n,s,r,0),void Eh(a,e,i,n,s,r,0)}t=t.next}o=o.next}while(o!==t)}function Bh(t,e){return t.x-e.x}function Sh(t,e){const i=function(t,e){let i,n=e,s=-1/0;const r=t.x,o=t.y;do{if(o<=n.y&&o>=n.next.y&&n.next.y!==n.y){const t=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(t<=r&&t>s&&(s=t,i=n.x<n.next.x?n:n.next,t===r))return i}n=n.next}while(n!==e);if(!i)return null;const a=i,h=i.x,c=i.y;let l,A=1/0;n=i;do{r>=n.x&&n.x>=h&&r!==n.x&&Qh(o<c?r:s,o,h,c,o<c?s:r,o,n.x,n.y)&&(l=Math.abs(o-n.y)/(r-n.x),Nh(n,t)&&(l<A||l===A&&(n.x>i.x||n.x===i.x&&Mh(i,n)))&&(i=n,A=l)),n=n.next}while(n!==a);return i}(t,e);if(!i)return e;const n=kh(i,t);return bh(n,n.next),bh(i,i.next)}function Mh(t,e){return Dh(t.prev,t,e.prev)<0&&Dh(e.next,t,t.next)<0}function xh(t,e,i,n,s){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*s|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*s|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function yh(t){let e=t,i=t;do{(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next}while(e!==t);return i}function Qh(t,e,i,n,s,r,o,a){return(s-o)*(e-a)>=(t-o)*(r-a)&&(t-o)*(n-a)>=(i-o)*(e-a)&&(i-o)*(r-a)>=(s-o)*(n-a)}function Th(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){let i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&Rh(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(t,e)&&(Nh(t,e)&&Nh(e,t)&&function(t,e){let i=t,n=!1;const s=(t.x+e.x)/2,r=(t.y+e.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&s<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==t);return n}(t,e)&&(Dh(t.prev,t,e.prev)||Dh(t,e.prev,e))||Lh(t,e)&&Dh(t.prev,t,t.next)>0&&Dh(e.prev,e,e.next)>0)}function Dh(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function Lh(t,e){return t.x===e.x&&t.y===e.y}function Rh(t,e,i,n){const s=Uh(Dh(t,e,i)),r=Uh(Dh(t,e,n)),o=Uh(Dh(i,n,t)),a=Uh(Dh(i,n,e));return s!==r&&o!==a||(!(0!==s||!Ph(t,i,e))||(!(0!==r||!Ph(t,n,e))||(!(0!==o||!Ph(i,t,n))||!(0!==a||!Ph(i,e,n)))))}function Ph(t,e,i){return e.x<=Math.max(t.x,i.x)&&e.x>=Math.min(t.x,i.x)&&e.y<=Math.max(t.y,i.y)&&e.y>=Math.min(t.y,i.y)}function Uh(t){return t>0?1:t<0?-1:0}function Nh(t,e){return Dh(t.prev,t,t.next)<0?Dh(t,e,t.next)>=0&&Dh(t,t.prev,e)>=0:Dh(t,e,t.prev)<0||Dh(t,t.next,e)<0}function kh(t,e){const i=new Gh(t.i,t.x,t.y),n=new Gh(e.i,e.x,e.y),s=t.next,r=e.prev;return t.next=e,e.prev=t,i.next=s,s.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function Fh(t,e,i,n){const s=new Gh(t,e,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function Oh(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Gh(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}class Hh{static area(t){const e=t.length;let i=0;for(let n=e-1,s=0;s<e;n=s++)i+=t[n].x*t[s].y-t[s].x*t[n].y;return.5*i}static isClockWise(t){return Hh.area(t)<0}static triangulateShape(t,e){const i=[],n=[],s=[];Vh(t),zh(i,t);let r=t.length;e.forEach(Vh);for(let t=0;t<e.length;t++)n.push(r),r+=e[t].length,zh(i,e[t]);const o=mh(i,n);for(let t=0;t<o.length;t+=3)s.push(o.slice(t,t+3));return s}}function Vh(t){const e=t.length;e>2&&t[e-1].equals(t[0])&&t.pop()}function zh(t,e){for(let i=0;i<e.length;i++)t.push(e[i].x),t.push(e[i].y)}class qh extends _n{constructor(t=.5,e=1,i=32,n=1,s=0,r=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:i,phiSegments:n,thetaStart:s,thetaLength:r},i=Math.max(3,i);const o=[],a=[],h=[],c=[];let l=t;const A=(e-t)/(n=Math.max(1,n)),u=new Ne,d=new ce;for(let t=0;t<=n;t++){for(let t=0;t<=i;t++){const n=s+t/i*r;u.x=l*Math.cos(n),u.y=l*Math.sin(n),a.push(u.x,u.y,u.z),h.push(0,0,1),d.x=(u.x/e+1)/2,d.y=(u.y/e+1)/2,c.push(d.x,d.y)}l+=A}for(let t=0;t<n;t++){const e=t*(i+1);for(let t=0;t<i;t++){const n=t+e,s=n,r=n+i+1,a=n+i+2,h=n+1;o.push(s,r,h),o.push(r,a,h)}}this.setIndex(o),this.setAttribute("position",new pn(a,3)),this.setAttribute("normal",new pn(h,3)),this.setAttribute("uv",new pn(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new qh(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class Wh extends _n{constructor(t=new ph([new ce(0,.5),new ce(-.5,-.5),new ce(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const i=[],n=[],s=[],r=[];let o=0,a=0;if(!1===Array.isArray(t))h(t);else for(let e=0;e<t.length;e++)h(t[e]),this.addGroup(o,a,e),o+=a,a=0;function h(t){const o=n.length/3,h=t.extractPoints(e);let c=h.shape;const l=h.holes;!1===Hh.isClockWise(c)&&(c=c.reverse());for(let t=0,e=l.length;t<e;t++){const e=l[t];!0===Hh.isClockWise(e)&&(l[t]=e.reverse())}const A=Hh.triangulateShape(c,l);for(let t=0,e=l.length;t<e;t++){const e=l[t];c=c.concat(e)}for(let t=0,e=c.length;t<e;t++){const e=c[t];n.push(e.x,e.y,0),s.push(0,0,1),r.push(e.x,e.y)}for(let t=0,e=A.length;t<e;t++){const e=A[t],n=e[0]+o,s=e[1]+o,r=e[2]+o;i.push(n,s,r),a+=3}}this.setIndex(i),this.setAttribute("position",new pn(n,3)),this.setAttribute("normal",new pn(s,3)),this.setAttribute("uv",new pn(r,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return function(t,e){if(e.shapes=[],Array.isArray(t))for(let i=0,n=t.length;i<n;i++){const n=t[i];e.shapes.push(n.uuid)}else e.shapes.push(t.uuid);return e}(this.parameters.shapes,t)}static fromJSON(t,e){const i=[];for(let n=0,s=t.shapes.length;n<s;n++){const s=e[t.shapes[n]];i.push(s)}return new Wh(i,t.curveSegments)}}class jh extends on{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new nn(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class Jh extends Yn{constructor(t){super(t),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class Yh extends on{constructor(t){super(),this.isMeshStandardMaterial=!0,this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new nn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new nn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=0,this.normalScale=new ce(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new wi,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Kh extends Yh{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ce(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ne(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new nn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new nn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new nn(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}function Xh(t,e,i){return t&&t.constructor!==e?"number"==typeof e.BYTES_PER_ELEMENT?new e(t):Array.prototype.slice.call(t):t}function Zh(t){const e=t.length,i=new Array(e);for(let t=0;t!==e;++t)i[t]=t;return i.sort((function(e,i){return t[e]-t[i]})),i}function $h(t,e,i){const n=t.length,s=new t.constructor(n);for(let r=0,o=0;o!==n;++r){const n=i[r]*e;for(let i=0;i!==e;++i)s[o++]=t[n+i]}return s}function tc(t,e,i,n){let s=1,r=t[0];for(;void 0!==r&&void 0===r[n];)r=t[s++];if(void 0===r)return;let o=r[n];if(void 0!==o)if(Array.isArray(o))do{o=r[n],void 0!==o&&(e.push(r.time),i.push.apply(i,o)),r=t[s++]}while(void 0!==r);else if(void 0!==o.toArray)do{o=r[n],void 0!==o&&(e.push(r.time),o.toArray(i,i.length)),r=t[s++]}while(void 0!==r);else do{o=r[n],void 0!==o&&(e.push(r.time),i.push(o)),r=t[s++]}while(void 0!==r)}class ec{constructor(t,e,i,n){this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new e.constructor(i),this.sampleValues=e,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(t){const e=this.parameterPositions;let i=this._cachedIndex,n=e[i],s=e[i-1];t:{e:{let r;i:{n:if(!(t<n)){for(let r=i+2;;){if(void 0===n){if(t<s)break n;return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===r)break;if(s=n,n=e[++i],t<n)break e}r=e.length;break i}if(t>=s)break t;{const o=e[1];t<o&&(i=2,s=o);for(let r=i-2;;){if(void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(i===r)break;if(n=s,s=e[--i-1],t>=s)break e}r=i,i=0}}for(;i<r;){const n=i+r>>>1;t<e[n]?r=n:i=n+1}if(n=e[i],s=e[i-1],void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===n)return i=e.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,n)}return this.interpolate_(i,s,t,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=t*n;for(let t=0;t!==n;++t)e[t]=i[s+t];return e}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class ic extends ec{constructor(t,e,i,n){super(t,e,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Bt,endingEnd:Bt}}intervalChanged_(t,e,i){const n=this.parameterPositions;let s=t-2,r=t+1,o=n[s],a=n[r];if(void 0===o)switch(this.getSettings_().endingStart){case St:s=t,o=2*e-i;break;case Mt:s=n.length-2,o=e+n[s]-n[s+1];break;default:s=t,o=i}if(void 0===a)switch(this.getSettings_().endingEnd){case St:r=t,a=2*i-e;break;case Mt:r=1,a=i+n[1]-n[0];break;default:r=t-1,a=e}const h=.5*(i-e),c=this.valueSize;this._weightPrev=h/(e-o),this._weightNext=h/(a-i),this._offsetPrev=s*c,this._offsetNext=r*c}interpolate_(t,e,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=t*o,h=a-o,c=this._offsetPrev,l=this._offsetNext,A=this._weightPrev,u=this._weightNext,d=(i-e)/(n-e),f=d*d,g=f*d,p=-A*g+2*A*f-A*d,m=(1+A)*g+(-1.5-2*A)*f+(-.5+A)*d+1,v=(-1-u)*g+(1.5+u)*f+.5*d,b=u*g-u*f;for(let t=0;t!==o;++t)s[t]=p*r[c+t]+m*r[h+t]+v*r[a+t]+b*r[l+t];return s}}class nc extends ec{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=t*o,h=a-o,c=(i-e)/(n-e),l=1-c;for(let t=0;t!==o;++t)s[t]=r[h+t]*l+r[a+t]*c;return s}}class sc extends ec{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t){return this.copySampleValue_(t-1)}}class rc{constructor(t,e,i,n){if(void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===e||0===e.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=Xh(e,this.TimeBufferType),this.values=Xh(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(t){const e=t.constructor;let i;if(e.toJSON!==this.toJSON)i=e.toJSON(t);else{i={name:t.name,times:Xh(t.times,Array),values:Xh(t.values,Array)};const e=t.getInterpolation();e!==t.DefaultInterpolation&&(i.interpolation=e)}return i.type=t.ValueTypeName,i}InterpolantFactoryMethodDiscrete(t){return new sc(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodLinear(t){return new nc(this.times,this.values,this.getValueSize(),t)}InterpolantFactoryMethodSmooth(t){return new ic(this.times,this.values,this.getValueSize(),t)}setInterpolation(t){let e;switch(t){case It:e=this.InterpolantFactoryMethodDiscrete;break;case wt:e=this.InterpolantFactoryMethodLinear;break;case _t:e=this.InterpolantFactoryMethodSmooth}if(void 0===e){const e="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(t===this.DefaultInterpolation)throw new Error(e);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",e),this}return this.createInterpolant=e,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return It;case this.InterpolantFactoryMethodLinear:return wt;case this.InterpolantFactoryMethodSmooth:return _t}}getValueSize(){return this.values.length/this.times.length}shift(t){if(0!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]+=t}return this}scale(t){if(1!==t){const e=this.times;for(let i=0,n=e.length;i!==n;++i)e[i]*=t}return this}trim(t,e){const i=this.times,n=i.length;let s=0,r=n-1;for(;s!==n&&i[s]<t;)++s;for(;-1!==r&&i[r]>e;)--r;if(++r,0!==s||r!==n){s>=r&&(r=Math.max(r,1),s=r-1);const t=this.getValueSize();this.times=i.slice(s,r),this.values=this.values.slice(s*t,r*t)}return this}validate(){let t=!0;const e=this.getValueSize();e-Math.floor(e)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),t=!1);const i=this.times,n=this.values,s=i.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),t=!1);let r=null;for(let e=0;e!==s;e++){const n=i[e];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,e,n),t=!1;break}if(null!==r&&r>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,e,n,r),t=!1;break}r=n}if(void 0!==n&&(o=n,ArrayBuffer.isView(o)&&!(o instanceof DataView)))for(let e=0,i=n.length;e!==i;++e){const i=n[e];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,e,i),t=!1;break}}var o;return t}optimize(){const t=this.times.slice(),e=this.values.slice(),i=this.getValueSize(),n=this.getInterpolation()===_t,s=t.length-1;let r=1;for(let o=1;o<s;++o){let s=!1;const a=t[o];if(a!==t[o+1]&&(1!==o||a!==t[0]))if(n)s=!0;else{const t=o*i,n=t-i,r=t+i;for(let o=0;o!==i;++o){const i=e[t+o];if(i!==e[n+o]||i!==e[r+o]){s=!0;break}}}if(s){if(o!==r){t[r]=t[o];const n=o*i,s=r*i;for(let t=0;t!==i;++t)e[s+t]=e[n+t]}++r}}if(s>0){t[r]=t[s];for(let t=s*i,n=r*i,o=0;o!==i;++o)e[n+o]=e[t+o];++r}return r!==t.length?(this.times=t.slice(0,r),this.values=e.slice(0,r*i)):(this.times=t,this.values=e),this}clone(){const t=this.times.slice(),e=this.values.slice(),i=new(0,this.constructor)(this.name,t,e);return i.createInterpolant=this.createInterpolant,i}}rc.prototype.TimeBufferType=Float32Array,rc.prototype.ValueBufferType=Float32Array,rc.prototype.DefaultInterpolation=wt;class oc extends rc{}oc.prototype.ValueTypeName="bool",oc.prototype.ValueBufferType=Array,oc.prototype.DefaultInterpolation=It,oc.prototype.InterpolantFactoryMethodLinear=void 0,oc.prototype.InterpolantFactoryMethodSmooth=void 0;class ac extends rc{}ac.prototype.ValueTypeName="color";class hc extends rc{}hc.prototype.ValueTypeName="number";class cc extends ec{constructor(t,e,i,n){super(t,e,i,n)}interpolate_(t,e,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=(i-e)/(n-e);let h=t*o;for(let t=h+o;h!==t;h+=4)Ue.slerpFlat(s,0,r,h-o,r,h,a);return s}}class lc extends rc{InterpolantFactoryMethodLinear(t){return new cc(this.times,this.values,this.getValueSize(),t)}}lc.prototype.ValueTypeName="quaternion",lc.prototype.DefaultInterpolation=wt,lc.prototype.InterpolantFactoryMethodSmooth=void 0;class Ac extends rc{}Ac.prototype.ValueTypeName="string",Ac.prototype.ValueBufferType=Array,Ac.prototype.DefaultInterpolation=It,Ac.prototype.InterpolantFactoryMethodLinear=void 0,Ac.prototype.InterpolantFactoryMethodSmooth=void 0;class uc extends rc{}uc.prototype.ValueTypeName="vector";class dc{constructor(t="",e=-1,i=[],n=2500){this.name=t,this.tracks=i,this.duration=e,this.blendMode=n,this.uuid=ie(),this.duration<0&&this.resetDuration()}static parse(t){const e=[],i=t.tracks,n=1/(t.fps||1);for(let t=0,s=i.length;t!==s;++t)e.push(fc(i[t]).scale(n));const s=new this(t.name,t.duration,e,t.blendMode);return s.uuid=t.uuid,s}static toJSON(t){const e=[],i=t.tracks,n={name:t.name,duration:t.duration,tracks:e,uuid:t.uuid,blendMode:t.blendMode};for(let t=0,n=i.length;t!==n;++t)e.push(rc.toJSON(i[t]));return n}static CreateFromMorphTargetSequence(t,e,i,n){const s=e.length,r=[];for(let t=0;t<s;t++){let o=[],a=[];o.push((t+s-1)%s,t,(t+1)%s),a.push(0,1,0);const h=Zh(o);o=$h(o,1,h),a=$h(a,1,h),n||0!==o[0]||(o.push(s),a.push(a[0])),r.push(new hc(".morphTargetInfluences["+e[t].name+"]",o,a).scale(1/i))}return new this(t,-1,r)}static findByName(t,e){let i=t;if(!Array.isArray(t)){const e=t;i=e.geometry&&e.geometry.animations||e.animations}for(let t=0;t<i.length;t++)if(i[t].name===e)return i[t];return null}static CreateClipsFromMorphTargetSequences(t,e,i){const n={},s=/^([\w-]*?)([\d]+)$/;for(let e=0,i=t.length;e<i;e++){const i=t[e],r=i.name.match(s);if(r&&r.length>1){const t=r[1];let e=n[t];e||(n[t]=e=[]),e.push(i)}}const r=[];for(const t in n)r.push(this.CreateFromMorphTargetSequence(t,n[t],e,i));return r}static parseAnimation(t,e){if(!t)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(t,e,i,n,s){if(0!==i.length){const r=[],o=[];tc(i,r,o,n),0!==r.length&&s.push(new t(e,r,o))}},n=[],s=t.name||"default",r=t.fps||30,o=t.blendMode;let a=t.length||-1;const h=t.hierarchy||[];for(let t=0;t<h.length;t++){const s=h[t].keys;if(s&&0!==s.length)if(s[0].morphTargets){const t={};let e;for(e=0;e<s.length;e++)if(s[e].morphTargets)for(let i=0;i<s[e].morphTargets.length;i++)t[s[e].morphTargets[i]]=-1;for(const i in t){const t=[],r=[];for(let n=0;n!==s[e].morphTargets.length;++n){const n=s[e];t.push(n.time),r.push(n.morphTarget===i?1:0)}n.push(new hc(".morphTargetInfluence["+i+"]",t,r))}a=t.length*r}else{const r=".bones["+e[t].name+"]";i(uc,r+".position",s,"pos",n),i(lc,r+".quaternion",s,"rot",n),i(uc,r+".scale",s,"scl",n)}}if(0===n.length)return null;return new this(s,a,n,o)}resetDuration(){let t=0;for(let e=0,i=this.tracks.length;e!==i;++e){const i=this.tracks[e];t=Math.max(t,i.times[i.times.length-1])}return this.duration=t,this}trim(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].trim(0,this.duration);return this}validate(){let t=!0;for(let e=0;e<this.tracks.length;e++)t=t&&this.tracks[e].validate();return t}optimize(){for(let t=0;t<this.tracks.length;t++)this.tracks[t].optimize();return this}clone(){const t=[];for(let e=0;e<this.tracks.length;e++)t.push(this.tracks[e].clone());return new this.constructor(this.name,this.duration,t,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function fc(t){if(void 0===t.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=function(t){switch(t.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return hc;case"vector":case"vector2":case"vector3":case"vector4":return uc;case"color":return ac;case"quaternion":return lc;case"bool":case"boolean":return oc;case"string":return Ac}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+t)}(t.type);if(void 0===t.times){const e=[],i=[];tc(t.keys,e,i,"value"),t.times=e,t.values=i}return void 0!==e.parse?e.parse(t):new e(t.name,t.times,t.values,t.interpolation)}const gc={enabled:!1,files:{},add:function(t,e){!1!==this.enabled&&(this.files[t]=e)},get:function(t){if(!1!==this.enabled)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class pc{constructor(t,e,i){const n=this;let s,r=!1,o=0,a=0;const h=[];this.onStart=void 0,this.onLoad=t,this.onProgress=e,this.onError=i,this.itemStart=function(t){a++,!1===r&&void 0!==n.onStart&&n.onStart(t,o,a),r=!0},this.itemEnd=function(t){o++,void 0!==n.onProgress&&n.onProgress(t,o,a),o===a&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(t){void 0!==n.onError&&n.onError(t)},this.resolveURL=function(t){return s?s(t):t},this.setURLModifier=function(t){return s=t,this},this.addHandler=function(t,e){return h.push(t,e),this},this.removeHandler=function(t){const e=h.indexOf(t);return-1!==e&&h.splice(e,2),this},this.getHandler=function(t){for(let e=0,i=h.length;e<i;e+=2){const i=h[e],n=h[e+1];if(i.global&&(i.lastIndex=0),i.test(t))return n}return null}}}const mc=new pc;class vc{constructor(t){this.manager=void 0!==t?t:mc,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(t,e){const i=this;return new Promise((function(n,s){i.load(t,n,e,s)}))}parse(){}setCrossOrigin(t){return this.crossOrigin=t,this}setWithCredentials(t){return this.withCredentials=t,this}setPath(t){return this.path=t,this}setResourcePath(t){return this.resourcePath=t,this}setRequestHeader(t){return this.requestHeader=t,this}}vc.DEFAULT_MATERIAL_NAME="__DEFAULT";const bc={};class Ec extends Error{constructor(t,e){super(t),this.response=e}}class Cc extends vc{constructor(t){super(t)}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const s=gc.get(t);if(void 0!==s)return this.manager.itemStart(t),setTimeout((()=>{e&&e(s),this.manager.itemEnd(t)}),0),s;if(void 0!==bc[t])return void bc[t].push({onLoad:e,onProgress:i,onError:n});bc[t]=[],bc[t].push({onLoad:e,onProgress:i,onError:n});const r=new Request(t,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),o=this.mimeType,a=this.responseType;fetch(r).then((e=>{if(200===e.status||0===e.status){if(0===e.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"==typeof ReadableStream||void 0===e.body||void 0===e.body.getReader)return e;const i=bc[t],n=e.body.getReader(),s=e.headers.get("X-File-Size")||e.headers.get("Content-Length"),r=s?parseInt(s):0,o=0!==r;let a=0;const h=new ReadableStream({start(t){!function e(){n.read().then((({done:n,value:s})=>{if(n)t.close();else{a+=s.byteLength;const n=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:r});for(let t=0,e=i.length;t<e;t++){const e=i[t];e.onProgress&&e.onProgress(n)}t.enqueue(s),e()}}))}()}});return new Response(h)}throw new Ec(`fetch for "${e.url}" responded with ${e.status}: ${e.statusText}`,e)})).then((t=>{switch(a){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((t=>(new DOMParser).parseFromString(t,o)));case"json":return t.json();default:if(void 0===o)return t.text();{const e=/charset="?([^;"\s]*)"?/i.exec(o),i=e&&e[1]?e[1].toLowerCase():void 0,n=new TextDecoder(i);return t.arrayBuffer().then((t=>n.decode(t)))}}})).then((e=>{gc.add(t,e);const i=bc[t];delete bc[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onLoad&&n.onLoad(e)}})).catch((e=>{const i=bc[t];if(void 0===i)throw this.manager.itemError(t),e;delete bc[t];for(let t=0,n=i.length;t<n;t++){const n=i[t];n.onError&&n.onError(e)}this.manager.itemError(t)})).finally((()=>{this.manager.itemEnd(t)})),this.manager.itemStart(t)}setResponseType(t){return this.responseType=t,this}setMimeType(t){return this.mimeType=t,this}}class Ic extends vc{constructor(t){super(t)}load(t,e,i,n){void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,r=gc.get(t);if(void 0!==r)return s.manager.itemStart(t),setTimeout((function(){e&&e(r),s.manager.itemEnd(t)}),0),r;const o=de("img");function a(){c(),gc.add(t,this),e&&e(this),s.manager.itemEnd(t)}function h(e){c(),n&&n(e),s.manager.itemError(t),s.manager.itemEnd(t)}function c(){o.removeEventListener("load",a,!1),o.removeEventListener("error",h,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",h,!1),"data:"!==t.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(t),o.src=t,o}}class wc extends vc{constructor(t){super(t)}load(t,e,i,n){const s=this,r=new pa,o=new Cc(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(t,(function(t){let i;try{i=s.parse(t)}catch(t){if(void 0===n)return void console.error(t);n(t)}void 0!==i.image?r.image=i.image:void 0!==i.data&&(r.image.width=i.width,r.image.height=i.height,r.image.data=i.data),r.wrapS=void 0!==i.wrapS?i.wrapS:H,r.wrapT=void 0!==i.wrapT?i.wrapT:H,r.magFilter=void 0!==i.magFilter?i.magFilter:j,r.minFilter=void 0!==i.minFilter?i.minFilter:j,r.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.colorSpace&&(r.colorSpace=i.colorSpace),void 0!==i.flipY&&(r.flipY=i.flipY),void 0!==i.format&&(r.format=i.format),void 0!==i.type&&(r.type=i.type),void 0!==i.mipmaps&&(r.mipmaps=i.mipmaps,r.minFilter=Y),1===i.mipmapCount&&(r.minFilter=j),void 0!==i.generateMipmaps&&(r.generateMipmaps=i.generateMipmaps),r.needsUpdate=!0,e&&e(r,i)}),i,n),r}}class _c extends vc{constructor(t){super(t)}load(t,e,i,n){const s=new Qe,r=new Ic(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(t,(function(t){s.image=t,s.needsUpdate=!0,void 0!==e&&e(s)}),i,n),s}}let Bc=class extends Oi{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new nn(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,void 0!==this.groundColor&&(e.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(e.object.distance=this.distance),void 0!==this.angle&&(e.object.angle=this.angle),void 0!==this.decay&&(e.object.decay=this.decay),void 0!==this.penumbra&&(e.object.penumbra=this.penumbra),void 0!==this.shadow&&(e.object.shadow=this.shadow.toJSON()),e}};const Sc=new di,Mc=new Ne,xc=new Ne;class yc{constructor(t){this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new ce(512,512),this.map=null,this.mapPass=null,this.matrix=new di,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new As,this._frameExtents=new ce(1,1),this._viewportCount=1,this._viewports=[new Te(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,i=this.matrix;Mc.setFromMatrixPosition(t.matrixWorld),e.position.copy(Mc),xc.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(xc),e.updateMatrixWorld(),Sc.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Sc),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(Sc)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const t={};return 0!==this.bias&&(t.bias=this.bias),0!==this.normalBias&&(t.normalBias=this.normalBias),1!==this.radius&&(t.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class Qc extends yc{constructor(){super(new ts(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,i=2*ee*t.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=t.distance||e.far;i===e.fov&&n===e.aspect&&s===e.far||(e.fov=i,e.aspect=n,e.far=s,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}let Tc=class extends Bc{constructor(t,e,i=0,n=Math.PI/3,s=0,r=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Oi.DEFAULT_UP),this.updateMatrix(),this.target=new Oi,this.distance=i,this.angle=n,this.penumbra=s,this.decay=r,this.map=null,this.shadow=new Qc}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}};const Dc=new di,Lc=new Ne,Rc=new Ne;class Pc extends yc{constructor(){super(new ts(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new ce(4,2),this._viewportCount=6,this._viewports=[new Te(2,1,1,1),new Te(0,1,1,1),new Te(3,1,1,1),new Te(1,1,1,1),new Te(3,0,1,1),new Te(1,0,1,1)],this._cubeDirections=[new Ne(1,0,0),new Ne(-1,0,0),new Ne(0,0,1),new Ne(0,0,-1),new Ne(0,1,0),new Ne(0,-1,0)],this._cubeUps=[new Ne(0,1,0),new Ne(0,1,0),new Ne(0,1,0),new Ne(0,1,0),new Ne(0,0,1),new Ne(0,0,-1)]}updateMatrices(t,e=0){const i=this.camera,n=this.matrix,s=t.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),Lc.setFromMatrixPosition(t.matrixWorld),i.position.copy(Lc),Rc.copy(i.position),Rc.add(this._cubeDirections[e]),i.up.copy(this._cubeUps[e]),i.lookAt(Rc),i.updateMatrixWorld(),n.makeTranslation(-Lc.x,-Lc.y,-Lc.z),Dc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Dc)}}let Uc=class extends Bc{constructor(t,e,i=0,n=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new Pc}get power(){return 4*this.intensity*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}};class Nc extends yc{constructor(){super(new Ms(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}let kc=class extends Bc{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Oi.DEFAULT_UP),this.updateMatrix(),this.target=new Oi,this.shadow=new Nc}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}};class Fc{static decodeText(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);let e="";for(let i=0,n=t.length;i<n;i++)e+=String.fromCharCode(t[i]);try{return decodeURIComponent(escape(e))}catch(t){return e}}static extractUrlBase(t){const e=t.lastIndexOf("/");return-1===e?"./":t.slice(0,e+1)}static resolveURL(t,e){return"string"!=typeof t||""===t?"":(/^https?:\/\//i.test(e)&&/^\//.test(t)&&(e=e.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(t)||/^data:.*,.*$/i.test(t)||/^blob:.*$/i.test(t)?t:e+t)}}class Oc extends vc{constructor(t){super(t),this.isImageBitmapLoader=!0,"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(t){return this.options=t,this}load(t,e,i,n){void 0===t&&(t=""),void 0!==this.path&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,r=gc.get(t);if(void 0!==r)return s.manager.itemStart(t),r.then?void r.then((i=>{e&&e(i),s.manager.itemEnd(t)})).catch((t=>{n&&n(t)})):(setTimeout((function(){e&&e(r),s.manager.itemEnd(t)}),0),r);const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader;const a=fetch(t,o).then((function(t){return t.blob()})).then((function(t){return createImageBitmap(t,Object.assign(s.options,{colorSpaceConversion:"none"}))})).then((function(i){return gc.add(t,i),e&&e(i),s.manager.itemEnd(t),i})).catch((function(e){n&&n(e),gc.remove(t),s.manager.itemError(t),s.manager.itemEnd(t)}));gc.add(t,a),s.manager.itemStart(t)}}class Gc{constructor(t,e,i){let n,s,r;switch(this.binding=t,this.valueSize=i,e){case"quaternion":n=this._slerp,s=this._slerpAdditive,r=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,r=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,s=this._lerpAdditive,r=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=r,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(t,e){const i=this.buffer,n=this.valueSize,s=t*n+n;let r=this.cumulativeWeight;if(0===r){for(let t=0;t!==n;++t)i[s+t]=i[t];r=e}else{r+=e;const t=e/r;this._mixBufferRegion(i,s,0,t,n)}this.cumulativeWeight=r}accumulateAdditive(t){const e=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(e,n,0,t,i),this.cumulativeWeightAdditive+=t}apply(t){const e=this.valueSize,i=this.buffer,n=t*e+e,s=this.cumulativeWeight,r=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const t=e*this._origIndex;this._mixBufferRegion(i,n,t,1-s,e)}r>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*e,1,e);for(let t=e,s=e+e;t!==s;++t)if(i[t]!==i[t+e]){o.setValue(i,n);break}}saveOriginalState(){const t=this.binding,e=this.buffer,i=this.valueSize,n=i*this._origIndex;t.getValue(e,n);for(let t=i,s=n;t!==s;++t)e[t]=e[n+t%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const t=3*this.valueSize;this.binding.setValue(this.buffer,t)}_setAdditiveIdentityNumeric(){const t=this._addIndex*this.valueSize,e=t+this.valueSize;for(let i=t;i<e;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const t=this._origIndex*this.valueSize,e=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[e+i]=this.buffer[t+i]}_select(t,e,i,n,s){if(n>=.5)for(let n=0;n!==s;++n)t[e+n]=t[i+n]}_slerp(t,e,i,n){Ue.slerpFlat(t,e,t,e,t,i,n)}_slerpAdditive(t,e,i,n,s){const r=this._workIndex*s;Ue.multiplyQuaternionsFlat(t,r,t,e,t,i),Ue.slerpFlat(t,e,t,e,t,r,n)}_lerp(t,e,i,n,s){const r=1-n;for(let o=0;o!==s;++o){const s=e+o;t[s]=t[s]*r+t[i+o]*n}}_lerpAdditive(t,e,i,n,s){for(let r=0;r!==s;++r){const s=e+r;t[s]=t[s]+t[i+r]*n}}}const Hc="\\[\\]\\.:\\/",Vc=new RegExp("["+Hc+"]","g"),zc="[^"+Hc+"]",qc="[^"+Hc.replace("\\.","")+"]",Wc=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",zc)+/(WCOD+)?/.source.replace("WCOD",qc)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",zc)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",zc)+"$"),jc=["material","materials","bones","map"];class Jc{constructor(t,e,i){this.path=e,this.parsedPath=i||Jc.parseTrackName(e),this.node=Jc.findNode(t,this.parsedPath.nodeName),this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,e,i){return t&&t.isAnimationObjectGroup?new Jc.Composite(t,e,i):new Jc(t,e,i)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(Vc,"")}static parseTrackName(t){const e=Wc.exec(t);if(null===e)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const i={nodeName:e[2],objectName:e[3],objectIndex:e[4],propertyName:e[5],propertyIndex:e[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const t=i.nodeName.substring(n+1);-1!==jc.indexOf(t)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=t)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return i}static findNode(t,e){if(void 0===e||""===e||"."===e||-1===e||e===t.name||e===t.uuid)return t;if(t.skeleton){const i=t.skeleton.getBoneByName(e);if(void 0!==i)return i}if(t.children){const i=function(t){for(let n=0;n<t.length;n++){const s=t[n];if(s.name===e||s.uuid===e)return s;const r=i(s.children);if(r)return r}return null},n=i(t.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,e){t[e]=this.targetObject[this.propertyName]}_getValue_array(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)t[e++]=i[n]}_getValue_arrayElement(t,e){t[e]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,e){this.resolvedProperty.toArray(t,e)}_setValue_direct(t,e){this.targetObject[this.propertyName]=t[e]}_setValue_direct_setNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,e){this.targetObject[this.propertyName]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=t[e++]}_setValue_array_setNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=t[e++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,e){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=t[e++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,e){this.resolvedProperty[this.propertyIndex]=t[e]}_setValue_arrayElement_setNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty[this.propertyIndex]=t[e],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,e){this.resolvedProperty.fromArray(t,e)}_setValue_fromArray_setNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,e){this.resolvedProperty.fromArray(t,e),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,e){this.bind(),this.getValue(t,e)}_setValue_unbound(t,e){this.bind(),this.setValue(t,e)}bind(){let t=this.node;const e=this.parsedPath,i=e.objectName,n=e.propertyName;let s=e.propertyIndex;if(t||(t=Jc.findNode(this.rootNode,e.nodeName),this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");if(i){let n=e.objectIndex;switch(i){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let e=0;e<t.length;e++)if(t[e].name===n){n=e;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[i]}if(void 0!==n){if(void 0===t[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[n]}}const r=t[n];if(void 0===r){const i=e.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",t)}let o=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===n){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[s]&&(s=t.morphTargetDictionary[s])}a=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=s}else void 0!==r.fromArray&&void 0!==r.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(a=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}Jc.Composite=class{constructor(t,e,i){const n=i||Jc.parseTrackName(e);this._targetGroup=t,this._bindings=t.subscribe_(e,n)}getValue(t,e){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(t,e)}setValue(t,e){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=i.length;n!==s;++n)i[n].setValue(t,e)}bind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].bind()}unbind(){const t=this._bindings;for(let e=this._targetGroup.nCachedObjects_,i=t.length;e!==i;++e)t[e].unbind()}},Jc.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Jc.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},Jc.prototype.GetterByBindingType=[Jc.prototype._getValue_direct,Jc.prototype._getValue_array,Jc.prototype._getValue_arrayElement,Jc.prototype._getValue_toArray],Jc.prototype.SetterByBindingTypeAndVersioning=[[Jc.prototype._setValue_direct,Jc.prototype._setValue_direct_setNeedsUpdate,Jc.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[Jc.prototype._setValue_array,Jc.prototype._setValue_array_setNeedsUpdate,Jc.prototype._setValue_array_setMatrixWorldNeedsUpdate],[Jc.prototype._setValue_arrayElement,Jc.prototype._setValue_arrayElement_setNeedsUpdate,Jc.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[Jc.prototype._setValue_fromArray,Jc.prototype._setValue_fromArray_setNeedsUpdate,Jc.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class Yc{constructor(t,e,i=null,n=e.blendMode){this._mixer=t,this._clip=e,this._localRoot=i,this.blendMode=n;const s=e.tracks,r=s.length,o=new Array(r),a={endingStart:Bt,endingEnd:Bt};for(let t=0;t!==r;++t){const e=s[t].createInterpolant(null);o[t]=e,e.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Ct,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(t){return this._startTime=t,this}setLoop(t,e){return this.loop=t,this.repetitions=e,this}setEffectiveWeight(t){return this.weight=t,this._effectiveWeight=this.enabled?t:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(t){return this._scheduleFading(t,0,1)}fadeOut(t){return this._scheduleFading(t,1,0)}crossFadeFrom(t,e,i){if(t.fadeOut(e),this.fadeIn(e),i){const i=this._clip.duration,n=t._clip.duration,s=n/i,r=i/n;t.warp(1,s,e),this.warp(r,1,e)}return this}crossFadeTo(t,e,i){return t.crossFadeFrom(this,e,i)}stopFading(){const t=this._weightInterpolant;return null!==t&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}setEffectiveTimeScale(t){return this.timeScale=t,this._effectiveTimeScale=this.paused?0:t,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(t){return this.timeScale=this._clip.duration/t,this.stopWarping()}syncWith(t){return this.time=t.time,this.timeScale=t.timeScale,this.stopWarping()}halt(t){return this.warp(this._effectiveTimeScale,0,t)}warp(t,e,i){const n=this._mixer,s=n.time,r=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,h=o.sampleValues;return a[0]=s,a[1]=s+i,h[0]=t/r,h[1]=e/r,this}stopWarping(){const t=this._timeScaleInterpolant;return null!==t&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(t)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(t,e,i,n){if(!this.enabled)return void this._updateWeight(t);const s=this._startTime;if(null!==s){const n=(t-s)*i;n<0||0===i?e=0:(this._startTime=null,e=i*n)}e*=this._updateTimeScale(t);const r=this._updateTime(e),o=this._updateWeight(t);if(o>0){const t=this._interpolants,e=this._propertyBindings;if(2501===this.blendMode)for(let i=0,n=t.length;i!==n;++i)t[i].evaluate(r),e[i].accumulateAdditive(o);else for(let i=0,s=t.length;i!==s;++i)t[i].evaluate(r),e[i].accumulate(n,o)}}_updateWeight(t){let e=0;if(this.enabled){e=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(t)[0];e*=n,t>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=e,e}_updateTimeScale(t){let e=0;if(!this.paused){e=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){e*=i.evaluate(t)[0],t>i.parameterPositions[1]&&(this.stopWarping(),0===e?this.paused=!0:this.timeScale=e)}}return this._effectiveTimeScale=e,e}_updateTime(t){const e=this._clip.duration,i=this.loop;let n=this.time+t,s=this._loopCount;const r=2202===i;if(0===t)return-1===s||!r||1&~s?n:e-n;if(2200===i){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));t:{if(n>=e)n=e;else{if(!(n<0)){this.time=n;break t}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t<0?-1:1})}}else{if(-1===s&&(t>=0?(s=0,this._setEndings(!0,0===this.repetitions,r)):this._setEndings(0===this.repetitions,!0,r)),n>=e||n<0){const i=Math.floor(n/e);n-=e*i,s+=Math.abs(i);const o=this.repetitions-s;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=t>0?e:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:t>0?1:-1});else{if(1===o){const e=t<0;this._setEndings(e,!e,r)}else this._setEndings(!1,!1,r);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(r&&!(1&~s))return e-n}return n}_setEndings(t,e,i){const n=this._interpolantSettings;i?(n.endingStart=St,n.endingEnd=St):(n.endingStart=t?this.zeroSlopeAtStart?St:Bt:Mt,n.endingEnd=e?this.zeroSlopeAtEnd?St:Bt:Mt)}_scheduleFading(t,e,i){const n=this._mixer,s=n.time;let r=this._weightInterpolant;null===r&&(r=n._lendControlInterpolant(),this._weightInterpolant=r);const o=r.parameterPositions,a=r.sampleValues;return o[0]=s,a[0]=e,o[1]=s+t,a[1]=i,this}}const Kc=new Float32Array(1);class Xc extends Xt{constructor(t){super(),this._root=t,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(t,e){const i=t._localRoot||this._root,n=t._clip.tracks,s=n.length,r=t._propertyBindings,o=t._interpolants,a=i.uuid,h=this._bindingsByRootAndName;let c=h[a];void 0===c&&(c={},h[a]=c);for(let t=0;t!==s;++t){const s=n[t],h=s.name;let l=c[h];if(void 0!==l)++l.referenceCount,r[t]=l;else{if(l=r[t],void 0!==l){null===l._cacheIndex&&(++l.referenceCount,this._addInactiveBinding(l,a,h));continue}const n=e&&e._propertyBindings[t].binding.parsedPath;l=new Gc(Jc.create(i,h,n),s.ValueTypeName,s.getValueSize()),++l.referenceCount,this._addInactiveBinding(l,a,h),r[t]=l}o[t].resultBuffer=l.buffer}}_activateAction(t){if(!this._isActiveAction(t)){if(null===t._cacheIndex){const e=(t._localRoot||this._root).uuid,i=t._clip.uuid,n=this._actionsByClip[i];this._bindAction(t,n&&n.knownActions[0]),this._addInactiveAction(t,i,e)}const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(t)}}_deactivateAction(t){if(this._isActiveAction(t)){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(t)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const t=this;this.stats={actions:{get total(){return t._actions.length},get inUse(){return t._nActiveActions}},bindings:{get total(){return t._bindings.length},get inUse(){return t._nActiveBindings}},controlInterpolants:{get total(){return t._controlInterpolants.length},get inUse(){return t._nActiveControlInterpolants}}}}_isActiveAction(t){const e=t._cacheIndex;return null!==e&&e<this._nActiveActions}_addInactiveAction(t,e,i){const n=this._actions,s=this._actionsByClip;let r=s[e];if(void 0===r)r={knownActions:[t],actionByRoot:{}},t._byClipCacheIndex=0,s[e]=r;else{const e=r.knownActions;t._byClipCacheIndex=e.length,e.push(t)}t._cacheIndex=n.length,n.push(t),r.actionByRoot[i]=t}_removeInactiveAction(t){const e=this._actions,i=e[e.length-1],n=t._cacheIndex;i._cacheIndex=n,e[n]=i,e.pop(),t._cacheIndex=null;const s=t._clip.uuid,r=this._actionsByClip,o=r[s],a=o.knownActions,h=a[a.length-1],c=t._byClipCacheIndex;h._byClipCacheIndex=c,a[c]=h,a.pop(),t._byClipCacheIndex=null;delete o.actionByRoot[(t._localRoot||this._root).uuid],0===a.length&&delete r[s],this._removeInactiveBindingsForAction(t)}_removeInactiveBindingsForAction(t){const e=t._propertyBindings;for(let t=0,i=e.length;t!==i;++t){const i=e[t];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(t){const e=this._actions,i=t._cacheIndex,n=this._nActiveActions++,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_takeBackAction(t){const e=this._actions,i=t._cacheIndex,n=--this._nActiveActions,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_addInactiveBinding(t,e,i){const n=this._bindingsByRootAndName,s=this._bindings;let r=n[e];void 0===r&&(r={},n[e]=r),r[i]=t,t._cacheIndex=s.length,s.push(t)}_removeInactiveBinding(t){const e=this._bindings,i=t.binding,n=i.rootNode.uuid,s=i.path,r=this._bindingsByRootAndName,o=r[n],a=e[e.length-1],h=t._cacheIndex;a._cacheIndex=h,e[h]=a,e.pop(),delete o[s],0===Object.keys(o).length&&delete r[n]}_lendBinding(t){const e=this._bindings,i=t._cacheIndex,n=this._nActiveBindings++,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_takeBackBinding(t){const e=this._bindings,i=t._cacheIndex,n=--this._nActiveBindings,s=e[n];t._cacheIndex=n,e[n]=t,s._cacheIndex=i,e[i]=s}_lendControlInterpolant(){const t=this._controlInterpolants,e=this._nActiveControlInterpolants++;let i=t[e];return void 0===i&&(i=new nc(new Float32Array(2),new Float32Array(2),1,Kc),i.__cacheIndex=e,t[e]=i),i}_takeBackControlInterpolant(t){const e=this._controlInterpolants,i=t.__cacheIndex,n=--this._nActiveControlInterpolants,s=e[n];t.__cacheIndex=n,e[n]=t,s.__cacheIndex=i,e[i]=s}clipAction(t,e,i){const n=e||this._root,s=n.uuid;let r="string"==typeof t?dc.findByName(n,t):t;const o=null!==r?r.uuid:t,a=this._actionsByClip[o];let h=null;if(void 0===i&&(i=null!==r?r.blendMode:xt),void 0!==a){const t=a.actionByRoot[s];if(void 0!==t&&t.blendMode===i)return t;h=a.knownActions[0],null===r&&(r=h._clip)}if(null===r)return null;const c=new Yc(this,r,e,i);return this._bindAction(c,h),this._addInactiveAction(c,o,s),c}existingAction(t,e){const i=e||this._root,n=i.uuid,s="string"==typeof t?dc.findByName(i,t):t,r=s?s.uuid:t,o=this._actionsByClip[r];return void 0!==o&&o.actionByRoot[n]||null}stopAllAction(){const t=this._actions;for(let e=this._nActiveActions-1;e>=0;--e)t[e].stop();return this}update(t){t*=this.timeScale;const e=this._actions,i=this._nActiveActions,n=this.time+=t,s=Math.sign(t),r=this._accuIndex^=1;for(let o=0;o!==i;++o){e[o]._update(n,t,s,r)}const o=this._bindings,a=this._nActiveBindings;for(let t=0;t!==a;++t)o[t].apply(r);return this}setTime(t){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(t)}getRoot(){return this._root}uncacheClip(t){const e=this._actions,i=t.uuid,n=this._actionsByClip,s=n[i];if(void 0!==s){const t=s.knownActions;for(let i=0,n=t.length;i!==n;++i){const n=t[i];this._deactivateAction(n);const s=n._cacheIndex,r=e[e.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,r._cacheIndex=s,e[s]=r,e.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(t){const e=t.uuid,i=this._actionsByClip;for(const t in i){const n=i[t].actionByRoot[e];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[e];if(void 0!==n)for(const t in n){const e=n[t];e.restoreOriginalState(),this._removeInactiveBinding(e)}}uncacheAction(t,e){const i=this.existingAction(t,e);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}const Zc=new di;class $c{constructor(t,e,i=0,n=1/0){this.ray=new ui(t,e),this.near=i,this.far=n,this.camera=null,this.layers=new _i,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return Zc.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Zc),this}intersectObject(t,e=!0,i=[]){return el(t,this,i,e),i.sort(tl),i}intersectObjects(t,e=!0,i=[]){for(let n=0,s=t.length;n<s;n++)el(t[n],this,i,e);return i.sort(tl),i}}function tl(t,e){return t.distance-e.distance}function el(t,e,i,n){if(t.layers.test(e.layers)&&t.raycast(e,i),!0===n){const n=t.children;for(let t=0,s=n.length;t<s;t++)el(n[t],e,i,!0)}}class il{constructor(t=1,e=0,i=0){return this.radius=t,this.phi=e,this.theta=i,this}set(t,e,i){return this.radius=t,this.phi=e,this.theta=i,this}copy(t){return this.radius=t.radius,this.phi=t.phi,this.theta=t.theta,this}makeSafe(){const t=1e-6;return this.phi=Math.max(t,Math.min(Math.PI-t,this.phi)),this}setFromVector3(t){return this.setFromCartesianCoords(t.x,t.y,t.z)}setFromCartesianCoords(t,e,i){return this.radius=Math.sqrt(t*t+e*e+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(t,i),this.phi=Math.acos(ne(e/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:t}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=t);const nl=document.createElement("template");nl.innerHTML='\n  <style>\n    \n  * > * {\n    padding: 0;\n    margin: 0;\n  }\n\n  :host {\n    display: block;\n    position: relative;\n    width: 300px;\n    height: 150px;\n    isolation: isolate;\n    user-select: none;\n    overflow: hidden;\n    -webkit-user-select: none;\n    -ms-user-select: none;\n  }\n\n  :host([hidden]) {\n    display: none!important;\n  }\n\n  .container {\n    position: relative;\n    width: 100%;\n    height: 100%;\n    margin: 0!important;\n    padding: 0!important;\n    contain: strict;\n    background: var(--background);\n    overflow: hidden;\n  }\n\n  .canvas-container > canvas {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 0;\n    pointer-events: none;\n  }\n\n  .input {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 1;\n  }\n\n  .hotspots {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    z-index: 2;\n    pointer-events: none;\n  }\n\n  .hotspots ::slotted(*) {\n    pointer-events: initial;\n  }\n\n  .hidden {\n    display: none!important;\n  }\n\n  ::slotted(:not(.hotspot)) {\n    position: absolute;\n    z-index: 4;\n  }\n\n  slot[name="poster"] {\n    width: 100%;\n    height: 100%;\n  }\n\n  [part="default-poster"] {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-size: contain;\n    background-repeat: no-repeat;\n    background-position: center;\n    background-color: transparent;\n  }\n\n  [part="default-progress-bar"] {\n    --progress: 0;\n\n    position: absolute;\n    top: 0;\n    left: 0;\n    height: 5px;\n    min-width: 0;\n    max-width: 100%;\n    width: calc(var(--progress, 0) * 100%);\n    background-color: #327dd9; \n    pointer-events: none;\n    transition: width 0.1s;\n    overflow: hidden;\n  }\n\n  [part="default-progress-bar"].hide {\n    opacity: 0;\n    transition: 0.3s opacity 0.3s;\n  }\n\n  </style>\n  \n  <div class="container">\n    <div class="canvas-container">\n      <canvas></canvas>\n    </div>\n    <div class="input"></div>\n    <div class="hotspots hidden"></div>\n    <slot name="poster" class="hidden">\n      <div part="default-poster"></div>\n    </slot>\n    <div part="default-progress-bar"></div>\n  </div>\n\n  <slot></slot>\n\n';
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const sl=globalThis,rl=sl.ShadowRoot&&(void 0===sl.ShadyCSS||sl.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,ol=Symbol(),al=new WeakMap;let hl=class{constructor(t,e,i){if(this._$cssResult$=!0,i!==ol)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=t,this.t=e}get styleSheet(){let t=this.o;const e=this.t;if(rl&&void 0===t){const i=void 0!==e&&1===e.length;i&&(t=al.get(e)),void 0===t&&((this.o=t=new CSSStyleSheet).replaceSync(this.cssText),i&&al.set(e,t))}return t}toString(){return this.cssText}};const cl=t=>new hl("string"==typeof t?t:t+"",void 0,ol),ll=rl?t=>t:t=>t instanceof CSSStyleSheet?(t=>{let e="";for(const i of t.cssRules)e+=i.cssText;return cl(e)})(t):t
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */,{is:Al,defineProperty:ul,getOwnPropertyDescriptor:dl,getOwnPropertyNames:fl,getOwnPropertySymbols:gl,getPrototypeOf:pl}=Object,ml=globalThis,vl=ml.trustedTypes,bl=vl?vl.emptyScript:"",El=ml.reactiveElementPolyfillSupport,Cl=(t,e)=>t,Il={toAttribute(t,e){switch(e){case Boolean:t=t?bl:null;break;case Object:case Array:t=null==t?t:JSON.stringify(t)}return t},fromAttribute(t,e){let i=t;switch(e){case Boolean:i=null!==t;break;case Number:i=null===t?null:Number(t);break;case Object:case Array:try{i=JSON.parse(t)}catch(t){i=null}}return i}},wl=(t,e)=>!Al(t,e),_l={attribute:!0,type:String,converter:Il,reflect:!1,hasChanged:wl};Symbol.metadata??=Symbol("metadata"),ml.litPropertyMetadata??=new WeakMap;class Bl extends HTMLElement{static addInitializer(t){this._$Ei(),(this.l??=[]).push(t)}static get observedAttributes(){return this.finalize(),this._$Eh&&[...this._$Eh.keys()]}static createProperty(t,e=_l){if(e.state&&(e.attribute=!1),this._$Ei(),this.elementProperties.set(t,e),!e.noAccessor){const i=Symbol(),n=this.getPropertyDescriptor(t,i,e);void 0!==n&&ul(this.prototype,t,n)}}static getPropertyDescriptor(t,e,i){const{get:n,set:s}=dl(this.prototype,t)??{get(){return this[e]},set(t){this[e]=t}};return{get(){return n?.call(this)},set(e){const r=n?.call(this);s.call(this,e),this.requestUpdate(t,r,i)},configurable:!0,enumerable:!0}}static getPropertyOptions(t){return this.elementProperties.get(t)??_l}static _$Ei(){if(this.hasOwnProperty(Cl("elementProperties")))return;const t=pl(this);t.finalize(),void 0!==t.l&&(this.l=[...t.l]),this.elementProperties=new Map(t.elementProperties)}static finalize(){if(this.hasOwnProperty(Cl("finalized")))return;if(this.finalized=!0,this._$Ei(),this.hasOwnProperty(Cl("properties"))){const t=this.properties,e=[...fl(t),...gl(t)];for(const i of e)this.createProperty(i,t[i])}const t=this[Symbol.metadata];if(null!==t){const e=litPropertyMetadata.get(t);if(void 0!==e)for(const[t,i]of e)this.elementProperties.set(t,i)}this._$Eh=new Map;for(const[t,e]of this.elementProperties){const i=this._$Eu(t,e);void 0!==i&&this._$Eh.set(i,t)}this.elementStyles=this.finalizeStyles(this.styles)}static finalizeStyles(t){const e=[];if(Array.isArray(t)){const i=new Set(t.flat(1/0).reverse());for(const t of i)e.unshift(ll(t))}else void 0!==t&&e.push(ll(t));return e}static _$Eu(t,e){const i=e.attribute;return!1===i?void 0:"string"==typeof i?i:"string"==typeof t?t.toLowerCase():void 0}constructor(){super(),this._$Ep=void 0,this.isUpdatePending=!1,this.hasUpdated=!1,this._$Em=null,this._$Ev()}_$Ev(){this._$ES=new Promise((t=>this.enableUpdating=t)),this._$AL=new Map,this._$E_(),this.requestUpdate(),this.constructor.l?.forEach((t=>t(this)))}addController(t){(this._$EO??=new Set).add(t),void 0!==this.renderRoot&&this.isConnected&&t.hostConnected?.()}removeController(t){this._$EO?.delete(t)}_$E_(){const t=new Map,e=this.constructor.elementProperties;for(const i of e.keys())this.hasOwnProperty(i)&&(t.set(i,this[i]),delete this[i]);t.size>0&&(this._$Ep=t)}createRenderRoot(){const t=this.shadowRoot??this.attachShadow(this.constructor.shadowRootOptions);return((t,e)=>{if(rl)t.adoptedStyleSheets=e.map((t=>t instanceof CSSStyleSheet?t:t.styleSheet));else for(const i of e){const e=document.createElement("style"),n=sl.litNonce;void 0!==n&&e.setAttribute("nonce",n),e.textContent=i.cssText,t.appendChild(e)}})(t,this.constructor.elementStyles),t}connectedCallback(){this.renderRoot??=this.createRenderRoot(),this.enableUpdating(!0),this._$EO?.forEach((t=>t.hostConnected?.()))}enableUpdating(t){}disconnectedCallback(){this._$EO?.forEach((t=>t.hostDisconnected?.()))}attributeChangedCallback(t,e,i){this._$AK(t,i)}_$EC(t,e){const i=this.constructor.elementProperties.get(t),n=this.constructor._$Eu(t,i);if(void 0!==n&&!0===i.reflect){const s=(void 0!==i.converter?.toAttribute?i.converter:Il).toAttribute(e,i.type);this._$Em=t,null==s?this.removeAttribute(n):this.setAttribute(n,s),this._$Em=null}}_$AK(t,e){const i=this.constructor,n=i._$Eh.get(t);if(void 0!==n&&this._$Em!==n){const t=i.getPropertyOptions(n),s="function"==typeof t.converter?{fromAttribute:t.converter}:void 0!==t.converter?.fromAttribute?t.converter:Il;this._$Em=n,this[n]=s.fromAttribute(e,t.type),this._$Em=null}}requestUpdate(t,e,i){if(void 0!==t){if(i??=this.constructor.getPropertyOptions(t),!(i.hasChanged??wl)(this[t],e))return;this.P(t,e,i)}!1===this.isUpdatePending&&(this._$ES=this._$ET())}P(t,e,i){this._$AL.has(t)||this._$AL.set(t,e),!0===i.reflect&&this._$Em!==t&&(this._$Ej??=new Set).add(t)}async _$ET(){this.isUpdatePending=!0;try{await this._$ES}catch(t){Promise.reject(t)}const t=this.scheduleUpdate();return null!=t&&await t,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){if(!this.isUpdatePending)return;if(!this.hasUpdated){if(this.renderRoot??=this.createRenderRoot(),this._$Ep){for(const[t,e]of this._$Ep)this[t]=e;this._$Ep=void 0}const t=this.constructor.elementProperties;if(t.size>0)for(const[e,i]of t)!0!==i.wrapped||this._$AL.has(e)||void 0===this[e]||this.P(e,this[e],i)}let t=!1;const e=this._$AL;try{t=this.shouldUpdate(e),t?(this.willUpdate(e),this._$EO?.forEach((t=>t.hostUpdate?.())),this.update(e)):this._$EU()}catch(e){throw t=!1,this._$EU(),e}t&&this._$AE(e)}willUpdate(t){}_$AE(t){this._$EO?.forEach((t=>t.hostUpdated?.())),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(t)),this.updated(t)}_$EU(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$ES}shouldUpdate(t){return!0}update(t){this._$Ej&&=this._$Ej.forEach((t=>this._$EC(t,this[t]))),this._$EU()}updated(t){}firstUpdated(t){}}Bl.elementStyles=[],Bl.shadowRootOptions={mode:"open"},Bl[Cl("elementProperties")]=new Map,Bl[Cl("finalized")]=new Map,El?.({ReactiveElement:Bl}),(ml.reactiveElementVersions??=[]).push("2.0.4");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const Sl=globalThis,Ml=Sl.trustedTypes,xl=Ml?Ml.createPolicy("lit-html",{createHTML:t=>t}):void 0,yl="$lit$",Ql=`lit$${Math.random().toFixed(9).slice(2)}$`,Tl="?"+Ql,Dl=`<${Tl}>`,Ll=document,Rl=()=>Ll.createComment(""),Pl=t=>null===t||"object"!=typeof t&&"function"!=typeof t,Ul=Array.isArray,Nl="[ \t\n\f\r]",kl=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,Fl=/-->/g,Ol=/>/g,Gl=RegExp(`>|${Nl}(?:([^\\s"'>=/]+)(${Nl}*=${Nl}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),Hl=/'/g,Vl=/"/g,zl=/^(?:script|style|textarea|title)$/i,ql=(t=>(e,...i)=>({_$litType$:t,strings:e,values:i}))(1),Wl=Symbol.for("lit-noChange"),jl=Symbol.for("lit-nothing"),Jl=new WeakMap,Yl=Ll.createTreeWalker(Ll,129);function Kl(t,e){if(!Array.isArray(t)||!t.hasOwnProperty("raw"))throw Error("invalid template strings array");return void 0!==xl?xl.createHTML(e):e}const Xl=(t,e)=>{const i=t.length-1,n=[];let s,r=2===e?"<svg>":"",o=kl;for(let e=0;e<i;e++){const i=t[e];let a,h,c=-1,l=0;for(;l<i.length&&(o.lastIndex=l,h=o.exec(i),null!==h);)l=o.lastIndex,o===kl?"!--"===h[1]?o=Fl:void 0!==h[1]?o=Ol:void 0!==h[2]?(zl.test(h[2])&&(s=RegExp("</"+h[2],"g")),o=Gl):void 0!==h[3]&&(o=Gl):o===Gl?">"===h[0]?(o=s??kl,c=-1):void 0===h[1]?c=-2:(c=o.lastIndex-h[2].length,a=h[1],o=void 0===h[3]?Gl:'"'===h[3]?Vl:Hl):o===Vl||o===Hl?o=Gl:o===Fl||o===Ol?o=kl:(o=Gl,s=void 0);const A=o===Gl&&t[e+1].startsWith("/>")?" ":"";r+=o===kl?i+Dl:c>=0?(n.push(a),i.slice(0,c)+yl+i.slice(c)+Ql+A):i+Ql+(-2===c?e:A)}return[Kl(t,r+(t[i]||"<?>")+(2===e?"</svg>":"")),n]};class Zl{constructor({strings:t,_$litType$:e},i){let n;this.parts=[];let s=0,r=0;const o=t.length-1,a=this.parts,[h,c]=Xl(t,e);if(this.el=Zl.createElement(h,i),Yl.currentNode=this.el.content,2===e){const t=this.el.content.firstChild;t.replaceWith(...t.childNodes)}for(;null!==(n=Yl.nextNode())&&a.length<o;){if(1===n.nodeType){if(n.hasAttributes())for(const t of n.getAttributeNames())if(t.endsWith(yl)){const e=c[r++],i=n.getAttribute(t).split(Ql),o=/([.?@])?(.*)/.exec(e);a.push({type:1,index:s,name:o[2],strings:i,ctor:"."===o[1]?nA:"?"===o[1]?sA:"@"===o[1]?rA:iA}),n.removeAttribute(t)}else t.startsWith(Ql)&&(a.push({type:6,index:s}),n.removeAttribute(t));if(zl.test(n.tagName)){const t=n.textContent.split(Ql),e=t.length-1;if(e>0){n.textContent=Ml?Ml.emptyScript:"";for(let i=0;i<e;i++)n.append(t[i],Rl()),Yl.nextNode(),a.push({type:2,index:++s});n.append(t[e],Rl())}}}else if(8===n.nodeType)if(n.data===Tl)a.push({type:2,index:s});else{let t=-1;for(;-1!==(t=n.data.indexOf(Ql,t+1));)a.push({type:7,index:s}),t+=Ql.length-1}s++}}static createElement(t,e){const i=Ll.createElement("template");return i.innerHTML=t,i}}function $l(t,e,i=t,n){if(e===Wl)return e;let s=void 0!==n?i._$Co?.[n]:i._$Cl;const r=Pl(e)?void 0:e._$litDirective$;return s?.constructor!==r&&(s?._$AO?.(!1),void 0===r?s=void 0:(s=new r(t),s._$AT(t,i,n)),void 0!==n?(i._$Co??=[])[n]=s:i._$Cl=s),void 0!==s&&(e=$l(t,s._$AS(t,e.values),s,n)),e}class tA{constructor(t,e){this._$AV=[],this._$AN=void 0,this._$AD=t,this._$AM=e}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}u(t){const{el:{content:e},parts:i}=this._$AD,n=(t?.creationScope??Ll).importNode(e,!0);Yl.currentNode=n;let s=Yl.nextNode(),r=0,o=0,a=i[0];for(;void 0!==a;){if(r===a.index){let e;2===a.type?e=new eA(s,s.nextSibling,this,t):1===a.type?e=new a.ctor(s,a.name,a.strings,this,t):6===a.type&&(e=new oA(s,this,t)),this._$AV.push(e),a=i[++o]}r!==a?.index&&(s=Yl.nextNode(),r++)}return Yl.currentNode=Ll,n}p(t){let e=0;for(const i of this._$AV)void 0!==i&&(void 0!==i.strings?(i._$AI(t,i,e),e+=i.strings.length-2):i._$AI(t[e])),e++}}class eA{get _$AU(){return this._$AM?._$AU??this._$Cv}constructor(t,e,i,n){this.type=2,this._$AH=jl,this._$AN=void 0,this._$AA=t,this._$AB=e,this._$AM=i,this.options=n,this._$Cv=n?.isConnected??!0}get parentNode(){let t=this._$AA.parentNode;const e=this._$AM;return void 0!==e&&11===t?.nodeType&&(t=e.parentNode),t}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(t,e=this){t=$l(this,t,e),Pl(t)?t===jl||null==t||""===t?(this._$AH!==jl&&this._$AR(),this._$AH=jl):t!==this._$AH&&t!==Wl&&this._(t):void 0!==t._$litType$?this.$(t):void 0!==t.nodeType?this.T(t):(t=>Ul(t)||"function"==typeof t?.[Symbol.iterator])(t)?this.k(t):this._(t)}S(t){return this._$AA.parentNode.insertBefore(t,this._$AB)}T(t){this._$AH!==t&&(this._$AR(),this._$AH=this.S(t))}_(t){this._$AH!==jl&&Pl(this._$AH)?this._$AA.nextSibling.data=t:this.T(Ll.createTextNode(t)),this._$AH=t}$(t){const{values:e,_$litType$:i}=t,n="number"==typeof i?this._$AC(t):(void 0===i.el&&(i.el=Zl.createElement(Kl(i.h,i.h[0]),this.options)),i);if(this._$AH?._$AD===n)this._$AH.p(e);else{const t=new tA(n,this),i=t.u(this.options);t.p(e),this.T(i),this._$AH=t}}_$AC(t){let e=Jl.get(t.strings);return void 0===e&&Jl.set(t.strings,e=new Zl(t)),e}k(t){Ul(this._$AH)||(this._$AH=[],this._$AR());const e=this._$AH;let i,n=0;for(const s of t)n===e.length?e.push(i=new eA(this.S(Rl()),this.S(Rl()),this,this.options)):i=e[n],i._$AI(s),n++;n<e.length&&(this._$AR(i&&i._$AB.nextSibling,n),e.length=n)}_$AR(t=this._$AA.nextSibling,e){for(this._$AP?.(!1,!0,e);t&&t!==this._$AB;){const e=t.nextSibling;t.remove(),t=e}}setConnected(t){void 0===this._$AM&&(this._$Cv=t,this._$AP?.(t))}}class iA{get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}constructor(t,e,i,n,s){this.type=1,this._$AH=jl,this._$AN=void 0,this.element=t,this.name=e,this._$AM=n,this.options=s,i.length>2||""!==i[0]||""!==i[1]?(this._$AH=Array(i.length-1).fill(new String),this.strings=i):this._$AH=jl}_$AI(t,e=this,i,n){const s=this.strings;let r=!1;if(void 0===s)t=$l(this,t,e,0),r=!Pl(t)||t!==this._$AH&&t!==Wl,r&&(this._$AH=t);else{const n=t;let o,a;for(t=s[0],o=0;o<s.length-1;o++)a=$l(this,n[i+o],e,o),a===Wl&&(a=this._$AH[o]),r||=!Pl(a)||a!==this._$AH[o],a===jl?t=jl:t!==jl&&(t+=(a??"")+s[o+1]),this._$AH[o]=a}r&&!n&&this.j(t)}j(t){t===jl?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,t??"")}}class nA extends iA{constructor(){super(...arguments),this.type=3}j(t){this.element[this.name]=t===jl?void 0:t}}class sA extends iA{constructor(){super(...arguments),this.type=4}j(t){this.element.toggleAttribute(this.name,!!t&&t!==jl)}}let rA=class extends iA{constructor(t,e,i,n,s){super(t,e,i,n,s),this.type=5}_$AI(t,e=this){if((t=$l(this,t,e,0)??jl)===Wl)return;const i=this._$AH,n=t===jl&&i!==jl||t.capture!==i.capture||t.once!==i.once||t.passive!==i.passive,s=t!==jl&&(i===jl||n);n&&this.element.removeEventListener(this.name,this,i),s&&this.element.addEventListener(this.name,this,t),this._$AH=t}handleEvent(t){"function"==typeof this._$AH?this._$AH.call(this.options?.host??this.element,t):this._$AH.handleEvent(t)}};class oA{constructor(t,e,i){this.element=t,this.type=6,this._$AN=void 0,this._$AM=e,this.options=i}get _$AU(){return this._$AM._$AU}_$AI(t){$l(this,t)}}const aA=Sl.litHtmlPolyfillSupport;aA?.(Zl,eA),(Sl.litHtmlVersions??=[]).push("3.1.4");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
class hA extends Bl{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){const t=super.createRenderRoot();return this.renderOptions.renderBefore??=t.firstChild,t}update(t){const e=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(t),this._$Do=((t,e,i)=>{const n=i?.renderBefore??e;let s=n._$litPart$;if(void 0===s){const t=i?.renderBefore??null;n._$litPart$=s=new eA(e.insertBefore(Rl(),t),t,void 0,i??{})}return s._$AI(t),s})(e,this.renderRoot,this.renderOptions)}connectedCallback(){super.connectedCallback(),this._$Do?.setConnected(!0)}disconnectedCallback(){super.disconnectedCallback(),this._$Do?.setConnected(!1)}render(){return Wl}}hA._$litElement$=!0,hA.finalized=!0,globalThis.litElementHydrateSupport?.({LitElement:hA});const cA=globalThis.litElementPolyfillSupport;function lA(t,e,i,n,s,r,o){if(t!==nt||e!==et)throw Error("Unsupported rendertarget format/type");let a=8*s;return(r||o)&&(a+=4*s,s>1&&(a+=4)),a*i*n}cA?.({LitElement:hA}),(globalThis.litElementVersions??=[]).push("4.0.6");class AA{constructor(){this.A=[]}allocate(t,e,i){const n=lA(nt,i.type,t,e,i.samples,i.depthTexture,i.depthBuffer);let s,r=1/0;for(const t of this.A){if(t.allocated)continue;const e=t.renderTarget;if(e.texture.type!==i.type||e.samples!==i.samples)continue;let o=n-lA(e.texture.format,e.texture.type,e.width,e.height,e.samples,!!e.depthTexture,e.depthBuffer);o<0&&(o=1/o),o<r&&(r=o,s=t)}if(s){let n=s.renderTarget;s.allocated=!0;const r=Math.max(n.width,t),o=Math.max(n.height,e);if(Number(i.depthBuffer)>Number(n.depthBuffer)||Number(i.depthTexture)>Number(!!n.depthTexture)){n.dispose();const t=new Le(r,o,{type:i.type,depthBuffer:i.depthBuffer,samples:i.samples,depthTexture:i.depthTexture?new Zs(r,o):void 0});s.renderTarget=t,n=t}else n.setSize(r,o);return{renderTarget:n,width:t,height:e}}const o=new Le(t,e,{type:i.type,depthBuffer:i.depthBuffer,samples:i.samples,depthTexture:i.depthTexture?new Zs(t,e):void 0});return this.A.push({renderTarget:o,allocated:!0}),{renderTarget:o,width:t,height:e}}free(t){for(const e of this.A)if(e.renderTarget===t.renderTarget){e.allocated=!1;break}}dispose(){for(const t of this.A)t.renderTarget.dispose();this.A=[]}}const uA="#define GLSLIFY 1\nvarying vec2 vUv;varying vec2 vUnscaledUv;uniform vec2 uvScale;void main(){vUnscaledUv=(position.xy+1.0)*0.5;vUv=uvScale*vUnscaledUv;gl_Position=vec4(position,1.0);}",dA="#define GLSLIFY 1\nuniform float opacity;uniform sampler2D tDiffuse;varying vec2 vUv;void main(){gl_FragColor=opacity*texture2D(tDiffuse,vUv);}",fA="#define GLSLIFY 1\nuniform sampler2D tNormal;uniform sampler2D tDepth;uniform mat4 cameraInverseProjectionMatrix;uniform float kernelRadius;uniform float strength;uniform vec2 uvScale;varying vec2 vUv;vec3 getViewPosition(vec2 uv){float depth=textureLod(tDepth,uv,0.).x;vec4 viewPos4=cameraInverseProjectionMatrix*vec4(vec3(uv/uvScale,depth)*2.-1.,1.0);vec3 viewPos=viewPos4.xyz/viewPos4.w;return viewPos;}float hash12(vec2 p){vec3 p3=fract(vec3(p.xyx)*vec3(.1031,.11369,.13787));p3+=dot(p3,p3.yzx+19.19);return fract((p3.x+p3.y)*p3.z);}const float kernelSizeInv=1./float(KERNEL_SIZE);float sampleAo(vec2 uv,vec3 origPos,vec3 origNor,float maxDist){vec3 viewPos=getViewPosition(uv);vec3 diff=viewPos-origPos;float dist=length(diff);vec3 dir=diff/dist;float ao=max(0.0,dot(origNor,dir)-0.15);ao*=smoothstep(maxDist,maxDist*0.5,dist);return ao;}float calcAo(vec2 uv0,vec3 origPos,vec3 origNor){const float goldenAngle=2.399963;float angle=hash12(gl_FragCoord.xy)*(2.*3.14159);float radiusStep=0.03*kernelRadius*kernelSizeInv;float radius=radiusStep;vec2 texSize=vec2(textureSize(tDepth,0))*uvScale;float uScale=texSize.y/texSize.x;float maxDist=-origPos.z*0.05*kernelRadius;float ao=0.;for(int i=0;i<KERNEL_SIZE;i++){vec2 uvOffset=vec2(sin(angle),cos(angle));vec2 uv=uv0+uvOffset*radius*vec2(uScale,1.)*uvScale;ao+=sampleAo(uv,origPos,origNor,maxDist);radius+=radiusStep;angle+=goldenAngle;}ao*=kernelSizeInv;return ao;}void main(){vec3 viewPosition=getViewPosition(vUv);vec3 viewNormal=texture2D(tNormal,vUv).xyz;if(viewNormal==vec3(0.0)){gl_FragColor=vec4(1.0);return;}float ao=calcAo(vUv,viewPosition,viewNormal);ao=pow(1.0-ao,strength);gl_FragColor=vec4(vec3(ao),1.0);}",gA="#define GLSLIFY 1\n#ifdef CHUNK_HEADER\n#if defined(USE_SSAO) && defined(STANDARD)\nuniform sampler2D ssaoTexture;uniform sampler2D normalTexture;uniform sampler2D depthTexture;uniform vec2 depthToZParams;float unproject(float d){return-1./(depthToZParams.x*d+depthToZParams.y);}float sampleZ(ivec2 pix){return unproject(texelFetch(depthTexture,pix,0).x);}\n#endif\n#if defined(USE_AOMAP)\nuniform sampler2D aoMap;uniform float aoMapIntensity;\n#endif\n#endif\n#ifdef CHUNK_BODY\nfloat ambientOcclusion=1.0;\n#if defined(USE_SSAO) && defined(STANDARD)\n#if !defined(SSAO_HALF_RES)\nvec3 viewNormal=nonPerturbedNormal;float mainZ=-vViewPosition.z;ivec2 mainPix=ivec2(gl_FragCoord.xy);vec2 dZdXY=vec2(dFdx(mainZ),dFdy(mainZ));float mainDirX=vViewPosition.x/vViewPosition.z;float pixSizeAtZ1=dFdx(mainDirX);float allowedDepthError=pixSizeAtZ1*mainZ;const ivec2 pixOffsets[5]=ivec2[5](ivec2(0,0),ivec2(1,0),ivec2(0,1),ivec2(-1,0),ivec2(0,-1));ambientOcclusion=0.;for(int iPixOffset=0;iPixOffset<5;++iPixOffset){ivec2 pix=mainPix+pixOffsets[iPixOffset];vec3 n=texelFetch(normalTexture,pix,0).xyz;float z=sampleZ(pix);float ao=texelFetch(ssaoTexture,pix,0).r;ambientOcclusion+=ao*(1./5.);if(abs(z-(mainZ+dot(dZdXY,vec2(pixOffsets[iPixOffset]))))<allowedDepthError&&dot(n,viewNormal)>0.95){ambientOcclusion=ao;break;}}\n#else\nvec3 viewNormal=nonPerturbedNormal;vec3 mainDir=vViewPosition/vViewPosition.z;float mainZ=-vViewPosition.z;float pixSizeAtZ1=dFdx(mainDir.x);float normalDotMainDir=dot(viewNormal,mainDir);vec2 normalDotViewOffsetPerPix=viewNormal.xy*pixSizeAtZ1;float normalDotMainPos=-normalDotMainDir*mainZ;float allowedDepthError=pixSizeAtZ1*mainZ;float aoSum=0.;float weightSum=0.;vec2 fc0=gl_FragCoord.xy*0.5;ivec2 halfPix00=ivec2(fc0-0.5);vec2 halfPixFrac=fc0-vec2(halfPix00)-0.5;for(int i=0;i<2;++i){for(int j=0;j<2;++j){ivec2 halfPix=halfPix00+ivec2(i,j);vec3 n=texelFetch(normalTexture,halfPix,0).xyz;float ao=texelFetch(ssaoTexture,halfPix,0).r;float z=sampleZ(halfPix);vec2 pixOffset=(vec2(i,j)-halfPixFrac)*2.;float distFromPlane=(dot(pixOffset,normalDotViewOffsetPerPix)+normalDotMainDir)*z+normalDotMainPos;float bilinCoeffX=i==0 ? 1.-halfPixFrac.x : halfPixFrac.x;float bilinCoeffY=j==0 ? 1.-halfPixFrac.y : halfPixFrac.y;float bilinCoeff=bilinCoeffX*bilinCoeffY;float w=bilinCoeff*max(dot(n,viewNormal)-0.95,1./2048.);w*=abs(distFromPlane)<=allowedDepthError ? 1. : 1./2048.;aoSum+=ao*w;weightSum+=w;}}ambientOcclusion=aoSum/weightSum;\n#endif\n#endif\n#if defined( USE_AOMAP )\nambientOcclusion=min(ambientOcclusion,(texture2D(aoMap,vAoMapUv).r-1.0)*aoMapIntensity+1.0);\n#endif\n#if defined( USE_AOMAP ) || defined( USE_SSAO ) && defined( STANDARD )\nreflectedLight.indirectDiffuse*=ambientOcclusion;\n#if defined( USE_CLEARCOAT )\nclearcoatSpecularIndirect*=ambientOcclusion;\n#endif\n#if defined( USE_SHEEN )\nsheenSpecularIndirect*=ambientOcclusion;\n#endif\n#if defined( USE_ENVMAP ) && defined( STANDARD )\nfloat dotNV=saturate(dot(geometryNormal,geometryViewDir));reflectedLight.indirectSpecular*=computeSpecularOcclusion(dotNV,ambientOcclusion,material.roughness);\n#endif\n#endif\n#endif\n",pA="#define GLSLIFY 1\nvarying vec2 vUv;uniform sampler2D colorTexture;uniform vec2 sampleDir;uniform vec3 coeffSampleOffsets[MAX_NUM_SAMPLES];uniform int numSamples;\n#if defined(COLOR_TEXTURE_VIEWPORT)\nuniform vec4 colorTextureViewport;vec2 getUV(in vec2 sampleOffset){vec2 invSize=vec2(1.0)/vec2(textureSize(colorTexture,0));vec2 offset=invSize*colorTextureViewport.xy;vec2 scale=invSize*colorTextureViewport.zw;vec2 halfPixelSize=0.5*invSize/scale;vec2 newUv=clamp(vUv+sampleOffset/scale,vec2(halfPixelSize),vec2(1.0)-halfPixelSize);return newUv*scale+offset;}\n#else\nvec2 getUV(in vec2 sampleOffset){return vUv+sampleOffset;}\n#endif\nvoid main(){vec4 diffuseSum=coeffSampleOffsets[0].x*texture2D(colorTexture,getUV(vec2(0.0)));for(int i=1;i<numSamples;i++){diffuseSum+=coeffSampleOffsets[i].x*texture2D(colorTexture,getUV(sampleDir*coeffSampleOffsets[i].yz));diffuseSum+=coeffSampleOffsets[i].x*texture2D(colorTexture,getUV(-sampleDir*coeffSampleOffsets[i].yz));}gl_FragColor=diffuseSum;}",mA="#define GLSLIFY 1\nuniform sampler2D colorTexture;uniform sampler2D depthTexture;uniform sampler2D normalTexture;uniform ivec2 sampleDir;uniform int numSamples;uniform ivec2 texSize;uniform vec4 uvToViewMad;uniform vec2 depthToZParams;uniform float pixSizeAtZ1;varying vec2 vUv;float unproject(float d){return-1./(depthToZParams.x*d+depthToZParams.y);}float sampleZ(ivec2 pix){return unproject(texelFetch(depthTexture,pix,0).x);}void main(){ivec2 mainPix=ivec2(floor(vUv*vec2(texSize)));vec3 mainNormal=texelFetch(normalTexture,mainPix,0).xyz;if(dot(mainNormal,mainNormal)<0.5){gl_FragColor=vec4(1.);return;}float mainZ=sampleZ(mainPix);vec3 mainDir=vec3(vUv*uvToViewMad.xy+uvToViewMad.zw,1.);float allowedErrorPerPix=pixSizeAtZ1*mainZ*0.5;float normalDotMainDir=dot(mainNormal,mainDir);float normalDotViewOffsetPerPix=dot(mainNormal.xy,vec2(sampleDir))*pixSizeAtZ1;float normalDotMainPos=-normalDotMainDir*mainZ;vec4 diffuseSum=vec4(0.);float weightSum=0.;for(int i=-numSamples+1;i<numSamples;++i){ivec2 pix=clamp(mainPix+i*sampleDir,ivec2(0),texSize-ivec2(1));vec3 normal=texelFetch(normalTexture,pix,0).xyz;float z=sampleZ(pix);float distFromPlane=(float(i)*normalDotViewOffsetPerPix+normalDotMainDir)*z+normalDotMainPos;float w=dot(normal,mainNormal)-0.95;if(w>0.&&abs(distFromPlane)<=allowedErrorPerPix*(abs(float(i))+0.2)){diffuseSum+=w*texelFetch(colorTexture,pix,0);weightSum+=w;}}gl_FragColor=diffuseSum/weightSum;}",vA="#define GLSLIFY 1\nuniform sampler2D tDiffuse;uniform float amount;varying vec2 vUv;void main(){float neighbor=-2.0*amount;float center=amount*8.0+1.0;vec2 invResolution=vec2(1.0)/vec2(textureSize(tDiffuse,0));vec4 centerTex=texture2D(tDiffuse,vUv);vec3 color=centerTex.rgb*center;color+=neighbor*texture2D(tDiffuse,vUv+vec2(-invResolution.x*0.5,-invResolution.y)).rgb;color+=neighbor*texture2D(tDiffuse,vUv+vec2(invResolution.x,-invResolution.y*0.5)).rgb;color+=neighbor*texture2D(tDiffuse,vUv+vec2(invResolution.x*0.5,invResolution.y)).rgb;color+=neighbor*texture2D(tDiffuse,vUv+vec2(-invResolution.x,invResolution.y*0.5)).rgb;gl_FragColor=vec4(color,centerTex.a);}",bA="#define GLSLIFY 1\n#include <tonemapping_pars_fragment>\nuniform sampler2D tDiffuse;uniform vec4 colorCorrection;varying vec2 vUv;const vec3 W=vec3(0.2125,0.7154,0.0721);vec3 hueShift(in vec3 color,in float h){const vec3 k=vec3(0.57735,0.57735,0.57735);float cosAngle=cos(h);return vec3(color*cosAngle+cross(k,color)*sin(h)+k*dot(k,color)*(1.0-cosAngle));}vec3 saturation(in vec3 color,in float s){vec3 intensity=vec3(dot(color,W));return mix(intensity,color,s);}vec3 contrast(in vec3 color,in float c){return mix(vec3(0.5),color,c);}vec3 brightness(in vec3 color,in float b){return color+vec3(b);}\n#ifdef BLOOM_COMPOSITE\nvarying vec2 vUnscaledUv;uniform sampler2D bloomTexture;uniform float bloomStrength;uniform float bloomRadius;uniform vec4 viewports[NUM_BLOOM_MIPS];vec2 getUV(in int i){vec2 invSize=vec2(1.0)/vec2(textureSize(bloomTexture,0));vec2 offset=invSize*viewports[i].xy;vec2 scale=invSize*viewports[i].zw;vec2 halfPixelSize=0.5*invSize/scale;vec2 newUv=clamp(vUnscaledUv,vec2(halfPixelSize),vec2(1.0)-halfPixelSize);return newUv*scale+offset;}vec3 getBloom(){vec3 s=vec3(0.0);for(int i=0;i<NUM_BLOOM_MIPS;i++){s+=texture2D(bloomTexture,getUV(i)).xyz*clamp(bloomRadius-float(i),0.0,1.0);}return bloomStrength*s;}\n#endif\nvec3 linearToFinalColor(in vec3 color,bool bloom){\n#ifdef LINEAR_TONE_MAPPING\ncolor=LinearToneMapping(color);\n#elif defined(REINHARD_TONE_MAPPING)\ncolor=ReinhardToneMapping(color);\n#elif defined(CINEON_TONE_MAPPING)\ncolor=OptimizedCineonToneMapping(color);\n#elif defined(ACES_FILMIC_TONE_MAPPING)\ncolor=ACESFilmicToneMapping(color);\n#elif defined(AGX_TONE_MAPPING)\ncolor=clamp(AgXToneMapping(color),0.0,1.0);\n#elif defined(NEUTRAL_TONE_MAPPING)\ncolor=NeutralToneMapping(color);\n#endif\ncolor=LinearTosRGB(vec4(color,0.0)).rgb;\n#ifdef HAS_HUE_SHIFT\ncolor=hueShift(color,colorCorrection.x);\n#endif\n#ifdef HAS_SATURATION\ncolor=saturation(color,colorCorrection.y);\n#endif\n#ifdef HAS_CONTRAST\nif(bloom){color=mix(vec3(min(0.5,dot(color,W))),color,colorCorrection.z);}else{color=contrast(color,colorCorrection.z);}\n#endif\n#ifdef HAS_BRIGHTNESS\nif(bloom){if(colorCorrection.w>0.){color=mix(color,vec3(dot(color*(1.+colorCorrection.w*2.),W)),colorCorrection.w);}else{color=mix(color,vec3(0.),-colorCorrection.w);}}else{color=brightness(color,colorCorrection.w);}\n#endif\nreturn color;}void main(){gl_FragColor=texture2D(tDiffuse,vUv);if(gl_FragColor.a!=0.0){gl_FragColor.rgb/=gl_FragColor.a;}\n#ifdef BLOOM_COMPOSITE\nvec3 bloom=getBloom();gl_FragColor.rgb+=bloom*gl_FragColor.a;\n#endif\ngl_FragColor.rgb=linearToFinalColor(gl_FragColor.rgb,false);gl_FragColor.rgb*=gl_FragColor.a;\n#ifdef BLOOM_COMPOSITE\ngl_FragColor.rgb+=linearToFinalColor(bloom,true)*(1.-gl_FragColor.a);gl_FragColor.a=max(gl_FragColor.a,1.0/256.0);\n#endif\n}",EA="#define GLSLIFY 1\nuniform sampler2D tDiffuse;uniform float luminosityThreshold;varying vec2 vUv;void main(){vec3 texelUnclamped=texture2D(tDiffuse,vUv).xyz;const float maxIntensityPerCh=3.;float texelUnclampedSum=max(0.0001,dot(texelUnclamped,vec3(1.)));vec3 texel=texelUnclamped*min(1.,maxIntensityPerCh*3./texelUnclampedSum);float texelSum=max(0.0001,dot(texel,vec3(1.)));vec3 clr=texel*max(0.,1.-luminosityThreshold*3./texelSum);gl_FragColor=vec4(clr,1.);}",CA="#define GLSLIFY 1\n#if defined(FLAT_SHADED) || !defined(USE_TANGENT)\nvarying vec3 vViewPosition;\n#endif\n#if defined(USE_UV1)\nvarying vec2 vUv1;\n#endif\n#include <uv_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <color_pars_vertex>\nvoid main(){\n#include <uv_vertex>\n#include <beginnormal_vertex>\n#include <morphnormal_vertex>\n#include <skinbase_vertex>\n#include <skinnormal_vertex>\n#include <defaultnormal_vertex>\n#include <normal_vertex>\n#include <begin_vertex>\n#include <morphtarget_vertex>\n#include <skinning_vertex>\n#include <project_vertex>\n#include <color_vertex>\n#if defined(FLAT_SHADED) || !defined(USE_TANGENT)\nvViewPosition=-mvPosition.xyz;\n#endif\n#if defined(USE_UV1)\nvUv1=uv1;\n#endif\n}",IA='#define GLSLIFY 1\n#if defined(FLAT_SHADED) || !defined(USE_TANGENT)\nvarying vec3 vViewPosition;\n#endif\n#if defined(USE_UV1)\nvarying vec2 vUv1;\n#endif\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <map_pars_fragment>\n#include <color_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <emissivemap_pars_fragment>\nuniform sampler2D uvChecker;uniform vec3 diffuse;uniform vec3 emissive;uniform float roughness;uniform float metalness;uniform float opacity;vec3 viewToWorldSpacePacked(in vec3 v){return normalize(vec3(inverse(viewMatrix)*vec4(v,0.0)))*0.5+0.5;}vec4 getMissingDataGrid(){ivec2 gridCoords=ivec2(gl_FragCoord.xy/25.0);if((gridCoords.x+gridCoords.y)% 2==0){return vec4(1.0);}return vec4(vec3(229.0/255.0),1.0);}void main(){\n#include <normal_fragment_begin>\n#if defined(OUTPUT_VertexNormal)\ngl_FragColor=vec4(viewToWorldSpacePacked(tbn[2]),1.0);\n#elif defined(OUTPUT_VertexTangent)\n#if defined(HAS_VERTEX_TANGENT)\ngl_FragColor=vec4(viewToWorldSpacePacked(tbn[0]),1.0);\n#else\ngl_FragColor=getMissingDataGrid();\n#endif\n#elif defined(OUTPUT_DerivativeTangent)\n#if !defined(FLAT_SHADED)\ngl_FragColor=vec4(viewToWorldSpacePacked(tbn[0]),1.0);\n#else\ngl_FragColor=getMissingDataGrid();\n#endif\n#elif defined(OUTPUT_VertexBitangent)\n#if defined(HAS_VERTEX_TANGENT)\ngl_FragColor=vec4(viewToWorldSpacePacked(tbn[1]),1.0);\n#else\ngl_FragColor=getMissingDataGrid();\n#endif\n#elif defined(OUTPUT_DerivativeBitangent)\n#if !defined(FLAT_SHADED)\ngl_FragColor=vec4(viewToWorldSpacePacked(tbn[1]),1.0);\n#else\ngl_FragColor=getMissingDataGrid();\n#endif\n#elif defined(OUTPUT_WorldSpaceNormal)\n#if defined(USE_NORMALMAP)\nvec3 wsNormal=texture2D(normalMap,vNormalMapUv).xyz*2.0-1.0;wsNormal.xy*=normalScale;wsNormal=normalize(tbn*wsNormal);gl_FragColor=vec4(viewToWorldSpacePacked(wsNormal),1.0);\n#else\ngl_FragColor=vec4(viewToWorldSpacePacked(nonPerturbedNormal),1.0);\n#endif\n#elif defined(OUTPUT_NormalTexture)\n#if defined(USE_NORMALMAP)\ngl_FragColor=vec4(texture2D(normalMap,vNormalMapUv).xyz,1.0);\n#else\ngl_FragColor=getMissingDataGrid();\n#endif\n#elif defined(OUTPUT_BaseColor)\ngl_FragColor=vec4(diffuse,1.0);\n#if defined(USE_COLOR)\ngl_FragColor.rgb*=vColor.rgb;\n#endif\n#if defined(USE_MAP)\ngl_FragColor.rgb*=texture2D(map,vMapUv).rgb;\n#endif\ngl_FragColor=LinearTosRGB(gl_FragColor);\n#elif defined(OUTPUT_Alpha)\ngl_FragColor=vec4(opacity,opacity,opacity,1.0);\n#if defined(USE_COLOR_ALPHA)\ngl_FragColor.rgb*=vColor.a;\n#endif\n#if defined(USE_MAP)\ngl_FragColor.rgb*=texture2D(map,vMapUv).a;\n#endif\ngl_FragColor=LinearTosRGB(gl_FragColor);\n#elif defined(OUTPUT_Metallic)\ngl_FragColor=vec4(metalness,metalness,metalness,1.0);\n#if defined(USE_METALNESSMAP)\ngl_FragColor.rgb*=texture2D(metalnessMap,vMetalnessMapUv).b;\n#endif\n#elif defined(OUTPUT_Roughness)\ngl_FragColor=vec4(roughness,roughness,roughness,1.0);\n#if defined(USE_ROUGHNESSMAP)\ngl_FragColor.rgb*=texture2D(roughnessMap,vRoughnessMapUv).g;\n#endif\n#elif defined(OUTPUT_Occlusion)\n#if defined(USE_AOMAP)\ngl_FragColor=vec4(vec3(aoMapIntensity*texture2D(aoMap,vAoMapUv).r),1.0);\n#else\ngl_FragColor=getMissingDataGrid();\n#endif\n#elif defined(OUTPUT_Emissive)\ngl_FragColor=vec4(emissive,1.0);\n#if defined(USE_EMISSIVEMAP)\ngl_FragColor.rgb*=texture2D(emissiveMap,vEmissiveMapUv).rgb;\n#endif\ngl_FragColor=LinearTosRGB(gl_FragColor);\n#elif defined(OUTPUT_FaceOrientation)\nif(gl_FrontFacing){gl_FragColor=vec4(0.0,0.0,1.0,1.0);}else{gl_FragColor=vec4(1.0,0.0,0.0,1.0);}\n#elif defined(OUTPUT_UV0)\ngl_FragColor=vec4(vUv.xy,0.0,1.0);\n#elif defined(OUTPUT_UV0Wrapped)\ngl_FragColor=vec4(fract(vUv.xy),0.0,1.0);\n#elif defined(OUTPUT_UV1)\n#if defined(USE_UV1)\ngl_FragColor=vec4(vUv1.xy,0.0,1.0);\n#else\ngl_FragColor=getMissingDataGrid();\n#endif\n#elif defined(OUTPUT_UV1Wrapped)\n#if defined(USE_UV1)\ngl_FragColor=vec4(fract(vUv1.xy),0.0,1.0);\n#else\ngl_FragColor=getMissingDataGrid();\n#endif\n#elif defined(OUTPUT_UV0Checker)\ngl_FragColor=texture2D(uvChecker,vUv);\n#elif defined(OUTPUT_UV1Checker)\n#if defined(USE_UV1)\ngl_FragColor=texture2D(uvChecker,vUv1);\n#else\ngl_FragColor=getMissingDataGrid();\n#endif\n#else\n#error "No view channel defined!";\n#endif\n}',wA="#define GLSLIFY 1\n#if defined(FLAT_SHADED)\nvarying vec3 vViewPosition;\n#endif\n#include <uv_pars_fragment>\n#include <color_pars_fragment>\n#include <map_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <normal_pars_fragment>\nuniform float opacity;void main(){vec4 diffuseColor=vec4(1.0,1.0,1.0,opacity);\n#include <color_fragment>\n#include <map_fragment>\n#include <alphatest_fragment>\n#include <normal_fragment_begin>\ngl_FragColor=vec4(normal,1.0);}",_A="#define GLSLIFY 1\nvarying vec3 positionOS;varying vec3 normalOS;void main(){positionOS=position;normalOS=normal;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.0);}",BA="#define GLSLIFY 1\n#define EPSILON 0.001\nuniform vec3 gemTint;uniform vec3 colorIoR;uniform sampler2D planeList;uniform mat3 objectToWorld;uniform vec3 cameraPositionOS;varying vec3 positionOS;varying vec3 normalOS;uniform samplerCube environmentMap;vec3 envColor(in vec3 objDir){return textureLod(environmentMap,objectToWorld*objDir,0.0).rgb;}float intersect(in vec3 origin,in vec3 dir,in vec4 plane){float ddp=dot(dir,plane.xyz);float t=(plane.w-dot(origin,plane.xyz))/ddp;return t;}\n#if USE_CUBEMAP_CACHE\nuniform highp usamplerCube planeCache;uniform vec3 bminv;uniform vec3 bmaxv;float intersectBox(in vec3 origin,in vec3 dir){vec3 tmin=(bminv-origin)/dir;vec3 tmax=(bmaxv-origin)/dir;vec3 farp=max(tmin,tmax);return min(farp.x,min(farp.y,farp.z));}uvec2 sampleCube(vec3 p){return textureLod(planeCache,p,0.).xy;}vec3 findInternalIntersection(vec3 o,vec3 d,out vec3 N){float t0=intersectBox(o,d)+EPSILON;vec3 bpMul=1./(bmaxv-bminv);vec3 bpAdd=-0.5*(bmaxv+bminv)*bpMul;uvec2 ip=sampleCube((o+d*t0)*bpMul+bpAdd);uint iCandPlane=ip.x;uint iAltPlane=ip.y;uint iPlane=iCandPlane;for(int i=0;i<10;++i){vec4 p=texelFetch(planeList,ivec2(iCandPlane,0),0);float ddp=dot(d,p.xyz);if(ddp>=0.){break;}float t=(p.w-dot(o,p.xyz))/ddp;if(t>=t0){break;}t0=t;iPlane=iCandPlane;uvec2 ip=sampleCube((o+d*t)*bpMul+bpAdd);iCandPlane=ip.x;iAltPlane=ip.y;if(iCandPlane==iPlane){break;}}if(iAltPlane!=iPlane){vec4 p=texelFetch(planeList,ivec2(iAltPlane,0),0);float ddp=dot(d,p.xyz);if(ddp<0.){float t=(p.w-dot(o,p.xyz))/ddp;if(t<=t0){iPlane=iAltPlane;}}}vec4 plf=texelFetch(planeList,ivec2(iPlane,0),0);N=plf.xyz;float tf=intersect(o,d,plf);return o+(tf-EPSILON)*d;}void findInternalIntersection(inout vec3 origin[SP],in vec3 dir[SP],out vec3 N[SP]){for(int i=0;i<SP;++i){origin[i]=findInternalIntersection(origin[i],dir[i],N[i]);}}\n#else\nvoid findInternalIntersection(inout vec3 origin[SP],in vec3 dir[SP],out vec3 N[SP]){float bestT[SP];for(int i=0;i<SP;++i){bestT[i]=1e9;}for(int i=0;i<textureSize(planeList,0).x;i++){vec4 plane=texelFetch(planeList,ivec2(i,0),0);for(int j=0;j<SP;++j){float t=intersect(origin[j],dir[j],plane);if(t>0.0&&t<bestT[j]){bestT[j]=t;N[j]=plane.xyz;}}}for(int i=0;i<SP;++i){origin[i]=origin[i]+(bestT[i]-EPSILON)*dir[i];}}\n#endif\nfloat fresnelR(float cthetai,float cthetat,float ni,float nt){float t1=(ni*cthetai-nt*cthetat)/(ni*cthetai+nt*cthetat);float t2=(ni*cthetat-nt*cthetai)/(ni*cthetat+nt*cthetai);return 0.5*(t1*t1+t2*t2);}void rayTraceHelper(inout vec3 origin[SP],inout vec3 dir[SP],in vec3 IoR,out vec3 refractionColor,out vec3 coeffReflected){vec3 N[SP];findInternalIntersection(origin,dir,N);for(int i=0;i<SP;++i){vec3 T=refract(dir[i],N[i],IoR[i]);float ct1=-dot(dir[i],N[i]);float ct2=-dot(T,N[i]);dir[i]=reflect(dir[i],N[i]);\n#if SP == 3\nrefractionColor[i]=envColor(T)[i];coeffReflected[i]=fresnelR(ct1,ct2,IoR[i],1.0);\n#else\nrefractionColor=envColor(T);coeffReflected=vec3(fresnelR(ct1,ct2,IoR[i],1.0));\n#endif\n}}vec3 rayTrace(in vec3 origin[SP],in vec3 dir[SP],in vec3 IoR){vec3 totalColor=vec3(0.0);vec3 coeffRemain=vec3(1.0);for(int i=0;i<RAY_TRACE_DEPTH;++i){vec3 refractionColor;vec3 coeffReflected;rayTraceHelper(origin,dir,IoR,refractionColor,coeffReflected);totalColor+=coeffRemain*(1.0-coeffReflected)*refractionColor;coeffRemain*=coeffReflected;}\n#if SP == 3\nvec3 remainColor=vec3(envColor(dir[0]).r,envColor(dir[1]).g,envColor(dir[2]).b);\n#else\nvec3 remainColor=envColor(dir[0]);\n#endif\ntotalColor+=coeffRemain*remainColor;return totalColor;}vec3 computeRefraction(in vec3 V,in vec3 N,in vec3 posOS,in float ct1,in vec3 IoR,out vec3 f){vec3 dir[SP];for(int i=0;i<SP;++i){dir[i]=refract(V,N,1.0/IoR[i]);float ct2=-dot(dir[i],N);\n#if SP == 3\nf[i]=fresnelR(ct1,ct2,1.0,IoR[i]);\n#else\nf=vec3(fresnelR(ct1,ct2,1.0,IoR[i]));\n#endif\n}vec3 origin[SP];for(int i=0;i<SP;++i){origin[i]=posOS+EPSILON*dir[i];}return rayTrace(origin,dir,IoR);}vec3 computeColor(in vec3 N,in vec3 posOS){vec3 V=normalize(posOS-cameraPositionOS);vec3 R=reflect(V,N);vec3 reflection=envColor(R);float ct1=-dot(V,N);vec3 f=vec3(0.0,0.0,0.0);vec3 refraction=computeRefraction(V,N,posOS,ct1,colorIoR,f);return mix(refraction*gemTint,reflection,f);}void main(){\n#ifdef USE_AA\nvec3 N=normalize(normalOS);const float a=2.0/16.0;const float b=6.0/16.0;vec3 dPx=dFdx(positionOS);vec3 dPy=dFdy(positionOS);vec3 color0=computeColor(N,positionOS-a*dPx-b*dPy);vec3 color1=computeColor(N,positionOS+b*dPx-a*dPy);vec3 color2=computeColor(N,positionOS-b*dPx+a*dPy);vec3 color3=computeColor(N,positionOS+a*dPx+b*dPy);vec3 color=0.25*(color0+color1+color2+color3);\n#else\nvec3 color=computeColor(normalize(normalOS),positionOS);\n#endif\ngl_FragColor=linearToOutputTexel(vec4(min(color,vec3(10.0)),1.0));}",SA="#define GLSLIFY 1\nin vec4 position;out vec3 positionOS;uniform mat4 projectionMatrix;uniform mat4 modelViewMatrix;void main(){positionOS=position.xyz;gl_Position=projectionMatrix*modelViewMatrix*position;}",MA="layout(location=0)out highp uvec2 pc_fragColor;precision highp float;precision highp int;\n#define GLSLIFY 1\nuniform sampler2D planeList;uniform vec3 boxSize;uniform vec3 boxMid;in vec3 positionOS;float intersect(vec3 origin,vec3 dir,vec4 plane){float ddp=dot(dir,plane.xyz);float t=(plane.w-dot(origin,plane.xyz))/ddp;return t;}int findInternalIntersection(vec3 origin,vec3 dir){float bestT=1e9;int iBest=-1;for(int i=0;i<textureSize(planeList,0).x;i++){vec4 plane=texelFetch(planeList,ivec2(i,0),0);float t=intersect(origin,dir,plane);if(t>0.0&&t<bestT){bestT=t;iBest=i;}}return iBest;}const int maxPlaneCands=8;ivec2 iPlaneAndHitCnt[maxPlaneCands]=ivec2[maxPlaneCands](ivec2(-1,0),ivec2(-1,0),ivec2(-1,0),ivec2(-1,0),ivec2(-1,0),ivec2(-1,0),ivec2(-1,0),ivec2(-1,0));void testDir(vec3 dir){int iPlane=findInternalIntersection(boxMid,normalize(dir));for(int i=0;i<maxPlaneCands;i++){if(iPlaneAndHitCnt[i].x==iPlane||iPlaneAndHitCnt[i].x==-1){iPlaneAndHitCnt[i].x=iPlane;iPlaneAndHitCnt[i].y++;return;}}}void main(){vec3 bp=positionOS*boxSize;vec3 posDx=dFdx(bp)*0.5;vec3 posDy=dFdy(bp)*0.5;testDir(bp+posDx+posDy);testDir(bp-posDx+posDy);testDir(bp+posDx-posDy);testDir(bp-posDx-posDy);int iPlane=iPlaneAndHitCnt[0].x;int iOther=iPlane;if(iPlaneAndHitCnt[1].x!=-1){posDx*=3./4.;posDy*=3./4.;for(int i=0;i<4;++i){for(int j=0;j<4;++j){testDir(bp+mix(-posDx,posDx,float(i)/3.)+mix(-posDy,posDy,float(j)/3.));}}int planeCt=0;int otherCt=0;for(int i=0;i<maxPlaneCands;i++){if(iPlaneAndHitCnt[i].y>planeCt){iOther=iPlane;otherCt=planeCt;iPlane=iPlaneAndHitCnt[i].x;planeCt=iPlaneAndHitCnt[i].y;}else if(iPlaneAndHitCnt[i].y>otherCt){iOther=iPlaneAndHitCnt[i].x;otherCt=iPlaneAndHitCnt[i].y;}}}pc_fragColor=uvec2(iPlane,iOther);}",xA="#define GLSLIFY 1\nuniform sampler2D tDiffuse;varying vec2 vUv;uniform vec3 color;void main(){vec4 centerTex=texture2D(tDiffuse,vUv);if(any(greaterThan(centerTex,vec4(0.0)))){gl_FragColor=vec4(0.0);return;}vec2 invResolution=vec2(1.0)/vec2(textureSize(tDiffuse,0));vec2 edge=vUv+(vec2(WIDTH)-0.5)*invResolution;for(int i=-WIDTH;i<=WIDTH;i+=2){for(int j=-WIDTH;j<=WIDTH;j+=2){vec2 uv=vUv+(vec2(i,j)+vec2(0.5))*invResolution;uv=min(uv,edge);vec4 c=texture2D(tDiffuse,uv);if(any(greaterThan(c,vec4(0.0)))){gl_FragColor=vec4(color,1.0);return;};}}gl_FragColor=vec4(0.0);}",yA="#define GLSLIFY 1\nuniform float alphaFactor;uniform sampler2D tDiffuse;varying vec2 vUv;void main(){gl_FragColor=texture2D(tDiffuse,vUv);if(gl_FragColor.a!=0.0){gl_FragColor.rgb/=gl_FragColor.a;}gl_FragColor.a*=alphaFactor;}",QA="#define GLSLIFY 1\n#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;uniform vec2 normalScale;\n#endif\n#ifdef USE_NORMALMAP_OBJECTSPACE\nuniform mat3 normalMatrix;\n#endif\n#if !defined(USE_TANGENT) && (defined(USE_NORMALMAP_TANGENTSPACE) || defined(USE_CLEARCOAT_NORMALMAP) || defined(USE_ANISOTROPY))\nmat3 getTangentFrame(vec3 eye_pos,vec3 surf_norm,vec2 uv){vec3 q0=dFdx(eye_pos);vec3 q1=dFdy(eye_pos);vec2 st0=dFdx(uv);vec2 st1=dFdy(uv);vec3 N=surf_norm;vec3 q1perp=cross(q1,N);vec3 q0perp=cross(N,q0);vec3 T=q1perp*st0.x+q0perp*st1.x;vec3 B=-(q1perp*st0.y+q0perp*st1.y);float det=max(dot(T,T),dot(B,B));float scale=(det==0.0)? 0.0 : inversesqrt(det);return mat3(T*scale,B*scale,N);}\n#endif\n";function TA(t){return 0===t?"uv":`uv${t}`}function DA(t,e){const i=[Math.pow(.5,2*t-2)];for(let e=1;e<t;e++)i.push(i[e-1]*(2*t-1-e)/e);i.reverse(),function(t,e,i){i[0].x=e[0];for(let n=1;n<t;n+=2){const t=e[n]+e[n+1],s=(e[n]*n+e[n+1]*(n+1))/t;i[(n+1)/2].x=t,i[(n+1)/2].y=s,i[(n+1)/2].z=s}}(t,i,e)}function LA(t,e){e[t-1].x=Math.pow(.5,2*t-2);for(let i=1;i<t;i++)e[t-1-i].x=e[t-i].x*(2*t-1-i)/i;for(let i=0;i<t;i++)e[i].y=2*i,e[i].z=2*i}const RA=ms.physical.fragmentShader.slice();class PA extends Yn{constructor(t,e="tDiffuse"){t.vertexShader=uA,void 0===t.uniforms&&(t.uniforms={}),t.uniforms.uvScale={value:new ce(1,1)},t.uniforms[e]={value:null},super(t),this.m=e}setRtView(t){this.uniforms.uvScale.value.x=t.width/t.renderTarget.width,this.uniforms.uvScale.value.y=t.height/t.renderTarget.height,this.uniforms[this.m].value=t.renderTarget.texture}}class UA{constructor(){this.v=new Ms(-1,1,1,-1,0,1);const t=new _n;t.setAttribute("position",new pn([-1,3,0,-1,-1,0,3,-1,0],3)),this.C=new Hn(t)}dispose(){this.C.geometry.dispose()}render(t,e){this.C.material=e,t.render(this.C,this.v)}}const NA=(()=>{const t=navigator.userAgent||navigator.vendor||self.opera;let e=!1;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),e})(),kA=/android/i.test(navigator.userAgent),FA=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!self.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1,OA=/firefox/i.test(navigator.userAgent),GA=/OculusBrowser/.test(navigator.userAgent),HA=FA&&/CriOS\//.test(navigator.userAgent),VA="ontouchstart"in self&&!!window.matchMedia("(pointer: coarse)").matches,zA=kA&&!OA&&!GA,qA=Boolean(window.webkit&&window.webkit.messageHandlers),WA=(()=>{if(FA){if(qA)return Boolean(/CriOS\/|EdgiOS\/|FxiOS\/|GSA\/|DuckDuckGo\//.test(navigator.userAgent));{const t=document.createElement("a");return Boolean(t.relList&&t.relList.supports&&t.relList.supports("ar"))}}return!1})(),jA=null!=navigator.xr&&null!=navigator.xr.isSessionSupported&&null!=self.XRSession&&null!=self.XRSession.prototype.requestHitTestSource,JA=jA,YA=(async()=>!!jA&&navigator.xr.isSessionSupported("immersive-ar"))(),KA=(async()=>{try{return await YA&&!(NA||VA)}catch{return!1}})();let XA,ZA;(async()=>{try{return await YA&&(NA||VA)}catch{return!1}})();class $A extends Xt{constructor(){if($A.instance)throw new Error("Renderer instance already created.");super(),this.webglRenderer=null,this.canvas=document.createElement("canvas"),this.time=performance.now(),this.I=new Te,this.B=(t,e)=>{this.dispatchEvent({type:"prerender"});const i=t-this.time;this.time=t,XA=1,ZA=1,this.dispatchEvent({type:"tick",time:t,delta:i});const n=XA,s=ZA;this.canvas.width===n&&this.canvas.height===s||(this.canvas.width=n,this.canvas.height=s,this.rtPool.dispose());const r=this.webglRenderer.xr?.isPresenting?this.webglRenderer?.getRenderTarget():null;r&&(this.webglRenderer.xr.enabled=!1,this.webglRenderer.setRenderTarget(null)),this.dispatchEvent({type:"render"}),r&&(this.webglRenderer.xr.enabled=!0,this.webglRenderer.setRenderTarget(r)),this.xrTask&&this.xrTask(this.webglRenderer,e),this.dispatchEvent({type:"postrender"})};try{this.webglRenderer=new ta({canvas:this.canvas,alpha:!0,antialias:JA,preserveDrawingBuffer:!0,depth:JA}),this.webglRenderer.autoClear=!1,this.webglRenderer.outputColorSpace=Qt,this.webglRenderer.toneMapping=y,this.webglRenderer.debug={checkShaderErrors:!1,onShaderError:null},this.webglRenderer.setClearColor(0,0),this.webglRenderer.setPixelRatio(1),this.webglRenderer.shadowMap.type=n,this.webglRenderer.shadowMap.autoUpdate=!1,this.webglRenderer.setAnimationLoop(this.B),this.canvas.addEventListener("webglcontextlost",(()=>{this.dispatchEvent({type:"webglcontextlost"})})),this.canvas.addEventListener("webglcontextrestored",(()=>{this.dispatchEvent({type:"webglcontextrestored"})}))}catch(t){console.error(t)}this.rtPool=new AA,this.M=new UA,this.D=new PA({uniforms:{opacity:{value:1}},fragmentShader:dA,transparent:!0,depthTest:!1,depthWrite:!1,blending:2}),function(){gs.aomap_pars_fragment=`\n    #define CHUNK_HEADER\n    ${gA}\n    #undef CHUNK_HEADER\n    `,gs.aomap_fragment=`\n    #define CHUNK_BODY\n    ${gA}\n    #undef CHUNK_BODY\n    `,gs.normalmap_pars_fragment=QA;const t=RA.lastIndexOf("}");ms.physical.fragmentShader=RA.slice(0,t)+"gl_FragColor.rgb = min(gl_FragColor.rgb, 1000.0);"+RA.slice(t)}(),document.addEventListener("visibilitychange",(()=>{document.hidden&&this.rtPool.dispose()}))}requestSize(t,e){XA=Math.max(XA,t),ZA=Math.max(ZA,e)}copyPixels(t,e,i,n=0,s=0){const r=t.getContext("2d");r?(r.clearRect(n,s,e,i),r.drawImage(this.canvas,0,0,e,i,n,s,e,i)):console.error("Cannot acquire 2D context")}fsRender(t){this.M.render(this.webglRenderer,t)}setRtView(t){const e=this.webglRenderer;!this.webglRenderer.getRenderTarget()&&t&&e.getCurrentViewport(this.I),t?(t.renderTarget.viewport.set(0,0,t.width,t.height),e.setRenderTarget(t.renderTarget)):(e.setViewport(this.I),e.setRenderTarget(null))}copyRt(t,e,i=!1,n=1){this.D.setRtView(t),this.D.uniforms.opacity.value=n,this.D.blending=i?2:0,this.setRtView(e),this.fsRender(this.D)}maxAnisotropy(){return Math.min(this.webglRenderer.capabilities.getMaxAnisotropy(),16)}getContext(){return this.webglRenderer?.getContext()||null}dispose(){this.M.dispose(),this.D.dispose(),this.rtPool.dispose(),this.webglRenderer?.dispose()}}$A.instance=new $A;const tu=$A.instance;function eu(t){const e=t.length/4,i=new pa(t,e,1,nt,tt);return i.needsUpdate=!0,i}function iu(t){let e;if("string"==typeof t.planeBuffer)e=eu(function(t,e,i){const n=window.atob(t),s=n.length/i,r=new DataView(new ArrayBuffer(i)),o=new e(s);for(let t=0;t<s;t++){for(let e=0;e<i;++e)r.setUint8(e,n.charCodeAt(t*i+e));o instanceof Float32Array?o[t]=r.getFloat32(0,!0):o instanceof Uint16Array&&(o[t]=r.getUint16(0,!0))}return o}(t.planeBuffer,Float32Array,4));else{if(!Array.isArray(t.planeBuffer))throw new Error("Invalid GemMaterial arguments");e=eu(new Float32Array(t.planeBuffer)),console.warn("Gem material data is deprecated. Please reprocess the model.")}return e}function nu(t,e,i){const{refractiveIndex:n,dispersion:s,color:r}=t.parameters;e.colorIoR||(e.colorIoR={value:new Ne}),e.colorIoR.value.set(n-.5*s,n,n+.5*s),i.SP=s>0?3:1,e.gemTint||(e.gemTint={value:new nn}),e.gemTint.value.set(r)}class su extends Yn{constructor(t,e,i,n,s){const r={planeList:{value:null},cameraPositionOS:{value:new Ne},objectToWorld:{value:new le},environmentMap:{value:s},planeCache:{value:null},bminv:{value:e.min.clone()},bmaxv:{value:e.max.clone()}},o={RAY_TRACE_DEPTH:i,USE_CUBEMAP_CACHE:1};nu(t,r,o),n&&(o.USE_AA=1),super({defines:o,vertexShader:_A,fragmentShader:BA,uniforms:r,name:t.name+"_gem"})}setRtTextures(t,e){this.uniforms.planeList.value=t,this.uniforms.planeCache.value=e??null,this.needsUpdate=!!this.defines.USE_CUBEMAP_CACHE!=!!e,this.defines.USE_CUBEMAP_CACHE=e?1:0}set rayTraceDepth(t){t!==this.defines.RAY_TRACE_DEPTH&&(this.defines.RAY_TRACE_DEPTH=t,this.needsUpdate=!0)}set antiAliasing(t){t!==(1===this.defines.USE_AA)&&(t?this.defines.USE_AA=1:delete this.defines.USE_AA,this.needsUpdate=!0)}set envMap(t){this.uniforms.environmentMap.value=t}updateParameters(t){t.parameters?(this.name=t.name+"_gem",nu(t,this.uniforms,this.defines)):console.warn("GemMaterial: cannot update parameters: specified gem type doesn't have 'parameters' attribute.")}rebuild(){this.fragmentShader=BA,this.vertexShader=_A,this.needsUpdate=!0}}class ru extends Yn{constructor(t){if(!(t.material instanceof an||t.material instanceof Yh||t.material instanceof su))throw new Error("Unsupported base material for MeshNormalMaterial");const e={},i={},n=t.geometry;n.hasAttribute("normal")||(e.FLAT_SHADED="");const s=n.hasAttribute("color")&&4===n.getAttribute("color").itemSize;s&&(e.USE_COLOR="",e.USE_COLOR_ALPHA="");const r=t.material;r.alphaTest&&r.map&&(i.opacity={value:r.opacity},e.MAP_UV=TA(r.map.channel),e.USE_MAP="",e.USE_ALPHATEST="",i.map={value:r.map},i.mapTransform={value:r.map.matrix},i.alphaTest={value:r.alphaTest}),super({vertexShader:CA,fragmentShader:wA,defines:e,uniforms:i,vertexColors:s,side:r.side})}}class ou{dispose(){}setSize(t,e){}}let au=null;function hu(t,e,i,n){if(!e)return[()=>{},[i,n]];t.view?.enabled?au=Object.assign(au??{},t.view):au&&(au.enabled=!1);let s=0,r=0;t.view?.enabled&&(t.view.fullHeight==t.view.height&&t.view.fullWidth==t.view.width&&t.view.fullHeight==n&&t.view.fullWidth==i||console.error("SSAO does not support cameras with view offsets other than TAA"),s=t.view.offsetX,r=t.view.offsetY);const o=[Math.round(i/2),Math.round(n/2)];t.setViewOffset(i,n,s,r+n-2*o[1],2*o[0],2*o[1]);return[()=>{au?.enabled?t.setViewOffset(au.fullWidth,au.fullHeight,au.offsetX,au.offsetY,au.width,au.height):t.clearViewOffset()},o]}class cu extends ou{constructor(t,e,i){super(),this.L=t,this.v=e,this.useHalfRes=i,this.R=new Map,this.U=new Map}dispose(){this.U.forEach((t=>{t.dispose()})),this.U.clear()}render(t,e){const i=t.readBuffer,[n,s]=hu(this.v,this.useHalfRes,i.width,i.height),r=tu.rtPool.allocate(s[0],s[1],{type:et,depthTexture:!0,depthBuffer:!0,samples:0});this.N(r),n(),t.normalRenderTarget=r}F(t){const e=t.material,i=this.U.get(e.uuid);if(i)return i;const n=new ru(t);return this.U.set(e.uuid,n),n}N(t){this.L.traverse((t=>{t instanceof Hn&&(this.R.set(t.uuid,t.material),t.material=this.F(t))}));const e=tu.webglRenderer;tu.setRtView(t),e.clear(),e.render(this.L,this.v),this.L.traverse((t=>{t instanceof Hn&&(t.material=this.R.get(t.uuid))})),this.R.clear()}}const lu={value:null},Au={value:null},uu={value:null},du={value:[0,0]};function fu(t){t.uniforms.ssaoTexture=lu,t.uniforms.normalTexture=Au,t.uniforms.depthTexture=uu,t.uniforms.depthToZParams=du}function gu(t,e,i){void 0===t.defines&&(t.defines={}),e in t.defines?i||(delete t.defines[e],t.needsUpdate=!0):i&&(t.defines[e]="",t.needsUpdate=!0)}function pu(t,e,i){t.modelRoots.traverse((t=>{t instanceof Hn&&(gu(t.material,"USE_SSAO",e),gu(t.material,"SSAO_HALF_RES",i))}))}class mu extends ou{constructor(t,e){super(),this.O=t,this.v=e,this.O.modelRoots.traverse((t=>{t instanceof Hn&&(t.material.onBeforeCompile=fu)}))}setSsaoEnabled(t,e){pu(this.O,t,e)}render(t,e){const i=t.writeBuffer,n=t.ssaoRenderTarget,s=t.normalRenderTarget;n&&s&&(lu.value=n.renderTarget.texture,Au.value=s.renderTarget.texture,uu.value=s.renderTarget.depthTexture,du.value[0]=2*this.v.projectionMatrixInverse.elements[11],du.value[1]=this.v.projectionMatrixInverse.elements[15]-this.v.projectionMatrixInverse.elements[11]),tu.setRtView(e?null:i),tu.webglRenderer?.clear(),tu.webglRenderer?.render(this.O,this.v),n&&tu.rtPool.free(n),s&&tu.rtPool.free(s),t.ssaoRenderTarget=void 0,t.normalRenderTarget=void 0,[t.readBuffer,t.writeBuffer]=[t.writeBuffer,t.readBuffer]}}class vu extends ou{constructor(t,e={}){super(),this.G=new PA({uniforms:e,fragmentShader:t,depthTest:!1,depthWrite:!1})}get uniforms(){return this.G.uniforms}render(t,e){this.G.setRtView(t.readBuffer),tu.setRtView(e?null:t.writeBuffer),tu.fsRender(this.G),[t.readBuffer,t.writeBuffer]=[t.writeBuffer,t.readBuffer]}dispose(){this.G.dispose()}}const bu=[new Ne(0,0,0),new Ne(0,0,0),new Ne(0,0,0),new Ne(0,0,0),new Ne(0,0,0),new Ne(0,0,0),new Ne(0,0,0),new Ne(0,0,0),new Ne(0,0,0),new Ne(0,0,0),new Ne(0,0,0)],Eu=[new Te(0,0,0),new Te(0,0,0),new Te(0,0,0),new Te(0,0,0),new Te(0,0,0)],Cu=[5,5,5,5,5],Iu=new Te,wu=new Te,_u=new Te;class Bu extends ou{constructor(){super(),this.H=new PA({uniforms:{luminosityThreshold:{value:0}},fragmentShader:EA,depthTest:!1,depthWrite:!1}),this.V=new PA({defines:{MAX_NUM_SAMPLES:bu.length,COLOR_TEXTURE_VIEWPORT:1},uniforms:{sampleDir:{value:new ce(0,0)},colorTextureViewport:{value:new Te(0,0,0,0)},coeffSampleOffsets:{value:bu},numSamples:{value:0}},fragmentShader:pA,depthTest:!1,depthWrite:!1},"colorTexture")}set threshold(t){this.H.uniforms.luminosityThreshold.value=t}dispose(){this.V.dispose(),this.H.dispose()}render(t,e){const i=t.writeBuffer,n=t.readBuffer,s=tu.webglRenderer,r=tu.rtPool.allocate(Math.round(i.width/2),Math.round(i.height/2),{type:et,depthBuffer:!1,depthTexture:!1,samples:0});s.getViewport(Iu),this.H.setRtView(n),tu.setRtView(i),tu.fsRender(this.H),wu.set(0,0,i.width,i.height),_u.set(0,0,r.width,r.height);for(let t=0;t<5;t++)LA(Cu[t],bu),this.V.uniforms.numSamples.value=Cu[t],this.V.uniforms.colorTexture.value=i.renderTarget.texture,this.V.uniforms.colorTextureViewport.value=wu,this.V.uniforms.sampleDir.value.x=1/i.renderTarget.width,this.V.uniforms.sampleDir.value.y=0,s.setRenderTarget(r.renderTarget),s.setViewport(_u),tu.fsRender(this.V),0!==t&&(wu.x+=wu.z+1),wu.z=Math.round(wu.z/2),wu.w=Math.round(wu.w/2),Eu[t].copy(wu),DA(Cu[t],bu),this.V.uniforms.numSamples.value=Math.ceil(Cu[t]/2),this.V.uniforms.colorTexture.value=r.renderTarget.texture,this.V.uniforms.colorTextureViewport.value=_u,this.V.uniforms.sampleDir.value.x=0,this.V.uniforms.sampleDir.value.y=1/r.renderTarget.height,s.setRenderTarget(i.renderTarget),s.setViewport(wu),tu.fsRender(this.V),_u.z=Math.round(_u.z/2),_u.w=Math.round(_u.w/2);t.bloomRenderTarget=i,t.bloomViewports=Eu,s.setViewport(Iu),tu.rtPool.free(r)}}const Su=new Te(0,1,1,0);class Mu extends ou{constructor(){super(),this.q=null,this.G=new PA({defines:{NUM_BLOOM_MIPS:5},uniforms:{toneMappingExposure:{value:1},colorCorrection:{value:Su.clone()},bloomTexture:{value:null},bloomStrength:{value:0},bloomRadius:{value:0},viewports:{value:[]}},fragmentShader:bA,depthTest:!1,depthWrite:!1,toneMapped:!1})}set bloomStrength(t){this.G.uniforms.bloomStrength.value=t}set bloomRadius(t){this.G.uniforms.bloomRadius.value=t}W(){const t=tu.webglRenderer,e=this.G.uniforms.bloomStrength.value>0&&this.G.uniforms.bloomRadius.value>0;return this.q!==t.toneMapping||!!this.G.defines.BLOOM_COMPOSITE!==e}J(){const t=tu.webglRenderer;this.q=t.toneMapping,this.G.defines={NUM_BLOOM_MIPS:5},this.G.uniforms.bloomStrength.value>0&&this.G.uniforms.bloomRadius.value>0&&(this.G.defines.BLOOM_COMPOSITE=""),this.q===y?this.G.defines.LINEAR_TONE_MAPPING="":this.q===Q?this.G.defines.REINHARD_TONE_MAPPING="":this.q===T?this.G.defines.CINEON_TONE_MAPPING="":this.q===D?this.G.defines.ACES_FILMIC_TONE_MAPPING="":this.q===R?this.G.defines.AGX_TONE_MAPPING="":this.q===P&&(this.G.defines.NEUTRAL_TONE_MAPPING="");const e=this.G.uniforms.colorCorrection.value;e.x!==Su.x&&(this.G.defines.HAS_HUE_SHIFT=""),e.y!==Su.y&&(this.G.defines.HAS_SATURATION=""),e.z!==Su.z&&(this.G.defines.HAS_CONTRAST=""),e.w!==Su.w&&(this.G.defines.HAS_BRIGHTNESS=""),this.G.needsUpdate=!0}render(t,e){const i=t.readBuffer,n=tu.webglRenderer;this.G.setRtView(i),this.G.uniforms.toneMappingExposure.value=n.toneMappingExposure;const s=t.bloomRenderTarget;this.G.uniforms.bloomTexture.value=s?.renderTarget.texture,this.G.uniforms.viewports.value=t.bloomViewports,this.W()&&this.J(),e||t.writeBuffer!==s||(t.writeBuffer=tu.rtPool.allocate(i.width,i.height,{type:et,depthBuffer:!1,depthTexture:!1,samples:0})),tu.setRtView(e?null:t.writeBuffer),tu.fsRender(this.G),s&&s!==t.writeBuffer&&s!==i&&tu.rtPool.free(s),[t.readBuffer,t.writeBuffer]=[t.writeBuffer,t.readBuffer]}Y(t,e,i){this.G.uniforms.colorCorrection.value.setComponent(e,i);t in this.G.defines!==(i!==Su.getComponent(e))&&this.J()}set hueShift(t){this.Y("HAS_HUE_SHIFT",0,t)}set saturation(t){this.Y("HAS_SATURATION",1,t)}set contrast(t){this.Y("HAS_CONTRAST",2,t)}set brightness(t){this.Y("HAS_BRIGHTNESS",3,t)}dispose(){this.G.dispose()}}const xu=[[4,4],[-5,-4],[4,-4],[-3,3],[3,7],[-4,-7],[5,-7],[-5,7],[6,2],[-1,-4],[4,-1],[-7,1],[7,5],[-7,6],[6,-5],[-7,-6],[0,4],[-4,0],[2,-3],[-1,2],[2,1],[-2,-2],[1,-1],[-6,3],[5,6],[-3,-5],[1,-6],[-1,7],[2,5],[-6,-1],[7,-2],[-3,6]],yu=[[0,0],[-1,2],[2,1],[-2,-2],[2,-3],[-4,0],[0,4],[-1,-4],[4,-1],[-3,3],[2,5],[4,-4],[4,4],[-3,-5],[-6,-1],[1,-6],[6,2],[-5,-4],[-6,3],[-3,6],[-7,1],[-1,7],[7,-2],[3,7],[6,-5],[5,6],[-4,-7],[-7,-5],[-5,7],[5,-7],[7,5],[-7,6]];class Qu extends ou{constructor(t){super(),this.accumulate=!0,this.K=1,this.X=[],this.Z=0,this.v=t,this.tt=new Le(1,1,{type:et,depthBuffer:!1}),this.tt.texture.name="TAARenderPass.hold",this.et=new PA({uniforms:{opacity:{value:1}},fragmentShader:dA,transparent:!0,depthTest:!1,depthWrite:!1,blending:5,blendEquation:a,blendSrc:f,blendSrcAlpha:201,blendDst:201}),this.nt=new PA({uniforms:{alphaFactor:{value:1}},fragmentShader:yA,transparent:!1,depthTest:!1,depthWrite:!1})}st(t,e){this.v.setViewOffset(t.fullWidth,t.fullHeight,t.offsetX+.0625*e[0],t.offsetY+.0625*e[1],t.width,t.height)}rt(t,e,i){const n={readBuffer:e,writeBuffer:t};for(const t of this.X){const e=i&&t===this.X[this.X.length-1];t.render(n,e)}return n.readBuffer}ot(t,e,i,n){const s=1===this.K?yu:xu,r={fullWidth:e.width,fullHeight:e.height,offsetX:0,offsetY:0,width:e.width,height:e.height},o=Object.assign({},this.v.view);o.enabled&&Object.assign(r,o);for(let o=0;o<this.K;o++){const o=s[n];this.st(r,o);const a=this.rt(e,i,!1);if(this.et.setRtView(a),tu.setRtView(t),tu.fsRender(this.et),++n>=s.length)break}return o.enabled?this.st(o,[0,0]):this.v.clearViewOffset(),n}render(t,e){const i=t.writeBuffer,n=t.readBuffer,s={renderTarget:this.tt,width:this.tt.width,height:this.tt.height};if(this.accumulate||(this.Z=0,1!==this.K))0===this.Z&&(tu.setRtView(s),tu.webglRenderer?.clear()),this.Z=this.ot(s,i,n,this.Z),this.nt.setRtView(s),this.nt.uniforms.alphaFactor.value=1/this.Z,tu.setRtView(e?null:i),tu.fsRender(this.nt),[t.readBuffer,t.writeBuffer]=[t.writeBuffer,t.readBuffer];else{this.rt(i,n,e)===i&&([t.readBuffer,t.writeBuffer]=[t.writeBuffer,t.readBuffer])}}set ssaaSamples(t){t=Math.min(Math.max(t,1),xu.length),this.K=1<<Math.round(Math.log2(t))}get sssaSampels(){return this.K}setPasses(t){this.X=t}dispose(){this.tt.dispose();for(const t of this.X)t.dispose();this.X=[],this.et.dispose(),this.nt.dispose()}setSize(t,e){this.tt.setSize(t,e);for(const i of this.X)i.setSize(t,e)}hasMaxAccumulation(){return this.Z==xu.length}}const Tu=new Te,Du=new Te,Lu=new Te;class Ru extends ou{constructor(t,e){super(),this.v=t,this.useHalfRes=e,this.kernelRadius=1,this.ht=new PA({defines:{KERNEL_SIZE:16},uniforms:{tDepth:{value:null},cameraInverseProjectionMatrix:{value:new di},kernelRadius:{value:this.kernelRadius},strength:{value:0}},fragmentShader:fA,blending:0,depthTest:!1,depthWrite:!1},"tNormal");this.ct=new PA({defines:{MAX_NUM_SAMPLES:5,COLOR_TEXTURE_VIEWPORT:1},uniforms:{texSize:{value:[0,0]},sampleDir:{value:[0,0]},numSamples:{value:5},normalTexture:{value:null},depthTexture:{value:null},cameraInverseProjectionMatrix:{value:new di},depthToZParams:{value:[0,0]},uvToViewMad:{value:new Te},pixSizeAtZ1:{value:0}},fragmentShader:mA,depthTest:!1,depthWrite:!1},"colorTexture")}set strength(t){this.ht.uniforms.strength.value=t}dispose(){this.ct.dispose()}render(t,e){const i=t.readBuffer,n=tu.webglRenderer,[s,r]=hu(this.v,this.useHalfRes,i.width,i.height),o=tu.rtPool.allocate(r[0],r[1],{type:et,depthTexture:!1,depthBuffer:!1,samples:0});Tu.set(0,0,r[0],r[1]);const a=t.normalRenderTarget;this.ht.setRtView(a),this.ht.uniforms.cameraInverseProjectionMatrix.value.copy(this.v.projectionMatrixInverse),this.ht.uniforms.kernelRadius.value=this.kernelRadius,this.ht.uniforms.tDepth.value=a.renderTarget.depthTexture,16!==this.ht.defines.KERNEL_SIZE&&(this.ht.defines.KERNEL_SIZE=16,this.ht.needsUpdate=!0),n.setRenderTarget(o.renderTarget),n.setViewport(Tu),tu.fsRender(this.ht);{this.ct.uniforms.normalTexture.value=a.renderTarget.texture,this.ct.uniforms.depthTexture.value=a.renderTarget.depthTexture,this.ct.uniforms.texSize.value[0]=r[0],this.ct.uniforms.texSize.value[1]=r[1],this.ct.uniforms.cameraInverseProjectionMatrix.value.copy(this.v.projectionMatrixInverse),this.ct.uniforms.depthToZParams.value[0]=2*this.v.projectionMatrixInverse.elements[11],this.ct.uniforms.depthToZParams.value[1]=this.v.projectionMatrixInverse.elements[15]-this.v.projectionMatrixInverse.elements[11],Du.set(-1,-1,-1,1).applyMatrix4(this.v.projectionMatrixInverse),Lu.set(1,1,-1,1).applyMatrix4(this.v.projectionMatrixInverse),Du.divideScalar(Du.z),Lu.divideScalar(Lu.z);const t=Lu.sub(Du);this.ct.uniforms.uvToViewMad.value.set(t.x,t.y,Du.x,Du.y),this.ct.uniforms.pixSizeAtZ1.value=t.x/r[0];for(let t=0;t<1;++t)this.ct.uniforms.colorTexture.value=o.renderTarget.texture,this.ct.uniforms.sampleDir.value[0]=1,this.ct.uniforms.sampleDir.value[1]=0,n.setRenderTarget(i.renderTarget),n.setViewport(Tu),tu.fsRender(this.ct),this.ct.uniforms.colorTexture.value=i.renderTarget.texture,this.ct.uniforms.sampleDir.value[0]=0,this.ct.uniforms.sampleDir.value[1]=1,n.setRenderTarget(o.renderTarget),n.setViewport(Tu),tu.fsRender(this.ct)}s(),t.ssaoRenderTarget=o}}const Pu={src:"",usdz:void 0,position:[0,0,0],rotation:[0,0,0],scale:[1,1,1],animation:void 0},Uu={name:"",repeatMode:"repeat",repeatCount:1/0,autoPlay:!0},Nu={type:"directional",intensity:1,color:16777215,position:[0,1,0],direction:[0,-1,0]},ku={type:"point",intensity:1,color:16777215,position:[0,1,0],distance:0},Fu={type:"spot",intensity:1,color:16777215,position:[0,1,0],direction:[0,-1,0],distance:0,angle:Math.PI/3,penumbra:0},Ou={scene:{models:[],environment:{src:"",skybox:!1,rotation:[0,0,0]},shadow:{intensity:0,radius:2,offset:0,samples:16,resolution:512},lights:{showModelLights:!0,lightRigIntensity:1,lightRigOverrideColor:null,lightRig:[]}},controls:{enableZoom:!0,enablePan:!0,spherical:void 0,target:void 0,minSpherical:void 0,maxSpherical:void 0,enabled:!0,enableSceneLimits:!0,rotateSpeed:1.5,autoRotate:{enabled:!1,speed:30,resetTime:5}},rendering:{exposure:1,toneMap:"aces",antiAliasing:"ssaa",msaaSamples:8,ssaaSamples:1,sharpen:0,bloomStrength:0,bloomRadius:0,bloomThreshold:.85,ssaoStrength:4,ssaoRadius:1,hueShift:0,saturation:1,contrast:1,brightness:0,transparencyMode:"normal"},jewelry:{enabled:!1,gemAntiAliasing:!1,depth:4},styling:void 0,poster:"",loading:"visible",ui:{fsButton:!0,qrButton:!0,arButton:!0,centerButton:!0,zoomButtons:!0,qrURL:"",autoAR:!1}};function Gu(t,e){if(void 0!==e)for(const i in t){if("type"===i)continue;const n=i,s=t[n];"object"!=typeof s||Array.isArray(s)||Gu(s,e[n]),JSON.stringify(s)!==JSON.stringify({})&&JSON.stringify(s)!==JSON.stringify(e[n])||delete t[n]}}const Hu=new Map([["none",x],["linear",y],["reinhard",Q],["cineon",T],["aces",D],["agx",R],["neutral",P]]);class Vu{constructor(t,e){this.lt=512,this.At=512,this.X=[],this.ut={...Ou.rendering},this.W=!0,this.dt=!1,this.ft=null,this.gt=null,this.vt=null,this.bt=null,this.Et=new Mu,this.Ct=null,this.It=new Map,this.transparentWireframe=!1,this.wt=[],this.O=t,this.v=e,this.Bt=new an({color:16777215,depthWrite:!1,depthTest:!1,side:2,toneMapped:!1}),this.St=new PA({fragmentShader:xA,depthTest:!1,depthWrite:!1,transparent:!0,uniforms:{color:{value:new nn}},defines:{WIDTH:2}}),this.outlineColor=16756521,t.addEventListener("model-added",(t=>{t.model.transparentDepthWrite="depthWrite"===this.ut.transparencyMode,this.W=!0})),t.addEventListener("model-removed",(t=>{this.W=!0}))}save(){return{...this.ut}}load(t={}){const e={...Ou.rendering};Object.assign(e,t);for(const[t,i]of Object.entries(e)){const e=t;this.Mt(t,i??Ou.rendering[e])}this.W=!0}Mt(t,e){const i=t;return void 0===this.ut[i]?(console.warn("RenderingConfig doesn't have property "+t),!1):this.ut[i]!==e&&(this.ut[i]=e,!0)}get antiAliasing(){return this.ut.antiAliasing}set antiAliasing(t){this.Mt("antiAliasing",t)&&(this.W=!0)}get sharpenStrength(){return this.ut.sharpen}set sharpenStrength(t){this.Mt("sharpen",t)&&(this.gt&&0===t||!this.gt&&t>0?this.W=!0:this.gt&&(this.gt.uniforms.amount.value=t,this.dt=!0))}get ssaaSamples(){return this.ut.ssaaSamples}set ssaaSamples(t){this.Mt("ssaaSamples",t)&&this.ft&&(this.ft.ssaaSamples=t,this.dt=!0)}get msaaSamples(){return this.ut.msaaSamples}set msaaSamples(t){this.Mt("msaaSamples",t)&&(this.W=!0)}get bloomStrength(){return this.ut.bloomStrength}set bloomStrength(t){this.Mt("bloomStrength",t)&&(this.vt&&0===t||!this.vt&&t>0?this.W=!0:this.vt&&(this.Et.bloomStrength=t,this.dt=!0))}get bloomRadius(){return this.ut.bloomRadius}set bloomRadius(t){this.Mt("bloomRadius",t)&&(this.vt&&0===t||!this.vt&&t>0?this.W=!0:this.vt&&(this.Et.bloomRadius=t,this.dt=!0))}get bloomThreshold(){return this.ut.bloomThreshold}set bloomThreshold(t){this.Mt("bloomThreshold",t)&&this.vt&&(this.vt.threshold=t,this.dt=!0)}get ssaoRadius(){return this.ut.ssaoRadius}set ssaoRadius(t){this.Mt("ssaoRadius",t)&&(this.bt&&0===t||!this.bt&&t>0&&this.ut.ssaoStrength>0?this.W=!0:this.bt&&(this.bt.kernelRadius=t,this.dt=!0))}get ssaoStrength(){return this.ut.ssaoStrength}set ssaoStrength(t){this.Mt("ssaoStrength",t)&&(this.bt&&0===t||!this.bt&&t>0&&this.ut.ssaoRadius>0?this.W=!0:this.bt&&(this.bt.strength=t,this.dt=!0))}get hueShift(){return this.ut.hueShift}set hueShift(t){this.Mt("hueShift",t)&&(this.Et.hueShift=t,this.dt=!0)}get saturation(){return this.ut.saturation}set saturation(t){this.Mt("saturation",t)&&(this.Et.saturation=t,this.dt=!0)}get contrast(){return this.ut.contrast}set contrast(t){this.Mt("contrast",t)&&(this.Et.contrast=t,this.dt=!0)}get brightness(){return this.ut.brightness}set brightness(t){this.Mt("brightness",t)&&(this.Et.brightness=t,this.dt=!0)}get transparencyMode(){return this.ut.transparencyMode}set transparencyMode(t){this.ut.transparencyMode=t,this.O.transparentDepthWrite="depthWrite"===t,this.dt=!0}get exposure(){return this.ut.exposure}set exposure(t){this.dt=this.Mt("exposure",t)}get toneMapping(){return this.ut.toneMap}set toneMapping(t){this.dt=this.Mt("toneMap",t)}set outlineColor(t){this.St.uniforms.color.value.set(t),this.St.uniforms.color.value.convertLinearToSRGB(),this.dt=!0}set outlineWidth(t){this.St.defines.WIDTH=t,this.St.needsUpdate=!0,this.dt=!0}addOutlineMesh(t){const e=this.O.getObjectByProperty("uuid",t);if(void 0===e||!(e instanceof Hn))return;-1===this.wt.indexOf(e)&&(this.dt=!0,this.wt.push(e))}removeOutlineMesh(t){const e=this.O.getObjectByProperty("uuid",t);if(void 0===e||!(e instanceof Hn))return;const i=this.wt.indexOf(e);-1!==i&&(this.dt=!0,this.wt.splice(i,1))}meshName(t){const e=this.O.getObjectByProperty("uuid",t);if(void 0!==e&&e instanceof Hn)return e.name}clearOutlines(){this.dt=!0,this.wt=[]}rebuild(){this.W=!0}set wireframeColor(t){if(this.dt=!0,null===t)return this.Ct?.dispose(),void(this.Ct=null);null===this.Ct&&(this.Ct=new an({wireframe:!0,depthWrite:!1})),this.Ct.color=new nn(t),this.Ct.color.convertLinearToSRGB()}xt(){this.dispose(),tu.rtPool.dispose(),this.W=!1,this.St.fragmentShader=xA;const t=this.ut.ssaoRadius>0&&this.ut.ssaoStrength>0,e=!0,i=[];if(t){const t=new cu(this.O.modelRoots,this.v,e);i.push(t)}t&&(this.bt=new Ru(this.v,e),this.bt.kernelRadius=this.ut.ssaoRadius,this.bt.strength=this.ut.ssaoStrength,i.push(this.bt));const n=new mu(this.O,this.v);n.setSsaoEnabled(!!this.bt,!!this.bt?.useHalfRes),i.push(n),"ssaa"===this.ut.antiAliasing?(this.ft=new Qu(this.v),this.ft.ssaaSamples=this.ut.ssaaSamples,this.ft.setPasses(i),this.X.push(this.ft)):this.X=i,this.ut.bloomStrength>0&&this.ut.bloomRadius>0&&(this.vt=new Bu,this.vt.threshold=this.ut.bloomThreshold,this.X.push(this.vt)),this.Et=new Mu,this.Et.hueShift=this.ut.hueShift,this.Et.saturation=this.ut.saturation,this.Et.contrast=this.ut.contrast,this.Et.brightness=this.ut.brightness,this.Et.bloomRadius=this.ut.bloomRadius,this.Et.bloomStrength=this.ut.bloomStrength,this.X.push(this.Et),this.ut.sharpen>0&&(this.gt=new vu(vA,{amount:{value:this.ut.sharpen}}),this.X.push(this.gt)),this.O.transparentDepthWrite="depthWrite"===this.ut.transparencyMode;for(const t of this.X)t.setSize(this.lt,this.At)}update(t){let e=this.W||this.dt;return this.dt=!1,this.W&&this.xt(),this.ft&&(t||e?this.ft.accumulate=!1:this.ft.hasMaxAccumulation()||(this.ft.accumulate=!0,e=!0)),e}yt(t){if(0===this.wt.length)return;const e=tu.webglRenderer;tu.setRtView(t),e.clear(),e.outputColorSpace=Qt;for(const t of this.wt){const i=t.material;t.material=this.Bt,e.render(t,this.v),t.material=i}tu.setRtView(null),this.St.setRtView(t),tu.fsRender(this.St)}render(t){const e=tu.webglRenderer;e.toneMapping=Hu.get(this.toneMapping),e.toneMappingExposure=this.exposure,e.outputColorSpace=Qt;const i=1===this.ut.msaaSamples?0:this.ut.msaaSamples,n=tu.rtPool.allocate(this.lt,this.At,{type:et,samples:i,depthBuffer:!0,depthTexture:!1}),s=tu.rtPool.allocate(this.lt,this.At,{type:et,samples:0,depthBuffer:!1,depthTexture:!1}),r={writeBuffer:n,readBuffer:s},o=!!this.Ct;o&&this.O.modelRoots.traverse((t=>{t instanceof Hn&&(t.material.polygonOffset=!0,t.material.polygonOffsetFactor=1,t.material.polygonOffsetUnits=1)}));const a=this.O.helpers.children.length>0;if(o&&this.transparentWireframe)tu.setRtView(r.writeBuffer),e.clear(),tu.setRtView(r.readBuffer),e.clear();else if(t)tu.setRtView(n),e.clear(),e.render(this.O.modelRoots,this.v);else{o&&!this.transparentWireframe&&this.ft&&(this.ft.accumulate=!1);for(const t of this.X){const e=!o&&!a&&t===this.X[this.X.length-1];t.render(r,e)}}!o&&!a||r.writeBuffer!==n||t||tu.copyRt(r.readBuffer,n),o&&(this.It.clear(),this.O.modelRoots.traverse((t=>{t instanceof Hn&&(t.material.polygonOffset=!1,t.material.polygonOffsetFactor=1,t.material.polygonOffsetUnits=1,this.It.set(t.uuid,t.material),t.material=this.Ct)})),tu.setRtView(n),e.render(this.O.modelRoots,this.v),this.O.modelRoots.traverse((t=>{t instanceof Hn&&(t.material=this.It.get(t.uuid))}))),a&&(tu.setRtView(n),e.render(this.O.helpers,this.v)),(o||a||t)&&tu.copyRt(n,null),this.yt(s),tu.rtPool.free(r.writeBuffer),tu.rtPool.free(r.readBuffer)}setSize(t,e){if(t=Math.max(1,t),e=Math.max(1,e),t!==this.lt||e!==this.At){this.lt=t,this.At=e;for(const t of this.X)t.setSize(this.lt,this.At)}}get camera(){return this.v}set camera(t){this.v=t,this.W=!0}dispose(){for(const t of this.X)t.dispose();this.X=[],this.ft=null,this.gt=null,this.vt=null,this.bt=null,this.W=!0,this.St.dispose(),this.Bt.dispose()}}class zu{constructor(t=new Ne,e=new Ue){this.pos=t,this.quat=e}clone(){return new zu(this.pos.clone(),this.quat.clone())}copy(t){return this.pos.copy(t.pos),this.quat.copy(t.quat),this}compose(t){return this.pos.add(t.pos.applyQuaternion(this.quat)),this.quat.multiply(t.quat),this}precompose(t){this.pos.applyQuaternion(t.quat).add(t.pos),this.quat.premultiply(t.quat)}composeV(t){return this.pos.add(t.applyQuaternion(this.quat)),this}composeQ(t){return this.quat.multiply(t),this}invert(){return this.quat.conjugate(),this.pos.negate().applyQuaternion(this.quat),this}lerp(t,e){return this.pos.lerp(t.pos,e),this.quat.slerp(t.quat,e),this}identity(){return this.pos.set(0,0,0),this.quat.identity(),this}}class qu{constructor(t=new zu,e=0){this.placement=t,this.targetDist=e}clone(){return new qu(this.placement.clone(),this.targetDist)}copy(t){return this.placement.copy(t.placement),this.targetDist=t.targetDist,this}getTarget(t){return this.getPosToTarget(t).add(this.placement.pos)}getPosToTarget(t){return t.set(0,0,-this.targetDist),t.applyQuaternion(this.placement.quat)}}function Wu(t,e){return t-Math.floor(t/e)*e}function ju(t,e){return Wu(t-e+Math.PI,2*Math.PI)-Math.PI}function Ju(t,e){return ju(t,e)+e}const Yu=new Ne,Ku=new Ne;function Xu(t,e){return e.set(0,-1,0).applyAxisAngle(Yu.set(1,0,0),t.phi).applyAxisAngle(Ku.set(0,1,0),t.theta)}class Zu{constructor(t=new Ne,e=new il(0)){this.target=t,this.spherical=e}identity(){return this.target.set(0,0,0),this.spherical.set(0,0,0),this}set(t,e){return this.target.copy(t),this.spherical.copy(e),this}copy(t){return this.set(t.target,t.spherical)}clone(){return new Zu(this.target.clone(),this.spherical.clone())}lerp(t,e){return this.target.lerp(t.target,e),function(t,e,i,n){const s=ju(e.theta,t.theta);n.set(he.lerp(t.radius,e.radius,i),he.lerp(t.phi,e.phi,i),t.theta+s*i)}(this.spherical,t.spherical,e,this.spherical),this}add(t){return this.target.add(t.target),this.spherical.radius+=t.spherical.radius,this.spherical.phi+=t.spherical.phi,this.spherical.theta+=t.spherical.theta,this}sub(t){return this.target.sub(t.target),this.spherical.radius-=t.spherical.radius,this.spherical.phi-=t.spherical.phi,this.spherical.theta-=t.spherical.theta,this}toPlacement(t){const e=$u.setFromSpherical(this.spherical);return id.lookAt(e,td.set(0,0,0),ed.set(0,1,0)).decompose(td,t.placement.quat,ed),t.targetDist=this.spherical.radius,t.placement.pos.copy(e),t.placement.pos.add(this.target),t}fromPlacement(t){return t.getTarget(this.target),this.spherical.setFromVector3(t.getPosToTarget($u).negate()),this}isNearZero(t,e){return this.target.length()<t&&Math.abs(this.spherical.radius)<t&&Math.abs(this.spherical.phi)<e&&Math.abs(this.spherical.theta)<e}sphericalPos(t){return t.setFromSpherical(this.spherical).add(this.target)}}const $u=new Ne,td=new Ne,ed=new Ne,id=new di;const nd=/(.*)\.([^.]*)$/;function sd(t,e={}){const i=!!e.hasOwnProperty("geometry")&&!!e.geometry,n=!!e.hasOwnProperty("textures")&&!!e.textures,s=!!e.hasOwnProperty("skeletons")&&!!e.skeletons;t.traverse((t=>{if(t instanceof Hn){if(t.material){(Array.isArray(t.material)?t.material:[t.material]).forEach((t=>{if(!n){let e;for(e in t){const i=t[e];i instanceof Qe&&(i.source.data.image?.close?.(),i.dispose())}}t.dispose()}))}!s&&t instanceof fa&&t.skeleton?.dispose(),!i&&t.geometry&&t.geometry.dispose()}}))}function rd(t){const e=[],i=[],n=[],s=new Map,r=new Map,o=t.scene,a=t.scene.clone(),h=t.parser.associations,c=new Map;od(o,a,((t,e)=>{if(s.set(e.uuid,t),r.set(t.uuid,e),h.has(t)&&c.set(e,h.get(t)),e.material){const e=(i=t.material)?Array.isArray(i)?i:[i]:[];for(let t=0;t<e.length;++t){const i=e[t],n=h.get(i);n&&c.set(i,n)}}var i}));for(const[t,e]of h.entries())t instanceof Qe&&e&&c.set(t,e);return a.traverse((t=>{if(t instanceof Bc)i.push(t);else if(t instanceof Kn)e.push(t);else if(t instanceof Hn){const e=s.get(t.uuid).material;if(t.material=Array.isArray(e)?e.map((t=>t.clone())):e.clone(),t instanceof fa){const e=t,i=s.get(t.uuid),n=i.skeleton.bones;e.skeleton=i.skeleton.clone(),e.bindMatrix.copy(i.bindMatrix),e.skeleton.bones=n.map((t=>r.get(t.uuid))),e.bind(e.skeleton,e.bindMatrix)}}})),t.animations.forEach((t=>{const e=t.tracks.map((t=>{const e=t.name.match(nd);if(!e)return t;const[,i,n]=e,s=r.get(i)?.uuid;return s?new rc(`${s}.${n}`,t.times,t.values,t.getInterpolation()):t}));n.push(new dc(t.name,t.duration,e,t.blendMode))})),{scene:a,lights:i,cameras:e,animations:n,associations:c}}function od(t,e,i){i(t,e);for(let n=0;n<t.children.length;n++)od(t.children[n],e.children[n],i)}function ad(t,e){const i=new Ne;t.updateWorldMatrix(!0,!1),t.traverseVisible((t=>{t.updateWorldMatrix(!1,!1);const n=t.geometry?.getAttribute("position");if(n)if(t instanceof xa){const s=new di;for(let r=0;r<t.count;++r){t.getMatrixAt(r,s);for(let r=0;r<n.count;++r)t instanceof Hn?t.getVertexPosition(r,i):i.fromBufferAttribute(n,r),i.applyMatrix4(s),i.applyMatrix4(t.matrixWorld),e(i)}}else for(let s=0;s<n.count;++s)t instanceof Hn?t.getVertexPosition(s,i):i.fromBufferAttribute(n,s),i.applyMatrix4(t.matrixWorld),e(i)}))}function hd(t,e,i){let n=i;return ad(t,(t=>{n=e(n,t)})),n}function cd(t,e,i){const n=new ce,s=new Ne,r=new ce(-1/0,-1/0);return ad(t,(t=>{s.copy(t).sub(e).divideScalar(i);const o=s.length(),a=Math.abs(s.y),h=n.set(s.x,s.z).length(),c=o/Math.sqrt(1-o*o);let l=c;n.set(h,a-.5).length()<.5&&(l=h/(1-a)),r.max(n.set(l,c))})),r}function ld(t,e,i,n){return function(t,e){const i=Math.max(t.y,t.x/e);return 2*Math.atan(i)*he.RAD2DEG}(cd(t,e,i),n)}const Ad=new Ne,ud=new Ne,dd=new Ne,fd=new ce,gd=new ce,pd=new ce,md=1.05/Math.sin(he.degToRad(22.5));function vd(t){return Math.tan(he.degToRad(t/2))}class bd extends Xt{constructor(t,e,i){super(),this.distanceToTarget=1,this.enableZoom=Ou.controls.enableZoom,this.enablePan=Ou.controls.enablePan,this.enableAutoRotate=Ou.controls.autoRotate.enabled,this.autoRotateDegreesPerSec=Ou.controls.autoRotate.speed,this.autoRotateMinInactivityTime=Ou.controls.autoRotate.resetTime,this.rotateSpeed=Ou.controls.rotateSpeed,this.enableSphericalLimits=!1,this.minSpherical=new il(1,0,0),this.maxSpherical=new il(1,Math.PI,2*Math.PI),this.enableSceneLimits=!0,this.enableRetargetAfterPan=!1,this.mouseZoomSpeed=3,this.Qt=0,this.Tt=!1,this.Dt=new Map,this.Lt=new Zu,this.Rt=null,this.Pt=!1,this.Ut=new qu,this.Nt=new Zu,this._sceneSphere=new si,this.kt=new $c,this.Ft=new Ne,this.Ot=!1,this.Gt=1,this._sceneIdealVerticalFov=45,this.Ht=()=>{if(this.O.modelsBoundingBox.isEmpty())return this._sceneSphere.center.set(0,0,0),this._sceneSphere.radius=1,this.Gt=1,void(this._sceneIdealVerticalFov=45);this.O.modelsBoundingBox.getCenter(this._sceneSphere.center);const t=hd(this.O.modelRoots,((t,e)=>Math.max(t,e.distanceToSquared(this._sceneSphere.center))),0);this._sceneSphere.radius=Math.sqrt(t);const{fov:e,aspectRatio:i}=this.calcVerticalFovAndAspectRatioForPoster();this.Gt=i,this._sceneIdealVerticalFov=e},this.Vt=new qu,this.zt=new Zu,this.qt=t=>{t.preventDefault()},this.Wt=t=>{this.domElement.setPointerCapture(t.pointerId),0===this.Dt.size&&(this.domElement.addEventListener("pointermove",this.jt),this.domElement.style.cursor=this.enabled?"grabbing":"");const e=t.shiftKey||t.ctrlKey||t.metaKey||2==t.button;if(this.Dt.set(t.pointerId,{pos:new ce(t.offsetX,t.offsetY),panMode:e}),this.enablePan){let i=null;if(1===this.Dt.size&&e)i=this.Dt.get(t.pointerId).pos;else if(2===this.Dt.size){const t=this.Dt.values();i=fd.copy(t.next().value.pos).lerp(t.next().value.pos,.5)}if(i){const t=new ce(i.x/this.domElement.clientWidth*2-1,-i.y/this.domElement.clientHeight*2+1);this.kt.setFromCamera(t,this.camera);const e=this.kt.intersectObject(this.O.modelRoots,!0);e.length>0?this.Ft.copy(e[0].point):this.getTarget(this.Ft)}}},this.Jt=t=>{this.Dt.delete(t.pointerId),0===this.Dt.size&&(this.domElement.removeEventListener("pointermove",this.jt),this.domElement.style.cursor=this.enabled?"grab":""),this.Ot&&(this.Ot=!1,this.recastTarget())},this.jt=t=>{const e=this.Dt.get(t.pointerId);if(void 0!==e){if(1===this.Dt.size){const i=fd.set(t.offsetX,t.offsetY).sub(e.pos).divideScalar(this.domElement.clientHeight);e.panMode?this.enablePan&&this.Yt("pan",(()=>this.pan(i))):this.Yt("rotate",(()=>this.rotate(gd.copy(i).multiplyScalar(this.rotateSpeed),!0)))}if(2===this.Dt.size){const i=t.pointerId,n=Array.from(this.Dt.keys()).find((t=>t!==i)),s=fd.set(t.offsetX,t.offsetY),r=this.Dt.get(n).pos,o=e.pos;if(this.enablePan){const t=gd.copy(s).add(r).multiplyScalar(.5),e=pd.copy(o).add(r).multiplyScalar(.5),i=t.sub(e).divideScalar(this.domElement.clientHeight);this.Yt("pan",(()=>this.pan(i)))}if(this.enableZoom){const t=s.distanceTo(r)/o.distanceTo(r);this.Yt("zoom",(()=>this.zoom(t)))}}e.pos.set(t.offsetX,t.offsetY),this.Qt=0,this.Rt=null}else"mouse"===t.pointerType&&0===t.buttons||console.error("Pointer not found in state")},this.Kt=t=>{if(!this.enabled||!this.enableZoom)return;t.preventDefault();const e=Math.pow(.95,t.deltaY/150*this.mouseZoomSpeed);this.Yt("zoom",(()=>this.zoom(e))),this.Qt<this.autoRotateMinInactivityTime&&(this.Qt=0)},this.Xt=new Zu,this.Zt=new Zu,this.$t=new Zu,this.te=new Zu,this.camera=t,this.domElement=e,this.domElement.style.touchAction="none",this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.Lt.copy(this.currentTargetSpherical),this.domElement.addEventListener("contextmenu",this.qt),this.domElement.addEventListener("lostpointercapture",this.Jt),this.O=i,this.O.addEventListener("models-bounding-box-update",this.Ht),this.O.addEventListener("bounding-box-update",this.updateClipPlanes.bind(this)),this.enabled=!1}_minTargetDist(){return this.enableSceneLimits?2*this._sceneSphere.radius:0}ee(){return 3*this._sceneSphere.radius}get currentPlacement(){return this.Ut.placement.pos.copy(this.camera.position),this.Ut.placement.quat.copy(this.camera.quaternion),this.Ut.targetDist=this.distanceToTarget,this.Ut}set currentPlacement(t){this.camera.position.copy(t.placement.pos),this.camera.quaternion.copy(t.placement.quat),this.distanceToTarget=t.targetDist}_radiusToDistAndZoom(t){return this.enableSceneLimits?{dist:Math.max(this._minTargetDist(),t),zoom:Math.max(1,this._minTargetDist()/t)}:{dist:t,zoom:1}}_distAndZoomToRadius(t,e){return t/e}get currentTargetSpherical(){return this.Nt.fromPlacement(this.currentPlacement),this.Nt.spherical.radius=this._distAndZoomToRadius(this.Nt.spherical.radius,this.camera.zoom),this.Nt}set currentTargetSpherical(t){const e=this.currentTargetSpherical,i=he.degToRad(.01),n=1e-5*this._sceneSphere.radius;if(this.zt.copy(e).sub(t).isNearZero(n,i))return;const{dist:s,zoom:r}=this._radiusToDistAndZoom(t.spherical.radius);this.zt.copy(t),this.zt.spherical.radius=s,this.currentPlacement=this.zt.toPlacement(this.Vt),this.camera.zoom=r,this.camera.updateProjectionMatrix(),this.Pt=!0}get enabled(){return this.Tt}set enabled(t){this.Tt!==!!t&&(this.Tt=t,t?(this.domElement.addEventListener("wheel",this.Kt,{passive:!1}),this.domElement.addEventListener("pointerdown",this.Wt),this.domElement.style.cursor="grab"):(this.domElement.removeEventListener("pointerdown",this.Wt),this.domElement.removeEventListener("wheel",this.Kt),this.domElement.removeEventListener("pointermove",this.jt),this.domElement.style.cursor=""))}getTarget(t){return t.copy(this.Lt.target)}recastTarget(){const t=Xu(this.Lt.spherical,ud);this.kt.set(this.ie(Ad),t);const e=this.kt.intersectObject(this.O.modelRoots,!0);if(e.length>0){const t=this.Lt.spherical.radius,i=this._radiusToDistAndZoom(t).zoom;this.Lt.target.copy(e[0].point);let n=e[0].distance/i;n=Math.max(this._minTargetDist()/5,n),this.Lt.spherical.radius=n}}Yt(t,e){const i=this.Lt.clone();e(),this.dispatchEvent({type:t,before:i,after:this.Lt.clone()})}zoom(t){this.Lt.spherical.radius/=t,this.Lt.spherical.radius=this.ne(this.Lt.spherical.radius)}ie(t){const e=this.Lt.spherical.radius;return this.Lt.spherical.radius=this._radiusToDistAndZoom(e).dist,this.Lt.sphericalPos(t),this.Lt.spherical.radius=e,t}pan(t){const e=2*vd(this.camera.getEffectiveFOV()),i=-this.ie(ud).sub(this.Ft).dot(Xu(this.Lt.spherical,dd)),n=Ad.set(-t.x,t.y,0).multiplyScalar(i*e),s=function(t,e){return e.set(1,0,0).applyAxisAngle(Yu.set(0,1,0),t.theta)}(this.Lt.spherical,ud).multiplyScalar(n.x).add(function(t,e){return e.set(0,0,-1).applyAxisAngle(Yu.set(1,0,0),t.phi).applyAxisAngle(Ku.set(0,1,0),t.theta)}(this.Lt.spherical,dd).multiplyScalar(n.y));this.Lt.target.add(s),this.enableRetargetAfterPan&&(this.Ot=!0),this.se(this.Lt.target)}rotate(t,e=!1){const i=-t.y*Math.PI;let n=-t.x*Math.PI;if(this.enableSphericalLimits&&Math.abs(this.maxSpherical.theta-this.minSpherical.theta)<he.degToRad(359)){const t=this.minSpherical.theta+Wu(this.maxSpherical.theta-this.minSpherical.theta,2*Math.PI),e=(this.minSpherical.theta+t)/2,i=Ju(this.Lt.spherical.theta,e);n=he.clamp(n,this.minSpherical.theta-i,t-i)}if(e){const t=this.currentTargetSpherical.spherical.theta,e=Wu(this.Lt.spherical.theta-t,2*Math.PI),i=e+Math.min(0,n),s=e+Math.max(0,n);i<Math.PI&&Math.PI<s&&(n=0)}const s=this.Lt.spherical.phi+i,r=he.clamp(s,.01,Math.PI-.01);this.Lt.spherical.phi=r,this.Lt.spherical.theta+=n,this.re(this.Lt.spherical)}update(t){if(0==t){const t=this.Pt;return this.Pt=!1,t}this.Qt+=t;let e=1e-5;if(this.enableAutoRotate&&this.Qt>this.autoRotateMinInactivityTime){this.Qt>this.autoRotateMinInactivityTime||(this.getDefaultTargetSpherical(this.Xt),this.Lt.target.copy(this.Xt.target),this.Lt.spherical.radius=this.Xt.spherical.radius),this.rotate(fd.set(t*this.autoRotateDegreesPerSec/360,0)),e=.1,this.Pt=!0}if(this.Rt){const e=1-Math.pow(.1,t),i=this.Xt.identity().lerp(this.Rt,e);this.Rt.sub(i),this.Lt.add(i);const n=he.degToRad(.01),s=1e-5*this._sceneSphere.radius;this.Rt.isNearZero(s,n)?this.Rt=null:this.Qt=0}this.re(this.Lt.spherical),this.se(this.Lt.target);const i=this.Xt.copy(this.currentTargetSpherical),n=1-Math.pow(e,t);this.currentTargetSpherical=i.lerp(this.Lt,n),this.camera.updateMatrix(),this.camera.updateMatrixWorld();const s=this.Pt||!!this.Rt;return s?this.updateClipPlanes():this.finalizeSmoothing(),this.Pt=!1,s}moveTo(t){(t=t.clone()).target.sub(this.Lt.target),t.spherical.radius-=this.Lt.spherical.radius,t.spherical.phi-=this.Lt.spherical.phi,t.spherical.theta=ju(t.spherical.theta,this.Lt.spherical.theta),this.Rt=t,this.Qt=0}jumpTo(t){this.currentTargetSpherical=t,this.Rt=null,this.finalizeSmoothing()}oe(t){return t.copy(this.Lt),this.Rt&&t.add(this.Rt),t}moveToSpherical(t,e,i){this.oe(this.Zt),this.Zt.spherical.set(t,e,i),this.moveTo(this.Zt)}moveToTarget(t,e,i){this.oe(this.Zt),this.Zt.target.set(t,e,i),this.moveTo(this.Zt)}jumpToSpherical(t,e,i){this.Zt.copy(this.Lt),this.Zt.spherical.set(t,e,i),this.jumpTo(this.Zt)}jumpToTarget(t,e,i){this.Zt.copy(this.Lt),this.Zt.target.set(t,e,i),this.jumpTo(this.Zt)}finalizeSmoothing(){this.camera.updateMatrix(),this.camera.updateMatrixWorld(),this.camera.updateWorldMatrix(!0,!0),this.Lt.copy(this.currentTargetSpherical)}get aspect(){return this.camera.aspect}set aspect(t){this.aspect!==t&&(this.camera.aspect=t,this.camera.fov=this.ae(t),this.camera.updateProjectionMatrix(),this.Pt=!0)}ae(t){return e=vd(this._sceneIdealVerticalFov)*Math.max(1,this.Gt/t),2*he.radToDeg(Math.atan(e));var e}updateClipPlanes(){const t=Ad.setFromSpherical(this.currentTargetSpherical.spherical).normalize().negate(),e=this.O.boundingBox.getSize(ud).multiply(t),i=t.dot(this.O.boundingBox.min),n=i+Math.min(0,e.x)+Math.min(0,e.y)+Math.min(0,e.z),s=i+Math.max(0,e.x)+Math.max(0,e.y)+Math.max(0,e.z),r=this.camera.position.dot(t),o=(s-n)/1e3,a=s-r<=0?1:s-r+o,h=Math.max(n-r-o,a/200);this.camera.near=h,this.camera.far=a,this.camera.updateProjectionMatrix()}calcImplicitDefaultTargetAndSpherical(t){return this.O.modelsBoundingBox.isEmpty()?(t.target.set(0,0,0),t.spherical.set(1,he.degToRad(75),0),t):(t.target.copy(this._sceneSphere.center),t.spherical.set(this._sceneSphere.radius*md,he.degToRad(75),0),t)}getDefaultTargetSpherical(t){return this.calcImplicitDefaultTargetAndSpherical(t),this.explicitDefaultTarget&&(t.target.copy(this.explicitDefaultTarget),this.se(t.target)),this.explicitDefaultSpherical&&(t.spherical.copy(this.explicitDefaultSpherical),this.re(t.spherical)),t}centerCamera(){this.jumpTo(this.getDefaultTargetSpherical(this.$t))}save(){const t={enableZoom:this.enableZoom,enablePan:this.enablePan,enabled:this.enabled,enableSceneLimits:this.enableSceneLimits,rotateSpeed:this.rotateSpeed,target:this.explicitDefaultTarget?.toArray(),spherical:this.explicitDefaultSpherical&&[this.explicitDefaultSpherical.radius,this.explicitDefaultSpherical.phi,this.explicitDefaultSpherical.theta],autoRotate:{enabled:this.enableAutoRotate,speed:this.autoRotateDegreesPerSec,resetTime:this.autoRotateMinInactivityTime}};return this.enableSphericalLimits&&(t.minSpherical=[this.minSpherical.radius,this.minSpherical.phi,this.minSpherical.theta],t.maxSpherical=[this.maxSpherical.radius,this.maxSpherical.phi,this.maxSpherical.theta]),t.enableSceneLimits=this.enableSceneLimits,t}load(t={}){const e=Ou.controls;this.enableAutoRotate=t.autoRotate?.enabled??Ou.controls.autoRotate.enabled,this.autoRotateDegreesPerSec=t.autoRotate?.speed??Ou.controls.autoRotate.speed,this.autoRotateMinInactivityTime=t.autoRotate?.resetTime??Ou.controls.autoRotate.resetTime,this.enablePan=t.enablePan??e.enablePan,this.enableZoom=t.enableZoom??e.enableZoom,this.enableSceneLimits=t.enableSceneLimits??e.enableSceneLimits,this.rotateSpeed=t.rotateSpeed??e.rotateSpeed,this.enabled=t.enabled??e.enabled,t.minSpherical&&t.maxSpherical?(this.enableSphericalLimits=!0,this.minSpherical.set(...t.minSpherical),this.maxSpherical.set(...t.maxSpherical)):(this.enableSphericalLimits=!1,this.minSpherical.set(this._minTargetDist()/5,0,0),this.maxSpherical.set(3*this._sceneSphere.radius,Math.PI,2*Math.PI)),this.explicitDefaultTarget=t.target&&new Ne(...t.target),this.explicitDefaultSpherical=t.spherical&&new il(...t.spherical),t.legacy&&this.he(t.legacy),this.centerCamera()}he(t){const e=this.calcImplicitDefaultTargetAndSpherical(new Zu);if(t.target&&(this.explicitDefaultTarget=(new Ne).copy(e.target),this.explicitDefaultTarget.x="auto"!==t.target[0]?t.target[0]:this.explicitDefaultTarget.x,this.explicitDefaultTarget.y="auto"!==t.target[1]?t.target[1]:this.explicitDefaultTarget.y,this.explicitDefaultTarget.z="auto"!==t.target[2]?t.target[2]:this.explicitDefaultTarget.z),t.spherical&&(this.explicitDefaultSpherical=(new il).copy(e.spherical),this.explicitDefaultSpherical.radius="auto"!==t.spherical[0]?t.spherical[0]:this.explicitDefaultSpherical.radius,this.explicitDefaultSpherical.phi="auto"!==t.spherical[1]?t.spherical[1]:this.explicitDefaultSpherical.phi,this.explicitDefaultSpherical.theta="auto"!==t.spherical[2]?t.spherical[2]:this.explicitDefaultSpherical.theta),t.fov){this.explicitDefaultSpherical||(this.explicitDefaultSpherical=e.spherical);const i=vd(this._sceneIdealVerticalFov)/vd(t.fov);this.explicitDefaultSpherical.radius=this._distAndZoomToRadius(this.explicitDefaultSpherical.radius,i)}if(null==t.minFov&&null==t.maxFov||this.enableSphericalLimits||(this.enableSphericalLimits=!0,this.minSpherical.set(this._minTargetDist()/5,0,0),this.maxSpherical.set(3*this._sceneSphere.radius,Math.PI,2*Math.PI)),null!=t.minFov){const e=he.clamp(t.minFov,1,179);this.minSpherical.radius=Math.min(this.minSpherical.radius,this._sceneSphere.radius/(vd(this._sceneIdealVerticalFov)/vd(e)))}if(null!=t.maxFov){const e=he.clamp(t.maxFov,1,179);this.maxSpherical.radius=Math.max(this.maxSpherical.radius,this._sceneSphere.radius/(vd(this._sceneIdealVerticalFov)/vd(e)))}}se(t){if(this.enableSceneLimits){const e=ud.copy(this._sceneSphere.center).sub(t),i=e.length();if(i>this._sceneSphere.radius){const n=dd.copy(e).multiplyScalar(1-this._sceneSphere.radius/i);t.add(n)}}return t}re(t){if(this.enableSphericalLimits&&(t.radius=he.clamp(t.radius,this.minSpherical.radius,this.maxSpherical.radius),t.phi=he.clamp(t.phi,Math.PI-this.maxSpherical.phi,Math.PI-this.minSpherical.phi),Math.abs(this.maxSpherical.theta-this.minSpherical.theta)<he.degToRad(359))){const e=this.minSpherical.theta+Wu(this.maxSpherical.theta-this.minSpherical.theta,2*Math.PI),i=(e+this.minSpherical.theta)/2;t.theta=he.clamp(Ju(t.theta,i),this.minSpherical.theta,e)}return t.radius=this.ne(t.radius),t}ne(t){return this.enableSphericalLimits?he.clamp(t,this.minSpherical.radius,this.maxSpherical.radius):this.enableSceneLimits?he.clamp(t,this._minTargetDist()/5,this.ee()):t}calcVerticalFovAndAspectRatioForPoster(){return this.calcImplicitDefaultTargetAndSpherical(this.te),function(t,e,i){const n=cd(t,e,i);return{fov:2*Math.atan(n.y)*he.RAD2DEG,aspectRatio:n.x/n.y}}(this.O.modelRoots,this.te.target,this.te.spherical.radius)}setFovToFitAllViews(){this.calcImplicitDefaultTargetAndSpherical(this.te),this.camera.fov=ld(this.O.modelRoots,this.te.target,this.te.spherical.radius,this.camera.aspect)}setSize(t,e){const i=t/e;this.aspect=i}}class Ed extends wc{constructor(t){super(t),this.type=et}parse(t){const e=function(t,e){switch(t){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(e||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(e||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(e||""));default:throw new Error("THREE.RGBELoader: Memory Error: "+(e||""))}},i=function(t,e,i){e=e||1024;let n=t.pos,s=-1,r=0,o="",a=String.fromCharCode.apply(null,new Uint16Array(t.subarray(n,n+128)));for(;0>(s=a.indexOf("\n"))&&r<e&&n<t.byteLength;)o+=a,r+=a.length,n+=128,a+=String.fromCharCode.apply(null,new Uint16Array(t.subarray(n,n+128)));return-1<s&&(t.pos+=r+s+1,o+a.slice(0,s))},n=function(t,e,i,n){const s=t[e+3],r=Math.pow(2,s-128)/255;i[n+0]=t[e+0]*r,i[n+1]=t[e+1]*r,i[n+2]=t[e+2]*r,i[n+3]=1},s=function(t,e,i,n){const s=t[e+3],r=Math.pow(2,s-128)/255;i[n+0]=ln.toHalfFloat(Math.min(t[e+0]*r,65504)),i[n+1]=ln.toHalfFloat(Math.min(t[e+1]*r,65504)),i[n+2]=ln.toHalfFloat(Math.min(t[e+2]*r,65504)),i[n+3]=ln.toHalfFloat(1)},r=new Uint8Array(t);r.pos=0;const o=function(t){const n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,s=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,r=/^\s*FORMAT=(\S+)\s*$/,o=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,a={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let h,c;for((t.pos>=t.byteLength||!(h=i(t)))&&e(1,"no header found"),(c=h.match(/^#\?(\S+)/))||e(3,"bad initial token"),a.valid|=1,a.programtype=c[1],a.string+=h+"\n";h=i(t),!1!==h;)if(a.string+=h+"\n","#"!==h.charAt(0)){if((c=h.match(n))&&(a.gamma=parseFloat(c[1])),(c=h.match(s))&&(a.exposure=parseFloat(c[1])),(c=h.match(r))&&(a.valid|=2,a.format=c[1]),(c=h.match(o))&&(a.valid|=4,a.height=parseInt(c[1],10),a.width=parseInt(c[2],10)),2&a.valid&&4&a.valid)break}else a.comments+=h+"\n";return 2&a.valid||e(3,"missing format specifier"),4&a.valid||e(3,"missing image size specifier"),a}(r),a=o.width,h=o.height,c=function(t,i,n){const s=i;if(s<8||s>32767||2!==t[0]||2!==t[1]||128&t[2])return new Uint8Array(t);s!==(t[2]<<8|t[3])&&e(3,"wrong scanline width");const r=new Uint8Array(4*i*n);r.length||e(4,"unable to allocate buffer space");let o=0,a=0;const h=4*s,c=new Uint8Array(4),l=new Uint8Array(h);let A=n;for(;A>0&&a<t.byteLength;){a+4>t.byteLength&&e(1),c[0]=t[a++],c[1]=t[a++],c[2]=t[a++],c[3]=t[a++],2==c[0]&&2==c[1]&&(c[2]<<8|c[3])==s||e(3,"bad rgbe scanline format");let i,n=0;for(;n<h&&a<t.byteLength;){i=t[a++];const s=i>128;if(s&&(i-=128),(0===i||n+i>h)&&e(3,"bad scanline data"),s){const e=t[a++];for(let t=0;t<i;t++)l[n++]=e}else l.set(t.subarray(a,a+i),n),n+=i,a+=i}const u=s;for(let t=0;t<u;t++){let e=0;r[o]=l[t+e],e+=s,r[o+1]=l[t+e],e+=s,r[o+2]=l[t+e],e+=s,r[o+3]=l[t+e],o+=4}A--}return r}(r.subarray(r.pos),a,h);let l,A,u;switch(this.type){case tt:u=c.length/4;const t=new Float32Array(4*u);for(let e=0;e<u;e++)n(c,4*e,t,4*e);l=t,A=tt;break;case et:u=c.length/4;const e=new Uint16Array(4*u);for(let t=0;t<u;t++)s(c,4*t,e,4*t);l=e,A=et;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:a,height:h,data:l,header:o.string,gamma:o.gamma,exposure:o.exposure,type:A}}setDataType(t){return this.type=t,this}load(t,e,i,n){return super.load(t,(function(t,i){switch(t.type){case tt:case et:t.colorSpace=Tt,t.minFilter=j,t.magFilter=j,t.generateMipmaps=!1,t.flipY=!0}e&&e(t,i)}),i,n)}}var Cd;const Id=Symbol("count"),wd=Symbol("threshold");class _d extends Xt{constructor(t,e,i){super(),this.xhr=new XMLHttpRequest,this.xhr=new XMLHttpRequest,this.xhr.open("GET",t),this.xhr.responseType="arraybuffer",this.xhr.withCredentials=!!e,i?.forEach(((t,e)=>this.xhr.setRequestHeader(e,t))),this.done=new Promise(((e,i)=>{this.ce(0),this.xhr.addEventListener("load",(()=>{200===this.xhr.status||0===this.xhr.status?(this.data=this.xhr.response,e(this.xhr.response)):i(new Error(`Error downloading file ${t}`))})),this.xhr.addEventListener("error",(()=>{i(new Error(`Error downloading file ${t}`))})),this.xhr.addEventListener("progress",(t=>{t.lengthComputable&&t.total>0&&this.ce(t.loaded/t.total)})),this.xhr.addEventListener("abort",(()=>{i()}))})).finally((()=>{this.ce(1)})),this.xhr.send()}ce(t){this.dispatchEvent({type:"progress",value:he.clamp(t,0,1)})}dispose(){this.xhr.abort(),delete this.data}}let Bd=class extends Xt{constructor(t,e){let i;super(),this.le=!1,this.Ae=t,t.count++;const n=new Promise(((t,e)=>i=()=>e())),s=t.done.then((t=>(this.data=e(t,this),this.data)));this.done=Promise.race([s,n]).finally((()=>this.dispatchEvent({type:"progress",value:1}))),this.dispatchEvent({type:"progress",value:t.progress}),t.downloadRequest?.addEventListener("progress",(t=>this.dispatchEvent(t))),this.dispose=()=>{this.le||(this.le=!0,t.count--,i())}}get url(){return this.Ae.url}get progress(){return this.Ae.progress}};class Sd extends Xt{constructor(t,e,i,n,s){super(),this.count=0,this.progress=0,this.url=t,this[Id]=0,this.le=!1,this.downloadRequest=new _d(t,e,i),this.done=this.downloadRequest.done.then((t=>(delete this.downloadRequest,n(t)))).then((t=>(this.data=t,t))).finally((()=>{this.ce(1)})),this.dispose=()=>{this.le||(this.le=!0,this.downloadRequest?.dispose(),this.done.then((t=>s(t))).catch((()=>{})))},this.ce(0),this.downloadRequest.addEventListener("progress",(t=>this.ce(.9*t.value)))}ce(t){this.progress=he.clamp(t,0,1),this.dispatchEvent({type:"progress",value:this.progress})}get count(){return this[Id]}set count(t){const e=this[Id]>0;this[Id]=he.clamp(t,0,1/0),e!==this[Id]>0&&this.dispatchEvent({type:"usage-change"})}}class Md{constructor(){this.withCredentials=!1,this.headers=new Map,this.cache=new Map,this.unused=[],this[Cd]=3,this.ue=t=>{const e=t.target;e.count>0?this.de(e):this.fe(e)}}load(t){if(!this.cache.has(t)){const e=new Sd(t,this.withCredentials,this.headers,this.transform.bind(this),this.dispose.bind(this));this.cache.set(t,e),e.addEventListener("usage-change",this.ue),e.done.catch((()=>{e.removeEventListener("usage-change",this.ue),this.cache.delete(t),this.de(e)}))}const e=this.cache.get(t);return new Bd(e,this.supply.bind(this))}fe(t){const e=this.unused.findIndex((e=>e===t));-1===e&&(this.unused.unshift(t),this.ge())}de(t){const e=this.unused.findIndex((e=>e===t));-1!==e&&this.unused.splice(e,1)}ge(){const t=Math.min(this.unused.length,Math.max(this.cache.size-this.threshold,0));for(let t=this.unused.length-1;t>=0&&this.cache.size>this.threshold;--t){const e=this.unused[t];e.removeEventListener("usage-change",this.ue),this.cache.delete(e.url),e.dispose()}this.unused.length=this.unused.length-t}get threshold(){return this[wd]}set threshold(t){this[wd]=Math.max(0,t),this.ge()}setRequestHeaders(t){this.headers.clear(),Object.entries(t).forEach((([t,e])=>this.headers.set(t,e)))}}Cd=wd;class xd extends Md{constructor(){super(),this.rgbeLoader=new Ed,this.rgbeLoader.setDataType(et)}async transform(t){const e=this.rgbeLoader.parse(t);if(!e)throw new Error("Unable to parse environment data");const i=new pa(e.data,e.width,e.height);i.colorSpace=Tt,i.minFilter=j,i.magFilter=j,i.anisotropy=1,i.generateMipmaps=!1,i.flipY=!0,i.wrapS=H,i.wrapT=H,i.type=e.type,i.colorSpace=Tt,i.mapping=F,i.needsUpdate=!0;const n=256,s=new ss(n,{magFilter:j,minFilter:j,generateMipmaps:!1,type:et,format:nt,colorSpace:Tt,depthBuffer:!1}),r=tu.webglRenderer;s.fromEquirectangularTexture(r,i);const o=[null,null,null,null,null,null];for(let t=0;t<6;++t)o[t]={isDataTexture:!0,image:{width:n,height:n,data:new Uint16Array(262144)}};const a=new ns(o,N,H,H,j,j,nt,et,1,Tt);a.generateMipmaps=!1,a.needsUpdate=!0,r.initTexture(a);const h=tu.getContext();r.state.bindTexture(h.TEXTURE_CUBE_MAP,r.properties.get(a).__webglTexture);for(let t=0;t<6;++t)r.setRenderTarget(s,t),h.copyTexSubImage2D(h.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,0,0,0,0,n,n);return r.state.unbindTexture(),r.setRenderTarget(null),a.isRenderTargetTexture=!0,i.dispose(),s.dispose(),a}dispose(t){t.dispose()}supply(t){return t}}xd.instance=new xd;const yd=xd.instance;function Qd(t,e){if(0===e)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),t;if(2===e||1===e){let i=t.getIndex();if(null===i){const e=[],n=t.getAttribute("position");if(void 0===n)return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),t;for(let t=0;t<n.count;t++)e.push(t);t.setIndex(e),i=t.getIndex()}const n=i.count-2,s=[];if(2===e)for(let t=1;t<=n;t++)s.push(i.getX(0)),s.push(i.getX(t)),s.push(i.getX(t+1));else for(let t=0;t<n;t++)t%2==0?(s.push(i.getX(t)),s.push(i.getX(t+1)),s.push(i.getX(t+2))):(s.push(i.getX(t+2)),s.push(i.getX(t+1)),s.push(i.getX(t)));s.length/3!==n&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const r=t.clone();return r.setIndex(s),r.clearGroups(),r}return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),t}class Td extends vc{constructor(t){super(t),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(t){return new Nd(t)})),this.register((function(t){return new kd(t)})),this.register((function(t){return new jd(t)})),this.register((function(t){return new Jd(t)})),this.register((function(t){return new Yd(t)})),this.register((function(t){return new Od(t)})),this.register((function(t){return new Gd(t)})),this.register((function(t){return new Hd(t)})),this.register((function(t){return new Vd(t)})),this.register((function(t){return new Ud(t)})),this.register((function(t){return new zd(t)})),this.register((function(t){return new Fd(t)})),this.register((function(t){return new Wd(t)})),this.register((function(t){return new qd(t)})),this.register((function(t){return new Rd(t)})),this.register((function(t){return new Kd(t)})),this.register((function(t){return new Xd(t)}))}load(t,e,i,n){const s=this;let r;if(""!==this.resourcePath)r=this.resourcePath;else if(""!==this.path){const e=Fc.extractUrlBase(t);r=Fc.resolveURL(e,this.path)}else r=Fc.extractUrlBase(t);this.manager.itemStart(t);const o=function(e){n?n(e):console.error(e),s.manager.itemError(t),s.manager.itemEnd(t)},a=new Cc(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(t,(function(i){try{s.parse(i,r,(function(i){e(i),s.manager.itemEnd(t)}),o)}catch(t){o(t)}}),i,o)}setDRACOLoader(t){return this.dracoLoader=t,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(t){return this.ktx2Loader=t,this}setMeshoptDecoder(t){return this.meshoptDecoder=t,this}register(t){return-1===this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.push(t),this}unregister(t){return-1!==this.pluginCallbacks.indexOf(t)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(t),1),this}parse(t,e,i,n){let s;const r={},o={},a=new TextDecoder;if("string"==typeof t)s=JSON.parse(t);else if(t instanceof ArrayBuffer){if(a.decode(new Uint8Array(t,0,4))===Zd){try{r[Ld.KHR_BINARY_GLTF]=new ef(t)}catch(t){return void(n&&n(t))}s=JSON.parse(r[Ld.KHR_BINARY_GLTF].content)}else s=JSON.parse(a.decode(t))}else s=t;if(void 0===s.asset||s.asset.version[0]<2)return void(n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.")));const h=new Mf(s,{path:e||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});h.fileLoader.setRequestHeader(this.requestHeader);for(let t=0;t<this.pluginCallbacks.length;t++){const e=this.pluginCallbacks[t](h);e.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),o[e.name]=e,r[e.name]=!0}if(s.extensionsUsed)for(let t=0;t<s.extensionsUsed.length;++t){const e=s.extensionsUsed[t],i=s.extensionsRequired||[];switch(e){case Ld.KHR_MATERIALS_UNLIT:r[e]=new Pd;break;case Ld.KHR_DRACO_MESH_COMPRESSION:r[e]=new nf(s,this.dracoLoader);break;case Ld.KHR_TEXTURE_TRANSFORM:r[e]=new sf;break;case Ld.KHR_MESH_QUANTIZATION:r[e]=new rf;break;default:i.indexOf(e)>=0&&void 0===o[e]&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}h.setExtensions(r),h.setPlugins(o),h.parse(i,n)}parseAsync(t,e){const i=this;return new Promise((function(n,s){i.parse(t,e,n,s)}))}}function Dd(){let t={};return{get:function(e){return t[e]},add:function(e,i){t[e]=i},remove:function(e){delete t[e]},removeAll:function(){t={}}}}const Ld={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Rd{constructor(t){this.parser=t,this.name=Ld.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const t=this.parser,e=this.parser.json.nodes||[];for(let i=0,n=e.length;i<n;i++){const n=e[i];n.extensions&&n.extensions[this.name]&&void 0!==n.extensions[this.name].light&&t._addNodeRef(this.cache,n.extensions[this.name].light)}}_loadLight(t){const e=this.parser,i="light:"+t;let n=e.cache.get(i);if(n)return n;const s=e.json,r=((s.extensions&&s.extensions[this.name]||{}).lights||[])[t];let o;const a=new nn(16777215);void 0!==r.color&&a.setRGB(r.color[0],r.color[1],r.color[2],Tt);const h=void 0!==r.range?r.range:0;switch(r.type){case"directional":o=new kc(a),o.target.position.set(0,0,-1),o.add(o.target);break;case"point":o=new Uc(a),o.distance=h;break;case"spot":o=new Tc(a),o.distance=h,r.spot=r.spot||{},r.spot.innerConeAngle=void 0!==r.spot.innerConeAngle?r.spot.innerConeAngle:0,r.spot.outerConeAngle=void 0!==r.spot.outerConeAngle?r.spot.outerConeAngle:Math.PI/4,o.angle=r.spot.outerConeAngle,o.penumbra=1-r.spot.innerConeAngle/r.spot.outerConeAngle,o.target.position.set(0,0,-1),o.add(o.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+r.type)}return o.position.set(0,0,0),o.decay=2,Cf(o,r),void 0!==r.intensity&&(o.intensity=r.intensity),o.name=e.createUniqueName(r.name||"light_"+t),n=Promise.resolve(o),e.cache.add(i,n),n}getDependency(t,e){if("light"===t)return this._loadLight(e)}createNodeAttachment(t){const e=this,i=this.parser,n=i.json.nodes[t],s=(n.extensions&&n.extensions[this.name]||{}).light;return void 0===s?null:this._loadLight(s).then((function(t){return i._getNodeRef(e.cache,s,t)}))}}class Pd{constructor(){this.name=Ld.KHR_MATERIALS_UNLIT}getMaterialType(){return an}extendParams(t,e,i){const n=[];t.color=new nn(1,1,1),t.opacity=1;const s=e.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const e=s.baseColorFactor;t.color.setRGB(e[0],e[1],e[2],Tt),t.opacity=e[3]}void 0!==s.baseColorTexture&&n.push(i.assignTexture(t,"map",s.baseColorTexture,Qt))}return Promise.all(n)}}class Ud{constructor(t){this.parser=t,this.name=Ld.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name].emissiveStrength;return void 0!==n&&(e.emissiveIntensity=n),Promise.resolve()}}class Nd{constructor(t){this.parser=t,this.name=Ld.KHR_MATERIALS_CLEARCOAT}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Kh:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];if(void 0!==r.clearcoatFactor&&(e.clearcoat=r.clearcoatFactor),void 0!==r.clearcoatTexture&&s.push(i.assignTexture(e,"clearcoatMap",r.clearcoatTexture)),void 0!==r.clearcoatRoughnessFactor&&(e.clearcoatRoughness=r.clearcoatRoughnessFactor),void 0!==r.clearcoatRoughnessTexture&&s.push(i.assignTexture(e,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),void 0!==r.clearcoatNormalTexture&&(s.push(i.assignTexture(e,"clearcoatNormalMap",r.clearcoatNormalTexture)),void 0!==r.clearcoatNormalTexture.scale)){const t=r.clearcoatNormalTexture.scale;e.clearcoatNormalScale=new ce(t,t)}return Promise.all(s)}}class kd{constructor(t){this.parser=t,this.name=Ld.KHR_MATERIALS_DISPERSION}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Kh:null}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name];return e.dispersion=void 0!==n.dispersion?n.dispersion:0,Promise.resolve()}}class Fd{constructor(t){this.parser=t,this.name=Ld.KHR_MATERIALS_IRIDESCENCE}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Kh:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return void 0!==r.iridescenceFactor&&(e.iridescence=r.iridescenceFactor),void 0!==r.iridescenceTexture&&s.push(i.assignTexture(e,"iridescenceMap",r.iridescenceTexture)),void 0!==r.iridescenceIor&&(e.iridescenceIOR=r.iridescenceIor),void 0===e.iridescenceThicknessRange&&(e.iridescenceThicknessRange=[100,400]),void 0!==r.iridescenceThicknessMinimum&&(e.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),void 0!==r.iridescenceThicknessMaximum&&(e.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),void 0!==r.iridescenceThicknessTexture&&s.push(i.assignTexture(e,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(s)}}class Od{constructor(t){this.parser=t,this.name=Ld.KHR_MATERIALS_SHEEN}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Kh:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[];e.sheenColor=new nn(0,0,0),e.sheenRoughness=0,e.sheen=1;const r=n.extensions[this.name];if(void 0!==r.sheenColorFactor){const t=r.sheenColorFactor;e.sheenColor.setRGB(t[0],t[1],t[2],Tt)}return void 0!==r.sheenRoughnessFactor&&(e.sheenRoughness=r.sheenRoughnessFactor),void 0!==r.sheenColorTexture&&s.push(i.assignTexture(e,"sheenColorMap",r.sheenColorTexture,Qt)),void 0!==r.sheenRoughnessTexture&&s.push(i.assignTexture(e,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(s)}}class Gd{constructor(t){this.parser=t,this.name=Ld.KHR_MATERIALS_TRANSMISSION}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Kh:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return void 0!==r.transmissionFactor&&(e.transmission=r.transmissionFactor),void 0!==r.transmissionTexture&&s.push(i.assignTexture(e,"transmissionMap",r.transmissionTexture)),Promise.all(s)}}class Hd{constructor(t){this.parser=t,this.name=Ld.KHR_MATERIALS_VOLUME}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Kh:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];e.thickness=void 0!==r.thicknessFactor?r.thicknessFactor:0,void 0!==r.thicknessTexture&&s.push(i.assignTexture(e,"thicknessMap",r.thicknessTexture)),e.attenuationDistance=r.attenuationDistance||1/0;const o=r.attenuationColor||[1,1,1];return e.attenuationColor=(new nn).setRGB(o[0],o[1],o[2],Tt),Promise.all(s)}}class Vd{constructor(t){this.parser=t,this.name=Ld.KHR_MATERIALS_IOR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Kh:null}extendMaterialParams(t,e){const i=this.parser.json.materials[t];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();const n=i.extensions[this.name];return e.ior=void 0!==n.ior?n.ior:1.5,Promise.resolve()}}class zd{constructor(t){this.parser=t,this.name=Ld.KHR_MATERIALS_SPECULAR}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Kh:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];e.specularIntensity=void 0!==r.specularFactor?r.specularFactor:1,void 0!==r.specularTexture&&s.push(i.assignTexture(e,"specularIntensityMap",r.specularTexture));const o=r.specularColorFactor||[1,1,1];return e.specularColor=(new nn).setRGB(o[0],o[1],o[2],Tt),void 0!==r.specularColorTexture&&s.push(i.assignTexture(e,"specularColorMap",r.specularColorTexture,Qt)),Promise.all(s)}}class qd{constructor(t){this.parser=t,this.name=Ld.EXT_MATERIALS_BUMP}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Kh:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return e.bumpScale=void 0!==r.bumpFactor?r.bumpFactor:1,void 0!==r.bumpTexture&&s.push(i.assignTexture(e,"bumpMap",r.bumpTexture)),Promise.all(s)}}class Wd{constructor(t){this.parser=t,this.name=Ld.KHR_MATERIALS_ANISOTROPY}getMaterialType(t){const e=this.parser.json.materials[t];return e.extensions&&e.extensions[this.name]?Kh:null}extendMaterialParams(t,e){const i=this.parser,n=i.json.materials[t];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const s=[],r=n.extensions[this.name];return void 0!==r.anisotropyStrength&&(e.anisotropy=r.anisotropyStrength),void 0!==r.anisotropyRotation&&(e.anisotropyRotation=r.anisotropyRotation),void 0!==r.anisotropyTexture&&s.push(i.assignTexture(e,"anisotropyMap",r.anisotropyTexture)),Promise.all(s)}}class jd{constructor(t){this.parser=t,this.name=Ld.KHR_TEXTURE_BASISU}loadTexture(t){const e=this.parser,i=e.json,n=i.textures[t];if(!n.extensions||!n.extensions[this.name])return null;const s=n.extensions[this.name],r=e.options.ktx2Loader;if(!r){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return e.loadTextureImage(t,s.source,r)}}class Jd{constructor(t){this.parser=t,this.name=Ld.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,n=i.json,s=n.textures[t];if(!s.extensions||!s.extensions[e])return null;const r=s.extensions[e],o=n.images[r.source];let a=i.textureLoader;if(o.uri){const t=i.options.manager.getHandler(o.uri);null!==t&&(a=t)}return this.detectSupport().then((function(s){if(s)return i.loadTextureImage(t,r.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class Yd{constructor(t){this.parser=t,this.name=Ld.EXT_TEXTURE_AVIF,this.isSupported=null}loadTexture(t){const e=this.name,i=this.parser,n=i.json,s=n.textures[t];if(!s.extensions||!s.extensions[e])return null;const r=s.extensions[e],o=n.images[r.source];let a=i.textureLoader;if(o.uri){const t=i.options.manager.getHandler(o.uri);null!==t&&(a=t)}return this.detectSupport().then((function(s){if(s)return i.loadTextureImage(t,r.source,a);if(n.extensionsRequired&&n.extensionsRequired.indexOf(e)>=0)throw new Error("THREE.GLTFLoader: AVIF required by asset but unsupported.");return i.loadTexture(t)}))}detectSupport(){return this.isSupported||(this.isSupported=new Promise((function(t){const e=new Image;e.src="data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAABcAAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAEAAAABAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQAMAAAAABNjb2xybmNseAACAAIABoAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAAB9tZGF0EgAKCBgABogQEDQgMgkQAAAAB8dSLfI=",e.onload=e.onerror=function(){t(1===e.height)}}))),this.isSupported}}class Kd{constructor(t){this.name=Ld.EXT_MESHOPT_COMPRESSION,this.parser=t}loadBufferView(t){const e=this.parser.json,i=e.bufferViews[t];if(i.extensions&&i.extensions[this.name]){const t=i.extensions[this.name],n=this.parser.getDependency("buffer",t.buffer),s=this.parser.options.meshoptDecoder;if(!s||!s.supported){if(e.extensionsRequired&&e.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return n.then((function(e){const i=t.byteOffset||0,n=t.byteLength||0,r=t.count,o=t.byteStride,a=new Uint8Array(e,i,n);return s.decodeGltfBufferAsync?s.decodeGltfBufferAsync(r,o,a,t.mode,t.filter).then((function(t){return t.buffer})):s.ready.then((function(){const e=new ArrayBuffer(r*o);return s.decodeGltfBuffer(new Uint8Array(e),r,o,a,t.mode,t.filter),e}))}))}return null}}class Xd{constructor(t){this.name=Ld.EXT_MESH_GPU_INSTANCING,this.parser=t}createNodeMesh(t){const e=this.parser.json,i=e.nodes[t];if(!i.extensions||!i.extensions[this.name]||void 0===i.mesh)return null;const n=e.meshes[i.mesh];for(const t of n.primitives)if(t.mode!==cf.TRIANGLES&&t.mode!==cf.TRIANGLE_STRIP&&t.mode!==cf.TRIANGLE_FAN&&void 0!==t.mode)return null;const s=i.extensions[this.name].attributes,r=[],o={};for(const t in s)r.push(this.parser.getDependency("accessor",s[t]).then((e=>(o[t]=e,o[t]))));return r.length<1?null:(r.push(this.parser.createNodeMesh(t)),Promise.all(r).then((t=>{const e=t.pop(),i=e.isGroup?e.children:[e],n=t[0].count,s=[];for(const t of i){const e=new di,i=new Ne,r=new Ue,a=new Ne(1,1,1),h=new xa(t.geometry,t.material,n);for(let t=0;t<n;t++)o.TRANSLATION&&i.fromBufferAttribute(o.TRANSLATION,t),o.ROTATION&&r.fromBufferAttribute(o.ROTATION,t),o.SCALE&&a.fromBufferAttribute(o.SCALE,t),h.setMatrixAt(t,e.compose(i,r,a));for(const e in o)if("_COLOR_0"===e){const t=o[e];h.instanceColor=new Ea(t.array,t.itemSize,t.normalized)}else"TRANSLATION"!==e&&"ROTATION"!==e&&"SCALE"!==e&&t.geometry.setAttribute(e,o[e]);Oi.prototype.copy.call(h,t),this.parser.assignFinalMaterial(h),s.push(h)}return e.isGroup?(e.clear(),e.add(...s),e):s[0]})))}}const Zd="glTF",$d=1313821514,tf=5130562;class ef{constructor(t){this.name=Ld.KHR_BINARY_GLTF,this.content=null,this.body=null;const e=new DataView(t,0,12),i=new TextDecoder;if(this.header={magic:i.decode(new Uint8Array(t.slice(0,4))),version:e.getUint32(4,!0),length:e.getUint32(8,!0)},this.header.magic!==Zd)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-12,s=new DataView(t,12);let r=0;for(;r<n;){const e=s.getUint32(r,!0);r+=4;const n=s.getUint32(r,!0);if(r+=4,n===$d){const n=new Uint8Array(t,12+r,e);this.content=i.decode(n)}else if(n===tf){const i=12+r;this.body=t.slice(i,i+e)}r+=e}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class nf{constructor(t,e){if(!e)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=Ld.KHR_DRACO_MESH_COMPRESSION,this.json=t,this.dracoLoader=e,this.dracoLoader.preload()}decodePrimitive(t,e){const i=this.json,n=this.dracoLoader,s=t.extensions[this.name].bufferView,r=t.extensions[this.name].attributes,o={},a={},h={};for(const t in r){const e=ff[t]||t.toLowerCase();o[e]=r[t]}for(const e in t.attributes){const n=ff[e]||e.toLowerCase();if(void 0!==r[e]){const s=i.accessors[t.attributes[e]],r=lf[s.componentType];h[n]=r.name,a[n]=!0===s.normalized}}return e.getDependency("bufferView",s).then((function(t){return new Promise((function(e,i){n.decodeDracoFile(t,(function(t){for(const e in t.attributes){const i=t.attributes[e],n=a[e];void 0!==n&&(i.normalized=n)}e(t)}),o,h,Tt,i)}))}))}}class sf{constructor(){this.name=Ld.KHR_TEXTURE_TRANSFORM}extendTexture(t,e){return void 0!==e.texCoord&&e.texCoord!==t.channel||void 0!==e.offset||void 0!==e.rotation||void 0!==e.scale?(t=t.clone(),void 0!==e.texCoord&&(t.channel=e.texCoord),void 0!==e.offset&&t.offset.fromArray(e.offset),void 0!==e.rotation&&(t.rotation=e.rotation),void 0!==e.scale&&t.repeat.fromArray(e.scale),t.needsUpdate=!0,t):t}}class rf{constructor(){this.name=Ld.KHR_MESH_QUANTIZATION}}class of extends ec{constructor(t,e,i,n){super(t,e,i,n)}copySampleValue_(t){const e=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=t*n*3+n;for(let t=0;t!==n;t++)e[t]=i[s+t];return e}interpolate_(t,e,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=2*o,h=3*o,c=n-e,l=(i-e)/c,A=l*l,u=A*l,d=t*h,f=d-h,g=-2*u+3*A,p=u-A,m=1-g,v=p-A+l;for(let t=0;t!==o;t++){const e=r[f+t+o],i=r[f+t+a]*c,n=r[d+t+o],h=r[d+t]*c;s[t]=m*e+v*i+g*n+p*h}return s}}const af=new Ue;class hf extends of{interpolate_(t,e,i,n){const s=super.interpolate_(t,e,i,n);return af.fromArray(s).normalize().toArray(s),s}}const cf={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},lf={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},Af={9728:z,9729:j,9984:1004,9985:J,9986:W,9987:Y},uf={33071:H,33648:V,10497:G},df={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ff={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},gf={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},pf={CUBICSPLINE:void 0,LINEAR:wt,STEP:It},mf="OPAQUE",vf="MASK",bf="BLEND";function Ef(t,e,i){for(const n in i.extensions)void 0===t[n]&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[n]=i.extensions[n])}function Cf(t,e){void 0!==e.extras&&("object"==typeof e.extras?Object.assign(t.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function If(t,e){if(t.updateMorphTargets(),void 0!==e.weights)for(let i=0,n=e.weights.length;i<n;i++)t.morphTargetInfluences[i]=e.weights[i];if(e.extras&&Array.isArray(e.extras.targetNames)){const i=e.extras.targetNames;if(t.morphTargetInfluences.length===i.length){t.morphTargetDictionary={};for(let e=0,n=i.length;e<n;e++)t.morphTargetDictionary[i[e]]=e}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function wf(t){let e;const i=t.extensions&&t.extensions[Ld.KHR_DRACO_MESH_COMPRESSION];if(e=i?"draco:"+i.bufferView+":"+i.indices+":"+_f(i.attributes):t.indices+":"+_f(t.attributes)+":"+t.mode,void 0!==t.targets)for(let i=0,n=t.targets.length;i<n;i++)e+=":"+_f(t.targets[i]);return e}function _f(t){let e="";const i=Object.keys(t).sort();for(let n=0,s=i.length;n<s;n++)e+=i[n]+":"+t[i[n]]+";";return e}function Bf(t){switch(t){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}const Sf=new di;class Mf{constructor(t={},e={}){this.json=t,this.extensions={},this.plugins={},this.options=e,this.cache=new Dd,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let i=!1,n=!1,s=-1;"undefined"!=typeof navigator&&(i=!0===/^((?!chrome|android).)*safari/i.test(navigator.userAgent),n=navigator.userAgent.indexOf("Firefox")>-1,s=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1),"undefined"==typeof createImageBitmap||i||n&&s<98?this.textureLoader=new _c(this.options.manager):this.textureLoader=new Oc(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Cc(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}setExtensions(t){this.extensions=t}setPlugins(t){this.plugins=t}parse(t,e){const i=this,n=this.json,s=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll((function(t){return t._markDefs&&t._markDefs()})),Promise.all(this._invokeAll((function(t){return t.beforeRoot&&t.beforeRoot()}))).then((function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])})).then((function(e){const r={scene:e[0][n.scene||0],scenes:e[0],animations:e[1],cameras:e[2],asset:n.asset,parser:i,userData:{}};return Ef(s,r,n),Cf(r,n),Promise.all(i._invokeAll((function(t){return t.afterRoot&&t.afterRoot(r)}))).then((function(){for(const t of r.scenes)t.updateMatrixWorld();t(r)}))})).catch(e)}_markDefs(){const t=this.json.nodes||[],e=this.json.skins||[],i=this.json.meshes||[];for(let i=0,n=e.length;i<n;i++){const n=e[i].joints;for(let e=0,i=n.length;e<i;e++)t[n[e]].isBone=!0}for(let e=0,n=t.length;e<n;e++){const n=t[e];void 0!==n.mesh&&(this._addNodeRef(this.meshCache,n.mesh),void 0!==n.skin&&(i[n.mesh].isSkinnedMesh=!0)),void 0!==n.camera&&this._addNodeRef(this.cameraCache,n.camera)}}_addNodeRef(t,e){void 0!==e&&(void 0===t.refs[e]&&(t.refs[e]=t.uses[e]=0),t.refs[e]++)}_getNodeRef(t,e,i){if(t.refs[e]<=1)return i;const n=i.clone(),s=(t,e)=>{const i=this.associations.get(t);null!=i&&this.associations.set(e,i);for(const[i,n]of t.children.entries())s(n,e.children[i])};return s(i,n),n.name+="_instance_"+t.uses[e]++,n}_invokeOne(t){const e=Object.values(this.plugins);e.push(this);for(let i=0;i<e.length;i++){const n=t(e[i]);if(n)return n}return null}_invokeAll(t){const e=Object.values(this.plugins);e.unshift(this);const i=[];for(let n=0;n<e.length;n++){const s=t(e[n]);s&&i.push(s)}return i}getDependency(t,e){const i=t+":"+e;let n=this.cache.get(i);if(!n){switch(t){case"scene":n=this.loadScene(e);break;case"node":n=this._invokeOne((function(t){return t.loadNode&&t.loadNode(e)}));break;case"mesh":n=this._invokeOne((function(t){return t.loadMesh&&t.loadMesh(e)}));break;case"accessor":n=this.loadAccessor(e);break;case"bufferView":n=this._invokeOne((function(t){return t.loadBufferView&&t.loadBufferView(e)}));break;case"buffer":n=this.loadBuffer(e);break;case"material":n=this._invokeOne((function(t){return t.loadMaterial&&t.loadMaterial(e)}));break;case"texture":n=this._invokeOne((function(t){return t.loadTexture&&t.loadTexture(e)}));break;case"skin":n=this.loadSkin(e);break;case"animation":n=this._invokeOne((function(t){return t.loadAnimation&&t.loadAnimation(e)}));break;case"camera":n=this.loadCamera(e);break;default:if(n=this._invokeOne((function(i){return i!=this&&i.getDependency&&i.getDependency(t,e)})),!n)throw new Error("Unknown type: "+t)}this.cache.add(i,n)}return n}getDependencies(t){let e=this.cache.get(t);if(!e){const i=this,n=this.json[t+("mesh"===t?"es":"s")]||[];e=Promise.all(n.map((function(e,n){return i.getDependency(t,n)}))),this.cache.add(t,e)}return e}loadBuffer(t){const e=this.json.buffers[t],i=this.fileLoader;if(e.type&&"arraybuffer"!==e.type)throw new Error("THREE.GLTFLoader: "+e.type+" buffer type is not supported.");if(void 0===e.uri&&0===t)return Promise.resolve(this.extensions[Ld.KHR_BINARY_GLTF].body);const n=this.options;return new Promise((function(t,s){i.load(Fc.resolveURL(e.uri,n.path),t,void 0,(function(){s(new Error('THREE.GLTFLoader: Failed to load buffer "'+e.uri+'".'))}))}))}loadBufferView(t){const e=this.json.bufferViews[t];return this.getDependency("buffer",e.buffer).then((function(t){const i=e.byteLength||0,n=e.byteOffset||0;return t.slice(n,n+i)}))}loadAccessor(t){const e=this,i=this.json,n=this.json.accessors[t];if(void 0===n.bufferView&&void 0===n.sparse){const t=df[n.type],e=lf[n.componentType],i=!0===n.normalized,s=new e(n.count*t);return Promise.resolve(new dn(s,t,i))}const s=[];return void 0!==n.bufferView?s.push(this.getDependency("bufferView",n.bufferView)):s.push(null),void 0!==n.sparse&&(s.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(s).then((function(t){const s=t[0],r=df[n.type],o=lf[n.componentType],a=o.BYTES_PER_ELEMENT,h=a*r,c=n.byteOffset||0,l=void 0!==n.bufferView?i.bufferViews[n.bufferView].byteStride:void 0,A=!0===n.normalized;let u,d;if(l&&l!==h){const t=Math.floor(c/l),i="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+t+":"+n.count;let h=e.cache.get(i);h||(u=new o(s,t*l,n.count*l/a),h=new ia(u,l/a),e.cache.add(i,h)),d=new sa(h,r,c%l/a,A)}else u=null===s?new o(n.count*r):new o(s,c,n.count*r),d=new dn(u,r,A);if(void 0!==n.sparse){const e=df.SCALAR,i=lf[n.sparse.indices.componentType],a=n.sparse.indices.byteOffset||0,h=n.sparse.values.byteOffset||0,c=new i(t[1],a,n.sparse.count*e),l=new o(t[2],h,n.sparse.count*r);null!==s&&(d=new dn(d.array.slice(),d.itemSize,d.normalized));for(let t=0,e=c.length;t<e;t++){const e=c[t];if(d.setX(e,l[t*r]),r>=2&&d.setY(e,l[t*r+1]),r>=3&&d.setZ(e,l[t*r+2]),r>=4&&d.setW(e,l[t*r+3]),r>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return d}))}loadTexture(t){const e=this.json,i=this.options,n=e.textures[t].source,s=e.images[n];let r=this.textureLoader;if(s.uri){const t=i.manager.getHandler(s.uri);null!==t&&(r=t)}return this.loadTextureImage(t,n,r)}loadTextureImage(t,e,i){const n=this,s=this.json,r=s.textures[t],o=s.images[e],a=(o.uri||o.bufferView)+":"+r.sampler;if(this.textureCache[a])return this.textureCache[a];const h=this.loadImageSource(e,i).then((function(e){e.flipY=!1,e.name=r.name||o.name||"",""===e.name&&"string"==typeof o.uri&&!1===o.uri.startsWith("data:image/")&&(e.name=o.uri);const i=(s.samplers||{})[r.sampler]||{};return e.magFilter=Af[i.magFilter]||j,e.minFilter=Af[i.minFilter]||Y,e.wrapS=uf[i.wrapS]||G,e.wrapT=uf[i.wrapT]||G,n.associations.set(e,{textures:t}),e})).catch((function(){return null}));return this.textureCache[a]=h,h}loadImageSource(t,e){const i=this,n=this.json,s=this.options;if(void 0!==this.sourceCache[t])return this.sourceCache[t].then((t=>t.clone()));const r=n.images[t],o=self.URL||self.webkitURL;let a=r.uri||"",h=!1;if(void 0!==r.bufferView)a=i.getDependency("bufferView",r.bufferView).then((function(t){h=!0;const e=new Blob([t],{type:r.mimeType});return a=o.createObjectURL(e),a}));else if(void 0===r.uri)throw new Error("THREE.GLTFLoader: Image "+t+" is missing URI and bufferView");const c=Promise.resolve(a).then((function(t){return new Promise((function(i,n){let r=i;!0===e.isImageBitmapLoader&&(r=function(t){const e=new Qe(t);e.needsUpdate=!0,i(e)}),e.load(Fc.resolveURL(t,s.path),r,void 0,n)}))})).then((function(t){var e;return!0===h&&o.revokeObjectURL(a),t.userData.mimeType=r.mimeType||((e=r.uri).search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/)?"image/jpeg":e.search(/\.webp($|\?)/i)>0||0===e.search(/^data\:image\/webp/)?"image/webp":"image/png"),t})).catch((function(t){throw console.error("THREE.GLTFLoader: Couldn't load texture",a),t}));return this.sourceCache[t]=c,c}assignTexture(t,e,i,n){const s=this;return this.getDependency("texture",i.index).then((function(r){if(!r)return null;if(void 0!==i.texCoord&&i.texCoord>0&&((r=r.clone()).channel=i.texCoord),s.extensions[Ld.KHR_TEXTURE_TRANSFORM]){const t=void 0!==i.extensions?i.extensions[Ld.KHR_TEXTURE_TRANSFORM]:void 0;if(t){const e=s.associations.get(r);r=s.extensions[Ld.KHR_TEXTURE_TRANSFORM].extendTexture(r,t),s.associations.set(r,e)}}return void 0!==n&&(r.colorSpace=n),t[e]=r,r}))}assignFinalMaterial(t){const e=t.geometry;let i=t.material;const n=void 0===e.attributes.tangent,s=void 0!==e.attributes.color,r=void 0===e.attributes.normal;if(t.isPoints){const t="PointsMaterial:"+i.uuid;let e=this.cache.get(t);e||(e=new Va,on.prototype.copy.call(e,i),e.color.copy(i.color),e.map=i.map,e.sizeAttenuation=!1,this.cache.add(t,e)),i=e}else if(t.isLine){const t="LineBasicMaterial:"+i.uuid;let e=this.cache.get(t);e||(e=new ya,on.prototype.copy.call(e,i),e.color.copy(i.color),e.map=i.map,this.cache.add(t,e)),i=e}if(n||s||r){let t="ClonedMaterial:"+i.uuid+":";n&&(t+="derivative-tangents:"),s&&(t+="vertex-colors:"),r&&(t+="flat-shading:");let e=this.cache.get(t);e||(e=i.clone(),s&&(e.vertexColors=!0),r&&(e.flatShading=!0),n&&(e.normalScale&&(e.normalScale.y*=-1),e.clearcoatNormalScale&&(e.clearcoatNormalScale.y*=-1)),this.cache.add(t,e),this.associations.set(e,this.associations.get(i))),i=e}t.material=i}getMaterialType(){return Yh}loadMaterial(t){const e=this,i=this.json,n=this.extensions,s=i.materials[t];let r;const o={},a=[];if((s.extensions||{})[Ld.KHR_MATERIALS_UNLIT]){const t=n[Ld.KHR_MATERIALS_UNLIT];r=t.getMaterialType(),a.push(t.extendParams(o,s,e))}else{const i=s.pbrMetallicRoughness||{};if(o.color=new nn(1,1,1),o.opacity=1,Array.isArray(i.baseColorFactor)){const t=i.baseColorFactor;o.color.setRGB(t[0],t[1],t[2],Tt),o.opacity=t[3]}void 0!==i.baseColorTexture&&a.push(e.assignTexture(o,"map",i.baseColorTexture,Qt)),o.metalness=void 0!==i.metallicFactor?i.metallicFactor:1,o.roughness=void 0!==i.roughnessFactor?i.roughnessFactor:1,void 0!==i.metallicRoughnessTexture&&(a.push(e.assignTexture(o,"metalnessMap",i.metallicRoughnessTexture)),a.push(e.assignTexture(o,"roughnessMap",i.metallicRoughnessTexture))),r=this._invokeOne((function(e){return e.getMaterialType&&e.getMaterialType(t)})),a.push(Promise.all(this._invokeAll((function(e){return e.extendMaterialParams&&e.extendMaterialParams(t,o)}))))}!0===s.doubleSided&&(o.side=2);const h=s.alphaMode||mf;if(h===bf?(o.transparent=!0,o.depthWrite=!1):(o.transparent=!1,h===vf&&(o.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&r!==an&&(a.push(e.assignTexture(o,"normalMap",s.normalTexture)),o.normalScale=new ce(1,1),void 0!==s.normalTexture.scale)){const t=s.normalTexture.scale;o.normalScale.set(t,t)}if(void 0!==s.occlusionTexture&&r!==an&&(a.push(e.assignTexture(o,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(o.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&r!==an){const t=s.emissiveFactor;o.emissive=(new nn).setRGB(t[0],t[1],t[2],Tt)}return void 0!==s.emissiveTexture&&r!==an&&a.push(e.assignTexture(o,"emissiveMap",s.emissiveTexture,Qt)),Promise.all(a).then((function(){const i=new r(o);return s.name&&(i.name=s.name),Cf(i,s),e.associations.set(i,{materials:t}),s.extensions&&Ef(n,i,s),i}))}createUniqueName(t){const e=Jc.sanitizeNodeName(t||"");return e in this.nodeNamesUsed?e+"_"+ ++this.nodeNamesUsed[e]:(this.nodeNamesUsed[e]=0,e)}loadGeometries(t){const e=this,i=this.extensions,n=this.primitiveCache;function s(t){return i[Ld.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(t,e).then((function(i){return xf(i,t,e)}))}const r=[];for(let i=0,o=t.length;i<o;i++){const o=t[i],a=wf(o),h=n[a];if(h)r.push(h.promise);else{let t;t=o.extensions&&o.extensions[Ld.KHR_DRACO_MESH_COMPRESSION]?s(o):xf(new _n,o,e),n[a]={primitive:o,promise:t},r.push(t)}}return Promise.all(r)}loadMesh(t){const e=this,i=this.json,n=this.extensions,r=i.meshes[t],o=r.primitives,a=[];for(let t=0,e=o.length;t<e;t++){const e=void 0===o[t].material?(void 0===(h=this.cache).DefaultMaterial&&(h.DefaultMaterial=new Yh({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:s})),h.DefaultMaterial):this.getDependency("material",o[t].material);a.push(e)}var h;return a.push(e.loadGeometries(o)),Promise.all(a).then((function(i){const s=i.slice(0,i.length-1),a=i[i.length-1],h=[];for(let i=0,c=a.length;i<c;i++){const c=a[i],l=o[i];let A;const u=s[i];if(l.mode===cf.TRIANGLES||l.mode===cf.TRIANGLE_STRIP||l.mode===cf.TRIANGLE_FAN||void 0===l.mode)A=!0===r.isSkinnedMesh?new fa(c,u):new Hn(c,u),!0===A.isSkinnedMesh&&A.normalizeSkinWeights(),l.mode===cf.TRIANGLE_STRIP?A.geometry=Qd(A.geometry,1):l.mode===cf.TRIANGLE_FAN&&(A.geometry=Qd(A.geometry,2));else if(l.mode===cf.LINES)A=new Ga(c,u);else if(l.mode===cf.LINE_STRIP)A=new Na(c,u);else if(l.mode===cf.LINE_LOOP)A=new Ha(c,u);else{if(l.mode!==cf.POINTS)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+l.mode);A=new Ja(c,u)}Object.keys(A.geometry.morphAttributes).length>0&&If(A,r),A.name=e.createUniqueName(r.name||"mesh_"+t),Cf(A,r),l.extensions&&Ef(n,A,l),e.assignFinalMaterial(A),h.push(A)}for(let i=0,n=h.length;i<n;i++)e.associations.set(h[i],{meshes:t,primitives:i});if(1===h.length)return r.extensions&&Ef(n,h[0],r),h[0];const c=new qo;r.extensions&&Ef(n,c,r),e.associations.set(c,{meshes:t});for(let t=0,e=h.length;t<e;t++)c.add(h[t]);return c}))}loadCamera(t){let e;const i=this.json.cameras[t],n=i[i.type];if(n)return"perspective"===i.type?e=new ts(he.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):"orthographic"===i.type&&(e=new Ms(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),i.name&&(e.name=this.createUniqueName(i.name)),Cf(e,i),Promise.resolve(e);console.warn("THREE.GLTFLoader: Missing camera parameters.")}loadSkin(t){const e=this.json.skins[t],i=[];for(let t=0,n=e.joints.length;t<n;t++)i.push(this._loadNodeShallow(e.joints[t]));return void 0!==e.inverseBindMatrices?i.push(this.getDependency("accessor",e.inverseBindMatrices)):i.push(null),Promise.all(i).then((function(t){const i=t.pop(),n=t,s=[],r=[];for(let t=0,o=n.length;t<o;t++){const o=n[t];if(o){s.push(o);const e=new di;null!==i&&e.fromArray(i.array,16*t),r.push(e)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',e.joints[t])}return new ba(s,r)}))}loadAnimation(t){const e=this.json,i=this,n=e.animations[t],s=n.name?n.name:"animation_"+t,r=[],o=[],a=[],h=[],c=[];for(let t=0,e=n.channels.length;t<e;t++){const e=n.channels[t],i=n.samplers[e.sampler],s=e.target,l=s.node,A=void 0!==n.parameters?n.parameters[i.input]:i.input,u=void 0!==n.parameters?n.parameters[i.output]:i.output;void 0!==s.node&&(r.push(this.getDependency("node",l)),o.push(this.getDependency("accessor",A)),a.push(this.getDependency("accessor",u)),h.push(i),c.push(s))}return Promise.all([Promise.all(r),Promise.all(o),Promise.all(a),Promise.all(h),Promise.all(c)]).then((function(t){const e=t[0],n=t[1],r=t[2],o=t[3],a=t[4],h=[];for(let t=0,s=e.length;t<s;t++){const s=e[t],c=n[t],l=r[t],A=o[t],u=a[t];if(void 0===s)continue;s.updateMatrix&&s.updateMatrix();const d=i._createAnimationTracks(s,c,l,A,u);if(d)for(let t=0;t<d.length;t++)h.push(d[t])}return new dc(s,void 0,h)}))}createNodeMesh(t){const e=this.json,i=this,n=e.nodes[t];return void 0===n.mesh?null:i.getDependency("mesh",n.mesh).then((function(t){const e=i._getNodeRef(i.meshCache,n.mesh,t);return void 0!==n.weights&&e.traverse((function(t){if(t.isMesh)for(let e=0,i=n.weights.length;e<i;e++)t.morphTargetInfluences[e]=n.weights[e]})),e}))}loadNode(t){const e=this,i=this.json.nodes[t],n=e._loadNodeShallow(t),s=[],r=i.children||[];for(let t=0,i=r.length;t<i;t++)s.push(e.getDependency("node",r[t]));const o=void 0===i.skin?Promise.resolve(null):e.getDependency("skin",i.skin);return Promise.all([n,Promise.all(s),o]).then((function(t){const e=t[0],i=t[1],n=t[2];null!==n&&e.traverse((function(t){t.isSkinnedMesh&&t.bind(n,Sf)}));for(let t=0,n=i.length;t<n;t++)e.add(i[t]);return e}))}_loadNodeShallow(t){const e=this.json,i=this.extensions,n=this;if(void 0!==this.nodeCache[t])return this.nodeCache[t];const s=e.nodes[t],r=s.name?n.createUniqueName(s.name):"",o=[],a=n._invokeOne((function(e){return e.createNodeMesh&&e.createNodeMesh(t)}));return a&&o.push(a),void 0!==s.camera&&o.push(n.getDependency("camera",s.camera).then((function(t){return n._getNodeRef(n.cameraCache,s.camera,t)}))),n._invokeAll((function(e){return e.createNodeAttachment&&e.createNodeAttachment(t)})).forEach((function(t){o.push(t)})),this.nodeCache[t]=Promise.all(o).then((function(e){let o;if(o=!0===s.isBone?new ga:e.length>1?new qo:1===e.length?e[0]:new Oi,o!==e[0])for(let t=0,i=e.length;t<i;t++)o.add(e[t]);if(s.name&&(o.userData.name=s.name,o.name=r),Cf(o,s),s.extensions&&Ef(i,o,s),void 0!==s.matrix){const t=new di;t.fromArray(s.matrix),o.applyMatrix4(t)}else void 0!==s.translation&&o.position.fromArray(s.translation),void 0!==s.rotation&&o.quaternion.fromArray(s.rotation),void 0!==s.scale&&o.scale.fromArray(s.scale);return n.associations.has(o)||n.associations.set(o,{}),n.associations.get(o).nodes=t,o})),this.nodeCache[t]}loadScene(t){const e=this.extensions,i=this.json.scenes[t],n=this,s=new qo;i.name&&(s.name=n.createUniqueName(i.name)),Cf(s,i),i.extensions&&Ef(e,s,i);const r=i.nodes||[],o=[];for(let t=0,e=r.length;t<e;t++)o.push(n.getDependency("node",r[t]));return Promise.all(o).then((function(t){for(let e=0,i=t.length;e<i;e++)s.add(t[e]);return n.associations=(t=>{const e=new Map;for(const[t,i]of n.associations)(t instanceof on||t instanceof Qe)&&e.set(t,i);return t.traverse((t=>{const i=n.associations.get(t);null!=i&&e.set(t,i)})),e})(s),s}))}_createAnimationTracks(t,e,i,n,s){const r=[],o=t.name?t.name:t.uuid,a=[];let h;switch(gf[s.path]===gf.weights?t.traverse((function(t){t.morphTargetInfluences&&a.push(t.name?t.name:t.uuid)})):a.push(o),gf[s.path]){case gf.weights:h=hc;break;case gf.rotation:h=lc;break;case gf.position:case gf.scale:h=uc;break;default:if(1===i.itemSize)h=hc;else h=uc}const c=void 0!==n.interpolation?pf[n.interpolation]:wt,l=this._getArrayFromAccessor(i);for(let t=0,i=a.length;t<i;t++){const i=new h(a[t]+"."+gf[s.path],e.array,l,c);"CUBICSPLINE"===n.interpolation&&this._createCubicSplineTrackInterpolant(i),r.push(i)}return r}_getArrayFromAccessor(t){let e=t.array;if(t.normalized){const t=Bf(e.constructor),i=new Float32Array(e.length);for(let n=0,s=e.length;n<s;n++)i[n]=e[n]*t;e=i}return e}_createCubicSplineTrackInterpolant(t){t.createInterpolant=function(t){return new(this instanceof lc?hf:of)(this.times,this.values,this.getValueSize()/3,t)},t.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function xf(t,e,i){const n=e.attributes,s=[];function r(e,n){return i.getDependency("accessor",e).then((function(e){t.setAttribute(n,e)}))}for(const e in n){const i=ff[e]||e.toLowerCase();i in t.attributes||s.push(r(n[e],i))}if(void 0!==e.indices&&!t.index){const n=i.getDependency("accessor",e.indices).then((function(e){t.setIndex(e)}));s.push(n)}return Ce.workingColorSpace!==Tt&&"COLOR_0"in n&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${Ce.workingColorSpace}" not supported.`),Cf(t,e),function(t,e,i){const n=e.attributes,s=new Oe;if(void 0===n.POSITION)return;{const t=i.json.accessors[n.POSITION],e=t.min,r=t.max;if(void 0===e||void 0===r)return void console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");if(s.set(new Ne(e[0],e[1],e[2]),new Ne(r[0],r[1],r[2])),t.normalized){const e=Bf(lf[t.componentType]);s.min.multiplyScalar(e),s.max.multiplyScalar(e)}}const r=e.targets;if(void 0!==r){const t=new Ne,e=new Ne;for(let n=0,s=r.length;n<s;n++){const s=r[n];if(void 0!==s.POSITION){const n=i.json.accessors[s.POSITION],r=n.min,o=n.max;if(void 0!==r&&void 0!==o){if(e.setX(Math.max(Math.abs(r[0]),Math.abs(o[0]))),e.setY(Math.max(Math.abs(r[1]),Math.abs(o[1]))),e.setZ(Math.max(Math.abs(r[2]),Math.abs(o[2]))),n.normalized){const t=Bf(lf[n.componentType]);e.multiplyScalar(t)}t.max(e)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}s.expandByVector(t)}t.boundingBox=s;const o=new si;s.getCenter(o.center),o.radius=s.min.distanceTo(s.max)/2,t.boundingSphere=o}(t,e,i),Promise.all(s).then((function(){return void 0!==e.targets?function(t,e,i){let n=!1,s=!1,r=!1;for(let t=0,i=e.length;t<i;t++){const i=e[t];if(void 0!==i.POSITION&&(n=!0),void 0!==i.NORMAL&&(s=!0),void 0!==i.COLOR_0&&(r=!0),n&&s&&r)break}if(!n&&!s&&!r)return Promise.resolve(t);const o=[],a=[],h=[];for(let c=0,l=e.length;c<l;c++){const l=e[c];if(n){const e=void 0!==l.POSITION?i.getDependency("accessor",l.POSITION):t.attributes.position;o.push(e)}if(s){const e=void 0!==l.NORMAL?i.getDependency("accessor",l.NORMAL):t.attributes.normal;a.push(e)}if(r){const e=void 0!==l.COLOR_0?i.getDependency("accessor",l.COLOR_0):t.attributes.color;h.push(e)}}return Promise.all([Promise.all(o),Promise.all(a),Promise.all(h)]).then((function(e){const i=e[0],o=e[1],a=e[2];return n&&(t.morphAttributes.position=i),s&&(t.morphAttributes.normal=o),r&&(t.morphAttributes.color=a),t.morphTargetsRelative=!0,t}))}(t,e.targets,i):t}))}const yf=new WeakMap;class Qf extends vc{constructor(t){super(t),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(t){return this.decoderPath=t,this}setDecoderConfig(t){return this.decoderConfig=t,this}setWorkerLimit(t){return this.workerLimit=t,this}load(t,e,i,n){const s=new Cc(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials),s.load(t,(t=>{this.parse(t,e,n)}),i,n)}parse(t,e,i=(()=>{})){this.decodeDracoFile(t,e,null,null,Qt).catch(i)}decodeDracoFile(t,e,i,n,s=Tt,r=(()=>{})){const o={attributeIDs:i||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!i,vertexColorSpace:s};return this.decodeGeometry(t,o).then(e).catch(r)}decodeGeometry(t,e){const i=JSON.stringify(e);if(yf.has(t)){const e=yf.get(t);if(e.key===i)return e.promise;if(0===t.byteLength)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const s=this.workerNextTaskID++,r=t.byteLength,o=this._getWorker(s,r).then((i=>(n=i,new Promise(((i,r)=>{n._callbacks[s]={resolve:i,reject:r},n.postMessage({type:"decode",id:s,taskConfig:e,buffer:t},[t])}))))).then((t=>this._createGeometry(t.geometry)));return o.catch((()=>!0)).then((()=>{n&&s&&this._releaseTask(n,s)})),yf.set(t,{key:i,promise:o}),o}_createGeometry(t){const e=new _n;t.index&&e.setIndex(new dn(t.index.array,1));for(let i=0;i<t.attributes.length;i++){const n=t.attributes[i],s=n.name,r=n.array,o=n.itemSize,a=new dn(r,o);"color"===s&&(this._assignVertexColorSpace(a,n.vertexColorSpace),a.normalized=r instanceof Float32Array==!1),e.setAttribute(s,a)}return e}_assignVertexColorSpace(t,e){if(e!==Qt)return;const i=new nn;for(let e=0,n=t.count;e<n;e++)i.fromBufferAttribute(t,e).convertSRGBToLinear(),t.setXYZ(e,i.r,i.g,i.b)}_loadLibrary(t,e){const i=new Cc(this.manager);return i.setPath(this.decoderPath),i.setResponseType(e),i.setWithCredentials(this.withCredentials),new Promise(((e,n)=>{i.load(t,e,void 0,n)}))}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const t="object"!=typeof WebAssembly||"js"===this.decoderConfig.type,e=[];return t?e.push(this._loadLibrary("draco_decoder.js","text")):(e.push(this._loadLibrary("draco_wasm_wrapper.js","text")),e.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(e).then((e=>{const i=e[0];t||(this.decoderConfig.wasmBinary=e[1]);const n=Tf.toString(),s=["/* draco decoder */",i,"","/* worker */",n.substring(n.indexOf("{")+1,n.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([s]))})),this.decoderPending}_getWorker(t,e){return this._initDecoder().then((()=>{if(this.workerPool.length<this.workerLimit){const t=new Worker(this.workerSourceURL);t._callbacks={},t._taskCosts={},t._taskLoad=0,t.postMessage({type:"init",decoderConfig:this.decoderConfig}),t.onmessage=function(e){const i=e.data;switch(i.type){case"decode":t._callbacks[i.id].resolve(i);break;case"error":t._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(t)}else this.workerPool.sort((function(t,e){return t._taskLoad>e._taskLoad?-1:1}));const i=this.workerPool[this.workerPool.length-1];return i._taskCosts[t]=e,i._taskLoad+=e,i}))}_releaseTask(t,e){t._taskLoad-=t._taskCosts[e],delete t._callbacks[e],delete t._taskCosts[e]}debug(){console.log("Task load: ",this.workerPool.map((t=>t._taskLoad)))}dispose(){for(let t=0;t<this.workerPool.length;++t)this.workerPool[t].terminate();return this.workerPool.length=0,""!==this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),this}}function Tf(){let t,e;function i(t,e,i,n,s,r){const o=r.num_components(),a=i.num_points()*o,h=a*s.BYTES_PER_ELEMENT,c=function(t,e){switch(e){case Float32Array:return t.DT_FLOAT32;case Int8Array:return t.DT_INT8;case Int16Array:return t.DT_INT16;case Int32Array:return t.DT_INT32;case Uint8Array:return t.DT_UINT8;case Uint16Array:return t.DT_UINT16;case Uint32Array:return t.DT_UINT32}}(t,s),l=t._malloc(h);e.GetAttributeDataArrayForAllPoints(i,r,c,h,l);const A=new s(t.HEAPF32.buffer,l,a).slice();return t._free(l),{name:n,array:A,itemSize:o}}onmessage=function(n){const s=n.data;switch(s.type){case"init":t=s.decoderConfig,e=new Promise((function(e){t.onModuleLoaded=function(t){e({draco:t})},DracoDecoderModule(t)}));break;case"decode":const n=s.buffer,r=s.taskConfig;e.then((t=>{const e=t.draco,o=new e.Decoder;try{const t=function(t,e,n,s){const r=s.attributeIDs,o=s.attributeTypes;let a,h;const c=e.GetEncodedGeometryType(n);if(c===t.TRIANGULAR_MESH)a=new t.Mesh,h=e.DecodeArrayToMesh(n,n.byteLength,a);else{if(c!==t.POINT_CLOUD)throw new Error("THREE.DRACOLoader: Unexpected geometry type.");a=new t.PointCloud,h=e.DecodeArrayToPointCloud(n,n.byteLength,a)}if(!h.ok()||0===a.ptr)throw new Error("THREE.DRACOLoader: Decoding failed: "+h.error_msg());const l={index:null,attributes:[]};for(const n in r){const h=self[o[n]];let c,A;if(s.useUniqueIDs)A=r[n],c=e.GetAttributeByUniqueId(a,A);else{if(A=e.GetAttributeId(a,t[r[n]]),-1===A)continue;c=e.GetAttribute(a,A)}const u=i(t,e,a,n,h,c);"color"===n&&(u.vertexColorSpace=s.vertexColorSpace),l.attributes.push(u)}c===t.TRIANGULAR_MESH&&(l.index=function(t,e,i){const n=i.num_faces(),s=3*n,r=4*s,o=t._malloc(r);e.GetTrianglesUInt32Array(i,r,o);const a=new Uint32Array(t.HEAPF32.buffer,o,s).slice();return t._free(o),{array:a,itemSize:1}}(t,e,a));return t.destroy(a),l}(e,o,new Int8Array(n),r),a=t.attributes.map((t=>t.array.buffer));t.index&&a.push(t.index.array.buffer),self.postMessage({type:"decode",id:s.id,geometry:t},a)}catch(t){console.error(t),self.postMessage({type:"error",id:s.id,error:t.message})}finally{e.destroy(o)}}))}}}class Df{constructor(t=4){this.pool=t,this.queue=[],this.workers=[],this.workersResolve=[],this.workerStatus=0}_initWorker(t){if(!this.workers[t]){const e=this.workerCreator();e.addEventListener("message",this._onMessage.bind(this,t)),this.workers[t]=e}}_getIdleWorker(){for(let t=0;t<this.pool;t++)if(!(this.workerStatus&1<<t))return t;return-1}_onMessage(t,e){const i=this.workersResolve[t];if(i&&i(e),this.queue.length){const{resolve:e,msg:i,transfer:n}=this.queue.shift();this.workersResolve[t]=e,this.workers[t].postMessage(i,n)}else this.workerStatus^=1<<t}setWorkerCreator(t){this.workerCreator=t}setWorkerLimit(t){this.pool=t}postMessage(t,e){return new Promise((i=>{const n=this._getIdleWorker();-1!==n?(this._initWorker(n),this.workerStatus|=1<<n,this.workersResolve[n]=i,this.workers[n].postMessage(t,e)):this.queue.push({resolve:i,msg:t,transfer:e})}))}dispose(){this.workers.forEach((t=>t.terminate())),this.workersResolve.length=0,this.workers.length=0,this.queue.length=0,this.workerStatus=0}}const Lf=2,Rf=0,Pf=1,Uf=10,Nf=9,kf=15,Ff=16,Of=22,Gf=37,Hf=43,Vf=76,zf=83,qf=97,Wf=100,jf=103,Jf=109,Yf=165,Kf=166;class Xf{constructor(){this.vkFormat=0,this.typeSize=1,this.pixelWidth=0,this.pixelHeight=0,this.pixelDepth=0,this.layerCount=0,this.faceCount=1,this.supercompressionScheme=0,this.levels=[],this.dataFormatDescriptor=[{vendorId:0,descriptorType:0,descriptorBlockSize:0,versionNumber:2,colorModel:0,colorPrimaries:1,transferFunction:2,flags:0,texelBlockDimension:[0,0,0,0],bytesPlane:[0,0,0,0,0,0,0,0],samples:[]}],this.keyValue={},this.globalData=null}}class Zf{constructor(t,e,i,n){this._dataView=new DataView(t.buffer,t.byteOffset+e,i),this._littleEndian=n,this._offset=0}_nextUint8(){const t=this._dataView.getUint8(this._offset);return this._offset+=1,t}_nextUint16(){const t=this._dataView.getUint16(this._offset,this._littleEndian);return this._offset+=2,t}_nextUint32(){const t=this._dataView.getUint32(this._offset,this._littleEndian);return this._offset+=4,t}_nextUint64(){const t=this._dataView.getUint32(this._offset,this._littleEndian)+2**32*this._dataView.getUint32(this._offset+4,this._littleEndian);return this._offset+=8,t}_nextInt32(){const t=this._dataView.getInt32(this._offset,this._littleEndian);return this._offset+=4,t}_skip(t){return this._offset+=t,this}_scan(t,e=0){const i=this._offset;let n=0;for(;this._dataView.getUint8(this._offset)!==e&&n<t;)n++,this._offset++;return n<t&&this._offset++,new Uint8Array(this._dataView.buffer,this._dataView.byteOffset+i,n)}}const $f=[171,75,84,88,32,50,48,187,13,10,26,10];function tg(t){return"undefined"!=typeof TextDecoder?(new TextDecoder).decode(t):Buffer.from(t).toString("utf8")}let eg,ig,ng;const sg={env:{emscripten_notify_memory_growth:function(t){ng=new Uint8Array(ig.exports.memory.buffer)}}};class rg{init(){return eg||(eg="undefined"!=typeof fetch?fetch("data:application/wasm;base64,"+og).then((t=>t.arrayBuffer())).then((t=>WebAssembly.instantiate(t,sg))).then(this._init):WebAssembly.instantiate(Buffer.from(og,"base64"),sg).then(this._init),eg)}_init(t){ig=t.instance,sg.env.emscripten_notify_memory_growth(0)}decode(t,e=0){if(!ig)throw new Error("ZSTDDecoder: Await .init() before decoding.");const i=t.byteLength,n=ig.exports.malloc(i);ng.set(t,n),e=e||Number(ig.exports.ZSTD_findDecompressedSize(n,i));const s=ig.exports.malloc(e),r=ig.exports.ZSTD_decompress(s,e,n,i),o=ng.slice(s,s+r);return ig.exports.free(n),ig.exports.free(s),o}}const og="AGFzbQEAAAABpQEVYAF/AX9gAn9/AGADf39/AX9gBX9/f39/AX9gAX8AYAJ/fwF/YAR/f39/AX9gA39/fwBgBn9/f39/fwF/YAd/f39/f39/AX9gAn9/AX5gAn5+AX5gAABgBX9/f39/AGAGf39/f39/AGAIf39/f39/f38AYAl/f39/f39/f38AYAABf2AIf39/f39/f38Bf2ANf39/f39/f39/f39/fwF/YAF/AX4CJwEDZW52H2Vtc2NyaXB0ZW5fbm90aWZ5X21lbW9yeV9ncm93dGgABANpaAEFAAAFAgEFCwACAQABAgIFBQcAAwABDgsBAQcAEhMHAAUBDAQEAAANBwQCAgYCBAgDAwMDBgEACQkHBgICAAYGAgQUBwYGAwIGAAMCAQgBBwUGCgoEEQAEBAEIAwgDBQgDEA8IAAcABAUBcAECAgUEAQCAAgYJAX8BQaCgwAILB2AHBm1lbW9yeQIABm1hbGxvYwAoBGZyZWUAJgxaU1REX2lzRXJyb3IAaBlaU1REX2ZpbmREZWNvbXByZXNzZWRTaXplAFQPWlNURF9kZWNvbXByZXNzAEoGX3N0YXJ0ACQJBwEAQQELASQKussBaA8AIAAgACgCBCABajYCBAsZACAAKAIAIAAoAgRBH3F0QQAgAWtBH3F2CwgAIABBiH9LC34BBH9BAyEBIAAoAgQiA0EgTQRAIAAoAggiASAAKAIQTwRAIAAQDQ8LIAAoAgwiAiABRgRAQQFBAiADQSBJGw8LIAAgASABIAJrIANBA3YiBCABIARrIAJJIgEbIgJrIgQ2AgggACADIAJBA3RrNgIEIAAgBCgAADYCAAsgAQsUAQF/IAAgARACIQIgACABEAEgAgv3AQECfyACRQRAIABCADcCACAAQQA2AhAgAEIANwIIQbh/DwsgACABNgIMIAAgAUEEajYCECACQQRPBEAgACABIAJqIgFBfGoiAzYCCCAAIAMoAAA2AgAgAUF/ai0AACIBBEAgAEEIIAEQFGs2AgQgAg8LIABBADYCBEF/DwsgACABNgIIIAAgAS0AACIDNgIAIAJBfmoiBEEBTQRAIARBAWtFBEAgACABLQACQRB0IANyIgM2AgALIAAgAS0AAUEIdCADajYCAAsgASACakF/ai0AACIBRQRAIABBADYCBEFsDwsgAEEoIAEQFCACQQN0ams2AgQgAgsWACAAIAEpAAA3AAAgACABKQAINwAICy8BAX8gAUECdEGgHWooAgAgACgCAEEgIAEgACgCBGprQR9xdnEhAiAAIAEQASACCyEAIAFCz9bTvtLHq9lCfiAAfEIfiUKHla+vmLbem55/fgsdAQF/IAAoAgggACgCDEYEfyAAKAIEQSBGBUEACwuCBAEDfyACQYDAAE8EQCAAIAEgAhBnIAAPCyAAIAJqIQMCQCAAIAFzQQNxRQRAAkAgAkEBSARAIAAhAgwBCyAAQQNxRQRAIAAhAgwBCyAAIQIDQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADTw0BIAJBA3ENAAsLAkAgA0F8cSIEQcAASQ0AIAIgBEFAaiIFSw0AA0AgAiABKAIANgIAIAIgASgCBDYCBCACIAEoAgg2AgggAiABKAIMNgIMIAIgASgCEDYCECACIAEoAhQ2AhQgAiABKAIYNgIYIAIgASgCHDYCHCACIAEoAiA2AiAgAiABKAIkNgIkIAIgASgCKDYCKCACIAEoAiw2AiwgAiABKAIwNgIwIAIgASgCNDYCNCACIAEoAjg2AjggAiABKAI8NgI8IAFBQGshASACQUBrIgIgBU0NAAsLIAIgBE8NAQNAIAIgASgCADYCACABQQRqIQEgAkEEaiICIARJDQALDAELIANBBEkEQCAAIQIMAQsgA0F8aiIEIABJBEAgACECDAELIAAhAgNAIAIgAS0AADoAACACIAEtAAE6AAEgAiABLQACOgACIAIgAS0AAzoAAyABQQRqIQEgAkEEaiICIARNDQALCyACIANJBEADQCACIAEtAAA6AAAgAUEBaiEBIAJBAWoiAiADRw0ACwsgAAsMACAAIAEpAAA3AAALQQECfyAAKAIIIgEgACgCEEkEQEEDDwsgACAAKAIEIgJBB3E2AgQgACABIAJBA3ZrIgE2AgggACABKAAANgIAQQALDAAgACABKAIANgAAC/cCAQJ/AkAgACABRg0AAkAgASACaiAASwRAIAAgAmoiBCABSw0BCyAAIAEgAhALDwsgACABc0EDcSEDAkACQCAAIAFJBEAgAwRAIAAhAwwDCyAAQQNxRQRAIAAhAwwCCyAAIQMDQCACRQ0EIAMgAS0AADoAACABQQFqIQEgAkF/aiECIANBAWoiA0EDcQ0ACwwBCwJAIAMNACAEQQNxBEADQCACRQ0FIAAgAkF/aiICaiIDIAEgAmotAAA6AAAgA0EDcQ0ACwsgAkEDTQ0AA0AgACACQXxqIgJqIAEgAmooAgA2AgAgAkEDSw0ACwsgAkUNAgNAIAAgAkF/aiICaiABIAJqLQAAOgAAIAINAAsMAgsgAkEDTQ0AIAIhBANAIAMgASgCADYCACABQQRqIQEgA0EEaiEDIARBfGoiBEEDSw0ACyACQQNxIQILIAJFDQADQCADIAEtAAA6AAAgA0EBaiEDIAFBAWohASACQX9qIgINAAsLIAAL8wICAn8BfgJAIAJFDQAgACACaiIDQX9qIAE6AAAgACABOgAAIAJBA0kNACADQX5qIAE6AAAgACABOgABIANBfWogAToAACAAIAE6AAIgAkEHSQ0AIANBfGogAToAACAAIAE6AAMgAkEJSQ0AIABBACAAa0EDcSIEaiIDIAFB/wFxQYGChAhsIgE2AgAgAyACIARrQXxxIgRqIgJBfGogATYCACAEQQlJDQAgAyABNgIIIAMgATYCBCACQXhqIAE2AgAgAkF0aiABNgIAIARBGUkNACADIAE2AhggAyABNgIUIAMgATYCECADIAE2AgwgAkFwaiABNgIAIAJBbGogATYCACACQWhqIAE2AgAgAkFkaiABNgIAIAQgA0EEcUEYciIEayICQSBJDQAgAa0iBUIghiAFhCEFIAMgBGohAQNAIAEgBTcDGCABIAU3AxAgASAFNwMIIAEgBTcDACABQSBqIQEgAkFgaiICQR9LDQALCyAACy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAIajYCACADCy8BAn8gACgCBCAAKAIAQQJ0aiICLQACIQMgACACLwEAIAEgAi0AAxAFajYCACADCx8AIAAgASACKAIEEAg2AgAgARAEGiAAIAJBCGo2AgQLCAAgAGdBH3MLugUBDX8jAEEQayIKJAACfyAEQQNNBEAgCkEANgIMIApBDGogAyAEEAsaIAAgASACIApBDGpBBBAVIgBBbCAAEAMbIAAgACAESxsMAQsgAEEAIAEoAgBBAXRBAmoQECENQVQgAygAACIGQQ9xIgBBCksNABogAiAAQQVqNgIAIAMgBGoiAkF8aiEMIAJBeWohDiACQXtqIRAgAEEGaiELQQQhBSAGQQR2IQRBICAAdCIAQQFyIQkgASgCACEPQQAhAiADIQYCQANAIAlBAkggAiAPS3JFBEAgAiEHAkAgCARAA0AgBEH//wNxQf//A0YEQCAHQRhqIQcgBiAQSQR/IAZBAmoiBigAACAFdgUgBUEQaiEFIARBEHYLIQQMAQsLA0AgBEEDcSIIQQNGBEAgBUECaiEFIARBAnYhBCAHQQNqIQcMAQsLIAcgCGoiByAPSw0EIAVBAmohBQNAIAIgB0kEQCANIAJBAXRqQQA7AQAgAkEBaiECDAELCyAGIA5LQQAgBiAFQQN1aiIHIAxLG0UEQCAHKAAAIAVBB3EiBXYhBAwCCyAEQQJ2IQQLIAYhBwsCfyALQX9qIAQgAEF/anEiBiAAQQF0QX9qIgggCWsiEUkNABogBCAIcSIEQQAgESAEIABIG2shBiALCyEIIA0gAkEBdGogBkF/aiIEOwEAIAlBASAGayAEIAZBAUgbayEJA0AgCSAASARAIABBAXUhACALQX9qIQsMAQsLAn8gByAOS0EAIAcgBSAIaiIFQQN1aiIGIAxLG0UEQCAFQQdxDAELIAUgDCIGIAdrQQN0awshBSACQQFqIQIgBEUhCCAGKAAAIAVBH3F2IQQMAQsLQWwgCUEBRyAFQSBKcg0BGiABIAJBf2o2AgAgBiAFQQdqQQN1aiADawwBC0FQCyEAIApBEGokACAACwkAQQFBBSAAGwsMACAAIAEoAAA2AAALqgMBCn8jAEHwAGsiCiQAIAJBAWohDiAAQQhqIQtBgIAEIAVBf2p0QRB1IQxBACECQQEhBkEBIAV0IglBf2oiDyEIA0AgAiAORkUEQAJAIAEgAkEBdCINai8BACIHQf//A0YEQCALIAhBA3RqIAI2AgQgCEF/aiEIQQEhBwwBCyAGQQAgDCAHQRB0QRB1ShshBgsgCiANaiAHOwEAIAJBAWohAgwBCwsgACAFNgIEIAAgBjYCACAJQQN2IAlBAXZqQQNqIQxBACEAQQAhBkEAIQIDQCAGIA5GBEADQAJAIAAgCUYNACAKIAsgAEEDdGoiASgCBCIGQQF0aiICIAIvAQAiAkEBajsBACABIAUgAhAUayIIOgADIAEgAiAIQf8BcXQgCWs7AQAgASAEIAZBAnQiAmooAgA6AAIgASACIANqKAIANgIEIABBAWohAAwBCwsFIAEgBkEBdGouAQAhDUEAIQcDQCAHIA1ORQRAIAsgAkEDdGogBjYCBANAIAIgDGogD3EiAiAISw0ACyAHQQFqIQcMAQsLIAZBAWohBgwBCwsgCkHwAGokAAsjAEIAIAEQCSAAhUKHla+vmLbem55/fkLj3MqV/M7y9YV/fAsQACAAQn43AwggACABNgIACyQBAX8gAARAIAEoAgQiAgRAIAEoAgggACACEQEADwsgABAmCwsfACAAIAEgAi8BABAINgIAIAEQBBogACACQQRqNgIEC0oBAX9BoCAoAgAiASAAaiIAQX9MBEBBiCBBMDYCAEF/DwsCQCAAPwBBEHRNDQAgABBmDQBBiCBBMDYCAEF/DwtBoCAgADYCACABC9cBAQh/Qbp/IQoCQCACKAIEIgggAigCACIJaiIOIAEgAGtLDQBBbCEKIAkgBCADKAIAIgtrSw0AIAAgCWoiBCACKAIIIgxrIQ0gACABQWBqIg8gCyAJQQAQKSADIAkgC2o2AgACQAJAIAwgBCAFa00EQCANIQUMAQsgDCAEIAZrSw0CIAcgDSAFayIAaiIBIAhqIAdNBEAgBCABIAgQDxoMAgsgBCABQQAgAGsQDyEBIAIgACAIaiIINgIEIAEgAGshBAsgBCAPIAUgCEEBECkLIA4hCgsgCgubAgEBfyMAQYABayINJAAgDSADNgJ8AkAgAkEDSwRAQX8hCQwBCwJAAkACQAJAIAJBAWsOAwADAgELIAZFBEBBuH8hCQwEC0FsIQkgBS0AACICIANLDQMgACAHIAJBAnQiAmooAgAgAiAIaigCABA7IAEgADYCAEEBIQkMAwsgASAJNgIAQQAhCQwCCyAKRQRAQWwhCQwCC0EAIQkgC0UgDEEZSHINAUEIIAR0QQhqIQBBACECA0AgAiAATw0CIAJBQGshAgwAAAsAC0FsIQkgDSANQfwAaiANQfgAaiAFIAYQFSICEAMNACANKAJ4IgMgBEsNACAAIA0gDSgCfCAHIAggAxAYIAEgADYCACACIQkLIA1BgAFqJAAgCQsLACAAIAEgAhALGgsQACAALwAAIAAtAAJBEHRyCy8AAn9BuH8gAUEISQ0AGkFyIAAoAAQiAEF3Sw0AGkG4fyAAQQhqIgAgACABSxsLCwkAIAAgATsAAAsDAAELigYBBX8gACAAKAIAIgVBfnE2AgBBACAAIAVBAXZqQYQgKAIAIgQgAEYbIQECQAJAIAAoAgQiAkUNACACKAIAIgNBAXENACACQQhqIgUgA0EBdkF4aiIDQQggA0EISxtnQR9zQQJ0QYAfaiIDKAIARgRAIAMgAigCDDYCAAsgAigCCCIDBEAgAyACKAIMNgIECyACKAIMIgMEQCADIAIoAgg2AgALIAIgAigCACAAKAIAQX5xajYCAEGEICEAAkACQCABRQ0AIAEgAjYCBCABKAIAIgNBAXENASADQQF2QXhqIgNBCCADQQhLG2dBH3NBAnRBgB9qIgMoAgAgAUEIakYEQCADIAEoAgw2AgALIAEoAggiAwRAIAMgASgCDDYCBAsgASgCDCIDBEAgAyABKAIINgIAQYQgKAIAIQQLIAIgAigCACABKAIAQX5xajYCACABIARGDQAgASABKAIAQQF2akEEaiEACyAAIAI2AgALIAIoAgBBAXZBeGoiAEEIIABBCEsbZ0Efc0ECdEGAH2oiASgCACEAIAEgBTYCACACIAA2AgwgAkEANgIIIABFDQEgACAFNgIADwsCQCABRQ0AIAEoAgAiAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAigCACABQQhqRgRAIAIgASgCDDYCAAsgASgCCCICBEAgAiABKAIMNgIECyABKAIMIgIEQCACIAEoAgg2AgBBhCAoAgAhBAsgACAAKAIAIAEoAgBBfnFqIgI2AgACQCABIARHBEAgASABKAIAQQF2aiAANgIEIAAoAgAhAgwBC0GEICAANgIACyACQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgIoAgAhASACIABBCGoiAjYCACAAIAE2AgwgAEEANgIIIAFFDQEgASACNgIADwsgBUEBdkF4aiIBQQggAUEISxtnQR9zQQJ0QYAfaiICKAIAIQEgAiAAQQhqIgI2AgAgACABNgIMIABBADYCCCABRQ0AIAEgAjYCAAsLDgAgAARAIABBeGoQJQsLgAIBA38CQCAAQQ9qQXhxQYQgKAIAKAIAQQF2ayICEB1Bf0YNAAJAQYQgKAIAIgAoAgAiAUEBcQ0AIAFBAXZBeGoiAUEIIAFBCEsbZ0Efc0ECdEGAH2oiASgCACAAQQhqRgRAIAEgACgCDDYCAAsgACgCCCIBBEAgASAAKAIMNgIECyAAKAIMIgFFDQAgASAAKAIINgIAC0EBIQEgACAAKAIAIAJBAXRqIgI2AgAgAkEBcQ0AIAJBAXZBeGoiAkEIIAJBCEsbZ0Efc0ECdEGAH2oiAygCACECIAMgAEEIaiIDNgIAIAAgAjYCDCAAQQA2AgggAkUNACACIAM2AgALIAELtwIBA38CQAJAIABBASAAGyICEDgiAA0AAkACQEGEICgCACIARQ0AIAAoAgAiA0EBcQ0AIAAgA0EBcjYCACADQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgAgAEEIakYEQCABIAAoAgw2AgALIAAoAggiAQRAIAEgACgCDDYCBAsgACgCDCIBBEAgASAAKAIINgIACyACECchAkEAIQFBhCAoAgAhACACDQEgACAAKAIAQX5xNgIAQQAPCyACQQ9qQXhxIgMQHSICQX9GDQIgAkEHakF4cSIAIAJHBEAgACACaxAdQX9GDQMLAkBBhCAoAgAiAUUEQEGAICAANgIADAELIAAgATYCBAtBhCAgADYCACAAIANBAXRBAXI2AgAMAQsgAEUNAQsgAEEIaiEBCyABC7kDAQJ/IAAgA2ohBQJAIANBB0wEQANAIAAgBU8NAiAAIAItAAA6AAAgAEEBaiEAIAJBAWohAgwAAAsACyAEQQFGBEACQCAAIAJrIgZBB00EQCAAIAItAAA6AAAgACACLQABOgABIAAgAi0AAjoAAiAAIAItAAM6AAMgAEEEaiACIAZBAnQiBkHAHmooAgBqIgIQFyACIAZB4B5qKAIAayECDAELIAAgAhAMCyACQQhqIQIgAEEIaiEACwJAAkACQAJAIAUgAU0EQCAAIANqIQEgBEEBRyAAIAJrQQ9Kcg0BA0AgACACEAwgAkEIaiECIABBCGoiACABSQ0ACwwFCyAAIAFLBEAgACEBDAQLIARBAUcgACACa0EPSnINASAAIQMgAiEEA0AgAyAEEAwgBEEIaiEEIANBCGoiAyABSQ0ACwwCCwNAIAAgAhAHIAJBEGohAiAAQRBqIgAgAUkNAAsMAwsgACEDIAIhBANAIAMgBBAHIARBEGohBCADQRBqIgMgAUkNAAsLIAIgASAAa2ohAgsDQCABIAVPDQEgASACLQAAOgAAIAFBAWohASACQQFqIQIMAAALAAsLQQECfyAAIAAoArjgASIDNgLE4AEgACgCvOABIQQgACABNgK84AEgACABIAJqNgK44AEgACABIAQgA2tqNgLA4AELpgEBAX8gACAAKALs4QEQFjYCyOABIABCADcD+OABIABCADcDuOABIABBwOABakIANwMAIABBqNAAaiIBQYyAgOAANgIAIABBADYCmOIBIABCADcDiOEBIABCAzcDgOEBIABBrNABakHgEikCADcCACAAQbTQAWpB6BIoAgA2AgAgACABNgIMIAAgAEGYIGo2AgggACAAQaAwajYCBCAAIABBEGo2AgALYQEBf0G4fyEDAkAgAUEDSQ0AIAIgABAhIgFBA3YiADYCCCACIAFBAXE2AgQgAiABQQF2QQNxIgM2AgACQCADQX9qIgFBAksNAAJAIAFBAWsOAgEAAgtBbA8LIAAhAwsgAwsMACAAIAEgAkEAEC4LiAQCA38CfiADEBYhBCAAQQBBKBAQIQAgBCACSwRAIAQPCyABRQRAQX8PCwJAAkAgA0EBRg0AIAEoAAAiBkGo6r5pRg0AQXYhAyAGQXBxQdDUtMIBRw0BQQghAyACQQhJDQEgAEEAQSgQECEAIAEoAAQhASAAQQE2AhQgACABrTcDAEEADwsgASACIAMQLyIDIAJLDQAgACADNgIYQXIhAyABIARqIgVBf2otAAAiAkEIcQ0AIAJBIHEiBkUEQEFwIQMgBS0AACIFQacBSw0BIAVBB3GtQgEgBUEDdkEKaq2GIgdCA4h+IAd8IQggBEEBaiEECyACQQZ2IQMgAkECdiEFAkAgAkEDcUF/aiICQQJLBEBBACECDAELAkACQAJAIAJBAWsOAgECAAsgASAEai0AACECIARBAWohBAwCCyABIARqLwAAIQIgBEECaiEEDAELIAEgBGooAAAhAiAEQQRqIQQLIAVBAXEhBQJ+AkACQAJAIANBf2oiA0ECTQRAIANBAWsOAgIDAQtCfyAGRQ0DGiABIARqMQAADAMLIAEgBGovAACtQoACfAwCCyABIARqKAAArQwBCyABIARqKQAACyEHIAAgBTYCICAAIAI2AhwgACAHNwMAQQAhAyAAQQA2AhQgACAHIAggBhsiBzcDCCAAIAdCgIAIIAdCgIAIVBs+AhALIAMLWwEBf0G4fyEDIAIQFiICIAFNBH8gACACakF/ai0AACIAQQNxQQJ0QaAeaigCACACaiAAQQZ2IgFBAnRBsB5qKAIAaiAAQSBxIgBFaiABRSAAQQV2cWoFQbh/CwsdACAAKAKQ4gEQWiAAQQA2AqDiASAAQgA3A5DiAQu1AwEFfyMAQZACayIKJABBuH8hBgJAIAVFDQAgBCwAACIIQf8BcSEHAkAgCEF/TARAIAdBgn9qQQF2IgggBU8NAkFsIQYgB0GBf2oiBUGAAk8NAiAEQQFqIQdBACEGA0AgBiAFTwRAIAUhBiAIIQcMAwUgACAGaiAHIAZBAXZqIgQtAABBBHY6AAAgACAGQQFyaiAELQAAQQ9xOgAAIAZBAmohBgwBCwAACwALIAcgBU8NASAAIARBAWogByAKEFMiBhADDQELIAYhBEEAIQYgAUEAQTQQECEJQQAhBQNAIAQgBkcEQCAAIAZqIggtAAAiAUELSwRAQWwhBgwDBSAJIAFBAnRqIgEgASgCAEEBajYCACAGQQFqIQZBASAILQAAdEEBdSAFaiEFDAILAAsLQWwhBiAFRQ0AIAUQFEEBaiIBQQxLDQAgAyABNgIAQQFBASABdCAFayIDEBQiAXQgA0cNACAAIARqIAFBAWoiADoAACAJIABBAnRqIgAgACgCAEEBajYCACAJKAIEIgBBAkkgAEEBcXINACACIARBAWo2AgAgB0EBaiEGCyAKQZACaiQAIAYLxhEBDH8jAEHwAGsiBSQAQWwhCwJAIANBCkkNACACLwAAIQogAi8AAiEJIAIvAAQhByAFQQhqIAQQDgJAIAMgByAJIApqakEGaiIMSQ0AIAUtAAohCCAFQdgAaiACQQZqIgIgChAGIgsQAw0BIAVBQGsgAiAKaiICIAkQBiILEAMNASAFQShqIAIgCWoiAiAHEAYiCxADDQEgBUEQaiACIAdqIAMgDGsQBiILEAMNASAAIAFqIg9BfWohECAEQQRqIQZBASELIAAgAUEDakECdiIDaiIMIANqIgIgA2oiDiEDIAIhBCAMIQcDQCALIAMgEElxBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgCS0AAyELIAcgBiAFQUBrIAgQAkECdGoiCS8BADsAACAFQUBrIAktAAIQASAJLQADIQogBCAGIAVBKGogCBACQQJ0aiIJLwEAOwAAIAVBKGogCS0AAhABIAktAAMhCSADIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgDS0AAyENIAAgC2oiCyAGIAVB2ABqIAgQAkECdGoiAC8BADsAACAFQdgAaiAALQACEAEgAC0AAyEAIAcgCmoiCiAGIAVBQGsgCBACQQJ0aiIHLwEAOwAAIAVBQGsgBy0AAhABIActAAMhByAEIAlqIgkgBiAFQShqIAgQAkECdGoiBC8BADsAACAFQShqIAQtAAIQASAELQADIQQgAyANaiIDIAYgBUEQaiAIEAJBAnRqIg0vAQA7AAAgBUEQaiANLQACEAEgACALaiEAIAcgCmohByAEIAlqIQQgAyANLQADaiEDIAVB2ABqEA0gBUFAaxANciAFQShqEA1yIAVBEGoQDXJFIQsMAQsLIAQgDksgByACS3INAEFsIQsgACAMSw0BIAxBfWohCQNAQQAgACAJSSAFQdgAahAEGwRAIAAgBiAFQdgAaiAIEAJBAnRqIgovAQA7AAAgBUHYAGogCi0AAhABIAAgCi0AA2oiACAGIAVB2ABqIAgQAkECdGoiCi8BADsAACAFQdgAaiAKLQACEAEgACAKLQADaiEADAEFIAxBfmohCgNAIAVB2ABqEAQgACAKS3JFBEAgACAGIAVB2ABqIAgQAkECdGoiCS8BADsAACAFQdgAaiAJLQACEAEgACAJLQADaiEADAELCwNAIAAgCk0EQCAAIAYgBUHYAGogCBACQQJ0aiIJLwEAOwAAIAVB2ABqIAktAAIQASAAIAktAANqIQAMAQsLAkAgACAMTw0AIAAgBiAFQdgAaiAIEAIiAEECdGoiDC0AADoAACAMLQADQQFGBEAgBUHYAGogDC0AAhABDAELIAUoAlxBH0sNACAFQdgAaiAGIABBAnRqLQACEAEgBSgCXEEhSQ0AIAVBIDYCXAsgAkF9aiEMA0BBACAHIAxJIAVBQGsQBBsEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiIAIAYgBUFAayAIEAJBAnRqIgcvAQA7AAAgBUFAayAHLQACEAEgACAHLQADaiEHDAEFIAJBfmohDANAIAVBQGsQBCAHIAxLckUEQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwNAIAcgDE0EQCAHIAYgBUFAayAIEAJBAnRqIgAvAQA7AAAgBUFAayAALQACEAEgByAALQADaiEHDAELCwJAIAcgAk8NACAHIAYgBUFAayAIEAIiAEECdGoiAi0AADoAACACLQADQQFGBEAgBUFAayACLQACEAEMAQsgBSgCREEfSw0AIAVBQGsgBiAAQQJ0ai0AAhABIAUoAkRBIUkNACAFQSA2AkQLIA5BfWohAgNAQQAgBCACSSAFQShqEAQbBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2oiACAGIAVBKGogCBACQQJ0aiIELwEAOwAAIAVBKGogBC0AAhABIAAgBC0AA2ohBAwBBSAOQX5qIQIDQCAFQShqEAQgBCACS3JFBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsDQCAEIAJNBEAgBCAGIAVBKGogCBACQQJ0aiIALwEAOwAAIAVBKGogAC0AAhABIAQgAC0AA2ohBAwBCwsCQCAEIA5PDQAgBCAGIAVBKGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBKGogAi0AAhABDAELIAUoAixBH0sNACAFQShqIAYgAEECdGotAAIQASAFKAIsQSFJDQAgBUEgNgIsCwNAQQAgAyAQSSAFQRBqEAQbBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2oiACAGIAVBEGogCBACQQJ0aiICLwEAOwAAIAVBEGogAi0AAhABIAAgAi0AA2ohAwwBBSAPQX5qIQIDQCAFQRBqEAQgAyACS3JFBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsDQCADIAJNBEAgAyAGIAVBEGogCBACQQJ0aiIALwEAOwAAIAVBEGogAC0AAhABIAMgAC0AA2ohAwwBCwsCQCADIA9PDQAgAyAGIAVBEGogCBACIgBBAnRqIgItAAA6AAAgAi0AA0EBRgRAIAVBEGogAi0AAhABDAELIAUoAhRBH0sNACAFQRBqIAYgAEECdGotAAIQASAFKAIUQSFJDQAgBUEgNgIUCyABQWwgBUHYAGoQCiAFQUBrEApxIAVBKGoQCnEgBUEQahAKcRshCwwJCwAACwALAAALAAsAAAsACwAACwALQWwhCwsgBUHwAGokACALC7UEAQ5/IwBBEGsiBiQAIAZBBGogABAOQVQhBQJAIARB3AtJDQAgBi0ABCEHIANB8ARqQQBB7AAQECEIIAdBDEsNACADQdwJaiIJIAggBkEIaiAGQQxqIAEgAhAxIhAQA0UEQCAGKAIMIgQgB0sNASADQdwFaiEPIANBpAVqIREgAEEEaiESIANBqAVqIQEgBCEFA0AgBSICQX9qIQUgCCACQQJ0aigCAEUNAAsgAkEBaiEOQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgASALaiAKNgIAIAVBAWohBSAKIAxqIQoMAQsLIAEgCjYCAEEAIQUgBigCCCELA0AgBSALRkUEQCABIAUgCWotAAAiDEECdGoiDSANKAIAIg1BAWo2AgAgDyANQQF0aiINIAw6AAEgDSAFOgAAIAVBAWohBQwBCwtBACEBIANBADYCqAUgBEF/cyAHaiEJQQEhBQNAIAUgDk9FBEAgCCAFQQJ0IgtqKAIAIQwgAyALaiABNgIAIAwgBSAJanQgAWohASAFQQFqIQUMAQsLIAcgBEEBaiIBIAJrIgRrQQFqIQgDQEEBIQUgBCAIT0UEQANAIAUgDk9FBEAgBUECdCIJIAMgBEE0bGpqIAMgCWooAgAgBHY2AgAgBUEBaiEFDAELCyAEQQFqIQQMAQsLIBIgByAPIAogESADIAIgARBkIAZBAToABSAGIAc6AAYgACAGKAIENgIACyAQIQULIAZBEGokACAFC8ENAQt/IwBB8ABrIgUkAEFsIQkCQCADQQpJDQAgAi8AACEKIAIvAAIhDCACLwAEIQYgBUEIaiAEEA4CQCADIAYgCiAMampBBmoiDUkNACAFLQAKIQcgBUHYAGogAkEGaiICIAoQBiIJEAMNASAFQUBrIAIgCmoiAiAMEAYiCRADDQEgBUEoaiACIAxqIgIgBhAGIgkQAw0BIAVBEGogAiAGaiADIA1rEAYiCRADDQEgACABaiIOQX1qIQ8gBEEEaiEGQQEhCSAAIAFBA2pBAnYiAmoiCiACaiIMIAJqIg0hAyAMIQQgCiECA0AgCSADIA9JcQRAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAACAGIAVBQGsgBxACQQF0aiIILQAAIQsgBUFAayAILQABEAEgAiALOgAAIAYgBUEoaiAHEAJBAXRqIggtAAAhCyAFQShqIAgtAAEQASAEIAs6AAAgBiAFQRBqIAcQAkEBdGoiCC0AACELIAVBEGogCC0AARABIAMgCzoAACAGIAVB2ABqIAcQAkEBdGoiCC0AACELIAVB2ABqIAgtAAEQASAAIAs6AAEgBiAFQUBrIAcQAkEBdGoiCC0AACELIAVBQGsgCC0AARABIAIgCzoAASAGIAVBKGogBxACQQF0aiIILQAAIQsgBUEoaiAILQABEAEgBCALOgABIAYgBUEQaiAHEAJBAXRqIggtAAAhCyAFQRBqIAgtAAEQASADIAs6AAEgA0ECaiEDIARBAmohBCACQQJqIQIgAEECaiEAIAkgBUHYAGoQDUVxIAVBQGsQDUVxIAVBKGoQDUVxIAVBEGoQDUVxIQkMAQsLIAQgDUsgAiAMS3INAEFsIQkgACAKSw0BIApBfWohCQNAIAVB2ABqEAQgACAJT3JFBEAgBiAFQdgAaiAHEAJBAXRqIggtAAAhCyAFQdgAaiAILQABEAEgACALOgAAIAYgBUHYAGogBxACQQF0aiIILQAAIQsgBUHYAGogCC0AARABIAAgCzoAASAAQQJqIQAMAQsLA0AgBUHYAGoQBCAAIApPckUEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCwNAIAAgCkkEQCAGIAVB2ABqIAcQAkEBdGoiCS0AACEIIAVB2ABqIAktAAEQASAAIAg6AAAgAEEBaiEADAELCyAMQX1qIQADQCAFQUBrEAQgAiAAT3JFBEAgBiAFQUBrIAcQAkEBdGoiCi0AACEJIAVBQGsgCi0AARABIAIgCToAACAGIAVBQGsgBxACQQF0aiIKLQAAIQkgBUFAayAKLQABEAEgAiAJOgABIAJBAmohAgwBCwsDQCAFQUBrEAQgAiAMT3JFBEAgBiAFQUBrIAcQAkEBdGoiAC0AACEKIAVBQGsgAC0AARABIAIgCjoAACACQQFqIQIMAQsLA0AgAiAMSQRAIAYgBUFAayAHEAJBAXRqIgAtAAAhCiAFQUBrIAAtAAEQASACIAo6AAAgAkEBaiECDAELCyANQX1qIQADQCAFQShqEAQgBCAAT3JFBEAgBiAFQShqIAcQAkEBdGoiAi0AACEKIAVBKGogAi0AARABIAQgCjoAACAGIAVBKGogBxACQQF0aiICLQAAIQogBUEoaiACLQABEAEgBCAKOgABIARBAmohBAwBCwsDQCAFQShqEAQgBCANT3JFBEAgBiAFQShqIAcQAkEBdGoiAC0AACECIAVBKGogAC0AARABIAQgAjoAACAEQQFqIQQMAQsLA0AgBCANSQRAIAYgBUEoaiAHEAJBAXRqIgAtAAAhAiAFQShqIAAtAAEQASAEIAI6AAAgBEEBaiEEDAELCwNAIAVBEGoQBCADIA9PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIAYgBUEQaiAHEAJBAXRqIgAtAAAhAiAFQRBqIAAtAAEQASADIAI6AAEgA0ECaiEDDAELCwNAIAVBEGoQBCADIA5PckUEQCAGIAVBEGogBxACQQF0aiIALQAAIQIgBUEQaiAALQABEAEgAyACOgAAIANBAWohAwwBCwsDQCADIA5JBEAgBiAFQRBqIAcQAkEBdGoiAC0AACECIAVBEGogAC0AARABIAMgAjoAACADQQFqIQMMAQsLIAFBbCAFQdgAahAKIAVBQGsQCnEgBUEoahAKcSAFQRBqEApxGyEJDAELQWwhCQsgBUHwAGokACAJC8oCAQR/IwBBIGsiBSQAIAUgBBAOIAUtAAIhByAFQQhqIAIgAxAGIgIQA0UEQCAEQQRqIQIgACABaiIDQX1qIQQDQCAFQQhqEAQgACAET3JFBEAgAiAFQQhqIAcQAkEBdGoiBi0AACEIIAVBCGogBi0AARABIAAgCDoAACACIAVBCGogBxACQQF0aiIGLQAAIQggBUEIaiAGLQABEAEgACAIOgABIABBAmohAAwBCwsDQCAFQQhqEAQgACADT3JFBEAgAiAFQQhqIAcQAkEBdGoiBC0AACEGIAVBCGogBC0AARABIAAgBjoAACAAQQFqIQAMAQsLA0AgACADT0UEQCACIAVBCGogBxACQQF0aiIELQAAIQYgBUEIaiAELQABEAEgACAGOgAAIABBAWohAAwBCwsgAUFsIAVBCGoQChshAgsgBUEgaiQAIAILtgMBCX8jAEEQayIGJAAgBkEANgIMIAZBADYCCEFUIQQCQAJAIANBQGsiDCADIAZBCGogBkEMaiABIAIQMSICEAMNACAGQQRqIAAQDiAGKAIMIgcgBi0ABEEBaksNASAAQQRqIQogBkEAOgAFIAYgBzoABiAAIAYoAgQ2AgAgB0EBaiEJQQEhBANAIAQgCUkEQCADIARBAnRqIgEoAgAhACABIAU2AgAgACAEQX9qdCAFaiEFIARBAWohBAwBCwsgB0EBaiEHQQAhBSAGKAIIIQkDQCAFIAlGDQEgAyAFIAxqLQAAIgRBAnRqIgBBASAEdEEBdSILIAAoAgAiAWoiADYCACAHIARrIQhBACEEAkAgC0EDTQRAA0AgBCALRg0CIAogASAEakEBdGoiACAIOgABIAAgBToAACAEQQFqIQQMAAALAAsDQCABIABPDQEgCiABQQF0aiIEIAg6AAEgBCAFOgAAIAQgCDoAAyAEIAU6AAIgBCAIOgAFIAQgBToABCAEIAg6AAcgBCAFOgAGIAFBBGohAQwAAAsACyAFQQFqIQUMAAALAAsgAiEECyAGQRBqJAAgBAutAQECfwJAQYQgKAIAIABHIAAoAgBBAXYiAyABa0F4aiICQXhxQQhHcgR/IAIFIAMQJ0UNASACQQhqC0EQSQ0AIAAgACgCACICQQFxIAAgAWpBD2pBeHEiASAAa0EBdHI2AgAgASAANgIEIAEgASgCAEEBcSAAIAJBAXZqIAFrIgJBAXRyNgIAQYQgIAEgAkH/////B3FqQQRqQYQgKAIAIABGGyABNgIAIAEQJQsLygIBBX8CQAJAAkAgAEEIIABBCEsbZ0EfcyAAaUEBR2oiAUEESSAAIAF2cg0AIAFBAnRB/B5qKAIAIgJFDQADQCACQXhqIgMoAgBBAXZBeGoiBSAATwRAIAIgBUEIIAVBCEsbZ0Efc0ECdEGAH2oiASgCAEYEQCABIAIoAgQ2AgALDAMLIARBHksNASAEQQFqIQQgAigCBCICDQALC0EAIQMgAUEgTw0BA0AgAUECdEGAH2ooAgAiAkUEQCABQR5LIQIgAUEBaiEBIAJFDQEMAwsLIAIgAkF4aiIDKAIAQQF2QXhqIgFBCCABQQhLG2dBH3NBAnRBgB9qIgEoAgBGBEAgASACKAIENgIACwsgAigCACIBBEAgASACKAIENgIECyACKAIEIgEEQCABIAIoAgA2AgALIAMgAygCAEEBcjYCACADIAAQNwsgAwvhCwINfwV+IwBB8ABrIgckACAHIAAoAvDhASIINgJcIAEgAmohDSAIIAAoAoDiAWohDwJAAkAgBUUEQCABIQQMAQsgACgCxOABIRAgACgCwOABIREgACgCvOABIQ4gAEEBNgKM4QFBACEIA0AgCEEDRwRAIAcgCEECdCICaiAAIAJqQazQAWooAgA2AkQgCEEBaiEIDAELC0FsIQwgB0EYaiADIAQQBhADDQEgB0EsaiAHQRhqIAAoAgAQEyAHQTRqIAdBGGogACgCCBATIAdBPGogB0EYaiAAKAIEEBMgDUFgaiESIAEhBEEAIQwDQCAHKAIwIAcoAixBA3RqKQIAIhRCEIinQf8BcSEIIAcoAkAgBygCPEEDdGopAgAiFUIQiKdB/wFxIQsgBygCOCAHKAI0QQN0aikCACIWQiCIpyEJIBVCIIghFyAUQiCIpyECAkAgFkIQiKdB/wFxIgNBAk8EQAJAIAZFIANBGUlyRQRAIAkgB0EYaiADQSAgBygCHGsiCiAKIANLGyIKEAUgAyAKayIDdGohCSAHQRhqEAQaIANFDQEgB0EYaiADEAUgCWohCQwBCyAHQRhqIAMQBSAJaiEJIAdBGGoQBBoLIAcpAkQhGCAHIAk2AkQgByAYNwNIDAELAkAgA0UEQCACBEAgBygCRCEJDAMLIAcoAkghCQwBCwJAAkAgB0EYakEBEAUgCSACRWpqIgNBA0YEQCAHKAJEQX9qIgMgA0VqIQkMAQsgA0ECdCAHaigCRCIJIAlFaiEJIANBAUYNAQsgByAHKAJINgJMCwsgByAHKAJENgJIIAcgCTYCRAsgF6chAyALBEAgB0EYaiALEAUgA2ohAwsgCCALakEUTwRAIAdBGGoQBBoLIAgEQCAHQRhqIAgQBSACaiECCyAHQRhqEAQaIAcgB0EYaiAUQhiIp0H/AXEQCCAUp0H//wNxajYCLCAHIAdBGGogFUIYiKdB/wFxEAggFadB//8DcWo2AjwgB0EYahAEGiAHIAdBGGogFkIYiKdB/wFxEAggFqdB//8DcWo2AjQgByACNgJgIAcoAlwhCiAHIAk2AmggByADNgJkAkACQAJAIAQgAiADaiILaiASSw0AIAIgCmoiEyAPSw0AIA0gBGsgC0Egak8NAQsgByAHKQNoNwMQIAcgBykDYDcDCCAEIA0gB0EIaiAHQdwAaiAPIA4gESAQEB4hCwwBCyACIARqIQggBCAKEAcgAkERTwRAIARBEGohAgNAIAIgCkEQaiIKEAcgAkEQaiICIAhJDQALCyAIIAlrIQIgByATNgJcIAkgCCAOa0sEQCAJIAggEWtLBEBBbCELDAILIBAgAiAOayICaiIKIANqIBBNBEAgCCAKIAMQDxoMAgsgCCAKQQAgAmsQDyEIIAcgAiADaiIDNgJkIAggAmshCCAOIQILIAlBEE8EQCADIAhqIQMDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALDAELAkAgCUEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgCUECdCIDQcAeaigCAGoiAhAXIAIgA0HgHmooAgBrIQIgBygCZCEDDAELIAggAhAMCyADQQlJDQAgAyAIaiEDIAhBCGoiCCACQQhqIgJrQQ9MBEADQCAIIAIQDCACQQhqIQIgCEEIaiIIIANJDQAMAgALAAsDQCAIIAIQByACQRBqIQIgCEEQaiIIIANJDQALCyAHQRhqEAQaIAsgDCALEAMiAhshDCAEIAQgC2ogAhshBCAFQX9qIgUNAAsgDBADDQFBbCEMIAdBGGoQBEECSQ0BQQAhCANAIAhBA0cEQCAAIAhBAnQiAmpBrNABaiACIAdqKAJENgIAIAhBAWohCAwBCwsgBygCXCEIC0G6fyEMIA8gCGsiACANIARrSw0AIAQEfyAEIAggABALIABqBUEACyABayEMCyAHQfAAaiQAIAwLkRcCFn8FfiMAQdABayIHJAAgByAAKALw4QEiCDYCvAEgASACaiESIAggACgCgOIBaiETAkACQCAFRQRAIAEhAwwBCyAAKALE4AEhESAAKALA4AEhFSAAKAK84AEhDyAAQQE2AozhAUEAIQgDQCAIQQNHBEAgByAIQQJ0IgJqIAAgAmpBrNABaigCADYCVCAIQQFqIQgMAQsLIAcgETYCZCAHIA82AmAgByABIA9rNgJoQWwhECAHQShqIAMgBBAGEAMNASAFQQQgBUEESBshFyAHQTxqIAdBKGogACgCABATIAdBxABqIAdBKGogACgCCBATIAdBzABqIAdBKGogACgCBBATQQAhBCAHQeAAaiEMIAdB5ABqIQoDQCAHQShqEARBAksgBCAXTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEJIAcoAkggBygCREEDdGopAgAiH0IgiKchCCAeQiCIISAgHUIgiKchAgJAIB9CEIinQf8BcSIDQQJPBEACQCAGRSADQRlJckUEQCAIIAdBKGogA0EgIAcoAixrIg0gDSADSxsiDRAFIAMgDWsiA3RqIQggB0EoahAEGiADRQ0BIAdBKGogAxAFIAhqIQgMAQsgB0EoaiADEAUgCGohCCAHQShqEAQaCyAHKQJUISEgByAINgJUIAcgITcDWAwBCwJAIANFBEAgAgRAIAcoAlQhCAwDCyAHKAJYIQgMAQsCQAJAIAdBKGpBARAFIAggAkVqaiIDQQNGBEAgBygCVEF/aiIDIANFaiEIDAELIANBAnQgB2ooAlQiCCAIRWohCCADQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAg2AlQLICCnIQMgCQRAIAdBKGogCRAFIANqIQMLIAkgC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgAmohAgsgB0EoahAEGiAHIAcoAmggAmoiCSADajYCaCAKIAwgCCAJSxsoAgAhDSAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogB0EoaiAfQhiIp0H/AXEQCCEOIAdB8ABqIARBBHRqIgsgCSANaiAIazYCDCALIAg2AgggCyADNgIEIAsgAjYCACAHIA4gH6dB//8DcWo2AkQgBEEBaiEEDAELCyAEIBdIDQEgEkFgaiEYIAdB4ABqIRogB0HkAGohGyABIQMDQCAHQShqEARBAksgBCAFTnJFBEAgBygCQCAHKAI8QQN0aikCACIdQhCIp0H/AXEhCyAHKAJQIAcoAkxBA3RqKQIAIh5CEIinQf8BcSEIIAcoAkggBygCREEDdGopAgAiH0IgiKchCSAeQiCIISAgHUIgiKchDAJAIB9CEIinQf8BcSICQQJPBEACQCAGRSACQRlJckUEQCAJIAdBKGogAkEgIAcoAixrIgogCiACSxsiChAFIAIgCmsiAnRqIQkgB0EoahAEGiACRQ0BIAdBKGogAhAFIAlqIQkMAQsgB0EoaiACEAUgCWohCSAHQShqEAQaCyAHKQJUISEgByAJNgJUIAcgITcDWAwBCwJAIAJFBEAgDARAIAcoAlQhCQwDCyAHKAJYIQkMAQsCQAJAIAdBKGpBARAFIAkgDEVqaiICQQNGBEAgBygCVEF/aiICIAJFaiEJDAELIAJBAnQgB2ooAlQiCSAJRWohCSACQQFGDQELIAcgBygCWDYCXAsLIAcgBygCVDYCWCAHIAk2AlQLICCnIRQgCARAIAdBKGogCBAFIBRqIRQLIAggC2pBFE8EQCAHQShqEAQaCyALBEAgB0EoaiALEAUgDGohDAsgB0EoahAEGiAHIAcoAmggDGoiGSAUajYCaCAbIBogCSAZSxsoAgAhHCAHIAdBKGogHUIYiKdB/wFxEAggHadB//8DcWo2AjwgByAHQShqIB5CGIinQf8BcRAIIB6nQf//A3FqNgJMIAdBKGoQBBogByAHQShqIB9CGIinQf8BcRAIIB+nQf//A3FqNgJEIAcgB0HwAGogBEEDcUEEdGoiDSkDCCIdNwPIASAHIA0pAwAiHjcDwAECQAJAAkAgBygCvAEiDiAepyICaiIWIBNLDQAgAyAHKALEASIKIAJqIgtqIBhLDQAgEiADayALQSBqTw0BCyAHIAcpA8gBNwMQIAcgBykDwAE3AwggAyASIAdBCGogB0G8AWogEyAPIBUgERAeIQsMAQsgAiADaiEIIAMgDhAHIAJBEU8EQCADQRBqIQIDQCACIA5BEGoiDhAHIAJBEGoiAiAISQ0ACwsgCCAdpyIOayECIAcgFjYCvAEgDiAIIA9rSwRAIA4gCCAVa0sEQEFsIQsMAgsgESACIA9rIgJqIhYgCmogEU0EQCAIIBYgChAPGgwCCyAIIBZBACACaxAPIQggByACIApqIgo2AsQBIAggAmshCCAPIQILIA5BEE8EQCAIIApqIQoDQCAIIAIQByACQRBqIQIgCEEQaiIIIApJDQALDAELAkAgDkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgDkECdCIKQcAeaigCAGoiAhAXIAIgCkHgHmooAgBrIQIgBygCxAEhCgwBCyAIIAIQDAsgCkEJSQ0AIAggCmohCiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAKSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAKSQ0ACwsgCxADBEAgCyEQDAQFIA0gDDYCACANIBkgHGogCWs2AgwgDSAJNgIIIA0gFDYCBCAEQQFqIQQgAyALaiEDDAILAAsLIAQgBUgNASAEIBdrIQtBACEEA0AgCyAFSARAIAcgB0HwAGogC0EDcUEEdGoiAikDCCIdNwPIASAHIAIpAwAiHjcDwAECQAJAAkAgBygCvAEiDCAepyICaiIKIBNLDQAgAyAHKALEASIJIAJqIhBqIBhLDQAgEiADayAQQSBqTw0BCyAHIAcpA8gBNwMgIAcgBykDwAE3AxggAyASIAdBGGogB0G8AWogEyAPIBUgERAeIRAMAQsgAiADaiEIIAMgDBAHIAJBEU8EQCADQRBqIQIDQCACIAxBEGoiDBAHIAJBEGoiAiAISQ0ACwsgCCAdpyIGayECIAcgCjYCvAEgBiAIIA9rSwRAIAYgCCAVa0sEQEFsIRAMAgsgESACIA9rIgJqIgwgCWogEU0EQCAIIAwgCRAPGgwCCyAIIAxBACACaxAPIQggByACIAlqIgk2AsQBIAggAmshCCAPIQILIAZBEE8EQCAIIAlqIQYDQCAIIAIQByACQRBqIQIgCEEQaiIIIAZJDQALDAELAkAgBkEHTQRAIAggAi0AADoAACAIIAItAAE6AAEgCCACLQACOgACIAggAi0AAzoAAyAIQQRqIAIgBkECdCIGQcAeaigCAGoiAhAXIAIgBkHgHmooAgBrIQIgBygCxAEhCQwBCyAIIAIQDAsgCUEJSQ0AIAggCWohBiAIQQhqIgggAkEIaiICa0EPTARAA0AgCCACEAwgAkEIaiECIAhBCGoiCCAGSQ0ADAIACwALA0AgCCACEAcgAkEQaiECIAhBEGoiCCAGSQ0ACwsgEBADDQMgC0EBaiELIAMgEGohAwwBCwsDQCAEQQNHBEAgACAEQQJ0IgJqQazQAWogAiAHaigCVDYCACAEQQFqIQQMAQsLIAcoArwBIQgLQbp/IRAgEyAIayIAIBIgA2tLDQAgAwR/IAMgCCAAEAsgAGoFQQALIAFrIRALIAdB0AFqJAAgEAslACAAQgA3AgAgAEEAOwEIIABBADoACyAAIAE2AgwgACACOgAKC7QFAQN/IwBBMGsiBCQAIABB/wFqIgVBfWohBgJAIAMvAQIEQCAEQRhqIAEgAhAGIgIQAw0BIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahASOgAAIAMgBEEIaiAEQRhqEBI6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0FIAEgBEEQaiAEQRhqEBI6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBSABIARBCGogBEEYahASOgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEjoAACABIAJqIABrIQIMAwsgAyAEQRBqIARBGGoQEjoAAiADIARBCGogBEEYahASOgADIANBBGohAwwAAAsACyAEQRhqIAEgAhAGIgIQAw0AIARBEGogBEEYaiADEBwgBEEIaiAEQRhqIAMQHCAAIQMDQAJAIARBGGoQBCADIAZPckUEQCADIARBEGogBEEYahAROgAAIAMgBEEIaiAEQRhqEBE6AAEgBEEYahAERQ0BIANBAmohAwsgBUF+aiEFAn8DQEG6fyECIAMiASAFSw0EIAEgBEEQaiAEQRhqEBE6AAAgAUEBaiEDIARBGGoQBEEDRgRAQQIhAiAEQQhqDAILIAMgBUsNBCABIARBCGogBEEYahAROgABIAFBAmohA0EDIQIgBEEYahAEQQNHDQALIARBEGoLIQUgAyAFIARBGGoQEToAACABIAJqIABrIQIMAgsgAyAEQRBqIARBGGoQEToAAiADIARBCGogBEEYahAROgADIANBBGohAwwAAAsACyAEQTBqJAAgAgtpAQF/An8CQAJAIAJBB00NACABKAAAQbfIwuF+Rw0AIAAgASgABDYCmOIBQWIgAEEQaiABIAIQPiIDEAMNAhogAEKBgICAEDcDiOEBIAAgASADaiACIANrECoMAQsgACABIAIQKgtBAAsLrQMBBn8jAEGAAWsiAyQAQWIhCAJAIAJBCUkNACAAQZjQAGogAUEIaiIEIAJBeGogAEGY0AAQMyIFEAMiBg0AIANBHzYCfCADIANB/ABqIANB+ABqIAQgBCAFaiAGGyIEIAEgAmoiAiAEaxAVIgUQAw0AIAMoAnwiBkEfSw0AIAMoAngiB0EJTw0AIABBiCBqIAMgBkGAC0GADCAHEBggA0E0NgJ8IAMgA0H8AGogA0H4AGogBCAFaiIEIAIgBGsQFSIFEAMNACADKAJ8IgZBNEsNACADKAJ4IgdBCk8NACAAQZAwaiADIAZBgA1B4A4gBxAYIANBIzYCfCADIANB/ABqIANB+ABqIAQgBWoiBCACIARrEBUiBRADDQAgAygCfCIGQSNLDQAgAygCeCIHQQpPDQAgACADIAZBwBBB0BEgBxAYIAQgBWoiBEEMaiIFIAJLDQAgAiAFayEFQQAhAgNAIAJBA0cEQCAEKAAAIgZBf2ogBU8NAiAAIAJBAnRqQZzQAWogBjYCACACQQFqIQIgBEEEaiEEDAELCyAEIAFrIQgLIANBgAFqJAAgCAtGAQN/IABBCGohAyAAKAIEIQJBACEAA0AgACACdkUEQCABIAMgAEEDdGotAAJBFktqIQEgAEEBaiEADAELCyABQQggAmt0C4YDAQV/Qbh/IQcCQCADRQ0AIAItAAAiBEUEQCABQQA2AgBBAUG4fyADQQFGGw8LAn8gAkEBaiIFIARBGHRBGHUiBkF/Sg0AGiAGQX9GBEAgA0EDSA0CIAUvAABBgP4BaiEEIAJBA2oMAQsgA0ECSA0BIAItAAEgBEEIdHJBgIB+aiEEIAJBAmoLIQUgASAENgIAIAVBAWoiASACIANqIgNLDQBBbCEHIABBEGogACAFLQAAIgVBBnZBI0EJIAEgAyABa0HAEEHQEUHwEiAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBmCBqIABBCGogBUEEdkEDcUEfQQggASABIAZqIAgbIgEgAyABa0GAC0GADEGAFyAAKAKM4QEgACgCnOIBIAQQHyIGEAMiCA0AIABBoDBqIABBBGogBUECdkEDcUE0QQkgASABIAZqIAgbIgEgAyABa0GADUHgDkGQGSAAKAKM4QEgACgCnOIBIAQQHyIAEAMNACAAIAFqIAJrIQcLIAcLrQMBCn8jAEGABGsiCCQAAn9BUiACQf8BSw0AGkFUIANBDEsNABogAkEBaiELIABBBGohCUGAgAQgA0F/anRBEHUhCkEAIQJBASEEQQEgA3QiB0F/aiIMIQUDQCACIAtGRQRAAkAgASACQQF0Ig1qLwEAIgZB//8DRgRAIAkgBUECdGogAjoAAiAFQX9qIQVBASEGDAELIARBACAKIAZBEHRBEHVKGyEECyAIIA1qIAY7AQAgAkEBaiECDAELCyAAIAQ7AQIgACADOwEAIAdBA3YgB0EBdmpBA2ohBkEAIQRBACECA0AgBCALRkUEQCABIARBAXRqLgEAIQpBACEAA0AgACAKTkUEQCAJIAJBAnRqIAQ6AAIDQCACIAZqIAxxIgIgBUsNAAsgAEEBaiEADAELCyAEQQFqIQQMAQsLQX8gAg0AGkEAIQIDfyACIAdGBH9BAAUgCCAJIAJBAnRqIgAtAAJBAXRqIgEgAS8BACIBQQFqOwEAIAAgAyABEBRrIgU6AAMgACABIAVB/wFxdCAHazsBACACQQFqIQIMAQsLCyEFIAhBgARqJAAgBQvjBgEIf0FsIQcCQCACQQNJDQACQAJAAkACQCABLQAAIgNBA3EiCUEBaw4DAwEAAgsgACgCiOEBDQBBYg8LIAJBBUkNAkEDIQYgASgAACEFAn8CQAJAIANBAnZBA3EiCEF+aiIEQQFNBEAgBEEBaw0BDAILIAVBDnZB/wdxIQQgBUEEdkH/B3EhAyAIRQwCCyAFQRJ2IQRBBCEGIAVBBHZB//8AcSEDQQAMAQsgBUEEdkH//w9xIgNBgIAISw0DIAEtAARBCnQgBUEWdnIhBEEFIQZBAAshBSAEIAZqIgogAksNAgJAIANBgQZJDQAgACgCnOIBRQ0AQQAhAgNAIAJBg4ABSw0BIAJBQGshAgwAAAsACwJ/IAlBA0YEQCABIAZqIQEgAEHw4gFqIQIgACgCDCEGIAUEQCACIAMgASAEIAYQXwwCCyACIAMgASAEIAYQXQwBCyAAQbjQAWohAiABIAZqIQEgAEHw4gFqIQYgAEGo0ABqIQggBQRAIAggBiADIAEgBCACEF4MAQsgCCAGIAMgASAEIAIQXAsQAw0CIAAgAzYCgOIBIABBATYCiOEBIAAgAEHw4gFqNgLw4QEgCUECRgRAIAAgAEGo0ABqNgIMCyAAIANqIgBBiOMBakIANwAAIABBgOMBakIANwAAIABB+OIBakIANwAAIABB8OIBakIANwAAIAoPCwJ/AkACQAJAIANBAnZBA3FBf2oiBEECSw0AIARBAWsOAgACAQtBASEEIANBA3YMAgtBAiEEIAEvAABBBHYMAQtBAyEEIAEQIUEEdgsiAyAEaiIFQSBqIAJLBEAgBSACSw0CIABB8OIBaiABIARqIAMQCyEBIAAgAzYCgOIBIAAgATYC8OEBIAEgA2oiAEIANwAYIABCADcAECAAQgA3AAggAEIANwAAIAUPCyAAIAM2AoDiASAAIAEgBGo2AvDhASAFDwsCfwJAAkACQCADQQJ2QQNxQX9qIgRBAksNACAEQQFrDgIAAgELQQEhByADQQN2DAILQQIhByABLwAAQQR2DAELIAJBBEkgARAhIgJBj4CAAUtyDQFBAyEHIAJBBHYLIQIgAEHw4gFqIAEgB2otAAAgAkEgahAQIQEgACACNgKA4gEgACABNgLw4QEgB0EBaiEHCyAHC0sAIABC+erQ0OfJoeThADcDICAAQgA3AxggAELP1tO+0ser2UI3AxAgAELW64Lu6v2J9eAANwMIIABCADcDACAAQShqQQBBKBAQGgviAgICfwV+IABBKGoiASAAKAJIaiECAn4gACkDACIDQiBaBEAgACkDECIEQgeJIAApAwgiBUIBiXwgACkDGCIGQgyJfCAAKQMgIgdCEol8IAUQGSAEEBkgBhAZIAcQGQwBCyAAKQMYQsXP2bLx5brqJ3wLIAN8IQMDQCABQQhqIgAgAk0EQEIAIAEpAAAQCSADhUIbiUKHla+vmLbem55/fkLj3MqV/M7y9YV/fCEDIAAhAQwBCwsCQCABQQRqIgAgAksEQCABIQAMAQsgASgAAK1Ch5Wvr5i23puef34gA4VCF4lCz9bTvtLHq9lCfkL5893xmfaZqxZ8IQMLA0AgACACSQRAIAAxAABCxc/ZsvHluuonfiADhUILiUKHla+vmLbem55/fiEDIABBAWohAAwBCwsgA0IhiCADhULP1tO+0ser2UJ+IgNCHYggA4VC+fPd8Zn2masWfiIDQiCIIAOFC+8CAgJ/BH4gACAAKQMAIAKtfDcDAAJAAkAgACgCSCIDIAJqIgRBH00EQCABRQ0BIAAgA2pBKGogASACECAgACgCSCACaiEEDAELIAEgAmohAgJ/IAMEQCAAQShqIgQgA2ogAUEgIANrECAgACAAKQMIIAQpAAAQCTcDCCAAIAApAxAgACkAMBAJNwMQIAAgACkDGCAAKQA4EAk3AxggACAAKQMgIABBQGspAAAQCTcDICAAKAJIIQMgAEEANgJIIAEgA2tBIGohAQsgAUEgaiACTQsEQCACQWBqIQMgACkDICEFIAApAxghBiAAKQMQIQcgACkDCCEIA0AgCCABKQAAEAkhCCAHIAEpAAgQCSEHIAYgASkAEBAJIQYgBSABKQAYEAkhBSABQSBqIgEgA00NAAsgACAFNwMgIAAgBjcDGCAAIAc3AxAgACAINwMICyABIAJPDQEgAEEoaiABIAIgAWsiBBAgCyAAIAQ2AkgLCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQEBogAwVBun8LCy8BAX8gAEUEQEG2f0EAIAMbDwtBun8hBCADIAFNBH8gACACIAMQCxogAwVBun8LC6gCAQZ/IwBBEGsiByQAIABB2OABaikDAEKAgIAQViEIQbh/IQUCQCAEQf//B0sNACAAIAMgBBBCIgUQAyIGDQAgACgCnOIBIQkgACAHQQxqIAMgAyAFaiAGGyIKIARBACAFIAYbayIGEEAiAxADBEAgAyEFDAELIAcoAgwhBCABRQRAQbp/IQUgBEEASg0BCyAGIANrIQUgAyAKaiEDAkAgCQRAIABBADYCnOIBDAELAkACQAJAIARBBUgNACAAQdjgAWopAwBCgICACFgNAAwBCyAAQQA2ApziAQwBCyAAKAIIED8hBiAAQQA2ApziASAGQRRPDQELIAAgASACIAMgBSAEIAgQOSEFDAELIAAgASACIAMgBSAEIAgQOiEFCyAHQRBqJAAgBQtnACAAQdDgAWogASACIAAoAuzhARAuIgEQAwRAIAEPC0G4fyECAkAgAQ0AIABB7OABaigCACIBBEBBYCECIAAoApjiASABRw0BC0EAIQIgAEHw4AFqKAIARQ0AIABBkOEBahBDCyACCycBAX8QVyIERQRAQUAPCyAEIAAgASACIAMgBBBLEE8hACAEEFYgAAs/AQF/AkACQAJAIAAoAqDiAUEBaiIBQQJLDQAgAUEBaw4CAAECCyAAEDBBAA8LIABBADYCoOIBCyAAKAKU4gELvAMCB38BfiMAQRBrIgkkAEG4fyEGAkAgBCgCACIIQQVBCSAAKALs4QEiBRtJDQAgAygCACIHQQFBBSAFGyAFEC8iBRADBEAgBSEGDAELIAggBUEDakkNACAAIAcgBRBJIgYQAw0AIAEgAmohCiAAQZDhAWohCyAIIAVrIQIgBSAHaiEHIAEhBQNAIAcgAiAJECwiBhADDQEgAkF9aiICIAZJBEBBuH8hBgwCCyAJKAIAIghBAksEQEFsIQYMAgsgB0EDaiEHAn8CQAJAAkAgCEEBaw4CAgABCyAAIAUgCiAFayAHIAYQSAwCCyAFIAogBWsgByAGEEcMAQsgBSAKIAVrIActAAAgCSgCCBBGCyIIEAMEQCAIIQYMAgsgACgC8OABBEAgCyAFIAgQRQsgAiAGayECIAYgB2ohByAFIAhqIQUgCSgCBEUNAAsgACkD0OABIgxCf1IEQEFsIQYgDCAFIAFrrFINAQsgACgC8OABBEBBaiEGIAJBBEkNASALEEQhDCAHKAAAIAynRw0BIAdBBGohByACQXxqIQILIAMgBzYCACAEIAI2AgAgBSABayEGCyAJQRBqJAAgBgsuACAAECsCf0EAQQAQAw0AGiABRSACRXJFBEBBYiAAIAEgAhA9EAMNARoLQQALCzcAIAEEQCAAIAAoAsTgASABKAIEIAEoAghqRzYCnOIBCyAAECtBABADIAFFckUEQCAAIAEQWwsL0QIBB38jAEEQayIGJAAgBiAENgIIIAYgAzYCDCAFBEAgBSgCBCEKIAUoAgghCQsgASEIAkACQANAIAAoAuzhARAWIQsCQANAIAQgC0kNASADKAAAQXBxQdDUtMIBRgRAIAMgBBAiIgcQAw0EIAQgB2shBCADIAdqIQMMAQsLIAYgAzYCDCAGIAQ2AggCQCAFBEAgACAFEE5BACEHQQAQA0UNAQwFCyAAIAogCRBNIgcQAw0ECyAAIAgQUCAMQQFHQQAgACAIIAIgBkEMaiAGQQhqEEwiByIDa0EAIAMQAxtBCkdyRQRAQbh/IQcMBAsgBxADDQMgAiAHayECIAcgCGohCEEBIQwgBigCDCEDIAYoAgghBAwBCwsgBiADNgIMIAYgBDYCCEG4fyEHIAQNASAIIAFrIQcMAQsgBiADNgIMIAYgBDYCCAsgBkEQaiQAIAcLRgECfyABIAAoArjgASICRwRAIAAgAjYCxOABIAAgATYCuOABIAAoArzgASEDIAAgATYCvOABIAAgASADIAJrajYCwOABCwutAgIEfwF+IwBBQGoiBCQAAkACQCACQQhJDQAgASgAAEFwcUHQ1LTCAUcNACABIAIQIiEBIABCADcDCCAAQQA2AgQgACABNgIADAELIARBGGogASACEC0iAxADBEAgACADEBoMAQsgAwRAIABBuH8QGgwBCyACIAQoAjAiA2shAiABIANqIQMDQAJAIAAgAyACIARBCGoQLCIFEAMEfyAFBSACIAVBA2oiBU8NAUG4fwsQGgwCCyAGQQFqIQYgAiAFayECIAMgBWohAyAEKAIMRQ0ACyAEKAI4BEAgAkEDTQRAIABBuH8QGgwCCyADQQRqIQMLIAQoAighAiAEKQMYIQcgAEEANgIEIAAgAyABazYCACAAIAIgBmytIAcgB0J/URs3AwgLIARBQGskAAslAQF/IwBBEGsiAiQAIAIgACABEFEgAigCACEAIAJBEGokACAAC30BBH8jAEGQBGsiBCQAIARB/wE2AggCQCAEQRBqIARBCGogBEEMaiABIAIQFSIGEAMEQCAGIQUMAQtBVCEFIAQoAgwiB0EGSw0AIAMgBEEQaiAEKAIIIAcQQSIFEAMNACAAIAEgBmogAiAGayADEDwhBQsgBEGQBGokACAFC4cBAgJ/An5BABAWIQMCQANAIAEgA08EQAJAIAAoAABBcHFB0NS0wgFGBEAgACABECIiAhADRQ0BQn4PCyAAIAEQVSIEQn1WDQMgBCAFfCIFIARUIQJCfiEEIAINAyAAIAEQUiICEAMNAwsgASACayEBIAAgAmohAAwBCwtCfiAFIAEbIQQLIAQLPwIBfwF+IwBBMGsiAiQAAn5CfiACQQhqIAAgARAtDQAaQgAgAigCHEEBRg0AGiACKQMICyEDIAJBMGokACADC40BAQJ/IwBBMGsiASQAAkAgAEUNACAAKAKI4gENACABIABB/OEBaigCADYCKCABIAApAvThATcDICAAEDAgACgCqOIBIQIgASABKAIoNgIYIAEgASkDIDcDECACIAFBEGoQGyAAQQA2AqjiASABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALKgECfyMAQRBrIgAkACAAQQA2AgggAEIANwMAIAAQWCEBIABBEGokACABC4cBAQN/IwBBEGsiAiQAAkAgACgCAEUgACgCBEVzDQAgAiAAKAIINgIIIAIgACkCADcDAAJ/IAIoAgAiAQRAIAIoAghBqOMJIAERBQAMAQtBqOMJECgLIgFFDQAgASAAKQIANwL04QEgAUH84QFqIAAoAgg2AgAgARBZIAEhAwsgAkEQaiQAIAMLywEBAn8jAEEgayIBJAAgAEGBgIDAADYCtOIBIABBADYCiOIBIABBADYC7OEBIABCADcDkOIBIABBADYCpOMJIABBADYC3OIBIABCADcCzOIBIABBADYCvOIBIABBADYCxOABIABCADcCnOIBIABBpOIBakIANwIAIABBrOIBakEANgIAIAFCADcCECABQgA3AhggASABKQMYNwMIIAEgASkDEDcDACABKAIIQQh2QQFxIQIgAEEANgLg4gEgACACNgKM4gEgAUEgaiQAC3YBA38jAEEwayIBJAAgAARAIAEgAEHE0AFqIgIoAgA2AiggASAAKQK80AE3AyAgACgCACEDIAEgAigCADYCGCABIAApArzQATcDECADIAFBEGoQGyABIAEoAig2AgggASABKQMgNwMAIAAgARAbCyABQTBqJAALzAEBAX8gACABKAK00AE2ApjiASAAIAEoAgQiAjYCwOABIAAgAjYCvOABIAAgAiABKAIIaiICNgK44AEgACACNgLE4AEgASgCuNABBEAgAEKBgICAEDcDiOEBIAAgAUGk0ABqNgIMIAAgAUGUIGo2AgggACABQZwwajYCBCAAIAFBDGo2AgAgAEGs0AFqIAFBqNABaigCADYCACAAQbDQAWogAUGs0AFqKAIANgIAIABBtNABaiABQbDQAWooAgA2AgAPCyAAQgA3A4jhAQs7ACACRQRAQbp/DwsgBEUEQEFsDwsgAiAEEGAEQCAAIAEgAiADIAQgBRBhDwsgACABIAIgAyAEIAUQZQtGAQF/IwBBEGsiBSQAIAVBCGogBBAOAn8gBS0ACQRAIAAgASACIAMgBBAyDAELIAAgASACIAMgBBA0CyEAIAVBEGokACAACzQAIAAgAyAEIAUQNiIFEAMEQCAFDwsgBSAESQR/IAEgAiADIAVqIAQgBWsgABA1BUG4fwsLRgEBfyMAQRBrIgUkACAFQQhqIAQQDgJ/IAUtAAkEQCAAIAEgAiADIAQQYgwBCyAAIAEgAiADIAQQNQshACAFQRBqJAAgAAtZAQF/QQ8hAiABIABJBEAgAUEEdCAAbiECCyAAQQh2IgEgAkEYbCIAQYwIaigCAGwgAEGICGooAgBqIgJBA3YgAmogAEGACGooAgAgAEGECGooAgAgAWxqSQs3ACAAIAMgBCAFQYAQEDMiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQMgVBuH8LC78DAQN/IwBBIGsiBSQAIAVBCGogAiADEAYiAhADRQRAIAAgAWoiB0F9aiEGIAUgBBAOIARBBGohAiAFLQACIQMDQEEAIAAgBkkgBUEIahAEGwRAIAAgAiAFQQhqIAMQAkECdGoiBC8BADsAACAFQQhqIAQtAAIQASAAIAQtAANqIgQgAiAFQQhqIAMQAkECdGoiAC8BADsAACAFQQhqIAAtAAIQASAEIAAtAANqIQAMAQUgB0F+aiEEA0AgBUEIahAEIAAgBEtyRQRAIAAgAiAFQQhqIAMQAkECdGoiBi8BADsAACAFQQhqIAYtAAIQASAAIAYtAANqIQAMAQsLA0AgACAES0UEQCAAIAIgBUEIaiADEAJBAnRqIgYvAQA7AAAgBUEIaiAGLQACEAEgACAGLQADaiEADAELCwJAIAAgB08NACAAIAIgBUEIaiADEAIiA0ECdGoiAC0AADoAACAALQADQQFGBEAgBUEIaiAALQACEAEMAQsgBSgCDEEfSw0AIAVBCGogAiADQQJ0ai0AAhABIAUoAgxBIUkNACAFQSA2AgwLIAFBbCAFQQhqEAobIQILCwsgBUEgaiQAIAILkgIBBH8jAEFAaiIJJAAgCSADQTQQCyEDAkAgBEECSA0AIAMgBEECdGooAgAhCSADQTxqIAgQIyADQQE6AD8gAyACOgA+QQAhBCADKAI8IQoDQCAEIAlGDQEgACAEQQJ0aiAKNgEAIARBAWohBAwAAAsAC0EAIQkDQCAGIAlGRQRAIAMgBSAJQQF0aiIKLQABIgtBAnRqIgwoAgAhBCADQTxqIAotAABBCHQgCGpB//8DcRAjIANBAjoAPyADIAcgC2siCiACajoAPiAEQQEgASAKa3RqIQogAygCPCELA0AgACAEQQJ0aiALNgEAIARBAWoiBCAKSQ0ACyAMIAo2AgAgCUEBaiEJDAELCyADQUBrJAALowIBCX8jAEHQAGsiCSQAIAlBEGogBUE0EAsaIAcgBmshDyAHIAFrIRADQAJAIAMgCkcEQEEBIAEgByACIApBAXRqIgYtAAEiDGsiCGsiC3QhDSAGLQAAIQ4gCUEQaiAMQQJ0aiIMKAIAIQYgCyAPTwRAIAAgBkECdGogCyAIIAUgCEE0bGogCCAQaiIIQQEgCEEBShsiCCACIAQgCEECdGooAgAiCEEBdGogAyAIayAHIA4QYyAGIA1qIQgMAgsgCUEMaiAOECMgCUEBOgAPIAkgCDoADiAGIA1qIQggCSgCDCELA0AgBiAITw0CIAAgBkECdGogCzYBACAGQQFqIQYMAAALAAsgCUHQAGokAA8LIAwgCDYCACAKQQFqIQoMAAALAAs0ACAAIAMgBCAFEDYiBRADBEAgBQ8LIAUgBEkEfyABIAIgAyAFaiAEIAVrIAAQNAVBuH8LCyMAIAA/AEEQdGtB//8DakEQdkAAQX9GBEBBAA8LQQAQAEEBCzsBAX8gAgRAA0AgACABIAJBgCAgAkGAIEkbIgMQCyEAIAFBgCBqIQEgAEGAIGohACACIANrIgINAAsLCwYAIAAQAwsLqBUJAEGICAsNAQAAAAEAAAACAAAAAgBBoAgLswYBAAAAAQAAAAIAAAACAAAAJgAAAIIAAAAhBQAASgAAAGcIAAAmAAAAwAEAAIAAAABJBQAASgAAAL4IAAApAAAALAIAAIAAAABJBQAASgAAAL4IAAAvAAAAygIAAIAAAACKBQAASgAAAIQJAAA1AAAAcwMAAIAAAACdBQAASgAAAKAJAAA9AAAAgQMAAIAAAADrBQAASwAAAD4KAABEAAAAngMAAIAAAABNBgAASwAAAKoKAABLAAAAswMAAIAAAADBBgAATQAAAB8NAABNAAAAUwQAAIAAAAAjCAAAUQAAAKYPAABUAAAAmQQAAIAAAABLCQAAVwAAALESAABYAAAA2gQAAIAAAABvCQAAXQAAACMUAABUAAAARQUAAIAAAABUCgAAagAAAIwUAABqAAAArwUAAIAAAAB2CQAAfAAAAE4QAAB8AAAA0gIAAIAAAABjBwAAkQAAAJAHAACSAAAAAAAAAAEAAAABAAAABQAAAA0AAAAdAAAAPQAAAH0AAAD9AAAA/QEAAP0DAAD9BwAA/Q8AAP0fAAD9PwAA/X8AAP3/AAD9/wEA/f8DAP3/BwD9/w8A/f8fAP3/PwD9/38A/f//AP3//wH9//8D/f//B/3//w/9//8f/f//P/3//38AAAAAAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABEAAAASAAAAEwAAABQAAAAVAAAAFgAAABcAAAAYAAAAGQAAABoAAAAbAAAAHAAAAB0AAAAeAAAAHwAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAKAAAACwAAAAwAAAANAAAADgAAAA8AAAAQAAAAEQAAABIAAAATAAAAFAAAABUAAAAWAAAAFwAAABgAAAAZAAAAGgAAABsAAAAcAAAAHQAAAB4AAAAfAAAAIAAAACEAAAAiAAAAIwAAACUAAAAnAAAAKQAAACsAAAAvAAAAMwAAADsAAABDAAAAUwAAAGMAAACDAAAAAwEAAAMCAAADBAAAAwgAAAMQAAADIAAAA0AAAAOAAAADAAEAQeAPC1EBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAEAAAABQAAAAcAAAAIAAAACQAAAAoAAAALAAAADAAAAA0AAAAOAAAADwAAABAAQcQQC4sBAQAAAAIAAAADAAAABAAAAAUAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAABIAAAAUAAAAFgAAABgAAAAcAAAAIAAAACgAAAAwAAAAQAAAAIAAAAAAAQAAAAIAAAAEAAAACAAAABAAAAAgAAAAQAAAAIAAAAAAAQBBkBIL5gQBAAAAAQAAAAEAAAABAAAAAgAAAAIAAAADAAAAAwAAAAQAAAAGAAAABwAAAAgAAAAJAAAACgAAAAsAAAAMAAAADQAAAA4AAAAPAAAAEAAAAAEAAAAEAAAACAAAAAAAAAABAAEBBgAAAAAAAAQAAAAAEAAABAAAAAAgAAAFAQAAAAAAAAUDAAAAAAAABQQAAAAAAAAFBgAAAAAAAAUHAAAAAAAABQkAAAAAAAAFCgAAAAAAAAUMAAAAAAAABg4AAAAAAAEFEAAAAAAAAQUUAAAAAAABBRYAAAAAAAIFHAAAAAAAAwUgAAAAAAAEBTAAAAAgAAYFQAAAAAAABwWAAAAAAAAIBgABAAAAAAoGAAQAAAAADAYAEAAAIAAABAAAAAAAAAAEAQAAAAAAAAUCAAAAIAAABQQAAAAAAAAFBQAAACAAAAUHAAAAAAAABQgAAAAgAAAFCgAAAAAAAAULAAAAAAAABg0AAAAgAAEFEAAAAAAAAQUSAAAAIAABBRYAAAAAAAIFGAAAACAAAwUgAAAAAAADBSgAAAAAAAYEQAAAABAABgRAAAAAIAAHBYAAAAAAAAkGAAIAAAAACwYACAAAMAAABAAAAAAQAAAEAQAAACAAAAUCAAAAIAAABQMAAAAgAAAFBQAAACAAAAUGAAAAIAAABQgAAAAgAAAFCQAAACAAAAULAAAAIAAABQwAAAAAAAAGDwAAACAAAQUSAAAAIAABBRQAAAAgAAIFGAAAACAAAgUcAAAAIAADBSgAAAAgAAQFMAAAAAAAEAYAAAEAAAAPBgCAAAAAAA4GAEAAAAAADQYAIABBgBcLhwIBAAEBBQAAAAAAAAUAAAAAAAAGBD0AAAAAAAkF/QEAAAAADwX9fwAAAAAVBf3/HwAAAAMFBQAAAAAABwR9AAAAAAAMBf0PAAAAABIF/f8DAAAAFwX9/38AAAAFBR0AAAAAAAgE/QAAAAAADgX9PwAAAAAUBf3/DwAAAAIFAQAAABAABwR9AAAAAAALBf0HAAAAABEF/f8BAAAAFgX9/z8AAAAEBQ0AAAAQAAgE/QAAAAAADQX9HwAAAAATBf3/BwAAAAEFAQAAABAABgQ9AAAAAAAKBf0DAAAAABAF/f8AAAAAHAX9//8PAAAbBf3//wcAABoF/f//AwAAGQX9//8BAAAYBf3//wBBkBkLhgQBAAEBBgAAAAAAAAYDAAAAAAAABAQAAAAgAAAFBQAAAAAAAAUGAAAAAAAABQgAAAAAAAAFCQAAAAAAAAULAAAAAAAABg0AAAAAAAAGEAAAAAAAAAYTAAAAAAAABhYAAAAAAAAGGQAAAAAAAAYcAAAAAAAABh8AAAAAAAAGIgAAAAAAAQYlAAAAAAABBikAAAAAAAIGLwAAAAAAAwY7AAAAAAAEBlMAAAAAAAcGgwAAAAAACQYDAgAAEAAABAQAAAAAAAAEBQAAACAAAAUGAAAAAAAABQcAAAAgAAAFCQAAAAAAAAUKAAAAAAAABgwAAAAAAAAGDwAAAAAAAAYSAAAAAAAABhUAAAAAAAAGGAAAAAAAAAYbAAAAAAAABh4AAAAAAAAGIQAAAAAAAQYjAAAAAAABBicAAAAAAAIGKwAAAAAAAwYzAAAAAAAEBkMAAAAAAAUGYwAAAAAACAYDAQAAIAAABAQAAAAwAAAEBAAAABAAAAQFAAAAIAAABQcAAAAgAAAFCAAAACAAAAUKAAAAIAAABQsAAAAAAAAGDgAAAAAAAAYRAAAAAAAABhQAAAAAAAAGFwAAAAAAAAYaAAAAAAAABh0AAAAAAAAGIAAAAAAAEAYDAAEAAAAPBgOAAAAAAA4GA0AAAAAADQYDIAAAAAAMBgMQAAAAAAsGAwgAAAAACgYDBABBpB0L2QEBAAAAAwAAAAcAAAAPAAAAHwAAAD8AAAB/AAAA/wAAAP8BAAD/AwAA/wcAAP8PAAD/HwAA/z8AAP9/AAD//wAA//8BAP//AwD//wcA//8PAP//HwD//z8A//9/AP///wD///8B////A////wf///8P////H////z////9/AAAAAAEAAAACAAAABAAAAAAAAAACAAAABAAAAAgAAAAAAAAAAQAAAAIAAAABAAAABAAAAAQAAAAEAAAABAAAAAgAAAAIAAAACAAAAAcAAAAIAAAACQAAAAoAAAALAEGgIAsDwBBQ",ag=new WeakMap;let hg,cg=0;class lg extends vc{constructor(t){super(t),this.transcoderPath="",this.transcoderBinary=null,this.transcoderPending=null,this.workerPool=new Df,this.workerSourceURL="",this.workerConfig=null,"undefined"!=typeof MSC_TRANSCODER&&console.warn('THREE.KTX2Loader: Please update to latest "basis_transcoder". "msc_basis_transcoder" is no longer supported in three.js r125+.')}setTranscoderPath(t){return this.transcoderPath=t,this}setWorkerLimit(t){return this.workerPool.setWorkerLimit(t),this}async detectSupportAsync(t){return this.workerConfig={astcSupported:await t.hasFeatureAsync("texture-compression-astc"),etc1Supported:await t.hasFeatureAsync("texture-compression-etc1"),etc2Supported:await t.hasFeatureAsync("texture-compression-etc2"),dxtSupported:await t.hasFeatureAsync("texture-compression-bc"),bptcSupported:await t.hasFeatureAsync("texture-compression-bptc"),pvrtcSupported:await t.hasFeatureAsync("texture-compression-pvrtc")},this}detectSupport(t){return!0===t.isWebGPURenderer?this.workerConfig={astcSupported:t.hasFeature("texture-compression-astc"),etc1Supported:t.hasFeature("texture-compression-etc1"),etc2Supported:t.hasFeature("texture-compression-etc2"),dxtSupported:t.hasFeature("texture-compression-bc"),bptcSupported:t.hasFeature("texture-compression-bptc"),pvrtcSupported:t.hasFeature("texture-compression-pvrtc")}:this.workerConfig={astcSupported:t.extensions.has("WEBGL_compressed_texture_astc"),etc1Supported:t.extensions.has("WEBGL_compressed_texture_etc1"),etc2Supported:t.extensions.has("WEBGL_compressed_texture_etc"),dxtSupported:t.extensions.has("WEBGL_compressed_texture_s3tc"),bptcSupported:t.extensions.has("EXT_texture_compression_bptc"),pvrtcSupported:t.extensions.has("WEBGL_compressed_texture_pvrtc")||t.extensions.has("WEBKIT_WEBGL_compressed_texture_pvrtc")},this}init(){if(!this.transcoderPending){const t=new Cc(this.manager);t.setPath(this.transcoderPath),t.setWithCredentials(this.withCredentials);const e=t.loadAsync("basis_transcoder.js"),i=new Cc(this.manager);i.setPath(this.transcoderPath),i.setResponseType("arraybuffer"),i.setWithCredentials(this.withCredentials);const n=i.loadAsync("basis_transcoder.wasm");this.transcoderPending=Promise.all([e,n]).then((([t,e])=>{const i=lg.BasisWorker.toString(),n=["/* constants */","let _EngineFormat = "+JSON.stringify(lg.EngineFormat),"let _TranscoderFormat = "+JSON.stringify(lg.TranscoderFormat),"let _BasisFormat = "+JSON.stringify(lg.BasisFormat),"/* basis_transcoder.js */",t,"/* worker */",i.substring(i.indexOf("{")+1,i.lastIndexOf("}"))].join("\n");this.workerSourceURL=URL.createObjectURL(new Blob([n])),this.transcoderBinary=e,this.workerPool.setWorkerCreator((()=>{const t=new Worker(this.workerSourceURL),e=this.transcoderBinary.slice(0);return t.postMessage({type:"init",config:this.workerConfig,transcoderBinary:e},[e]),t}))})),cg>0&&console.warn("THREE.KTX2Loader: Multiple active KTX2 loaders may cause performance issues. Use a single KTX2Loader instance, or call .dispose() on old instances."),cg++}return this.transcoderPending}load(t,e,i,n){if(null===this.workerConfig)throw new Error("THREE.KTX2Loader: Missing initialization with `.detectSupport( renderer )`.");const s=new Cc(this.manager);s.setResponseType("arraybuffer"),s.setWithCredentials(this.withCredentials),s.load(t,(t=>{if(ag.has(t)){return ag.get(t).promise.then(e).catch(n)}this._createTexture(t).then((t=>e?e(t):null)).catch(n)}),i,n)}_createTextureFrom(t,e){const{faces:i,width:n,height:s,format:r,type:o,error:a,dfdFlags:h}=t;if("error"===o)return Promise.reject(a);let c;if(6===e.faceCount)c=new Za(i,r,K);else{const t=i[0].mipmaps;c=e.layerCount>1?new Xa(t,n,s,e.layerCount,r,K):new Ka(t,n,s,r,K)}return c.minFilter=1===i[0].mipmaps.length?j:Y,c.magFilter=j,c.generateMipmaps=!1,c.needsUpdate=!0,c.colorSpace=fg(e),c.premultiplyAlpha=!!(1&h),c}async _createTexture(t,e={}){const i=function(t){const e=new Uint8Array(t.buffer,t.byteOffset,$f.length);if(e[0]!==$f[0]||e[1]!==$f[1]||e[2]!==$f[2]||e[3]!==$f[3]||e[4]!==$f[4]||e[5]!==$f[5]||e[6]!==$f[6]||e[7]!==$f[7]||e[8]!==$f[8]||e[9]!==$f[9]||e[10]!==$f[10]||e[11]!==$f[11])throw new Error("Missing KTX 2.0 identifier.");const i=new Xf,n=17*Uint32Array.BYTES_PER_ELEMENT,s=new Zf(t,$f.length,n,!0);i.vkFormat=s._nextUint32(),i.typeSize=s._nextUint32(),i.pixelWidth=s._nextUint32(),i.pixelHeight=s._nextUint32(),i.pixelDepth=s._nextUint32(),i.layerCount=s._nextUint32(),i.faceCount=s._nextUint32();const r=s._nextUint32();i.supercompressionScheme=s._nextUint32();const o=s._nextUint32(),a=s._nextUint32(),h=s._nextUint32(),c=s._nextUint32(),l=s._nextUint64(),A=s._nextUint64(),u=new Zf(t,$f.length+n,3*r*8,!0);for(let e=0;e<r;e++)i.levels.push({levelData:new Uint8Array(t.buffer,t.byteOffset+u._nextUint64(),u._nextUint64()),uncompressedByteLength:u._nextUint64()});const d=new Zf(t,o,a,!0),f={vendorId:d._skip(4)._nextUint16(),descriptorType:d._nextUint16(),versionNumber:d._nextUint16(),descriptorBlockSize:d._nextUint16(),colorModel:d._nextUint8(),colorPrimaries:d._nextUint8(),transferFunction:d._nextUint8(),flags:d._nextUint8(),texelBlockDimension:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],bytesPlane:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],samples:[]},g=(f.descriptorBlockSize/4-6)/4;for(let t=0;t<g;t++){const e={bitOffset:d._nextUint16(),bitLength:d._nextUint8(),channelType:d._nextUint8(),samplePosition:[d._nextUint8(),d._nextUint8(),d._nextUint8(),d._nextUint8()],sampleLower:-1/0,sampleUpper:1/0};64&e.channelType?(e.sampleLower=d._nextInt32(),e.sampleUpper=d._nextInt32()):(e.sampleLower=d._nextUint32(),e.sampleUpper=d._nextUint32()),f.samples[t]=e}i.dataFormatDescriptor.length=0,i.dataFormatDescriptor.push(f);const p=new Zf(t,h,c,!0);for(;p._offset<c;){const t=p._nextUint32(),e=p._scan(t),n=tg(e),s=p._scan(t-e.byteLength);i.keyValue[n]=n.match(/^ktx/i)?tg(s):s,p._offset%4&&p._skip(4-p._offset%4)}if(A<=0)return i;const m=new Zf(t,l,A,!0),v=m._nextUint16(),b=m._nextUint16(),E=m._nextUint32(),C=m._nextUint32(),I=m._nextUint32(),w=m._nextUint32(),_=[];for(let t=0;t<r;t++)_.push({imageFlags:m._nextUint32(),rgbSliceByteOffset:m._nextUint32(),rgbSliceByteLength:m._nextUint32(),alphaSliceByteOffset:m._nextUint32(),alphaSliceByteLength:m._nextUint32()});const B=l+m._offset,S=B+E,M=S+C,x=M+I,y=new Uint8Array(t.buffer,t.byteOffset+B,E),Q=new Uint8Array(t.buffer,t.byteOffset+S,C),T=new Uint8Array(t.buffer,t.byteOffset+M,I),D=new Uint8Array(t.buffer,t.byteOffset+x,w);return i.globalData={endpointCount:v,selectorCount:b,imageDescs:_,endpointsData:y,selectorsData:Q,tablesData:T,extendedData:D},i}(new Uint8Array(t));if(0!==i.vkFormat)return async function(t){const{vkFormat:e}=t;if(void 0===ug[e])throw new Error("THREE.KTX2Loader: Unsupported vkFormat.");let i;2===t.supercompressionScheme&&(hg||(hg=new Promise((async t=>{const e=new rg;await e.init(),t(e)}))),i=await hg);const n=[];for(let s=0;s<t.levels.length;s++){const r=Math.max(1,t.pixelWidth>>s),o=Math.max(1,t.pixelHeight>>s),a=t.pixelDepth?Math.max(1,t.pixelDepth>>s):0,h=t.levels[s];let c,l;if(0===t.supercompressionScheme)c=h.levelData;else{if(2!==t.supercompressionScheme)throw new Error("THREE.KTX2Loader: Unsupported supercompressionScheme.");c=i.decode(h.levelData,h.uncompressedByteLength)}l=dg[e]===tt?new Float32Array(c.buffer,c.byteOffset,c.byteLength/Float32Array.BYTES_PER_ELEMENT):dg[e]===et?new Uint16Array(c.buffer,c.byteOffset,c.byteLength/Uint16Array.BYTES_PER_ELEMENT):c,n.push({data:l,width:r,height:o,depth:a})}let s;if(Ag.has(ug[e]))s=0===t.pixelDepth?new pa(n[0].data,t.pixelWidth,t.pixelHeight):new Pe(n[0].data,t.pixelWidth,t.pixelHeight,t.pixelDepth);else{if(t.pixelDepth>0)throw new Error("THREE.KTX2Loader: Unsupported pixelDepth.");s=new Ka(n,t.pixelWidth,t.pixelHeight)}return s.mipmaps=n,s.type=dg[e],s.format=ug[e],s.colorSpace=fg(t),s.needsUpdate=!0,Promise.resolve(s)}(i);const n=e,s=this.init().then((()=>this.workerPool.postMessage({type:"transcode",buffer:t,taskConfig:n},[t]))).then((t=>this._createTextureFrom(t.data,i)));return ag.set(t,{promise:s}),s}dispose(){return this.workerPool.dispose(),this.workerSourceURL&&URL.revokeObjectURL(this.workerSourceURL),cg--,this}}lg.BasisFormat={ETC1S:0,UASTC_4x4:1},lg.TranscoderFormat={ETC1:0,ETC2:1,BC1:2,BC3:3,BC4:4,BC5:5,BC7_M6_OPAQUE_ONLY:6,BC7_M5:7,PVRTC1_4_RGB:8,PVRTC1_4_RGBA:9,ASTC_4x4:10,ATC_RGB:11,ATC_RGBA_INTERPOLATED_ALPHA:12,RGBA32:13,RGB565:14,BGR565:15,RGBA4444:16},lg.EngineFormat={RGBAFormat:nt,RGBA_ASTC_4x4_Format:vt,RGBA_BPTC_Format:Et,RGBA_ETC2_EAC_Format:mt,RGBA_PVRTC_4BPPV1_Format:ft,RGBA_S3TC_DXT5_Format:ut,RGB_ETC1_Format:gt,RGB_ETC2_Format:pt,RGB_PVRTC_4BPPV1_Format:dt,RGBA_S3TC_DXT1_Format:lt},lg.BasisWorker=function(){let t,e,i;const n=_EngineFormat,s=_TranscoderFormat,r=_BasisFormat;self.addEventListener("message",(function(o){const A=o.data;switch(A.type){case"init":t=A.config,u=A.transcoderBinary,e=new Promise((t=>{i={wasmBinary:u,onRuntimeInitialized:t},BASIS(i)})).then((()=>{i.initializeBasis(),void 0===i.KTX2File&&console.warn("THREE.KTX2Loader: Please update Basis Universal transcoder.")}));break;case"transcode":e.then((()=>{try{const{faces:e,buffers:o,width:u,height:d,hasAlpha:f,format:g,dfdFlags:p}=function(e){const o=new i.KTX2File(new Uint8Array(e));function A(){o.close(),o.delete()}if(!o.isValid())throw A(),new Error("THREE.KTX2Loader:\tInvalid or unsupported .ktx2 file");const u=o.isUASTC()?r.UASTC_4x4:r.ETC1S,d=o.getWidth(),f=o.getHeight(),g=o.getLayers()||1,p=o.getLevels(),m=o.getFaces(),v=o.getHasAlpha(),b=o.getDFDFlags(),{transcoderFormat:E,engineFormat:C}=function(e,i,o,l){let A,u;const d=e===r.ETC1S?a:h;for(let n=0;n<d.length;n++){const s=d[n];if(t[s.if]&&(s.basisFormat.includes(e)&&!(l&&s.transcoderFormat.length<2)&&(!s.needsPowerOfTwo||c(i)&&c(o))))return A=s.transcoderFormat[l?1:0],u=s.engineFormat[l?1:0],{transcoderFormat:A,engineFormat:u}}return console.warn("THREE.KTX2Loader: No suitable compressed texture format found. Decoding to RGBA32."),A=s.RGBA32,u=n.RGBAFormat,{transcoderFormat:A,engineFormat:u}}(u,d,f,v);if(!d||!f||!p)throw A(),new Error("THREE.KTX2Loader:\tInvalid texture");if(!o.startTranscoding())throw A(),new Error("THREE.KTX2Loader: .startTranscoding failed");const I=[],w=[];for(let t=0;t<m;t++){const e=[];for(let i=0;i<p;i++){const n=[];let s,r;for(let e=0;e<g;e++){const a=o.getImageLevelInfo(i,e,t);0!==t||0!==i||0!==e||a.origWidth%4==0&&a.origHeight%4==0||console.warn("THREE.KTX2Loader: ETC1S and UASTC textures should use multiple-of-four dimensions."),p>1?(s=a.origWidth,r=a.origHeight):(s=a.width,r=a.height);const h=new Uint8Array(o.getImageTranscodedSizeInBytes(i,e,0,E));if(!o.transcodeImage(h,i,e,t,E,0,-1,-1))throw A(),new Error("THREE.KTX2Loader: .transcodeImage failed.");n.push(h)}const a=l(n);e.push({data:a,width:s,height:r}),w.push(a.buffer)}I.push({mipmaps:e,width:d,height:f,format:C})}return A(),{faces:I,buffers:w,width:d,height:f,hasAlpha:v,format:C,dfdFlags:b}}(A.buffer);self.postMessage({type:"transcode",id:A.id,faces:e,width:u,height:d,hasAlpha:f,format:g,dfdFlags:p},o)}catch(t){console.error(t),self.postMessage({type:"error",id:A.id,error:t.message})}}))}var u}));const o=[{if:"astcSupported",basisFormat:[r.UASTC_4x4],transcoderFormat:[s.ASTC_4x4,s.ASTC_4x4],engineFormat:[n.RGBA_ASTC_4x4_Format,n.RGBA_ASTC_4x4_Format],priorityETC1S:1/0,priorityUASTC:1,needsPowerOfTwo:!1},{if:"bptcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.BC7_M5,s.BC7_M5],engineFormat:[n.RGBA_BPTC_Format,n.RGBA_BPTC_Format],priorityETC1S:3,priorityUASTC:2,needsPowerOfTwo:!1},{if:"dxtSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.BC1,s.BC3],engineFormat:[n.RGBA_S3TC_DXT1_Format,n.RGBA_S3TC_DXT5_Format],priorityETC1S:4,priorityUASTC:5,needsPowerOfTwo:!1},{if:"etc2Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.ETC1,s.ETC2],engineFormat:[n.RGB_ETC2_Format,n.RGBA_ETC2_EAC_Format],priorityETC1S:1,priorityUASTC:3,needsPowerOfTwo:!1},{if:"etc1Supported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.ETC1],engineFormat:[n.RGB_ETC1_Format],priorityETC1S:2,priorityUASTC:4,needsPowerOfTwo:!1},{if:"pvrtcSupported",basisFormat:[r.ETC1S,r.UASTC_4x4],transcoderFormat:[s.PVRTC1_4_RGB,s.PVRTC1_4_RGBA],engineFormat:[n.RGB_PVRTC_4BPPV1_Format,n.RGBA_PVRTC_4BPPV1_Format],priorityETC1S:5,priorityUASTC:6,needsPowerOfTwo:!0}],a=o.sort((function(t,e){return t.priorityETC1S-e.priorityETC1S})),h=o.sort((function(t,e){return t.priorityUASTC-e.priorityUASTC}));function c(t){return t<=2||!(t&t-1)&&0!==t}function l(t){if(1===t.length)return t[0];let e=0;for(let i=0;i<t.length;i++){e+=t[i].byteLength}const i=new Uint8Array(e);let n=0;for(let e=0;e<t.length;e++){const s=t[e];i.set(s,n),n+=s.byteLength}return i}};const Ag=new Set([nt,at,ot]),ug={[Jf]:nt,[qf]:nt,[Gf]:nt,[Hf]:nt,[jf]:at,[zf]:at,[Ff]:at,[Of]:at,[Wf]:ot,[Vf]:ot,[kf]:ot,[Nf]:ot,[Kf]:bt,[Yf]:bt},dg={[Jf]:tt,[qf]:et,[Gf]:K,[Hf]:K,[jf]:tt,[zf]:et,[Ff]:K,[Of]:K,[Wf]:tt,[Vf]:et,[kf]:K,[Nf]:K,[Kf]:K,[Yf]:K};function fg(t){const e=t.dataFormatDescriptor[0];return e.colorPrimaries===Pf?e.transferFunction===Lf?Qt:Tt:e.colorPrimaries===Uf?e.transferFunction===Lf?Dt:Lt:(e.colorPrimaries===Rf||console.warn(`THREE.KTX2Loader: Unsupported color primaries, "${e.colorPrimaries}"`),yt)}var gg,pg,mg,vg,bg=function(){var t=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),e=new Uint8Array([32,0,65,2,1,106,34,33,3,128,11,4,13,64,6,253,10,7,15,116,127,5,8,12,40,16,19,54,20,9,27,255,113,17,42,67,24,23,146,148,18,14,22,45,70,69,56,114,101,21,25,63,75,136,108,28,118,29,73,115]);if("object"!=typeof WebAssembly)return{supported:!1};var i,n=WebAssembly.validate(t)?"b9H79TebbbeKl9Gbb9Gvuuuuueu9Giuuub9Geueuikqbbebeedddilve9Weeeviebeoweuec:q;Aekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbdY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVblE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtboK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbrL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbwl79IV9RbDq;t9tqlbzik9:evu8Jjjjjbcz9Rhbcbheincbhdcbhiinabcwfadfaicjuaead4ceGglE86bbaialfhiadcefgdcw9hmbkaec:q:yjjbfai86bbaecitc:q1jjbfab8Piw83ibaecefgecjd9hmbkk;h8JlHud97euo978Jjjjjbcj;kb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Rad;8qbbcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhwcbhDinaDae9pmeawaeaD9RaDawfae6Egqcsfgoc9WGgkci2hxakcethmaocl4cifcd4hPabaDad2fhscbhzdnincehHalhOcbhAdninaraO9RaP6miavcj;cbfaAak2fhCaOaPfhlcbhidnakc;ab6mbaral9Rc;Gb6mbcbhoinaCaofhidndndndndnaOaoco4fRbbgXciGPlbedibkaipxbbbbbbbbbbbbbbbbpklbxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklbalczfhlkdndndndndnaXcd4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklzxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklzalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklzalczfhlkdndndndndnaXcl4ciGPlbedibkaipxbbbbbbbbbbbbbbbbpklaxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklaalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaialpbbbpklaalczfhlkdndndndndnaXco4Plbedibkaipxbbbbbbbbbbbbbbbbpkl8WxikaialpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalclfaYpQbfaXc:q:yjjbfRbbfhlxdkaialpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibaXc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgXcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spkl8WalcwfaYpQbfaXc:q:yjjbfRbbfhlxekaialpbbbpkl8Walczfhlkaoc;abfhiaocjefak0meaihoaral9Rc;Fb0mbkkdndnaiak9pmbaici4hoinaral9RcK6mdaCaifhXdndndndndnaOaico4fRbbaocoG4ciGPlbedibkaXpxbbbbbbbbbbbbbbbbpklbxikaXalpbblalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLgQcdp:meaQpmbzeHdOiAlCvXoQrLpxiiiiiiiiiiiiiiiip9ogLpxiiiiiiiiiiiiiiiip8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalclfaYpQbfaKc:q:yjjbfRbbfhlxdkaXalpbbwalpbbbgQclp:meaQpmbzeHdOiAlCvXoQrLpxssssssssssssssssp9ogLpxssssssssssssssssp8JgQp5b9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibaKc:q:yjjbfpbbbgYaYpmbbbbbbbbbbbbbbbbaQp5e9cjF;8;4;W;G;ab9:9cU1:NgKcitc:q1jjbfpbibp9UpmbedilvorzHOACXQLpPaLaQp9spklbalcwfaYpQbfaKc:q:yjjbfRbbfhlxekaXalpbbbpklbalczfhlkaocdfhoaiczfgiak6mbkkalTmbaAci6hHalhOaAcefgohAaoclSmdxekkcbhlaHceGmdkdnakTmbavcjdfazfhiavazfpbdbhYcbhXinaiavcj;cbfaXfgopblbgLcep9TaLpxeeeeeeeeeeeeeeeegQp9op9Hp9rgLaoakfpblbg8Acep9Ta8AaQp9op9Hp9rg8ApmbzeHdOiAlCvXoQrLgEaoamfpblbg3cep9Ta3aQp9op9Hp9rg3aoaxfpblbg5cep9Ta5aQp9op9Hp9rg5pmbzeHdOiAlCvXoQrLg8EpmbezHdiOAlvCXorQLgQaQpmbedibedibedibediaYp9UgYp9AdbbaiadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaEa8EpmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwKDYq8AkEx3m5P8Es8FgLa3a5pmwKDYq8AkEx3m5P8Es8Fg8ApmbezHdiOAlvCXorQLgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfgoaYaLa8ApmwDKYqk8AExm35Ps8E8FgQaQpmbedibedibedibedip9UgYp9AdbbaoadfgoaYaQaQpmlvorlvorlvorlvorp9UgYp9AdbbaoadfgoaYaQaQpmwDqkwDqkwDqkwDqkp9UgYp9AdbbaoadfgoaYaQaQpmxmPsxmPsxmPsxmPsp9UgYp9AdbbaoadfhiaXczfgXak6mbkkazclfgzad6mbkasavcjdfaqad2;8qbbavavcjdfaqcufad2fad;8qbbaqaDfhDc9:hoalmexikkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;kbf8Kjjjjbaokwbz:bjjjbk;uzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecje;8kbavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:EPliuo97eue978Jjjjjbca9Rhidndnadcl9hmbdnaec98GglTmbcbhvabhdinadadpbbbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpkbbadczfhdavclfgval6mbkkalae9pmeaiaeciGgvcdtgdVcbczad9R;8kbaiabalcdtfglad;8qbbdnavTmbaiaipblbgocKp:RecKp:Sep;6egraocwp:RecKp:Sep;6earp;Geaoczp:RecKp:Sep;6egwp;Gep;Kep;LegDpxbbbbbbbbbbbbbbbbp:2egqarpxbbbjbbbjbbbjbbbjgkp9op9rp;Kegrpxbb;:9cbb;:9cbb;:9cbb;:9cararp;MeaDaDp;Meawaqawakp9op9rp;Kegrarp;Mep;Kep;Kep;Jep;Negwp;Mepxbbn0bbn0bbn0bbn0gqp;KepxFbbbFbbbFbbbFbbbp9oaopxbbbFbbbFbbbFbbbFp9op9qarawp;Meaqp;Kecwp:RepxbFbbbFbbbFbbbFbbp9op9qaDawp;Meaqp;Keczp:RepxbbFbbbFbbbFbbbFbp9op9qpklbkalaiad;8qbbskdnaec98GgxTmbcbhvabhdinadczfglalpbbbgopxbbbbbbFFbbbbbbFFgkp9oadpbbbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpkbbadaDakp9oawaopmbezHdiOAlvCXorQLp9qpkbbadcafhdavclfgvax6mbkkaxae9pmbaiaeciGgvcitgdfcbcaad9R;8kbaiabaxcitfglad;8qbbdnavTmbaiaipblzgopxbbbbbbFFbbbbbbFFgkp9oaipblbgDaopmlvorxmPsCXQL358E8FpxFubbFubbFubbFubbp9op;6eaDaopmbediwDqkzHOAKY8AEgoczp:Sep;6egrp;Geaoczp:Reczp:Sep;6egwp;Gep;Kep;Legopxb;:FSb;:FSb;:FSb;:FSawaopxbbbbbbbbbbbbbbbbp:2egqawpxbbbjbbbjbbbjbbbjgmp9op9rp;Kegwawp;Meaoaop;Mearaqaramp9op9rp;Kegoaop;Mep;Kep;Kep;Jep;Negrp;Mepxbbn0bbn0bbn0bbn0gqp;Keczp:Reawarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9op9qgwaoarp;Meaqp;KepxFFbbFFbbFFbbFFbbp9ogopmwDKYqk8AExm35Ps8E8Fp9qpklzaiaDakp9oawaopmbezHdiOAlvCXorQLp9qpklbkalaiad;8qbbkk;4wllue97euv978Jjjjjbc8W9Rhidnaec98GglTmbcbhvabhoinaiaopbbbgraoczfgwpbbbgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklbaopxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblbpEb:T:j83ibaocwfarp5eaipblbpEe:T:j83ibawaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblbpEd:T:j83ibaocKfakp5eaipblbpEi:T:j83ibaocafhoavclfgval6mbkkdnalae9pmbaiaeciGgvcitgofcbcaao9R;8kbaiabalcitfgwao;8qbbdnavTmbaiaipblbgraipblzgDpmlvorxmPsCXQL358E8Fgqczp:Segkclp:RepklaaipxbbjZbbjZbbjZbbjZpx;Zl81Z;Zl81Z;Zl81Z;Zl81Zakpxibbbibbbibbbibbbp9qp;6ep;NegkaraDpmbediwDqkzHOAKY8AEgrczp:Reczp:Sep;6ep;MegDaDp;Meakarczp:Sep;6ep;Megxaxp;Meakaqczp:Reczp:Sep;6ep;Megqaqp;Mep;Kep;Kep;Lepxbbbbbbbbbbbbbbbbp:4ep;Jepxb;:FSb;:FSb;:FSb;:FSgkp;Mepxbbn0bbn0bbn0bbn0grp;KepxFFbbFFbbFFbbFFbbgmp9oaxakp;Mearp;Keczp:Rep9qgxaqakp;Mearp;Keczp:ReaDakp;Mearp;Keamp9op9qgkpmbezHdiOAlvCXorQLgrp5baipblapEb:T:j83ibaiarp5eaipblapEe:T:j83iwaiaxakpmwDKYqk8AExm35Ps8E8Fgkp5baipblapEd:T:j83izaiakp5eaipblapEi:T:j83iKkawaiao;8qbbkk:Pddiue978Jjjjjbc;ab9Rhidnadcd4ae2glc98GgvTmbcbhdabheinaeaepbbbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepkbbaeczfheadclfgdav6mbkkdnaval9pmbaialciGgdcdtgeVcbc;abae9R;8kbaiabavcdtfgvae;8qbbdnadTmbaiaipblbgocwp:Recwp:Sep;6eaocep:SepxbbjZbbjZbbjZbbjZp:UepxbbjFbbjFbbjFbbjFp9op;Mepklbkavaiae;8qbbkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaikkkebcjwklz9Tbb":"b9H79Tebbbe8Fv9Gbb9Gvuuuuueu9Giuuub9Geueu9Giuuueuikqbeeedddillviebeoweuec:q;iekr;leDo9TW9T9VV95dbH9F9F939H79T9F9J9H229F9Jt9VV7bb8A9TW79O9V9Wt9F9KW9J9V9KW9wWVtW949c919M9MWVbeY9TW79O9V9Wt9F9KW9J9V9KW69U9KW949c919M9MWVbdE9TW79O9V9Wt9F9KW9J9V9KW69U9KW949tWG91W9U9JWbiL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9p9JtblK9TW79O9V9Wt9F9KW9J9V9KWS9P2tWV9r919HtbvL9TW79O9V9Wt9F9KW9J9V9KWS9P2tWVT949Wbol79IV9Rbrq:P8Yqdbk;3sezu8Jjjjjbcj;eb9Rgv8Kjjjjbc9:hodnadcefal0mbcuhoaiRbbc:Ge9hmbavaialfgrad9Radz1jjjbhwcj;abad9UhoaicefhldnadTmbaoc;WFbGgocjdaocjd6EhDcbhqinaqae9pmeaDaeaq9RaqaDfae6Egkcsfgocl4cifcd4hxdndndndnaoc9WGgmTmbcbhPcehsawcjdfhzalhHinaraH9Rax6midnaraHaxfgl9RcK6mbczhoinawcj;cbfaogifgoc9WfhOdndndndndnaHaic9WfgAco4fRbbaAci4coG4ciGPlbedibkaO9cb83ibaOcwf9cb83ibxikaOalRblalRbbgAco4gCaCciSgCE86bbaocGfalclfaCfgORbbaAcl4ciGgCaCciSgCE86bbaocVfaOaCfgORbbaAcd4ciGgCaCciSgCE86bbaoc7faOaCfgORbbaAciGgAaAciSgAE86bbaoctfaOaAfgARbbalRbegOco4gCaCciSgCE86bbaoc91faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc4faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc93faAaCfgARbbaOciGgOaOciSgOE86bbaoc94faAaOfgARbbalRbdgOco4gCaCciSgCE86bbaoc95faAaCfgARbbaOcl4ciGgCaCciSgCE86bbaoc96faAaCfgARbbaOcd4ciGgCaCciSgCE86bbaoc97faAaCfgARbbaOciGgOaOciSgOE86bbaoc98faAaOfgORbbalRbiglco4gAaAciSgAE86bbaoc99faOaAfgORbbalcl4ciGgAaAciSgAE86bbaoc9:faOaAfgORbbalcd4ciGgAaAciSgAE86bbaocufaOaAfgoRbbalciGglalciSglE86bbaoalfhlxdkaOalRbwalRbbgAcl4gCaCcsSgCE86bbaocGfalcwfaCfgORbbaAcsGgAaAcsSgAE86bbaocVfaOaAfgORbbalRbegAcl4gCaCcsSgCE86bbaoc7faOaCfgORbbaAcsGgAaAcsSgAE86bbaoctfaOaAfgORbbalRbdgAcl4gCaCcsSgCE86bbaoc91faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc4faOaAfgORbbalRbigAcl4gCaCcsSgCE86bbaoc93faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc94faOaAfgORbbalRblgAcl4gCaCcsSgCE86bbaoc95faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc96faOaAfgORbbalRbvgAcl4gCaCcsSgCE86bbaoc97faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc98faOaAfgORbbalRbogAcl4gCaCcsSgCE86bbaoc99faOaCfgORbbaAcsGgAaAcsSgAE86bbaoc9:faOaAfgORbbalRbrglcl4gAaAcsSgAE86bbaocufaOaAfgoRbbalcsGglalcsSglE86bbaoalfhlxekaOal8Pbb83bbaOcwfalcwf8Pbb83bbalczfhlkdnaiam9pmbaiczfhoaral9RcL0mekkaiam6mialTmidnakTmbawaPfRbbhOcbhoazhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkkazcefhzaPcefgPad6hsalhHaPad9hmexvkkcbhlasceGmdxikalaxad2fhCdnakTmbcbhHcehsawcjdfhminaral9Rax6mialTmdalaxfhlawaHfRbbhOcbhoamhiinaiawcj;cbfaofRbbgAce4cbaAceG9R7aOfgO86bbaiadfhiaocefgoak9hmbkamcefhmaHcefgHad6hsaHad9hmbkaChlxikcbhocehsinaral9Rax6mdalTmealaxfhlaocefgoad6hsadao9hmbkaChlxdkcbhlasceGTmekc9:hoxikabaqad2fawcjdfakad2z1jjjb8Aawawcjdfakcufad2fadz1jjjb8Aakaqfhqalmbkc9:hoxekcbc99aral9Radcaadca0ESEhokavcj;ebf8Kjjjjbaok;yzeHu8Jjjjjbc;ae9Rgv8Kjjjjbc9:hodnaeci9UgrcHfal0mbcuhoaiRbbgwc;WeGc;Ge9hmbawcsGgDce0mbavc;abfcFecjez:jjjjb8AavcUf9cu83ibavc8Wf9cu83ibavcyf9cu83ibavcaf9cu83ibavcKf9cu83ibavczf9cu83ibav9cu83iwav9cu83ibaialfc9WfhqaicefgwarfhodnaeTmbcmcsaDceSEhkcbhxcbhmcbhDcbhicbhlindnaoaq9nmbc9:hoxikdndnawRbbgrc;Ve0mbavc;abfalarcl4cu7fcsGcitfgPydlhsaPydbhzdnarcsGgPak9pmbavaiarcu7fcsGcdtfydbaxaPEhraPThPdndnadcd9hmbabaDcetfgHaz87ebaHcdfas87ebaHclfar87ebxekabaDcdtfgHazBdbaHclfasBdbaHcwfarBdbkaxaPfhxavc;abfalcitfgHarBdbaHasBdlavaicdtfarBdbavc;abfalcefcsGglcitfgHazBdbaHarBdlaiaPfhialcefhlxdkdndnaPcsSmbamaPfaPc987fcefhmxekaocefhrao8SbbgPcFeGhHdndnaPcu9mmbarhoxekaocvfhoaHcFbGhHcrhPdninar8SbbgOcFbGaPtaHVhHaOcu9kmearcefhraPcrfgPc8J9hmbxdkkarcefhokaHce4cbaHceG9R7amfhmkdndnadcd9hmbabaDcetfgraz87ebarcdfas87ebarclfam87ebxekabaDcdtfgrazBdbarclfasBdbarcwfamBdbkavc;abfalcitfgramBdbarasBdlavaicdtfamBdbavc;abfalcefcsGglcitfgrazBdbaramBdlaicefhialcefhlxekdnarcpe0mbaxcefgOavaiaqarcsGfRbbgPcl49RcsGcdtfydbaPcz6gHEhravaiaP9RcsGcdtfydbaOaHfgsaPcsGgOEhPaOThOdndnadcd9hmbabaDcetfgzax87ebazcdfar87ebazclfaP87ebxekabaDcdtfgzaxBdbazclfarBdbazcwfaPBdbkavaicdtfaxBdbavc;abfalcitfgzarBdbazaxBdlavaicefgicsGcdtfarBdbavc;abfalcefcsGcitfgzaPBdbazarBdlavaiaHfcsGgicdtfaPBdbavc;abfalcdfcsGglcitfgraxBdbaraPBdlalcefhlaiaOfhiasaOfhxxekaxcbaoRbbgzEgAarc;:eSgrfhsazcsGhCazcl4hXdndnazcs0mbascefhOxekashOavaiaX9RcsGcdtfydbhskdndnaCmbaOcefhxxekaOhxavaiaz9RcsGcdtfydbhOkdndnarTmbaocefhrxekaocdfhrao8SbegHcFeGhPdnaHcu9kmbaocofhAaPcFbGhPcrhodninar8SbbgHcFbGaotaPVhPaHcu9kmearcefhraocrfgoc8J9hmbkaAhrxekarcefhrkaPce4cbaPceG9R7amfgmhAkdndnaXcsSmbarhPxekarcefhPar8SbbgocFeGhHdnaocu9kmbarcvfhsaHcFbGhHcrhodninaP8SbbgrcFbGaotaHVhHarcu9kmeaPcefhPaocrfgoc8J9hmbkashPxekaPcefhPkaHce4cbaHceG9R7amfgmhskdndnaCcsSmbaPhoxekaPcefhoaP8SbbgrcFeGhHdnarcu9kmbaPcvfhOaHcFbGhHcrhrdninao8SbbgPcFbGartaHVhHaPcu9kmeaocefhoarcrfgrc8J9hmbkaOhoxekaocefhokaHce4cbaHceG9R7amfgmhOkdndnadcd9hmbabaDcetfgraA87ebarcdfas87ebarclfaO87ebxekabaDcdtfgraABdbarclfasBdbarcwfaOBdbkavc;abfalcitfgrasBdbaraABdlavaicdtfaABdbavc;abfalcefcsGcitfgraOBdbarasBdlavaicefgicsGcdtfasBdbavc;abfalcdfcsGcitfgraABdbaraOBdlavaiazcz6aXcsSVfgicsGcdtfaOBdbaiaCTaCcsSVfhialcifhlkawcefhwalcsGhlaicsGhiaDcifgDae6mbkkcbc99aoaqSEhokavc;aef8Kjjjjbaok:llevu8Jjjjjbcz9Rhvc9:hodnaecvfal0mbcuhoaiRbbc;:eGc;qe9hmbav9cb83iwaicefhraialfc98fhwdnaeTmbdnadcdSmbcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcdtfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfglBdbaoalBdbaDcefgDae9hmbxdkkcbhDindnaraw6mbc9:skarcefhoar8SbbglcFeGhidndnalcu9mmbaohrxekarcvfhraicFbGhicrhldninao8SbbgdcFbGaltaiVhiadcu9kmeaocefhoalcrfglc8J9hmbxdkkaocefhrkabaDcetfaicd4cbaice4ceG9R7avcwfaiceGcdtVgoydbfgl87ebaoalBdbaDcefgDae9hmbkkcbc99arawSEhokaok:Lvoeue99dud99eud99dndnadcl9hmbaeTmeindndnabcdfgd8Sbb:Yab8Sbbgi:Ygl:l:tabcefgv8Sbbgo:Ygr:l:tgwJbb;:9cawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai86bbdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad86bbdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad86bbabclfhbaecufgembxdkkaeTmbindndnabclfgd8Ueb:Yab8Uebgi:Ygl:l:tabcdfgv8Uebgo:Ygr:l:tgwJb;:FSawawNJbbbbawawJbbbb9GgDEgq:mgkaqaicb9iEalMgwawNakaqaocb9iEarMgqaqNMM:r:vglNJbbbZJbbb:;aDEMgr:lJbbb9p9DTmbar:Ohixekcjjjj94hikadai87ebdndnaqalNJbbbZJbbb:;aqJbbbb9GEMgq:lJbbb9p9DTmbaq:Ohdxekcjjjj94hdkavad87ebdndnawalNJbbbZJbbb:;awJbbbb9GEMgw:lJbbb9p9DTmbaw:Ohdxekcjjjj94hdkabad87ebabcwfhbaecufgembkkk;siliui99iue99dnaeTmbcbhiabhlindndnJ;Zl81Zalcof8UebgvciV:Y:vgoal8Ueb:YNgrJb;:FSNJbbbZJbbb:;arJbbbb9GEMgw:lJbbb9p9DTmbaw:OhDxekcjjjj94hDkalclf8Uebhqalcdf8UebhkabavcefciGaiVcetfaD87ebdndnaoak:YNgwJb;:FSNJbbbZJbbb:;awJbbbb9GEMgx:lJbbb9p9DTmbax:Ohkxekcjjjj94hkkabavcdfciGaiVcetfak87ebdndnaoaq:YNgoJb;:FSNJbbbZJbbb:;aoJbbbb9GEMgx:lJbbb9p9DTmbax:Ohqxekcjjjj94hqkabavcufciGaiVcetfaq87ebdndnJbbjZararN:tawawN:taoaoN:tgrJbbbbarJbbbb9GE:rJb;:FSNJbbbZMgr:lJbbb9p9DTmbar:Ohqxekcjjjj94hqkabavciGaiVcetfaq87ebalcwfhlaiclfhiaecufgembkkk9mbdnadcd4ae2geTmbinababydbgdcwtcw91:Yadce91cjjj;8ifcjjj98G::NUdbabclfhbaecufgembkkk9teiucbcbydj1jjbgeabcifc98GfgbBdj1jjbdndnabZbcztgd9nmbcuhiabad9RcFFifcz4nbcuSmekaehikaik;LeeeudndnaeabVciGTmbabhixekdndnadcz9pmbabhixekabhiinaiaeydbBdbaiclfaeclfydbBdbaicwfaecwfydbBdbaicxfaecxfydbBdbaiczfhiaeczfheadc9Wfgdcs0mbkkadcl6mbinaiaeydbBdbaeclfheaiclfhiadc98fgdci0mbkkdnadTmbinaiaeRbb86bbaicefhiaecefheadcufgdmbkkabk;aeedudndnabciGTmbabhixekaecFeGc:b:c:ew2hldndnadcz9pmbabhixekabhiinaialBdbaicxfalBdbaicwfalBdbaiclfalBdbaiczfhiadc9Wfgdcs0mbkkadcl6mbinaialBdbaiclfhiadc98fgdci0mbkkdnadTmbinaiae86bbaicefhiadcufgdmbkkabkkkebcjwklz9Kbb",s=WebAssembly.instantiate(r(n),{}).then((function(t){(i=t.instance).exports.__wasm_call_ctors()}));function r(t){for(var i=new Uint8Array(t.length),n=0;n<t.length;++n){var s=t.charCodeAt(n);i[n]=s>96?s-97:s>64?s-39:s+4}var r=0;for(n=0;n<t.length;++n)i[r++]=i[n]<60?e[i[n]]:64*(i[n]-60)+i[++n];return i.buffer.slice(0,r)}function o(t,e,n,s,r,o){var a=i.exports.sbrk,h=n+3&-4,c=a(h*s),l=a(r.length),A=new Uint8Array(i.exports.memory.buffer);A.set(r,l);var u=t(c,n,s,l,r.length);if(0==u&&o&&o(c,h,s),e.set(A.subarray(c,c+n*s)),a(c-a(0)),0!=u)throw new Error("Malformed buffer data: "+u)}var a={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},h={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"},c=[],l=0;function A(t){var e={object:new Worker(t),pending:0,requests:{}};return e.object.onmessage=function(t){var i=t.data;e.pending-=i.count,e.requests[i.id][i.action](i.value),delete e.requests[i.id]},e}function u(t){for(var e="var instance; var ready = WebAssembly.instantiate(new Uint8Array(["+new Uint8Array(r(n))+"]), {}).then(function(result) { instance = result.instance; instance.exports.__wasm_call_ctors(); });self.onmessage = workerProcess;"+o.toString()+d.toString(),i=new Blob([e],{type:"text/javascript"}),s=URL.createObjectURL(i),a=0;a<t;++a)c[a]=A(s);URL.revokeObjectURL(s)}function d(t){s.then((function(){var e=t.data;try{var n=new Uint8Array(e.count*e.size);o(i.exports[e.mode],n,e.count,e.size,e.source,i.exports[e.filter]),self.postMessage({id:e.id,count:e.count,action:"resolve",value:n},[n.buffer])}catch(t){self.postMessage({id:e.id,count:e.count,action:"reject",value:t})}}))}return{ready:s,supported:!0,useWorkers:function(t){u(t)},decodeVertexBuffer:function(t,e,n,s,r){o(i.exports.meshopt_decodeVertexBuffer,t,e,n,s,i.exports[a[r]])},decodeIndexBuffer:function(t,e,n,s){o(i.exports.meshopt_decodeIndexBuffer,t,e,n,s)},decodeIndexSequence:function(t,e,n,s){o(i.exports.meshopt_decodeIndexSequence,t,e,n,s)},decodeGltfBuffer:function(t,e,n,s,r,c){o(i.exports[h[r]],t,e,n,s,i.exports[a[c]])},decodeGltfBufferAsync:function(t,e,n,r,A){return c.length>0?function(t,e,i,n,s){for(var r=c[0],o=1;o<c.length;++o)c[o].pending<r.pending&&(r=c[o]);return new Promise((function(o,a){var h=new Uint8Array(i),c=l++;r.pending+=t,r.requests[c]={resolve:o,reject:a},r.object.postMessage({id:c,count:t,size:e,source:h,mode:n,filter:s},[h.buffer])}))}(t,e,n,h[r],a[A]):s.then((function(){var s=new Uint8Array(t*e);return o(i.exports[h[r]],s,t,e,n,i.exports[a[A]]),s}))}}}();const Eg=Symbol("paused"),Cg=Symbol("loop-mode"),Ig=Symbol("repetitions"),wg=Symbol("forced-update");class _g{constructor(t,e){if(this.pe=!1,this[gg]=!1,this[pg]=Ct,this[mg]=1/0,this[vg]=!1,0===e.length)throw new Error("Cannot construct AnimationController with no animations.");this.mixer=new Xc(t),this.names=e.map((t=>t.name)),this.nameToAction=new Map(e.map((t=>[t.name,this.mixer.clipAction(t)]))),this.currentAction=null,this.play(this.names[0]),this.dispose=()=>{this.mixer.stopAllAction(),this.mixer.uncacheRoot(t),this.currentAction=null,this.nameToAction.clear(),this.names.length=0}}get isActive(){return this.currentAction?.isRunning()||this[wg]}update(t){this.isActive&&(this.mixer.update(t),this[wg]=!1,this.pe=!0);const e=this.pe;return this.pe=!1,e}play(t,e=0){if(null!=t){const i=this.nameToAction.get(t);if(!i)return void console.warn(`Animation "${t}" not found.`);if(this.currentAction===i)return;this.currentAction&&i.crossFadeFrom(this.currentAction,e,!1),this.currentAction=i,this.currentAction.reset(),this.currentAction.play(),this.currentAction.paused=this.paused,i.setLoop(this[Cg],this[Ig]),this[wg]=this.paused}else this.currentAction&&(this.mixer.stopAllAction(),this.currentAction.enabled=!1,this.currentAction=null);this.pe=!0}get paused(){return this[Eg]}set paused(t){this[Eg]=!!t,this.currentAction&&(this.currentAction.paused=this.paused)}get repeatMode(){return this[Cg]===Ct?"repeat":"mirror-repeat"}set repeatMode(t){if("repeat"!==(t=t.toLowerCase())&&"mirror-repeat"!==t)return void console.warn(`Invalid repeat mode ${t}`);const e="repeat"===t?Ct:2202;this[Cg]!==e&&(this[Cg]=e,this.currentAction&&(this.currentAction.setLoop(this[Cg],this[Ig]),this.currentAction.enabled=!0,this.currentAction.time=0))}get repeatCount(){return this[Ig]}set repeatCount(t){this[Ig]!==t&&(this[Ig]=t,this.currentAction&&(this.currentAction.setLoop(this[Cg],this[Ig]),this.currentAction.enabled=!0))}get duration(){if(this.currentAction)return this.currentAction.getClip().duration}reset(){this.currentAction&&(this.currentAction.reset(),this.currentAction.play(),this.currentAction.paused=this.paused,this[Eg]&&(this[wg]=!0),this.pe=!0)}}var Bg;gg=Eg,pg=Cg,mg=Ig,vg=wg;const Sg=Symbol("scene"),Mg=Symbol("light");class xg{constructor(){this[Bg]=null,this._intensity=1,this._color=16777215}get intensity(){return this._intensity}set intensity(t){this._intensity!==t&&(this._intensity=t,this[Mg].intensity=t,this[Sg]&&(this[Mg].intensity*=this[Sg].lightRigIntensity,this[Sg].queueUpdate()))}get color(){return this._color}set color(t){this._color!==t&&(this._color=t,this[Sg]&&null!==this[Sg].lightRigOverrideColor?this[Mg].color.set(this[Sg].lightRigOverrideColor):this[Mg].color.setHex(t),this[Sg]?.queueUpdate())}get name(){return this[Mg].name}set name(t){this[Mg].name=t}getPosition(t=[0,0,0]){return this[Mg].position.toArray(t)}setPosition(t,e,i){this[Mg].position.set(t,e,i),this[Sg]?.queueUpdate()}addToScene(t){this[Sg]&&this.removeFromScene(),this[Sg]=t,this[Sg].lightRig.push(this),this[Sg].lightRoots.add(this[Mg]),this[Mg].intensity=this.intensity*this[Sg].lightRigIntensity,this[Sg].lightRigOverrideColor?this[Mg].color.set(this[Sg].lightRigOverrideColor):this[Mg].color.setHex(this.color),this[Sg].queueUpdate()}removeFromScene(){if(!this[Sg])return;const t=this[Sg].lightRig.indexOf(this);-1!==t&&(this[Mg].removeFromParent(),this[Mg].intensity=this.intensity,this[Mg].color.setHex(this.color),this[Sg].lightRig.splice(t,1),this[Sg].queueUpdate()),this[Sg]=null}dispose(){this[Mg].dispose()}}Bg=Sg;class yg extends xg{constructor(t){if(super(),t instanceof kc){const e=t;this[Mg]=e,this[Mg].target.position.sub(this[Mg].position),this[Mg].add(this[Mg].target)}else{const e=t,i=e.intensity??Nu.intensity,n=e.color??Nu.color,s=e.position??Nu.position,r=e.direction??Nu.direction;this[Mg]=new kc(n,i),this[Mg].position.fromArray(s),this[Mg].add(this[Mg].target),this[Mg].target.position.fromArray(r)}this._intensity=this[Mg].intensity,this._color=this[Mg].color.getHex()}getDirection(t=[0,0,0]){return this[Mg].target.position.toArray(t)}setDirection(t,e,i){this[Mg].target.position.set(t,e,i),this[Sg]?.queueUpdate()}save(){return{type:"directional",intensity:this.intensity,color:this.color,position:this[Mg].position.toArray(),direction:this[Mg].target.position.toArray()}}}class Qg extends xg{constructor(t){if(super(),t instanceof Uc){const e=t;this[Mg]=e}else{const e=t,i=e.intensity??ku.intensity,n=e.color??ku.color,s=e.position??ku.position,r=e.distance??ku.distance;this[Mg]=new Uc(n,i,r),this[Mg].position.fromArray(s)}this._intensity=this[Mg].intensity,this._color=this[Mg].color.getHex()}get distance(){return this[Mg].distance}set distance(t){this[Mg].distance!==t&&(this[Mg].distance=t,this[Sg]?.queueUpdate())}save(){return{type:"point",intensity:this.intensity,color:this.color,position:this[Mg].position.toArray(),distance:this[Mg].distance}}}class Tg extends xg{constructor(t){if(super(),t instanceof Tc){const e=t;this[Mg]=e,this[Mg].target.position.sub(this[Mg].position),this[Mg].add(this[Mg].target)}else{const e=t,i=e.intensity??Fu.intensity,n=e.color??Fu.color,s=e.position??Fu.position,r=e.direction??Fu.direction,o=e.distance??Fu.distance,a=e.angle??Fu.angle,h=e.penumbra??Fu.penumbra;this[Mg]=new Tc(n,i,o,a,h),this[Mg].position.fromArray(s),this[Mg].add(this[Mg].target),this[Mg].target.position.fromArray(r)}this._intensity=this[Mg].intensity,this._color=this[Mg].color.getHex()}getDirection(t=[0,0,0]){return this[Mg].target.position.toArray(t)}setDirection(t,e,i){this[Mg].target.position.set(t,e,i),this[Sg]?.queueUpdate()}get distance(){return this[Mg].distance}set distance(t){this[Mg].distance!==t&&(this[Mg].distance=t,this[Sg]?.queueUpdate())}get angle(){return this[Mg].angle}set angle(t){this.angle!==t&&(this[Mg].angle=t,this[Sg]?.queueUpdate())}get penumbra(){return this[Mg].penumbra}set penumbra(t){this.penumbra!==t&&(this[Mg].penumbra=t,this[Sg]?.queueUpdate())}save(){return{type:"spot",intensity:this.intensity,color:this.color,position:this[Mg].position.toArray(),direction:this[Mg].target.position.toArray(),distance:this[Mg].distance,angle:this[Mg].angle,penumbra:this[Mg].penumbra}}}class Dg extends Xt{constructor(t,e){super(),this.pe=!1,this.me=!0,this.ve=!1,this.cameras=[],this.lights=[],this.boundingBox=new Oe,this.be=t,this.Ee=e;const{scene:i,animations:n,lights:s,cameras:r,associations:o}=rd(t);this.scene=i,this.animation=n.length>0?new _g(i,n):null,this.cameras=r,this.associations=o,this.scene.rotation.order="YXZ",this.lights=[],s.forEach((t=>{t instanceof kc?this.lights.push(new yg(t)):t instanceof Uc?this.lights.push(new Qg(t)):t instanceof Tc?this.lights.push(new Tg(t)):console.warn("Unrecognized light type")})),this.Ce()}update(t){this.animation?.update(t)&&(this.dispatchEvent({type:"animation-frame"}),this.pe=!0);const e=this.pe;return this.pe=!1,e}get transparentDepthWrite(){return this.ve}set transparentDepthWrite(t){t=!!t,this.transparentDepthWrite!==t&&this.scene.traverse((e=>{e instanceof Hn&&e.material instanceof on&&e.material.transparent&&(e.material.depthWrite=t),this.ve=t}))}Ce(){if(this.scene.updateMatrixWorld(!0),this.animation){this.boundingBox.makeEmpty();const t=this.animation.mixer.time,e=new Map;for(const t of this.animation.nameToAction.values()){const{time:i,paused:n,enabled:s}=t;e.set(t,{time:i,paused:n,enabled:s}),t.enabled=!1}for(const t of this.animation.nameToAction.values()){t.enabled=!0,t.paused=!1,t.reset(),t.play();const e=t.getClip().duration,i=Math.max(1/60,e/30);for(let t=0;t<e;t+=i)this.animation.mixer.update(i),hd(this.scene,((t,e)=>t.expandByPoint(e)),this.boundingBox);t.enabled=!1,t.stop()}this.animation.mixer.setTime(t);for(const t of this.animation.nameToAction.values()){const{time:i,paused:n,enabled:s}=e.get(t);t.enabled=s,t.paused=n,t.time=i}this.animation.currentAction&&(this.animation.currentAction.play(),this.animation.mixer.update(0))}else hd(this.scene,((t,e)=>t.expandByPoint(e)),this.boundingBox.makeEmpty());return this.dispatchEvent({type:"bounding-box-update"}),this.boundingBox}get src(){return this.Ee?.url||""}setScale(t,e,i){const n=new Ne(t,e,i);this.scene.scale.equals(n)||(this.scene.scale.copy(n),this.Ce(),this.pe=!0)}setRotation(t,e,i,n="YXZ"){const s=new wi(t,e,i,n);s.order="YXZ",this.scene.rotation.equals(s)||(this.scene.rotation.copy(s),this.Ce(),this.pe=!0)}setPosition(t,e,i){const n=new Ne(t,e,i);this.scene.position.equals(n)||(this.scene.position.copy(n),this.Ce(),this.pe=!0)}get showLights(){return this.me}set showLights(t){t=!!t,this.me!==t&&(this.me=t,t?this.lights.forEach((t=>{const e=this.associations.get(t[Mg]),i=this.be.parser.json.nodes[e.nodes].extensions.KHR_lights_punctual.light,n=this.be.parser.json.extensions.KHR_lights_punctual.lights[i];t.intensity=n.intensity??1})):this.lights.forEach((t=>t.intensity=0)),this.pe=!0)}getMeshFromIndices(t,e){for(const[i,n]of this.associations.entries()){if(!(i instanceof Hn))continue;const{meshes:s,primitives:r}=n;if(s===t&&r===e)return i}return null}get json(){return JSON.parse(JSON.stringify(this.be.parser.json))}load(t){if(t.position&&this.setPosition(...t.position),t.rotation&&this.setRotation(...t.rotation),t.scale&&this.setScale(...t.scale),t.animation){if(!this.animation)return;t.animation.name&&this.animation.play(t.animation.name),this.animation.repeatMode=t.animation.repeatMode??Uu.repeatMode,this.animation.repeatCount=t.animation.repeatCount??Uu.repeatCount;!1===(t.animation.autoPlay??Uu.autoPlay)&&(this.animation.paused=!0)}}save(){const t={src:this.src};return this.scene.scale.equals((new Ne).setScalar(1))||(t.scale=this.scene.scale.toArray()),this.scene.rotation.equals(new wi)||(t.rotation=this.scene.rotation.toArray().splice(0,3)),this.scene.position.equals(new Ne)||(t.position=this.scene.position.toArray()),this.animation?.currentAction&&(this.animation.names.find((t=>this.animation.nameToAction.get(t)===this.animation.currentAction)),"repeat"!==this.animation.repeatMode&&this.animation.repeatMode,this.animation.repeatCount!==1/0&&this.animation.repeatCount),t}dispose(){sd(this.scene,{textures:!0,geometry:!0}),this.Ee?.dispose()}}class Lg extends Md{constructor(){super(),this.gltfLoader=new Td,this.dracoLoader=new Qf,this.ktx2Loader=new lg,this.dracoLoader.setDecoderPath("https://www.gstatic.com/draco/versioned/decoders/1.5.6/"),this.gltfLoader.setDRACOLoader(this.dracoLoader),this.gltfLoader.setMeshoptDecoder(bg),tu.webglRenderer&&(this.ktx2Loader.setTranscoderPath("https://www.gstatic.com/basis-universal/versioned/2021-04-15-ba1c3e4/"),this.ktx2Loader.detectSupport(tu.webglRenderer),this.gltfLoader.setKTX2Loader(this.ktx2Loader)),document.addEventListener("visibilitychange",(()=>{if(document.hidden)for(const t of this.cache.values())t.data&&this.dispose(t.data)}))}async transform(t){const e=await new Promise(((e,i)=>this.gltfLoader.parse(t,"",e,i))),i=new Set,n=tu.maxAnisotropy();return e.scene.traverse((t=>{if(!(t instanceof Hn))return;t.castShadow=!0;const e=t.material;if(e&&!i.has(e.uuid)){i.add(e.uuid);for(const t of Object.values(e).filter((t=>t instanceof Qe))){const e=t.mipmaps.length<Math.log2(Math.max(t.image.width,t.image.height));t instanceof Ka&&e?(t.minFilter=j,t.needsUpdate=!0):t.anisotropy=n}}})),e}supply(t,e){return new Dg(t,e)}dispose(t){t.scenes.forEach((t=>sd(t)))}}Lg.instance=new Lg;const Rg=Lg.instance;class Pg extends Oi{constructor(){super(),this.light=new kc(0),this.mesh=new Hn(new fs,new jh),this.Ie=0,this.we=0,this.pe=!1,this.light.castShadow=!0,this.light.shadow.autoUpdate=!1,this.light.shadow.blurSamples=16,this.mesh.receiveShadow=!0,this.mesh.geometry.rotateX(-Math.PI/2),this.mesh.material.opacity=0,this.light.target.position.set(0,-1,0),this.light.add(this.light.target),this.add(this.light,this.mesh)}update(){this.needsRepaint&&this.intensity>0&&(this.pe=!0);const t=this.pe;return this.pe=!1,t}dispose(){this.light.dispose(),this.mesh.geometry.dispose(),this.mesh.material.dispose()}get needsRepaint(){return this.light.shadow.needsUpdate}set needsRepaint(t){this.light.shadow.needsUpdate=!!t}get intensity(){return this.mesh.material.opacity}set intensity(t){const e=(t=he.clamp(t,0,1))>0;this.intensity>0!==e&&this.dispatchEvent({type:"visible",value:e}),this.mesh.material.opacity=t,this.pe=!0}get radius(){return this.light.shadow.radius}set radius(t){this.light.shadow.radius=t,this.needsRepaint=!0}get samples(){return this.light.shadow.blurSamples}set samples(t){this.light.shadow.blurSamples=t,this.needsRepaint=!0}get resolution(){return this.light.shadow.mapSize.x}set resolution(t){this.light.shadow.mapSize.x=t,this.light.shadow.mapSize.y=t,this.light.dispose(),this.light.shadow.map=null,this.light.shadow.mapPass=null,this.needsRepaint=!0}get offset(){return this.Ie}set offset(t){this.Ie!==t&&(this.Ie=t,this.mesh.position.set(0,.5*(2*this.offset-1)*this.we,0),this.mesh.updateMatrixWorld(!0),this.light.shadow.camera.far=(1+Math.abs(this.offset))*this.we*1.15,this.light.shadow.camera.updateProjectionMatrix(),this.light.shadow.updateMatrices(this.light),this.pe=!0,this.dispatchEvent({type:"bounding-box-update"}))}adjustToBox(t){t.getCenter(this.position),t.getSize(this.mesh.scale),this.we=this.mesh.scale.y,this.mesh.scale.multiplyScalar(1.15),this.mesh.position.set(0,.5*(2*this.offset-1)*this.we,0),this.light.position.set(0,.5*this.we,0),this.light.shadow.camera.far=(1+Math.abs(this.offset))*this.we*1.15,this.light.shadow.camera.near=0,this.light.shadow.camera.left=-this.mesh.scale.x/2,this.light.shadow.camera.right=this.mesh.scale.x/2,this.light.shadow.camera.top=-this.mesh.scale.z/2,this.light.shadow.camera.bottom=this.mesh.scale.z/2,this.light.shadow.camera.updateProjectionMatrix(),this.light.shadow.updateMatrices(this.light),this.updateMatrixWorld(!0),this.dispatchEvent({type:"bounding-box-update"}),this.pe=!0,this.needsRepaint=!0}load(t={}){this.intensity=t.intensity??Ou.scene.shadow.intensity,this.samples=t.samples??Ou.scene.shadow.samples,this.offset=t.offset??Ou.scene.shadow.offset,this.radius=t.radius??Ou.scene.shadow.radius,this.resolution=t.resolution??Ou.scene.shadow.resolution}save(){const t={};return 0!==this.intensity&&(t.intensity=this.intensity),2!==this.radius&&(t.radius=this.radius),16!==this.samples&&(t.samples=this.samples),513!==this.resolution&&(t.resolution=this.resolution),0!==this.offset&&(t.offset=this.offset),t}}class Ug extends ea{constructor(){super(),this._e=new Set,this.models=[],this.Be=null,this.Se=null,this.modelsBoundingBox=new Oe,this.boundingBox=new Oe,this.modelRoots=new Oi,this.hotspotRoots=new Oi,this.helpers=new Oi,this.shadow=new Pg,this.lightRoots=new Oi,this.lightRig=[],this.Me=1,this.xe=null,this.pe=!1,this.ye=!1,this.Qe=!0,this.ve=!1,this.Te=()=>{this.shadow.needsRepaint=!0},this.De=()=>{this.modelsBoundingBox.makeEmpty(),this.models.forEach((t=>this.modelsBoundingBox.union(t.boundingBox))),this.shadow.adjustToBox(this.modelsBoundingBox),this.Le(),this.pe=!0,this.dispatchEvent({type:"models-bounding-box-update"})},this.modelRoots.name="models",this.add(this.modelRoots),this.hotspotRoots.name="hotspots",this.add(this.hotspotRoots),this.lightRoots.name="lights",this.add(this.lightRoots),this.shadow.addEventListener("bounding-box-update",(()=>this.Le())),this.shadow.addEventListener("visible",(t=>t.value?this.add(this.shadow):this.remove(this.shadow)))}queueUpdate(){this.pe=!0}update(t){this.models.forEach((e=>{e.update(t)&&(this.pe=!0)})),this.shadow.update()&&(this.pe=!0);const e=this.pe;return this.pe=!1,e}async loadModels(t){const e=t.map((t=>"string"==typeof t?Rg.load(t):t)),i=e.filter((t=>!t.data));if(i.length>0){i.forEach((t=>this._e.add(t)));try{await Promise.all(i.map((t=>t.done)))}catch(t){throw i.forEach((t=>t.dispose())),t}finally{i.forEach((t=>this._e.delete(t)))}}return e.map((t=>t.data))}addModel(t){-1===this.models.findIndex((e=>e===t))&&(this.modelRoots.add(t.scene),this.models.push(t),t.showLights=this.showModelLights,t.transparentDepthWrite=this.transparentDepthWrite,this.dispatchEvent({type:"model-added",model:t,index:this.models.length-1}),t.addEventListener("bounding-box-update",this.De),t.addEventListener("animation-frame",this.Te),this.De(),this.pe=!0)}removeModel(t){const e=this.models.findIndex((e=>e===t));-1!==e&&(this.modelRoots.remove(t.scene),this.models.splice(e,1),this.dispatchEvent({type:"model-removed",model:t,index:e}),t.dispose(),t.removeEventListener("bounding-box-update",this.De),t.removeEventListener("animation-frame",this.Te),this.De(),this.pe=!0)}addHelper(t){this.helpers.add(t),this.pe=!0,this.Le()}removeHelper(t){this.helpers.remove(t),this.pe=!0,this.Le()}get transparentDepthWrite(){return this.ve}set transparentDepthWrite(t){t=!!t,this.transparentDepthWrite!==t&&(this.models.forEach((e=>{e.transparentDepthWrite=t})),this.ve=t)}Le(){this.boundingBox.makeEmpty(),this.boundingBox.union(this.modelsBoundingBox),this.boundingBox.expandByObject(this.helpers,!0),this.shadow.parent===this&&this.boundingBox.expandByObject(this.shadow,!0),this.dispatchEvent({type:"bounding-box-update"})}async loadEnvironment(t){const e=t?"string"==typeof t?yd.load(t):t:null;if(this.Be?.dispose(),this.Be=null,e&&!e.data)try{this.Be=e,await e.done,this.Be=null}catch(t){throw e?.dispose(),this.Be=null,t}const i=e?.data||null,n=i!==this.environment;this.environment=i,this.Se?.dispose(),this.Se=e,n&&(this.pe=!0,this.dispatchEvent({type:"environment-change",src:e?.url??""}),this.skybox&&(this.background=i))}get skybox(){return this.ye}set skybox(t){t=!!t,this.pe=t!==this.ye,this.ye=t,this.background=this.ye?this.environment:null}getEnvironmentRotation(){return{x:-this.environmentRotation.x,y:-this.environmentRotation.y,z:-this.environmentRotation.z}}setEnvironmentRotation(t,e,i,n="YXZ"){this.environmentRotation.set(-t,-e,-i,n),this.backgroundRotation.set(-t,-e,-i,n),this.pe=!0}get environmentSrc(){return this.Se?.url??""}get showModelLights(){return this.Qe}set showModelLights(t){t=!!t,this.Qe!==t&&(this.Qe=t,this.models.forEach((e=>e.showLights=t)),this.dispatchEvent({type:"model-lights-visibility",visible:t}),this.pe=!0)}loadLights(t={}){const e=!!t.preferModelLights,i=!!this.models.reduce(((t,e)=>t+e.lights.length),0),n=t.lightRigIntensity??Ou.scene.lights.lightRigIntensity;e&&i?(this.showModelLights=!0,this.lightRigIntensity=0):(this.showModelLights=t.showModelLights??Ou.scene.lights.showModelLights,this.lightRigIntensity=n),null!=t.lightRigOverrideColor&&(this.lightRigOverrideColor=t.lightRigOverrideColor),t.lightRig?.forEach((t=>{"directional"===t.type?new yg(t).addToScene(this):"point"===t.type?new Qg(t).addToScene(this):"spot"===t.type?new Tg(t).addToScene(this):console.warn("Invalid light config")}))}addLight(t){return t.addToScene(this),t}removeLight(t){return t[Sg]===this?t.removeFromScene():console.warn("Light is not part of the scene"),t}get lightRigIntensity(){return this.Me}set lightRigIntensity(t){this.Me!==t&&(this.Me=t,this.lightRig.forEach((e=>{e[Mg].intensity=e.intensity*t})),this.pe=!0)}get lightRigOverrideColor(){return this.xe}set lightRigOverrideColor(t){this.xe!==t&&(this.xe=t,this.lightRig.forEach((e=>{e[Mg].color.set(null!==t?t:e.color)})),this.pe=!0)}cancelPendingModelRequests(){this._e.forEach((t=>t.dispose())),this._e.clear()}cancelPendingEnvironmentRequest(){this.Be?.dispose(),this.Be=null}reset(){this.cancelPendingModelRequests(),this.cancelPendingEnvironmentRequest(),this.Se?.dispose(),this.Se=null,this.skybox=!1,this.setEnvironmentRotation(0,0,0),this.models.forEach(((t,e)=>{this.modelRoots.remove(t.scene),t.dispose(),this.dispatchEvent({type:"model-removed",model:t,index:e})})),this.models.length=0,this.modelsBoundingBox.makeEmpty(),[...this.lightRig].forEach((t=>{t.removeFromScene(),t.dispose()})),this.lightRigIntensity=1,this.lightRigOverrideColor=null}save(){const t={environment:{src:this.Se?.url,skybox:this.skybox,rotation:[-this.environmentRotation.x*he.RAD2DEG,-this.environmentRotation.y*he.RAD2DEG,-this.environmentRotation.z*he.RAD2DEG]},shadow:{samples:this.shadow.samples,offset:this.shadow.offset,intensity:this.shadow.intensity,radius:this.shadow.radius,resolution:this.shadow.resolution},lights:{showModelLights:this.showModelLights,lightRigOverrideColor:"string"==typeof this.lightRigOverrideColor?parseInt(this.lightRigOverrideColor.slice(1),16):this.lightRigOverrideColor,lightRigIntensity:this.lightRigIntensity,lightRig:this.lightRig.map((t=>t.save()))}},e=this.models.map((t=>t.save()));return t.models=e,t}dispose(){this._e.forEach((t=>t.dispose())),this._e.clear(),[...this.models].forEach((t=>this.removeModel(t))),this.models.length=0,this.Be?.dispose(),this.Be=null,this.Se?.dispose(),this.Se=null,this.skybox=!1,this.modelsBoundingBox.makeEmpty(),this.shadow.dispose(),[...this.lightRig].forEach((t=>{t.removeFromScene(),t.dispose()})),this.lightRigIntensity=1,this.lightRigOverrideColor=null}}var Ng;const kg=Symbol("view-channel");var Fg,Og;!function(t){t[t.None=0]="None",t[t.VertexNormal=1]="VertexNormal",t[t.VertexTangent=2]="VertexTangent",t[t.VertexBitangent=3]="VertexBitangent",t[t.DerivativeTangent=4]="DerivativeTangent",t[t.DerivativeBitangent=5]="DerivativeBitangent",t[t.WorldSpaceNormal=6]="WorldSpaceNormal",t[t.NormalTexture=7]="NormalTexture",t[t.BaseColor=8]="BaseColor",t[t.Alpha=9]="Alpha",t[t.Metallic=10]="Metallic",t[t.Roughness=11]="Roughness",t[t.Occlusion=12]="Occlusion",t[t.Emissive=13]="Emissive",t[t.FaceOrientation=14]="FaceOrientation",t[t.UV0=15]="UV0",t[t.UV0Wrapped=16]="UV0Wrapped",t[t.UV1=17]="UV1",t[t.UV1Wrapped=18]="UV1Wrapped",t[t.UV0Checker=19]="UV0Checker",t[t.UV1Checker=20]="UV1Checker"}(Fg||(Fg={}));class Gg extends Yn{constructor(t){if(!(t.material instanceof an||t.material instanceof Yh||t.material instanceof su))throw new Error("Unsupported base material for InspectionMaterial");const e={},i={},n=t.geometry;e.USE_UV="",e.USE_NORMALMAP_TANGENTSPACE="",n.hasAttribute("normal")&&n.hasAttribute("tangent")&&(e.HAS_VERTEX_TANGENT=""),n.hasAttribute("normal")||(e.FLAT_SHADED=""),n.hasAttribute("uv1")&&(e.USE_UV1=""),n.hasAttribute("color")&&(e.USE_COLOR="",4===n.getAttribute("color").itemSize&&(e.USE_COLOR_ALPHA=""));const s=n.hasAttribute("color"),r=t.material;i.diffuse={value:r.color},i.opacity={value:r.opacity},r.map&&(e.MAP_UV=TA(r.map.channel),e.USE_MAP="",i.map={value:r.map},i.mapTransform={value:r.map.matrix}),r.aoMap&&(e.USE_AOMAP="",e.AOMAP_UV=TA(r.aoMap.channel),i.aoMap={value:r.aoMap},i.aoMapIntensity={value:r.aoMapIntensity},i.aoMapTransform={value:r.aoMap.matrix}),r instanceof Yh&&(e.NORMALMAP_UV=r.normalMap?TA(r.normalMap.channel):TA(0),i.emissive={value:r.emissive.clone().multiplyScalar(r.emissiveIntensity)},i.roughness={value:r.roughness},i.metalness={value:r.metalness},r.normalMap&&(e.USE_NORMALMAP="",i.normalMap={value:r.normalMap},i.normalScale={value:r.normalScale},i.normalMapTransform={value:r.normalMap.matrix}),r.metalnessMap&&(e.USE_METALNESSMAP="",e.METALNESSMAP_UV=TA(r.metalnessMap.channel),i.metalnessMap={value:r.metalnessMap},i.metalnessMapTransform={value:r.metalnessMap.matrix}),r.roughnessMap&&(e.USE_ROUGHNESSMAP="",e.ROUGHNESSMAP_UV=TA(r.roughnessMap.channel),i.roughnessMap={value:r.roughnessMap},i.roughnessMapTransform={value:r.roughnessMap.matrix}),r.emissiveMap&&(e.USE_EMISSIVEMAP="",e.EMISSIVEMAP_UV=TA(r.emissiveMap.channel),i.emissiveMap={value:r.emissiveMap},i.emissiveMapTransform={value:r.emissiveMap.matrix})),super({vertexShader:CA,fragmentShader:IA,defines:e,uniforms:i,vertexColors:s,side:r.side}),this[Ng]=Fg.None}get viewChannel(){return this[kg]}set viewChannel(t){this.viewChannel!==t&&(delete this.defines[`OUTPUT_${Fg[this.viewChannel]}`],this[kg]=t,this.viewChannel!==Fg.DerivativeTangent&&this.viewChannel!==Fg.DerivativeBitangent&&void 0!==this.defines.HAS_VERTEX_TANGENT?this.defines.USE_TANGENT="":delete this.defines.USE_TANGENT,this.defines[`OUTPUT_${Fg[this.viewChannel]}`]="",this.needsUpdate=!0)}}Ng=kg;const Hg=Symbol("view-channel");class Vg{constructor(t){this.Re=new Map,this.Pe=!1,this[Og]=Fg.None,this.Ue=null,t.addEventListener("model-added",(t=>{t.model.scene.traverse((t=>{if(t instanceof Hn){const e={mesh:t,material:t.material};this.viewChannel!==Fg.None&&(e.mesh.material=new Gg(e.mesh),e.mesh.material.viewChannel=this.viewChannel),this.Re.set(t.uuid,e)}})),this.Pe=!0})),t.addEventListener("model-removed",(t=>{t.model.scene.traverse((t=>{if(t instanceof Hn){const e=this.Re.get(t.uuid);if(!e)return;this.viewChannel!==Fg.None&&(e.mesh.material.dispose(),e.mesh.material=e.material),this.Re.delete(t.uuid)}})),this.Pe=!0}))}isActive(){return this.viewChannel!==Fg.None}update(){const t=this.Pe;return this.Pe=!1,t}get viewChannel(){return this[Hg]}set viewChannel(t){if(this.viewChannel===t)return;const e=t===Fg.UV0Checker||t===Fg.UV1Checker;null===this.Ue&&e&&(this.Ue=(new _c).load("https://storage.googleapis.com/static-prd-mul-reg-stn-unif-vntana-com/assets/images/2k_Texture_checker.png",(t=>{t.wrapS=G,t.wrapT=G,t.anisotropy=tu.maxAnisotropy(),this.Pe=!0}))),Array.from(this.Re.values()).forEach((i=>{if(this[Hg]===Fg.None){const e=new Gg(i.mesh);e.viewChannel=t,i.mesh.material=e}else if(t===Fg.None){i.mesh.material.dispose(),i.mesh.material=i.material}else{i.mesh.material.viewChannel=t}if(e){i.mesh.material.uniforms.uvChecker={value:this.Ue}}})),this[Hg]=t,this.Pe=!0}dispose(){this.Ue?.dispose(),this.Ue=null}}Og=Hg;var zg=[{name:"amethyst",parameters:{refractiveIndex:1.553,dispersion:0,color:[.294,.118,.467]}},{name:"aquamarine",parameters:{refractiveIndex:1.596,dispersion:0,color:[.392,.643,.878]}},{name:"blackdiamond",parameters:{refractiveIndex:1.596,dispersion:0,color:[.212,.2,.169]}},{name:"bluediamond",parameters:{refractiveIndex:2.429,dispersion:0,color:[.557,.78,.953]}},{name:"browndiamond",parameters:{refractiveIndex:2.429,dispersion:0,color:[.741,.592,.553]}},{name:"citrine",parameters:{refractiveIndex:1.553,dispersion:0,color:[.976,.565,.004]}},{name:"diamond_",parameters:{refractiveIndex:2.429,dispersion:.044,color:[1,1,1]}},{name:"emerald",parameters:{refractiveIndex:1.6,dispersion:0,color:[.063,.498,.396]}},{name:"morganite",parameters:{refractiveIndex:1.6,dispersion:.014,color:[.961,.733,.655]}},{name:"mozambiquegarnet",parameters:{refractiveIndex:1.76,dispersion:0,color:[.133,0,0]}},{name:"peridot",parameters:{refractiveIndex:1.7,dispersion:0,color:[.851,.969,.31]}},{name:"pinkdiamond",parameters:{refractiveIndex:2.429,dispersion:.044,color:[.957,.659,.714]}},{name:"rhodolitegarnet",parameters:{refractiveIndex:1.76,dispersion:.026,color:[.412,.106,.133]}},{name:"ruby",parameters:{refractiveIndex:1.778,dispersion:0,color:[.58,.094,.149]}},{name:"sapphire",parameters:{refractiveIndex:1.778,dispersion:0,color:[.137,.302,.761]}},{name:"colorlesssapphire",parameters:{refractiveIndex:1.778,dispersion:0,color:[.686,.686,.686]}},{name:"brownsapphire",parameters:{refractiveIndex:1.778,dispersion:0,color:[.6,.459,.271]}},{name:"blacksapphire",parameters:{refractiveIndex:1.778,dispersion:0,color:[.212,.212,.212]}},{name:"graysapphire",parameters:{refractiveIndex:1.778,dispersion:0,color:[.561,.561,.561]}},{name:"orangesapphire",parameters:{refractiveIndex:1.778,dispersion:0,color:[.561,.227,.059]}},{name:"purplesapphire",parameters:{refractiveIndex:1.778,dispersion:0,color:[.435,.278,.522]}},{name:"greensapphire",parameters:{refractiveIndex:1.778,dispersion:0,color:[.561,.725,.549]}},{name:"yellowsapphire",parameters:{refractiveIndex:1.778,dispersion:0,color:[.741,.675,.184]}},{name:"pinksapphire",parameters:{refractiveIndex:1.778,dispersion:0,color:[1,.361,.804]}},{name:"spessartitegarnet",parameters:{refractiveIndex:1.82,dispersion:.01,color:[.898,.059,.043]}},{name:"swissbluetopaz",parameters:{refractiveIndex:1.543,dispersion:0,color:[.49,.82,.996]}},{name:"tanzanite",parameters:{refractiveIndex:1.7,dispersion:0,color:[.392,.38,.992]}},{name:"tsavoritegarnet",parameters:{refractiveIndex:1.745,dispersion:0,color:[.055,.329,.114]}},{name:"yellowdiamond",parameters:{refractiveIndex:2.429,dispersion:.044,color:[.91,.859,.502]}}],qg=[{name:"opal",parameters:{color:[1,1,1],metalness:.1,roughness:.3,envMapIntensity:.4}},{name:"goldenpearl",parameters:{color:[.686,.537,.306],metalness:.9,roughness:.335,envMapIntensity:2.5}},{name:"tahitianpearl",parameters:{color:[.055,.063,.067],metalness:.97,roughness:.4}},{name:"whitepearl",parameters:{color:[1,.957,.882],metalness:.8,roughness:.4}}],Wg=[{name:"whitegold_met",parameters:{color:[.937,.941,.961],metalness:1,roughness:0}},{name:"yellowgold_met",parameters:{color:[.945,.816,.533],metalness:1,roughness:0}},{name:"rosegold_met",parameters:{color:[.937,.686,.592],metalness:1,roughness:0}},{name:"platinum_met",parameters:{color:[.937,.941,.961],metalness:1,roughness:.05}},{name:"whitegold_matte_met",parameters:{color:[.937,.941,.961],metalness:1,roughness:.4}},{name:"yellowgold_matte_met",parameters:{color:[.945,.816,.533],metalness:1,roughness:.4}},{name:"rosegold_matte_met",parameters:{color:[.937,.686,.592],metalness:1,roughness:.4}},{name:"platinum_matte_met",parameters:{color:[.937,.941,.961],metalness:1,roughness:.4}}];let jg=null;class Jg extends Jh{constructor(){super({vertexShader:SA,fragmentShader:MA,name:"GemCubeCacheMaterial",uniforms:{projectionMatrix:{value:new di},modelViewMatrix:{value:new di}},glslVersion:Jt})}rebuild(){this.fragmentShader=MA,this.vertexShader=SA,this.needsUpdate=!0}}const Yg=new di,Kg=new le,Xg=new wi;var Zg;function $g(t){const e=t.replace("/","").toLowerCase();let i;t:{const t=zg.find((t=>e.startsWith(t.name)));if(t){i={type:Zg.RAYTRACED_GEM,props:t};break t}const n=qg.find((t=>e.startsWith(t.name)));if(n){i={type:Zg.GEM,props:n};break t}const s=Wg.find((t=>e.includes(t.name)));s&&(i={type:Zg.METAL,props:s})}return i?{type:i.type,props:{name:i.props.name,parameters:{...i.props.parameters,color:new nn(...i.props.parameters.color).convertSRGBToLinear()}}}:{type:Zg.NON_JEWELRY,props:{}}}!function(t){t[t.NON_JEWELRY=0]="NON_JEWELRY",t[t.RAYTRACED_GEM=1]="RAYTRACED_GEM",t[t.GEM=2]="GEM",t[t.METAL=3]="METAL"}(Zg||(Zg={}));class tp extends Xt{constructor(t){super(),this.dt=!1,this.Ne=4,this.ke=!1,this.Fe=new Map,this.Oe=new Map,this.Tt=!1,this.O=t,t.addEventListener("model-added",(t=>{this.Ge(t.model)})),t.addEventListener("model-removed",(t=>{this.He(t.model)})),t.addEventListener("environment-change",(()=>{this.Fe.forEach((e=>{e.material instanceof su&&(e.material.envMap=t.environment)})),this.dt=!0}))}Ge(t){if(!this.Tt)return;const e=t.scene.userData;t.scene.traverse((t=>{if(t instanceof Hn){const i=t.geometry;void 0!==e[t.name]?i.gemData=e[t.name]:void 0!==t.userData.gltfExtensions?.VNT_jewelry_mesh&&(i.gemData=t.userData.gltfExtensions.VNT_jewelry_mesh),this.Oe.set(t.uuid,t.material)}})),t.scene.traverse((t=>{if(t instanceof Hn){let i=t.material.name;const n=e["node_extra-"+t.name];void 0!==n?i=n.overrideMaterial:void 0!==t.userData.gltfExtensions?.VNT_jewelry_node&&(i=t.userData.gltfExtensions.VNT_jewelry_node.overrideMaterial),this.Ve(t,i)}}))}He(t){t.scene.traverse((t=>{t instanceof Hn&&this.Fe.has(t.uuid)&&(this.Fe.delete(t.uuid),t.material.dispose(),t.material=this.Oe.get(t.uuid),this.Oe.delete(t.uuid))}))}set enabled(t){t!==this.Tt&&(this.Tt=t,this.O.models.forEach((t=>{this.Tt?this.Ge(t):this.He(t)})),this.dt=!0,this.dispatchEvent({type:"enabled",value:this.Tt}))}get enabled(){return this.Tt}update(){const t=this.dt;return this.dt=!1,t}setMeshMaterial(t,e){const i=this.Fe.get(t);i&&(this.Ve(i,e),this.dt=!0)}Ve(t,e){const i=t.material;if(!(i instanceof on))return;const{props:n,type:s}=$g(e);if(s!==Zg.NON_JEWELRY){if(i instanceof su&&(t.onBeforeRender=()=>{}),i.dispose(),s===Zg.RAYTRACED_GEM){const e=t.geometry,i=e.gemData;if(!n.parameters||!i)return void console.warn("Invalid GemMaterial arguments: "+n+" "+i);const s=t=>{if(!e.planeListTex){e.planeListTex=iu(i);const t=()=>{e.planeListTex.dispose(),e.planeListTex=void 0,e.removeEventListener("dispose",t)};e.addEventListener("dispose",t)}const n=e.planeListTex,s=n.image.data.length/4,r=()=>{e.gemCubeCache.dispose(),e.gemCubeCache=void 0,e.removeEventListener("dispose",r)};return s>8&&!e.gemCubeCache&&(e.gemCubeCache=function(t,e,i){const n=e.image.data.length/4>255,s=new ss(128,{generateMipmaps:!1,type:n?X:K,format:ht,internalFormat:n?"RG16UI":"RG8UI",depthBuffer:!1,magFilter:z,minFilter:z}),r=new is(.01,10,s);jg||(jg=new Jg),jg.uniforms.planeList={value:e},jg.uniforms.boxSize={value:i.getSize(new Ne)},jg.uniforms.boxMid={value:i.getCenter(new Ne)},jg.side=2,jg.needsUpdate=!0,jg.rebuild();const o=new ea,a=new Hn(new zn(2,2,2),jg);return o.add(a),a.onBeforeRender=(t,e,i,n,s,r)=>{const o=s;o.uniforms.projectionMatrix.value.copy(i.projectionMatrix),o.uniforms.modelViewMatrix.value.copy(i.matrixWorldInverse)},r.update(t,o),a.geometry.dispose(),s}(tu.webglRenderer,n,t.boundingBox),e.addEventListener("dispose",r)),[n,e.gemCubeCache?.texture]};t.renderOrder=Number.MAX_SAFE_INTEGER;const r=new su(n,t.geometry.boundingBox,this.Ne,this.ke,this.O.environment);t.material=r,t.onBeforeRender=function(t,e,i,n,r,o){if(r instanceof su){const t=Yg.copy(this.matrixWorld).invert();r.uniforms.cameraPositionOS.value.setFromMatrixPosition(i.matrixWorld).applyMatrix4(t),r.uniforms.objectToWorld.value.setFromMatrix4(Yg.extractRotation(this.matrixWorld)),Xg.copy(e.environmentRotation),Xg.x=-Xg.x,Xg.y=-Xg.y,Xg.z=-Xg.z;const o=Kg.setFromMatrix4(Yg.makeRotationFromEuler(Xg));r.uniforms.objectToWorld.value.premultiply(o);const[a,h]=s(n);r.setRtTextures(a,h)}}}else t.material=new Yh({...n.parameters,name:n.name});this.Fe.set(t.uuid,t)}}get meshUuids(){return this.Fe.keys()}meshName(t){return this.Fe.get(t)?.name}getMeshMaterialName(t){const e=this.Fe.get(t);if(e)return e.material.name}getMeshMaterialList(t){const e=this.Fe.get(t);if(e){const t=$g(e.material.name).type;return t===Zg.RAYTRACED_GEM?zg:t===Zg.GEM?qg:Wg}return[]}get rayTraceDepth(){return this.Ne}set rayTraceDepth(t){t<1||!Number.isInteger(t)?console.warn("Invalid depth value: ",t):(this.dt=!0,this.Ne=t,this.Fe.forEach((e=>{e.material instanceof su&&(e.material.rayTraceDepth=t)})))}get gemAntiAliasing(){return this.ke}set gemAntiAliasing(t){t!=this.ke&&(this.dt=!0,this.ke=t,this.Fe.forEach((e=>{e.material instanceof su&&(e.material.antiAliasing=t)})))}rebuild(){this.dt=!0,this.Fe.forEach((t=>{t.material instanceof su&&t.material.rebuild()}))}load(t={}){this.Ne=t.depth??Ou.jewelry.depth,this.ke=t.gemAntiAliasing??Ou.jewelry.gemAntiAliasing,this.enabled=!!t.enabled}save(){return{enabled:this.Tt,depth:this.Ne,gemAntiAliasing:this.ke}}}class ep extends Oi{constructor(t=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=t,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new ce(.5,.5),this.addEventListener("removed",(function(){this.traverse((function(t){t.element instanceof Element&&null!==t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}))}copy(t,e){return super.copy(t,e),this.element=t.element.cloneNode(!0),this.center=t.center,this}}const ip=new Ne,np=new di,sp=new di,rp=new Ne,op=new Ne;class ap{constructor(t={}){const e=this;let i,n,s,r;const o={objects:new WeakMap},a=void 0!==t.element?t.element:document.createElement("div");function h(t,i,n){if(t.isCSS2DObject){ip.setFromMatrixPosition(t.matrixWorld),ip.applyMatrix4(sp);const h=!0===t.visible&&ip.z>=-1&&ip.z<=1&&!0===t.layers.test(n.layers);if(t.element.style.display=!0===h?"":"none",!0===h){t.onBeforeRender(e,i,n);const o=t.element;o.style.transform="translate("+-100*t.center.x+"%,"+-100*t.center.y+"%)translate("+(ip.x*s+s)+"px,"+(-ip.y*r+r)+"px)",o.parentNode!==a&&a.appendChild(o),t.onAfterRender(e,i,n)}const l={distanceToCameraSquared:c(n,t)};o.objects.set(t,l)}for(let e=0,s=t.children.length;e<s;e++)h(t.children[e],i,n)}function c(t,e){return rp.setFromMatrixPosition(t.matrixWorld),op.setFromMatrixPosition(e.matrixWorld),rp.distanceToSquared(op)}a.style.overflow="hidden",this.domElement=a,this.getSize=function(){return{width:i,height:n}},this.render=function(t,e){!0===t.matrixWorldAutoUpdate&&t.updateMatrixWorld(),null===e.parent&&!0===e.matrixWorldAutoUpdate&&e.updateMatrixWorld(),np.copy(e.matrixWorldInverse),sp.multiplyMatrices(e.projectionMatrix,np),h(t,t,e),function(t){const e=function(t){const e=[];return t.traverse((function(t){t.isCSS2DObject&&e.push(t)})),e}(t).sort((function(t,e){if(t.renderOrder!==e.renderOrder)return e.renderOrder-t.renderOrder;return o.objects.get(t).distanceToCameraSquared-o.objects.get(e).distanceToCameraSquared})),i=e.length;for(let t=0,n=e.length;t<n;t++)e[t].element.style.zIndex=i-t}(t)},this.setSize=function(t,e){i=t,n=e,s=i/2,r=n/2,a.style.width=t+"px",a.style.height=e+"px"}}}class hp{constructor(t){this.needsUpdate=!1,this.ze=new ap({element:t})}appendElement(t){this.ze.domElement.append(t)}render(t,e){this.needsUpdate&&(this.ze.render(t,e),this.needsUpdate=!1)}setSize(t,e){this.ze.setSize(t,e),this.ze.domElement.children.length>0&&(this.needsUpdate=!0)}}function cp(t){const e={};return function(t,e){const i=t.scene?.models?.[0];if(!i)return;void 0!==i.src&&(e.src=i.src);void 0!==i.usdz&&(e.usdzSrc=i.usdz);void 0!==i.rotation&&(e.rotation=i.rotation.map((t=>`${t}rad`)).join(" "));void 0!==i.scale&&(e.scale=i.scale.join(" "))}(t,e),function(t,e){const i=t.scene?.environment;if(!i)return;void 0!==i.src&&(e.environmentSrc=i.src);void 0!==i.rotation&&(e.environmentRotation=i.rotation.map((t=>`${t}deg`)).join(" "));i.skybox&&(e.skybox=!0)}(t,e),function(t,e){const i=t.scene?.shadow;if(!i)return;void 0!==i.intensity&&(e.shadowIntensity=i.intensity);void 0!==i.radius&&(e.shadowRadius=i.radius);void 0!==i.samples&&(e.shadowSamples=i.samples);void 0!==i.resolution&&(e.shadowResolution=i.resolution);void 0!==i.offset&&(e.shadowOffset=100*i.offset+"%")}(t,e),function(t,e){const i=t.scene?.lights;if(!i)return;i.lightRig&&(e.lightRig=i.lightRig.map((t=>{const e={type:t.type};for(const i of Object.keys(t))e[i]=t[i];return e.hasOwnProperty("position")&&(e.position=e.position.join(" ")),e.hasOwnProperty("direction")&&(e.direction=e.direction.join(" ")),e})));void 0!==i.lightRigIntensity&&(e.lightRigIntensity=i.lightRigIntensity);void 0!==i.lightRigOverrideColor&&(e.lightRigColor=i.lightRigOverrideColor);i.hasOwnProperty("showModelLights")&&!i.showModelLights&&(e.hideModelLights=!0);i.preferModelLights&&(e.preferModelLights=i.preferModelLights)}(t,e),function(t,e){const i=t.rendering;if(!i)return;void 0!==i.exposure&&(e.exposure=i.exposure);void 0!==i.toneMap&&(e.toneMapping=i.toneMap);void 0!==i.antiAliasing&&(e.antiAliasing=i.antiAliasing);void 0!==i.msaaSamples&&(e.msaaSamples=i.msaaSamples);void 0!==i.ssaaSamples&&(e.ssaaSamples=Math.round(Math.log2(i.ssaaSamples)));void 0!==i.sharpen&&(e.sharpenStrength=i.sharpen);void 0!==i.bloomStrength&&(e.bloomStrength=i.bloomStrength);void 0!==i.bloomRadius&&(e.bloomRadius=i.bloomRadius);void 0!==i.bloomThreshold&&(e.bloomThreshold=i.bloomThreshold);void 0!==i.ssaoStrength&&(e.ssaoStrength=i.ssaoStrength);void 0!==i.ssaoRadius&&(e.ssaoRadius=i.ssaoRadius);void 0!==i.hueShift&&(e.hueShift=i.hueShift);void 0!==i.saturation&&(e.saturation=i.saturation);void 0!==i.brightness&&(e.brightness=i.brightness);void 0!==i.contrast&&(e.contrast=i.contrast);"depthWrite"===i.transparencyMode?e.transparencyMode="depth-write":"normal"===i.transparencyMode&&(e.transparencyMode="normal")}(t,e),function(t,e){const i=t.jewelry;if(!i)return;i.enabled&&(e.enableJewelry=!0);i.gemAntiAliasing&&(e.gemAntiAliasing=!0);void 0!==i.depth&&(e.gemRayTracingDepth=i.depth)}(t,e),function(t,e){"immediate"===t.loading?e.loading="eager":"visible"===t.loading?e.loading="lazy":"hover"===t.loading&&(e.loading="hover");t.poster&&(e.poster=t.poster)}(t,e),function(t,e){t.styling?.background&&(e.background=t.styling.background);const i=t.ui;if(!i)return;i.hasOwnProperty("autoAR")&&i.autoAR&&(e.autoAR=!0)}(t,e),function(t,e){const i=t.controls;if(!i)return;i.hasOwnProperty("enableZoom")&&(e.disableZoom=!i.enableZoom);i.hasOwnProperty("enablePan")&&(e.disablePan=!i.disablePan);i.hasOwnProperty("enabled")&&(e.disableControls=!i.enabled);i.autoRotate&&(i.autoRotate.enabled&&(e.enableAutoRotate=!0),i.autoRotate.speed&&(e.autoRotatePerSecond=`${i.autoRotate.speed}deg`),i.autoRotate.resetTime&&(e.autoRotateDelay=i.autoRotate.resetTime));i.rotateSpeed&&(e.rotateSpeed=i.rotateSpeed);const n=i.target||i.legacy?.target;if(n){const t=["auto"===n[0]?"auto":`${n[0]}m`,"auto"===n[1]?"auto":`${n[1]}m`,"auto"===n[2]?"auto":`${n[2]}m`];e.cameraTarget=t.join(" ")}const s=i.spherical||i.legacy?.spherical;if(s){const t=["auto"===s[0]?"auto":`${s[0]}m`,"auto"===s[1]?"auto":`${s[1]}rad`,"auto"===s[2]?"auto":`${s[2]}rad`];e.cameraSpherical=t.join(" ")}if(i.minSpherical){const t=i.minSpherical;e.minCameraSpherical=`${t[0]}m ${t[1]}rad ${t[2]}rad`}if(i.maxSpherical){const t=i.maxSpherical;e.maxCameraSpherical=`${t[0]}m ${t[1]}rad ${t[2]}rad`}if(i.legacy){const{legacy:t}=i;t.hasOwnProperty("fov")&&(e.legacyFov=String(t.fov))}}(t,e),e}const{clamp:lp}=he;class Ap extends Xt{constructor(){super(...arguments),this.qe=new Set,this.We=0,this.je=0,this.Je=0}get count(){return this.qe.size}addActivity(t=0,e=""){const i={initial:t=lp(t,0,1),progress:t,source:e};return i.progress<1&&(this.qe.add(i),1===this.count&&this.ce(i,0)),t=>this.ce(i,t)}ce(t,e){if(!this.qe.has(t))return;const i=t.progress,n=lp(e,0,1);if(1!==i&&1===n&&++this.je,t.progress=n,this.je===this.count)this.dispatchEvent({type:"progress",value:1,source:t.source}),this.reset();else{this.Je+=(n-i)/(1-t.initial);const e=lp(this.Je/this.count,0,1);(0===this.We||e>this.We)&&(this.We=e,this.dispatchEvent({type:"progress",value:this.We,source:t.source}))}}reset(){this.qe.clear(),this.We=0,this.je=0,this.Je=0}}function up(t,e,i,n){var s,r=arguments.length,o=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;a>=0;a--)(s=t[a])&&(o=(r<3?s(o):r>3?s(e,i,o):s(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o}function dp(t,e,i,n){if("a"===i&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!n:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===i?n:"a"===i?n.call(t):n?n.value:e.get(t)}function fp(t,e,i,n,s){if("function"==typeof e?t!==e||!s:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(t,i),i}var gp,pp,mp,vp,bp,Ep;"function"==typeof SuppressedError&&SuppressedError;const Cp=Symbol("qrURL"),Ip=Symbol("parent");class wp{get fsButton(){return dp(this,gp,"f")}set fsButton(t){fp(this,gp,t)}get qrButton(){return dp(this,pp,"f")}set qrButton(t){fp(this,pp,t)}get arButton(){return dp(this,mp,"f")}set arButton(t){fp(this,mp,t)}get centerButton(){return dp(this,vp,"f")}set centerButton(t){fp(this,vp,t)}constructor(t){gp.set(this,void 0),pp.set(this,void 0),mp.set(this,void 0),vp.set(this,void 0),this[bp]="",this[Ep]={},this.viewer=t,this.fsButton=!1,this.qrButton=!1,this.arButton=!1,this.centerButton=!1,this.zoomButtons=!1}get qrURL(){return this[Cp]}set qrURL(t){let e=this.viewer.querySelector("vntana-qr-button");e||(e=document.createElement("vntana-qr-button"),this.viewer.append(e)),this[Cp]=t,e.url=t}get zoomButtons(){return!!this.viewer.querySelector(".zoom-buttons")}set zoomButtons(t){if((t=!!t)!==this.zoomButtons)if(t){const t=document.createElement("div");t.classList.add("button-container","zoom-buttons");const e=this[Ip].zoomButtons||this.viewer;this[Ip].zoomButtons=e,e.append(t),t.append(document.createElement("vntana-zoom-in-button")),t.append(document.createElement("vntana-zoom-out-button"))}else{if(!this[Ip].zoomButtons)return;const t=this.viewer.querySelector(".zoom-buttons");this[Ip].zoomButtons=t?.parentElement,t?.remove()}}load(t={}){Object.keys(Ou.ui).forEach((e=>{const i=e;this[i]=t[i]??Ou.ui[i]}))}save(){return{fsButton:this.fsButton,qrButton:this.qrButton,arButton:this.arButton,centerButton:this.centerButton,zoomButtons:this.zoomButtons,qrURL:this.qrURL}}}function _p(t){return(e,i,n)=>({get:function(){return!!this.viewer.querySelector(t)},set:function(e){if((e=!!e)!==this[i])if(e){const e=document.createElement(t),i=this[Ip][t]||this.viewer;this[Ip][t]=i,i.append(e),"vntana-qr-button"===t&&(e.url=this.qrURL,e.classList.add("expandable"))}else{if(!this[Ip][t])return;const e=this.viewer.querySelector(t);this[Ip][i]=e?.parentElement,this.viewer.querySelector(t)?.remove()}}})}var Bp,Sp,Mp,xp,yp,Qp,Tp;gp=new WeakMap,pp=new WeakMap,mp=new WeakMap,vp=new WeakMap,bp=Cp,Ep=Ip,up([_p("vntana-fs-button")],wp.prototype,"fsButton",null),up([_p("vntana-qr-button")],wp.prototype,"qrButton",null),up([_p("vntana-ar-button")],wp.prototype,"arButton",null),up([_p("vntana-center-button")],wp.prototype,"centerButton",null);const Dp=Symbol("loaded"),Lp=Symbol("visible"),Rp=Symbol("needs-render"),Pp=Symbol(),Up=Symbol("initial-load"),Np=Symbol(),kp=Symbol(),Fp=Symbol(),Op=Symbol(),Gp=Symbol(),Hp=Symbol(),Vp=Symbol(),zp=Symbol(),qp=Symbol();class Wp extends Bl{constructor(){if(super(),this[Bp]=!1,this[Sp]=!1,this[Mp]=!1,this[xp]=!1,this[yp]=0,this[Qp]=!0,this[Tp]=!1,this.onTick=({delta:t})=>{this.updateSize(),tu.requestSize(this.width,this.height),this[Pp]+=t/1e3,this.sceneVisible&&this.updateComponents()},this.updateSize=()=>{const{maxTextureSize:t}=tu.webglRenderer.capabilities;let{clientWidth:e,clientHeight:i}=this.container;if(this[Vp]=Math.round(e*window.devicePixelRatio),this[zp]=Math.round(i*window.devicePixelRatio),this[Vp]>t||this[zp]>t){this[qp]||(this[qp]=!0,console.warn(`Resolution ${this[Vp]}x${this[zp]} cannot be properly rendered in this browser.`));const n=e/i;this[Vp]=Math.max(Math.round(t*Math.min(1,n)),1),this[zp]=Math.max(Math.round(t*Math.min(1,1/n)),1)}else this[qp]=!1;this[Vp]===this.canvas.width&&this[zp]===this.canvas.height||(this.canvas.width=this[Vp],this.canvas.height=this[zp],this.dispatchEvent(new CustomEvent("resize",{detail:{width:Vp,height:zp}})),this.needsRender=!0),this.rendering.setSize(this[Vp],this[zp]),this.controls.setSize(this[Vp],this[zp]),this.hotspotRenderer.setSize(e,i)},this.updateComponents=()=>{this.scene.update(this[Pp])&&(this.needsRender=!0),this.controls.update(this[Pp])&&(this.dispatchEvent(new CustomEvent("camera-change")),this.needsRender=!0),this.inspector.update()&&(this.needsRender=!0),this.jewelry.update()&&(this.needsRender=!0),this.ar?.update(this[Pp])&&(this.needsRender=!0),this.ar?.active||this.rendering.update(this.needsRender)&&(this.needsRender=!0),this.hotspotRenderer.render(this.scene,this.camera),this[Pp]=0},this.render=()=>{if(this.sceneVisible&&this.needsRender&&!this.ar?.active){const{width:t,height:e}=this.canvas;tu.webglRenderer.setRenderTarget(null),tu.webglRenderer.setViewport(0,tu.canvas.height-e,t,e),tu.webglRenderer.setClearColor(0,0),tu.webglRenderer.outputColorSpace=Qt,tu.webglRenderer.clear();!!this.scene.shadow.parent?(tu.webglRenderer.shadowMap.enabled=!0,tu.webglRenderer.shadowMap.needsUpdate=this.scene.shadow.needsRepaint):tu.webglRenderer.shadowMap.enabled=!1,this.rendering.render(this.inspector.isActive()),tu.copyPixels(this.canvas,t,e),this[Rp]=!1}},this.Ye=()=>{this.dispatchEvent(new CustomEvent("webglcontextlost"))},this.attachShadow({mode:"open"}),!this.shadowRoot)throw new Error("Failed to attach shadow root");this.shadowRoot.append(nl.content.cloneNode(!0)),this.container=this.shadowRoot.querySelector(".container"),this.canvas=this.shadowRoot.querySelector("canvas"),this.canvasContainer=this.shadowRoot.querySelector("div.canvas-container"),this.input=this.shadowRoot.querySelector(".input"),this.hotspots=this.shadowRoot.querySelector(".hotspots"),this.scene=new Ug,this.camera=new ts(45,1,.01,1e3),this.scene.add(this.camera),this.controls=new bd(this.camera,this.input,this.scene),this.rendering=new Vu(this.scene,this.camera),this.jewelry=new tp(this.scene),this.inspector=new Vg(this.scene),this.hotspotRenderer=new hp(this.shadowRoot.querySelector(".hotspots")),this.progressTracker=new Ap,this.ui=new wp(this),this[Vp]=this.container.clientWidth*window.devicePixelRatio,this[zp]=this.container.clientHeight*window.devicePixelRatio,this.canvas.width=this.width,this.canvas.height=this.height,this.jewelry.addEventListener("enabled",(()=>{this.rendering.rebuild()})),this.Ke=window.IntersectionObserver?new IntersectionObserver((t=>{for(const e of t)if(e.target===this){if(this[Lp]===e.isIntersecting)return;this[Lp]=e.isIntersecting,this[Np](),this.dispatchEvent(new CustomEvent("visibility",{detail:{visible:e.isIntersecting}}))}})):null,document.addEventListener("visibilitychange",(()=>{document.hidden&&(this.rendering.dispose(),this.inspector.dispose())}))}connectedCallback(){super.connectedCallback(),tu.addEventListener("tick",this.onTick),tu.addEventListener("render",this.render),tu.addEventListener("webglcontextlost",this.Ye),this.Ke?.observe(this)}disconnectedCallback(){super.disconnectedCallback(),tu.removeEventListener("tick",this.onTick),tu.removeEventListener("render",this.render),tu.removeEventListener("webglcontextlost",this.Ye),this.Ke?.unobserve(this)}dispose(){this.rendering.dispose(),this.scene.dispose(),this.inspector.dispose()}async load(t={}){const e=cp(t),i=this;Wp.elementProperties.forEach(((t,e)=>{i[e]=null}));const n=new Promise(((t,e)=>{const i={resolve:null,reject:null};i.resolve=()=>{this.removeEventListener("load",i.resolve),this.removeEventListener("error",i.reject),t()},i.reject=()=>{this.removeEventListener("load",i.resolve),this.removeEventListener("error",i.reject),e()},this.addEventListener("load",i.resolve),this.addEventListener("error",i.reject)}));for(const t in e)i[t]=e[t];return this.ui.fsButton=t.ui?.fsButton??!0,this.ui.qrButton=t.ui?.qrButton??!0,this.ui.arButton=t.ui?.arButton??!0,this.ui.centerButton=t.ui?.centerButton??!0,this.ui.zoomButtons=t.ui?.zoomButtons??!0,this.ui.qrURL=t.ui?.qrURL||"",n}save(){const t={scene:this.scene.save(),rendering:this.rendering.save(),jewelry:this.jewelry.save(),controls:this.controls.save(),styling:{background:this.background},ui:this.ui.save()};return function(t){if(Gu(t,Ou),t.scene?.models){const e=t=>{t.animation&&Gu(t.animation,Uu),Gu(t,Pu)},i=t.scene.models;for(const t of i)e(t);t.scene.models=i.filter((t=>0!==Object.keys(t).length)),0===t.scene.models.length&&delete t.scene.models}if(t.scene?.lights?.lightRig){const e=t.scene?.lights?.lightRig;for(const t of e)"directional"===t.type?Gu(t,Nu):"point"===t.type?Gu(t,ku):"spot"===t.type&&Gu(t,Fu)}}(t),t}get loaded(){return this[Dp]}get visible(){return this[Lp]}get needsRender(){return this[Rp]}set needsRender(t){this[Rp]=this[Rp]||!!t}get width(){return this[Vp]}get height(){return this[zp]}get sceneVisible(){return this.loaded&&this.visible}[(Bp=qp,Sp=Dp,Mp=Lp,xp=Rp,yp=Pp,Qp=Up,Tp=kp,Np)](){}[Gp](){}get[Fp](){return this.visible}get[Op](){return this.loaded&&!this[kp]}[Hp](){}getNDC(t,e){const i=this.container.getBoundingClientRect();return{x:(t-i.x)/i.width*2-1,y:(e-i.y)/i.height*-2+1}}evaluate(t,e,i){if(!Wp.evaluator.has(t))throw new Error(`Invalid property name "${t}"`);return Wp.evaluator.get(t).call(this,e,i)}}Wp.renderer=tu,Wp.evaluator=new Map;
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const jp={attribute:!0,type:String,converter:Il,reflect:!1,hasChanged:wl},Jp=(t=jp,e,i)=>{const{kind:n,metadata:s}=i;let r=globalThis.litPropertyMetadata.get(s);if(void 0===r&&globalThis.litPropertyMetadata.set(s,r=new Map),r.set(i.name,t),"accessor"===n){const{name:n}=i;return{set(i){const s=e.get.call(this);e.set.call(this,i),this.requestUpdate(n,s,t)},init(e){return void 0!==e&&this.P(n,void 0,t),e}}}if("setter"===n){const{name:n}=i;return function(i){const s=this[n];e.call(this,i),this.requestUpdate(n,s,t)}}throw Error("Unsupported decorator location: "+n)};function Yp(t){return(e,i)=>"object"==typeof i?Jp(t,e,i):((t,e,i)=>{const n=e.hasOwnProperty(i);return e.constructor.createProperty(i,n?{...t,wrapped:!0}:t),n?Object.getOwnPropertyDescriptor(e,i):void 0})(t,e,i)
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */}function Kp(t){return Yp({...t,state:!0,attribute:!1})}const Xp=new Ne,Zp=new Xi,$p=new di,tm=new le;class em extends hA{constructor(){super(),this.Xe=null,this.Ze=null,this.$e=null,this.ti=new Ne,this.ei={path:null,position:new Ne,normal:new Ne},this.modelIndex=0,this.position="",this.normal="",this.path="",this.ii=new ep(document.createElement("div")),this.ii.element.innerHTML=`<slot name="${this.ii.uuid}"></slot>`,this.ni=this.si.bind(this),this.ri=this.oi.bind(this),this.ai=this.hi.bind(this),this.ci=this.li.bind(this)}connectedCallback(){super.connectedCallback(),this.setAttribute("slot",this.ii.uuid),this.Xe=this.parentElement instanceof Wp?this.parentElement:null,this.Xe&&(this.Xe.scene.addEventListener("model-added",this.ni),this.Xe.scene.addEventListener("model-removed",this.ri),this.Xe.addEventListener("camera-change",this.ai))}disconnectedCallback(){super.disconnectedCallback(),this.Xe&&(this.Xe.scene.removeEventListener("model-added",this.ni),this.Xe.scene.removeEventListener("model-removed",this.ri),this.Xe.removeEventListener("camera-change",this.ai)),this.Ze instanceof Dg&&this.Ai(),this.removeAttribute("slot"),this.Xe=null,this.ii.element.remove(),this.ii.removeFromParent(),this.Ze=null,this.$e=null,this.ei.position.set(0,0,0),this.ei.normal.set(0,0,0),this.ei.path=null}set needsRender(t){this.Xe&&t&&(this.Xe.hotspotRenderer.needsUpdate=!0)}render(){return ql`<slot></slot>`}shouldUpdate(t){return t.has("position")&&this.di(),t.has("normal")&&this.fi(),t.has("path")&&this.gi(),t.has("modelIndex")&&this.pi(),(t.has("modelIndex")||t.has("path"))&&this.mi(),this.bi(),this.Ei(),this.needsRender=!0,!this.hasUpdated}pi(){let t;return t=this.Xe?this.modelIndex<0?this.Xe.scene:this.modelIndex<this.Xe.scene.models.length?this.Xe.scene.models[this.modelIndex]:null:null,this.Ze!==t&&(this.Ze instanceof Dg&&this.Ai(),this.Ze&&!t?(this.Xe?.scene.hotspotRoots.remove(this.ii),this.ii.element.remove()):!this.Ze&&t&&(this.Xe?.scene.hotspotRoots.add(this.ii),this.Xe?.hotspotRenderer.appendElement(this.ii.element)),this.Ze=t,this.Ze instanceof Dg&&this.Ci(),!0)}mi(){try{if(!(this.Xe&&this.Ze instanceof Dg&&this.ei.path))throw null;const{path:t}=this.ei,e=this.Ze.getMeshFromIndices(this.ei.path[0],this.ei.path[1]);if(!e)throw null;const i=e.geometry.getAttribute("position").count;if(t[2]>=i||t[3]>=i||t[4]>=i)throw console.warn("Vertex indices out of range"),null;if(e instanceof xa&&t[8]>=e.count)throw console.warn("Instance index out of range"),null;this.$e={mesh:e,vertices:[t[2],t[3],t[4]],uvw:[t[5],t[6],t[7]],instance:t[8]}}catch(t){if(null!=t)throw t;this.$e=null}}bi(){if(!this.Xe||!this.Ze)return;const t=this.Ze instanceof Dg&&this.Ze.animation?.isActive||!1;if(this.$e&&t){if(this.$e.mesh.getVertexPosition(this.$e.vertices[0],Zp.a),this.$e.mesh.getVertexPosition(this.$e.vertices[1],Zp.b),this.$e.mesh.getVertexPosition(this.$e.vertices[2],Zp.c),this.$e.mesh instanceof xa){const t=$p;this.$e.mesh.getMatrixAt(this.$e.instance,t),Zp.a.applyMatrix4(t),Zp.b.applyMatrix4(t),Zp.c.applyMatrix4(t)}const t=tm;t.set(Zp.a.x,Zp.b.x,Zp.c.x,Zp.a.y,Zp.b.y,Zp.c.y,Zp.a.z,Zp.b.z,Zp.c.z),this.ii.position.fromArray(this.$e.uvw).applyMatrix3(t),this.Xe.scene.worldToLocal(this.$e.mesh.localToWorld(this.ii.position));const e=tm.getNormalMatrix(this.$e.mesh.matrixWorld);Zp.getNormal(this.ti).applyNormalMatrix(e)}else{const t=this.Ze instanceof Dg?this.Ze.scene:this.Ze;this.ii.position.copy(this.ei.position),this.Xe.scene.worldToLocal(this.ii.position.applyMatrix4(t.matrixWorld));const e=tm.getNormalMatrix(t.matrixWorld);this.ti.copy(this.ei.normal),this.ti.applyNormalMatrix(e)}}Ei(){if(!this.Xe)return;this.Xe.scene.localToWorld(Xp.copy(this.ii.position)).sub(this.Xe.camera.position).normalize().multiplyScalar(-1).dot(this.ti)<0?this.classList.add("hide"):this.classList.remove("hide")}di(){if(!this.position)return void this.ei.position.set(0,0,0);const t=im(this.position);3!==t.length&&(console.warn(`Invalid position attribute "${this.position}"`),this.ei.position.set(0,0,0)),this.ei.position.fromArray(t)}fi(){this.normal||this.ei.normal.set(0,0,0);const t=im(this.normal);3!==t.length&&(console.warn(`Invalid normal attribute "${this.normal}"`),this.ei.normal.set(0,0,0)),this.ei.normal.fromArray(t).normalize()}gi(){if(!this.path)return void(this.ei.path=null);const t=im(this.path);8===t.length&&t.push(0);[...t.slice(0,5),t[8]].some((t=>Math.round(t)!==t||t<0))?(console.warn(`Invalid path attribute "${this.path}"`),this.ei.path=null):this.ei.path=t}Ci(){const t=this.Ze;t?.addEventListener("animation-frame",this.ci),t?.addEventListener("bounding-box-update",this.ci)}Ai(){const t=this.Ze;t?.removeEventListener("animation-frame",this.ci),t?.removeEventListener("bounding-box-update",this.ci)}si(t){const{index:e}=t;this.Ze||this.modelIndex!==e||this.requestUpdate("modelIndex")}oi(t){const{index:e}=t;this.Ze&&(e<this.modelIndex?--this.modelIndex:this.modelIndex===e&&this.remove())}hi(t){this.Ei(),this.needsRender=!0}li(t){this.bi(),this.Ei(),this.needsRender=!0}}function im(t){return t.trim().split(/\s+/).map(parseFloat).filter(isFinite)}up([Yp({attribute:"model-index",type:Number})],em.prototype,"modelIndex",void 0),up([Yp()],em.prototype,"position",void 0),up([Yp()],em.prototype,"normal",void 0),up([Yp()],em.prototype,"path",void 0);function nm(t){let e=t;for(;e&&!(e instanceof Wp);)e=e.parentElement;return e||null}const sm=Symbol();var rm,om,am,hm,cm=':host, .vntana-button {\n  --computed-button-size: var(--button-size, 40px);\n  --computed-icon-size: var(--icon-size, 22px);\n\n  display: flex;\n  flex-direction: row;\n  justify-content: start;\n  align-items: center;\n  flex-wrap: nowrap;\n\n  border: none;\n  border-radius: 5px;\n  outline: none;\n\n  overflow: hidden;\n\n  box-sizing: border-box;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n\n  background-color: white;\n  cursor: pointer;\n\n  user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n}\n\n[part="default-icon"], .vntana-button-icon {\n  flex: 0 0 auto;\n\n  margin: calc(0.5 * (var(--computed-button-size) - var(--computed-icon-size)));\n\n  height: var(--computed-icon-size);\n  width: var(--computed-icon-size);\n}\n\n[part="default-text"], .vntana-button-text {\n  color: #494949;\n\n  font-family: \'Roboto\';\n  font-size: 14px;\n  font-weight: 500;\n  line-height: 16.41px;\n  text-align: center;\n\n  text-overflow: clip;\n  white-space: nowrap;\n\n  margin-right: calc(0.5 * (var(--computed-button-size) - var(--computed-icon-size)));\n}\n\n:host([data-hidden]) {\n  display: none!important;\n}\n';const lm=new CustomEvent("enter-fullscreen",{bubbles:!0}),Am=new CustomEvent("exit-fullscreen",{bubbles:!0}),um=Symbol(),dm=Symbol(),fm=Symbol();class gm extends hA{constructor(){super(),this[rm]=!1,this[om]=null,this[am]=null,this[hm]=null,this.Ii=()=>{mm(this[um])?(this[fm]=!0,this.dispatchEvent(lm)):(this[fm]=!1,this.dispatchEvent(Am))},this.addEventListener("click",(()=>{!function(t){if(!t)return;const e=pm()===t;e?document.exitFullscreen?.()||document.webkitExitFullscreen?.()||document.mozCancelFullScreen?.():t.requestFullscreen?.()||t.webkitRequestFullscreen?.()||t.mozRequestFullscreen?.()}(this[um])}))}connectedCallback(){super.connectedCallback(),this[sm]=nm(this)}disconnectedCallback(){super.disconnectedCallback(),this[sm]=null}get externalTarget(){return this[dm]}set externalTarget(t){this[dm]=t||null}get enabled(){return!NA&&!!this[um]&&(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled)}get isFullscreen(){return this[fm]}shouldUpdate(t){if(t.has(dm)||t.has(sm)){const t=this[dm]||this[sm]||this.parentElement||null;this[um]!==t&&(this[um]&&(this[um].removeEventListener("fullscreenchange",this.Ii),this[um].removeEventListener("webkitfullscreenchange",this.Ii),this[um].removeEventListener("mozfullscreenchange",this.Ii)),this[um]=t,this[um]&&(this[um].addEventListener("fullscreenchange",this.Ii),this[um].addEventListener("webkitfullscreenchange",this.Ii),this[um].addEventListener("mozfullscreenchange",this.Ii)),this[fm]=!!this[um]&&mm(this[um]))}return this.Ei(),!0}Ei(){this.enabled?this.removeAttribute("data-hidden"):this.setAttribute("data-hidden","")}render(){return this[fm]?ql`
        <slot name="active">
          <svg part="default-icon" xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 24 25'><defs><path id='prefix__a' d='M8.603 14.373c.196 0 .373.08.501.207.129.129.208.306.208.502v6.158c0 .391-.317.709-.71.709-.39 0-.708-.318-.708-.71v-5.448H2.445c-.392 0-.71-.317-.71-.71 0-.39.318-.708.71-.708zm13.079 0c.392 0 .71.317.71.709 0 .392-.318.709-.71.71l-5.449-.001v5.449c0 .391-.317.709-.709.709-.392 0-.71-.318-.71-.71v-6.157c0-.196.08-.373.209-.502.128-.128.305-.207.5-.207h6.159zM8.602 1.559c.393 0 .71.317.71.71v6.157c0 .196-.08.373-.208.501-.128.129-.305.208-.5.208H2.444c-.392 0-.71-.318-.71-.71 0-.39.318-.708.71-.708h5.449V2.268c0-.392.317-.71.709-.71zm6.922 0c.392 0 .709.317.71.709v5.449h5.448c.392 0 .71.317.71.709 0 .391-.318.709-.71.709h-6.158c-.196 0-.373-.08-.501-.208-.129-.128-.208-.305-.208-.5V2.267c0-.392.317-.71.709-.71z'/></defs><g fill='none' fill-rule='evenodd' transform='translate(0 1)'><path d='M0 0H24V24H0z'/><use fill='#1a1a1a' xlink:href='#prefix__a'/></g></svg>
        </slot>
      `:ql`
        <slot name="inactive">
          <svg part="default-icon" xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' viewBox='0 0 24 24'><defs><path id='prefix__a' d='M3.71 13.424c.39 0 .708.317.708.709v5.449h5.45c.39 0 .708.317.708.709 0 .391-.317.709-.709.709H3.71c-.196 0-.373-.08-.501-.208S3 20.487 3 20.291v-6.158c0-.392.318-.71.71-.71zm16.58 0c.392 0 .71.317.71.709v6.158c0 .196-.08.373-.208.501s-.305.208-.501.208h-6.158c-.392 0-.71-.318-.71-.71 0-.391.318-.708.71-.709h5.449v-5.448c0-.392.317-.71.709-.71zM9.868 3c.392 0 .71.318.71.71 0 .39-.318.708-.71.708H4.418v5.449c0 .392-.317.71-.709.71-.391 0-.709-.318-.709-.71V3.709c0-.196.08-.373.208-.501.128-.129.305-.208.501-.208h6.158zm10.424 0c.196 0 .373.08.501.208s.208.305.208.5v6.159c0 .392-.318.71-.71.71-.39 0-.708-.318-.708-.71V4.418h-5.45c-.39 0-.708-.317-.708-.709 0-.391.317-.709.709-.709z'/></defs><g fill='none' fill-rule='evenodd'><path d='M0 0H24V24H0z'/><use fill='#1a1a1a' xlink:href='#prefix__a'/></g></svg>
        </slot>
      `}}function pm(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement}function mm(t){return!!t&&pm()===t}rm=fm,om=dm,am=sm,hm=um,gm.styles=[cl(cm)],up([Kp()],gm.prototype,rm,void 0),up([Kp()],gm.prototype,om,void 0),up([Kp()],gm.prototype,am,void 0),up([Kp()],gm.prototype,hm,void 0);var vm,bm,Em,Cm,Im=":host {\n  max-width: 170px;\n}\n";const wm=Symbol(),_m=Symbol(),Bm=Symbol(),Sm=new CustomEvent("enter-qr-modal",{bubbles:!0}),Mm=new CustomEvent("exit-qr-modal",{bubbles:!0});class xm extends hA{constructor(){super(),this[vm]=null,this[bm]=null,this[Em]=null,this[Cm]=null,this.url="",this.Ei=()=>{this.enabled?this.removeAttribute("data-hidden"):this.setAttribute("data-hidden","")},this.addEventListener("click",(()=>{this[_m]&&(this[wm]||(this[wm]=document.createElement("vntana-qr-overlay"),this[wm].addEventListener("enter-qr-overlay",(t=>{t.stopPropagation(),this.dispatchEvent(Sm)})),this[wm].addEventListener("exit-qr-overlay",(t=>{t.stopPropagation(),this.dispatchEvent(Mm)}))),this[wm].url=this.url,this[_m].append(this[wm]))}))}connectedCallback(){super.connectedCallback(),this[sm]=nm(this)}disconnectedCallback(){super.disconnectedCallback(),this[sm]=null,this[wm]?.remove()}get externalTarget(){return this[Bm]}set externalTarget(t){this[Bm]=t||null}get enabled(){return!(!this[sm]||"none"!==this[sm].arMode||NA||VA||!this.url||this[sm]&&this[sm].jewelry.enabled)}get isOverlayed(){return this[wm]&&this[wm].parentElement===this[_m]}shouldUpdate(t){if(t.has(Bm)||t.has(sm)){const t=this[Bm]||this[sm]||this.parentElement||null;this[_m]!==t&&(this[wm]?.remove(),this[_m]=t)}if(t.has(sm)){const e=t.get(sm);e&&e.jewelry.removeEventListener("enabled",this.Ei),this[sm]&&this[sm].addEventListener("enabled",this.Ei)}return t.has("url")&&this[wm]&&(this[wm].url=this.url),this.Ei(),!0}render(){return ql`
      <slot>
        <img part="default-icon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAAA2CAQAAAD99wh0AAAAAmJLR0QA/4ePzL8AAATwSURBVFjDrZhdbBRVFMfPbltKKXbp7pbt3rmf06WCpfTrQR9MxIKJL4YosWpsNMb4YqJiTIwfkIgxPphieJAgLUiUJibyUKNQG0gkwVCM+mJC06gJwahVQcCkgPaDjufeWWy7nZm92/Y8TWbn/ubuvef+z/8MgHVsLpf7yYQ83LQClj/UfWyEeEmPeOy86lpWtNggTzie47FJhN/UV/yk27gsaJoUPVRjZ1S/6iee+kQdZfgCZ0rscxNLhTvssuNRTww3dOAC9SG+D6ChU35PcZnoL8maxbNjsLb6fueGGHMfx2uYxWPE1dP8V3Kh6m4g/m+lRg3cAW1AaHI2U+bg/58AtMJGqC0NvRJy0AEuFKTgAryOChD4bCNU2aHLwIF22ACrA5IzCK9jFdyOYwSUR661fJR/W/cabIJ08ANyL/Hk3pDRtdCceo4NinuDh7aKMxQTjg7g/EOCkfQeRkKnF6fH9JkQAy6fd78xLXrZNCbaTfEBTUb8vwpc5YqIky3EF0wn7A32JvX3ommFeiaf29/Ju4rsSxG8DnerHNWrwMbkCx2rgE5l9B/6XXVb5K8FXk9YvsyvOV4GRQQcr07jf3C3WGSVFR5iqltc1FziAcdlYZNmcQa5u3S8aBfDRjDGUfh8vPuQPKFvsX/UW7Rq8XgnJQ9pRaXTos/dQm/htVyJB8XPOq2cjyP2IBofY0NGts/KVpS9jnl4VMcq9w3+U93bERoSha+BprU9dFQ+5k9vAd5CQ8LwARoVho/SkCB8iEbl8WwKt7Y5WEOgBQU3FolP4TOBGqVaEI95vzPbB/FgDcFS0ZY9yof0VhXiGeFHyFdYTliIRpVlDzqvAiJyEalYRceJTrReJzWLz1WqnfQ63p9hGyPG5pBdBA+iTX5jNORv+TyeCcTLbfSCcQvn1QORJ8wGbw75E+IPAxxN72anTG6Py1dylUXGWeIxMtXubj6RRRuV1ZbkiKy3UCh7vF73NffUj6W87JXkdrCzgdb4vCPgHxGPfwhN2kGEZNsi8AmUCQ2M5Uu5/7JmSC0d7x936Wf7HKdQjvneXsR+aLyzK3sw7GAYxHqoDjEiWjr0q4PtR1n9IWeXEQXVErDaaXPcU0V8TgIXqRXqF4q4FgU2FSxptxkD6BRuX6CNiiO8Dbc7EShpBfgYVKKwduC6BSQfdiee2hco1BLHrMOdioXiczWqh09kDgQbQF8g6o/TTSEbWQ3rM31sQr3TtHohPu4+Jf7Ux532LroYAj9gBOM3+cg8fK5bfG1k66p8MdwCWjiFuHySXdKuQ57OPZzHI3aGeM40fz/SAFoaEV4r3qPaUE4bI0KM3RFnAyvW4mwUuM1i2OeC+DeTF1iLftUOXyaeZX8ZEzjhq/nFfHnoWjq+oZOfM7Srcsdm/zy7Cfkum9JbwoeUWJIBP25SZFLtkWsKWmNxUntzZzBCzaPxFfQ00V71c3ddcIeyTXyZfilczfFYDYq28IpQ97o41dBpUzoC1VyLgtwfVRHsusMQNQ+UtHkVwT5uGcGKCLxvAOdUhNIisbKTXOYjonMBPqa6+I+ZgcKKUOpXHMGvmyz+VMpZPHYgpkll5yIVyiYacvIz00xi5yIPI75fdyDaAAo7t2OhIVvFiJ6tc42YPszRTeqdy/lBCqWWXyLGpfErcoeFyyn9u5QaIjPqWK6ET0T/Ae/zy1FZSYKPAAAAAElFTkSuQmCC" />
        <span part="default-text" class="qr-button-text">View in Your Space</span>
      </slot>
    `}}vm=wm,bm=Bm,Em=sm,Cm=_m,xm.styles=[cl(cm),cl(Im)],up([Kp()],xm.prototype,bm,void 0),up([Kp()],xm.prototype,Em,void 0),up([Kp()],xm.prototype,Cm,void 0),up([Yp()],xm.prototype,"url",void 0);const ym=new CustomEvent("enter-qr-overlay"),Qm=new CustomEvent("exit-qr-overlay");class Tm extends hA{constructor(){super(),this.url="",this.addEventListener("click",(t=>{const e=this.shadowRoot.querySelector("[part=close-button]"),i=t.composedPath();i[0]!==this&&i[0]!==e||this.remove()}))}connectedCallback(){super.connectedCallback(),this.dispatchEvent(ym)}disconnectedCallback(){super.disconnectedCallback(),this.dispatchEvent(Qm)}updated(t){if(t.has("url")&&this.isConnected){const t=this.shadowRoot?.querySelector("canvas");!async function(t,e,i=Dm){if(e){if(!Lm){const t=document.createElement("script");t.src="https://static.vntana.com/js/qrious.min.js",Lm=new Promise(((e,i)=>{t.addEventListener("load",(()=>e())),t.addEventListener("error",(()=>i()))})),document.head.append(t)}await Lm,new QRious({element:t,value:e,size:i})}else{const e=t.getContext("2d");e?.clearRect(0,0,t.width,t.height)}}(t,this.url)}}render(){return ql`
      <div part="modal">
        <div part="close-button"></div>
        <div part="header">Scan QR Code</div>
        <div part="text">with your mobile device to view this 3D product in your space.</div>
        <canvas part="qr-canvas"></canvas>
      </div>
    `}}Tm.styles=[cl(cm),cl(":host {\n  all: initial;\n\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 10000;\n\n  width: 100%;\n  height: 100%;\n\n  background-color: rgba(0, 0, 0, 0.7);\n\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n[part=modal] {\n  all: initial;\n  position: absolute;\n  max-width: 90%;\n  width: 339px;\n  height: 346px;\n\n  padding: 0;\n\n  box-sizing: border-box;\n  background-color: white;\n}\n\n[part=close-button] {\n  position: absolute;\n  top: 15.37px;\n  right: 15.37px;\n\n  width: 16.2634px;\n  height: 16.2634px;\n\n  padding: 0;\n  margin: 0;\n\n  background-image: var(--default-qr-modal-close, url(\"data:image/svg+xml, %3Csvg viewBox='0 0 16.263456 16.263456' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'%3E%3Cdefs%3E%3Cpath d='M15.5563492,0 L16.263456,0.707106781 L8.839,8.132 L16.263456,15.5563492 L15.5563492,16.263456 L8.132,8.839 L0.707106781,16.263456 L8.32667268e-15,15.5563492 L7.425,8.132 L1.0658141e-14,0.707106781 L0.707106781,0 L8.132,7.425 L15.5563492,0 Z' id='path-1'%3E%3C/path%3E%3C/defs%3E%3Cg id='PDP-with-3D-Player' stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'%3E%3Cg id='1920_Kohler_PDP---Single-SKU_3D-Player-Full-Screen-QR-Code' transform='translate(-1098.3683, -382.3683)'%3E%3Cg id='Pop-Up' transform='translate(791, 367)'%3E%3Cg id='icon/directional/close/-2x' transform='translate(307.3683, 15.3683)'%3E%3Cmask id='mask-2' fill='white'%3E%3Cuse xlink:href='%23path-1'%3E%3C/use%3E%3C/mask%3E%3Cuse id='Close-Icon' fill='%23212121' xlink:href='%23path-1'%3E%3C/use%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/g%3E%3C/svg%3E%0A\"));\n  background-color: white;\n  background-repeat: no-repeat;\n  background-position: center;\n  background-size: 100%;\n\n  cursor: pointer;\n}\n\n[part=header] {\n  position: absolute;\n  top: 58px;\n  left: 0;\n  right: 0;\n\n  margin-left: auto;\n  margin-right: auto;\n\n  color: #494949;\n\n  font-family: 'Roboto';\n  font-size: 28px;\n  font-weight: 700;\n  line-height: 32.81px;\n  text-align: center;\n\n  overflow: hidden;\n}\n\n[part=text] {\n  position: absolute;\n  top: 108px;\n  left: 0;\n  right: 0;\n\n  margin-left: auto;\n  margin-right: auto;\n\n  height: 48px;\n  width: 241px;\n  max-width: 100%;\n\n  color: #757575;\n\n  font-family: 'Roboto';\n  font-size: 14px;\n  font-weight: 400;\n  line-height: 16.41px;\n  text-align: center;\n\n  overflow: hidden;\n}\n\n[part=qr-canvas] {\n  position: absolute;\n  top: 176px;\n  left: 0;\n  right: 0;\n\n  height: 137px;\n  width: 137px;\n  max-width: 100%;\n\n  margin-left: auto;\n  margin-right: auto;\n\n  color: #494949;\n\n  overflow: hidden;\n}\n\n")],up([Yp()],Tm.prototype,"url",void 0);const Dm=150;let Lm=null;const Rm=["m","%"],Pm=["rad","deg"];function Um(t,e,i){const n=t.constructor;n.evaluator.has(e)||n.evaluator.set(e,i)}function Nm(t,e,i){const n=t.constructor;n.elementProperties.has(e)||n.elementProperties.set(e,{attribute:i??e})}function km(t,e){const i=t.constructor,n=Object.getOwnPropertyDescriptor(t,e),{get:s,set:r}=n;return{get:function(){return s.call(this)},set:function(t){const n=this[e],s=i.evaluator.get(e).call(this,t);n!==s&&(r.call(this,s),this.requestUpdate(e))}}}function Fm(t,e,i){if(i){const n=t.updated;Object.defineProperty(t,"updated",{value:function(t){n.call(this,t),t.has(e)&&this[Op]&&i.call(this,this[e])}})}}function Om(t,e,i,n){const s=Object.getOwnPropertyDescriptor(t,e),{get:r,set:o}=s,a={get:function(){return r.call(this)},set:function(t){this[e]!==t&&(o.call(this,t),this.requestUpdate(e))}},h=t.constructor.evaluator.get(e);if(i){const s=t.updated;Object.defineProperty(t,"updated",{value:function(t){if(s.call(this,t),t.has(e)&&this[Op]){const t=r.call(this),e=h.call(this,t,n);i.call(this,e)}}})}return a}const Gm=t=>t?String(t):"",Hm=(t={})=>(e,i,n)=>{Nm(e,i,t.attribute),Um(e,i,Gm),Fm(e,i,t.update);return km(e,i)},Vm=t=>"string"==typeof t||Boolean(t),zm=(t={})=>(e,i,n)=>{Nm(e,i,t.attribute),Um(e,i,Vm),Fm(e,i,t.update);return km(e,i)};const qm=t=>(e,i,n)=>{Nm(e,i,t.attribute),Um(e,i,function(t,e){const i=t.auto,n=t.values;return t=>{let s;return null===t||"auto"===t?s=i:n.includes(t)?s=t:(s=i,console.warn(`Invalid value passed to ${e}, reverting to default (${i})`)),s}}(t.evaluator,i)),Fm(e,i,t.update);return km(e,i)};function Wm(t,e){const i=t.auto,n=t.nullable;return t=>{if("auto"===t||n&&null===t)return i;if(null===t)return console.warn(`Invalid value passed to ${e}, reverting to default (${i})`),i;if("string"==typeof t){if(t=t.trim(),/^#[0-9a-f]{6}(?=$)/i.test(t))return t;t=Number(t)}return"number"==typeof t?isNaN(t)||t<0||2**24<=t?(console.warn(`Invalid value passed to ${e}, reverting to defaul (${i})`),i):`#${t.toString(16).padStart(6,"0")}`:i}}const jm=t=>(e,i,n)=>{Nm(e,i,t.attribute),Um(e,i,Wm(t.evaluator,i)),Fm(e,i,t.update);return km(e,i)};function Jm(t,e){const i=t.auto,n=t.lower??-1/0,s=t.upper??1/0,r=!!t.integer,o=!!t.infinite;return t=>{let a;return"number"==typeof t?a=t:null===t||"auto"===t?a=i:"string"==typeof t?(a=Number(t),isNaN(a)&&(console.warn(`Invalid numeric value passed to ${e}, reverting to default (${i})`),a=i)):a=i,o||Number.isFinite(a)||(console.warn(`Infinite value passed to ${e}, reverting to default (${i})`),a=i),r&&!Number.isInteger(a)&&(a=Math.round(a),console.warn(`Non-integer value passed to ${e}, rounding the value to ${a}`)),(a<n||s<a)&&(a=Math.min(Math.max(a,n),s),console.warn(`Out-of-range value passed to ${e}, clamping the value to ${a}`)),a}}const Ym=t=>(e,i,n)=>{Nm(e,i,t.attribute),Um(e,i,Jm(t.evaluator,i)),Fm(e,i,t.update);return km(e,i)};function Km(t,e){const i=t.auto,n=t.lower??-1/0,s=t.upper??1/0,r=!!t.infinite;return function(t,o="rad"){if(!Pm.includes(o))throw new Error(`Cannot parse angle as ${o}`);const a="function"==typeof i?i.call(this):i;let h=a,c="rad";if("number"==typeof t)h=t;else if(null===t||"auto"===t)h=a;else if("string"==typeof t){const n=t.match(/^([\+\-]?(\d+\.\d+|\d+|\.\d+)([eE][\+\-]?\d+)?)([a-z%]+)?(?=$)/i);n?(h=Number(n[1])||0,n[4]&&(Pm.includes(n[4])?c=n[4]:console.warn(`Invalid unit passed to ${e}, reverting to default unit (rad)`))):"Infinity"===t||"+Infinity"===t?h=1/0:"-Infinity"===t?h=-1/0:console.warn(`Invalid value passed to ${e}, reverting to default (${i}rad)`)}else console.warn(`Invalid value passed to ${e}, reverting to default (${i}rad)`);r||Number.isFinite(h)||(console.warn(`Infinite value passed to ${e}, reverting to default (${i}rad)`),h=a,c="rad");let l=Zm(h,c,"rad");return(l<n||s<l)&&(l=Math.min(Math.max(l,n),s),h=Zm(l,"rad",c),console.warn(`Out-of-range value passed to ${e}, clamping the value to ${h}${c}`)),Zm(h,c,o)}}const Xm=t=>(e,i,n)=>{Nm(e,i,t.attribute),Um(e,i,Km(t.evaluator,i));return Om(e,i,t.update,t.unit)};function Zm(t,e,i){return e===i?t:"deg"===e?t*Math.PI/180:180*t/Math.PI}function $m(t,e){const i=t.auto,n=t.lower??-1/0,s=t.upper??1/0,r=!!t.infinite,o=t.baseline;return function(t,a="m"){if(!Rm.includes(a))throw new Error(`Cannot parse distance as ${a}`);const h="function"==typeof i?i.call(this):i,c="function"==typeof o?o.call(this):o;let l=h,A="m";if("number"==typeof t)l=t;else if(null===t||"auto"===t)l=h;else if("string"==typeof t){const i=t.match(/^([\+\-]?(\d+\.\d+|\d+|\.\d+)([eE][\+\-]?\d+)?)([a-z%]+)?(?=$)/i);i?(l=Number(i[1])||0,i[4]&&(Rm.includes(i[4])?A=i[4]:console.warn(`Invalid unit passed to ${e}, reverting to default unit (m)`))):"Infinity"===t||"+Infinity"===t?l=1/0:"-Infinity"===t?l=-1/0:console.warn(`Invalid value passed to ${e}, reverting to default`)}else console.warn(`Invalid value passed to ${e}, reverting to default`);r||Number.isFinite(l)||(console.warn(`Infinite value passed to ${e}, reverting to default`),l=h,A="m");let u=tv(l,A,"m",c);return(u<n||s<u)&&(u=Math.min(Math.max(u,n),s),l=tv(u,"m",A,c),console.warn(`Out-of-range value passed to ${e}, clamping the value`)),tv(l,A,a,c)}}function tv(t,e,i,n=null){if(e===i)return t;if("number"!=typeof n)throw new Error("Cannot convert to/from percentage without a referent value");return"m"===e?n?t/n*100:0:t*n/100}const ev=t=>(e,i,n)=>{Nm(e,i,t.attribute),Um(e,i,function(t,e){const i=t.auto,n=t.validate;return t=>{if("auto"===t||null===t)return i;if("string"==typeof t)try{t=JSON.parse(t)}catch{console.warn(`Invalid value passed to ${e}, reverting to default (${i})`),t=i}Array.isArray(t)||(console.warn(`Invalid value passed to ${e}, reverting to default (${i})`),t=i);let s=t;return n&&s.some((t=>!n(t)))&&(console.warn(`Invalid value passed to ${e}, reverting to default (${i})`),t=i),[...s]}}(t.evaluator,i)),Fm(e,i,t.update);return km(e,i)};const iv=t=>(e,i,n)=>{Nm(e,i,t.attribute),Um(e,i,function(t,e){const i=t.map(((t,i)=>Jm(t,`${e}[${i}]`)));return t=>(null===t||"auto"===t?t="auto auto auto":"string"!=typeof t&&(console.warn(`Invalid value "${t}" passed to ${e}, reverting to default`),t="auto auto auto"),3!==(t=t.trim().split(/\s+/)).length&&(console.warn(`Invalid value "${t}" passed to ${e}, reverting to default`),t=["auto","auto","auto"]),t.map(((t,e)=>i[e](t))))}(t.evaluator,i));return Om(e,i,t.update)};const nv=t=>(e,i,n)=>{Nm(e,i,t.attribute),Um(e,i,function(t,e){const i=t.map(((t,i)=>Km(t,`${e}[${i}]`)));return function(t,n=["rad","rad","rad"]){if(!Array.isArray(n))throw new Error(`Invalid out units provided to ${e}`);for(let t=0;t<3;++t)if(!Pm.includes(n[t]))throw new Error(`Invalid angle unit ${n[t]}`);return null===t||"auto"===t?t="auto auto auto":"string"!=typeof t&&(console.warn(`Invalid value "${t}" passed to ${e}, reverting to default`),t="auto auto auto"),3!==(t=t.trim().split(/\s+/)).length&&(console.warn(`Invalid value "${t}" passed to ${e}, reverting to default`),t=["auto","auto","auto"]),t.map(((t,e)=>i[e].call(this,t)))}}(t.evaluator,i));return Om(e,i,t.update)};function sv(t,e){const i=t.map(((t,i)=>$m(t,`${e}[${i}]`)));return function(t,n=["m","m","m"]){if(!Array.isArray(n))throw new Error(`Invalid out units provided to ${e}`);for(let t=0;t<3;++t)if(!Rm.includes(n[t]))throw new Error(`Invalid angle unit ${n[t]}`);null===t||"auto"===t?t="auto auto auto":"string"!=typeof t&&(console.warn(`Invalid value "${t}" passed to ${e}, reverting to default`),t="auto auto auto"),3!==(t=t.trim().split(/\s+/)).length&&(console.warn(`Invalid value "${t}" passed to ${e}, reverting to default`),t=["auto","auto","auto"]);return t.map(((t,e)=>i[e].call(this,t)))}}const rv=t=>(e,i,n)=>{Nm(e,i,t.attribute),Um(e,i,function(t,e){const i=[$m(t[0],`${e}[0]`),Km(t[1],`${e}[1]`),Km(t[2],`${e}[2]`)];return function(t,n=["m","rad","rad"]){if(!Array.isArray(n))throw new Error(`Invalid out units provided to ${e}`);if(!Rm.includes(n[0]))throw new Error(`Invalid distance unit ${n[0]}`);if(!Pm.includes(n[1]))throw new Error(`Invalid angle unit ${n[0]}`);if(!Pm.includes(n[2]))throw new Error(`Invalid angle unit ${n[2]}`);return null===t||"auto"===t?t="auto auto auto":"string"!=typeof t&&(console.warn(`Invalid value "${t}" passed to ${e}, reverting to default`),t="auto auto auto"),3!==(t=t.trim().split(/\s+/)).length&&(console.warn(`Invalid value "${t}" passed to ${e}, reverting to default`),t=["auto","auto","auto"]),t.map(((t,e)=>i[e].call(this,t)))}}(t.evaluator,i));return Om(e,i,t.update)},ov=Symbol(),av=Symbol(),hv=Symbol(),cv=Symbol(),lv=Symbol();const Av={intensity:Jm({auto:1,lower:0,upper:1/0},"light intensity"),color:Wm({auto:"#ffffff"},"light color"),position:sv([{auto:0},{auto:1},{auto:0}],"light position"),direction:sv([{auto:0},{auto:-1},{auto:0}],"light direction"),distance:$m({auto:0,lower:0},"light distance"),angle:Km({auto:Math.PI/3,lower:0,upper:Math.PI/2},"light angle"),penumbra:Jm({auto:0,lower:0,upper:1},"light penumbra")};function uv(t){let e={};return"directional"===t.type?(e.type="directional",e.intensity=Av.intensity(t.intensity??"auto"),e.color=Av.color(t.color??"auto"),e.position=Av.position.call(this,t.position??"auto"),e.direction=Av.direction.call(this,t.direction??"auto"),e):"point"===t.type?(e.type="point",e.intensity=Av.intensity(t.intensity??"auto"),e.color=Av.color(t.color??"auto"),e.position=Av.position.call(this,t.position??"auto"),e.distance=Av.distance.call(this,t.distance??"auto"),e):"spot"===t.type?(e.type="spot",e.intensity=Av.intensity(t.intensity??"auto"),e.color=Av.color(t.color??"auto"),e.position=Av.position.call(this,t.position??"auto"),e.direction=Av.direction.call(this,t.direction??"auto"),e.distance=Av.distance.call(this,t.distance??"auto"),e.angle=Av.angle.call(this,t.angle??"auto"),e.penumbra=Av.penumbra(t.penumbra??"auto"),e):null}const dv=.025;class fv{constructor(){this.arBaseReferenceSpace=null,this.arGroup=new qo;const t=tu.webglRenderer.xr;t.enabled=!0,t.addEventListener("sessionstart",(()=>this.arBaseReferenceSpace=t.getReferenceSpace())),t.setFoveation(0);const e=new an({color:4940277});e.side=2,this.arRing=new Hn(new qh(.1-dv,.1,32).rotateX(-Math.PI/2),e);const i=.017677669529702376;this.arArrow=new Hn(new Wh(new ph([new ce(0,0),new ce(-6,6),new ce(-4,6),new ce(2,0),new ce(-4,-6),new ce(-6,-6)])).rotateX(-Math.PI/2).rotateY(-Math.PI/2).scale(i,i,i),e),this.arBar=new Hn(new Wh(new ph([new ce(.0125,0),new ce(.0125,1),new ce(-.0125,1),new ce(-.0125,0)])).rotateX(-Math.PI/2),e),this.arRing.visible=!1,this.arArrow.visible=!1,this.arBar.visible=!1,this.arGroup.add(this.arRing),this.arGroup.add(this.arArrow),this.arGroup.add(this.arBar)}isPresenting(){return tu.webglRenderer.xr.isPresenting}static get(){return fv.singleton||(fv.singleton=new fv),fv.singleton}}var gv;fv.singleton=null,function(t){t[t.Viewing=0]="Viewing",t[t.Positioning=1]="Positioning",t[t.Rotating=2]="Rotating"}(gv||(gv={}));class pv extends Xt{constructor(t,e){super(),this.wi=t,this._i=e,this.active=!1,this.Bi=null,this.Si=new Ne,this.Mi=gv.Viewing,this.xi=new Ne,this.yi=!1,this.Qi=null,this.Ti=new Map,this.Di=new Map,this.Li=null,this.Ri=null,this.Pi=!0,this.Ui=null,this.Ni=t=>{this.Ri=t,this.dispatchEvent({type:"start"}),this.Pi=!0,t.addEventListener("inputsourceschange",(t=>{this.Qi&&t.removed.includes(this.Qi)&&this.ki()})),this.wi.add(fv.get().arGroup),pu(this.wi,!1,!1),tu.xrTask=this.Fi,this.active=!0},this.Oi=()=>{this.active=!1,tu.xrTask=void 0,this.wi.remove(fv.get().arGroup),this.ki(),this.wi.modelRoots.position.set(0,0,0),this.wi.modelRoots.rotation.set(0,0,0),this.dispatchEvent({type:"end"})},this.Gi=new Ne,this.Hi=new Ne,this.Vi=new Ne,this.zi=new Ue,this.qi=new di,this.Wi=new wi,this.Fi=(t,e)=>{if(fv.get().isPresenting()){this.Ui=e.getViewerPose(fv.get().arBaseReferenceSpace).transform,this.Pi&&(this.Pi=!1,this._i&&this.ji()),this.Bi=e;for(const t of e.session.inputSources){const i=e.getPose(t.targetRaySpace,fv.get().arBaseReferenceSpace)?.transform;if(!i){this.Di.delete(t),this.Ti.delete(t);continue}const n=this.Ji.set(i.position.x,i.position.y,i.position.z),s=this.Yi.set(i.orientation.x,i.orientation.y,i.orientation.z,i.orientation.w),r=this.Ki.compose(n,s,this.Xi.set(1,1,1));this.Zi.updateMatrix(),this.Zi.updateWorldMatrix(!0,!0),r.premultiply(this.Zi.matrixWorld),this.Ti.has(t)?(this.Di.has(t)||this.Di.set(t,new di),this.Di.get(t).copy(this.Ti.get(t)).invert().premultiply(r)):this.Ti.set(t,new di),this.Ti.get(t).copy(r)}t.setClearColor("black",0),t.clear(),t.render(this.wi,this.$i)}},this.tn=new Ne,this.Ji=new Ne,this.Xi=new Ne,this.Yi=new Ue,this.Ki=new di,this.$i=new ts(45,1,.01,1e3);const i=new qo;i.add(this.$i),this.Zi=i,this.wi.add(i)}ki(){this.Qi=null,fv.get().arRing.visible=!1,fv.get().arArrow.visible=!1,fv.get().arBar.visible=!1,this.wi.modelRoots.visible=!0,this.Mi=gv.Viewing,this.Li?.cancel(),this.Li=null}ji(){const t=this.wi.boundingBox.getSize(this.tn),e=t.length(),i=this.Gi.set(0,0,1).applyQuaternion(this.zi.set(this.Ui.orientation.x,this.Ui.orientation.y,this.Ui.orientation.z,this.Ui.orientation.w)),n=Math.atan2(i.x,i.z),s=this.Gi.set(this.Ui.position.x,this.Ui.position.y,this.Ui.position.z),r=this.qi.compose(this.Vi.set(s.x,0,s.z),this.zi.setFromEuler(this.Wi.set(0,n,0)),this.Hi.set(1,1,1)).invert();this.Zi.position.set(0,0,0),this.Zi.rotation.set(0,0,0),this.Zi.applyMatrix4(r);const o=t.y<1?s.y-this.wi.boundingBox.max.y:0;if(this._i){const t=this._i();this.wi.modelRoots.rotation.set(0,-t.theta,0)}this.wi.modelRoots.position.set(0,o,-e)}update(t){if(!this.active)return!1;const e=this.wi.boundingBox.getSize(this.tn).length();this.$i.near=.005,this.$i.far=Math.max(10,3*e),this.$i.updateProjectionMatrix();const{arRing:i,arBar:n,arArrow:s}=fv.get();for(const e of this.Ri.inputSources){const r=e.gamepad;if(!r)continue;const o=r.buttons[0].pressed,a=r.axes[2]??0,h=r.axes[3]??0,c=r.buttons[4]?.pressed??!1,l=r.buttons[5]?.pressed??!1,A=Math.abs(a)>Math.abs(h)&&Math.abs(a)>.5?a:0,u=Math.abs(h)>Math.abs(a)&&Math.abs(h)>.5?h:0;switch(this.Mi){case gv.Viewing:l&&!this.Qi&&(this.Qi=e,this.Mi=gv.Positioning,i.position.copy(this.wi.modelRoots.position),this.Ri.requestHitTestSource({space:e.targetRaySpace}).then((t=>{this.Qi&&(this.Li=t)})));break;case gv.Positioning:if(this.Qi!==e)break;if(this.wi.modelRoots.visible=!1,this.Li&&this.Bi){const t=this.Bi.getHitTestResults(this.Li);if(t.length){const e=fv.get().arBaseReferenceSpace,n=t[0].getPose(e).transform.position;this.Si.set(n.x,n.y,n.z),this.Si.applyMatrix4(this.Zi.matrixWorld),i.visible=!0,i.position.copy(this.Si)}}else i.position.copy(this.wi.modelRoots.position),i.visible=!1;o&&(this.Li.cancel(),this.Li=null,this.Mi=gv.Rotating);break;case gv.Rotating:if(this.Qi!==e)break;const t=this.Bi?.getPose(this.Qi.targetRaySpace,fv.get().arBaseReferenceSpace)?.transform??null;if(o&&t){const e=t.position,r=this.Ji.set(e.x,e.y,e.z);r.applyMatrix4(this.Zi.matrixWorld);const o=t.orientation,a=this.Xi.set(0,0,-1).applyQuaternion(this.Yi.set(o.x,o.y,o.z,o.w));a.applyQuaternion(this.Zi.quaternion);const h=i.position,c=(h.y-r.y)/a.y;if(this.yi=0<c&&c<1e5,i.visible=!0,s.visible=this.yi,n.visible=this.yi,this.yi){this.xi.copy(a).multiplyScalar(c).add(r).sub(h);const t=Math.atan2(this.xi.x,this.xi.z);n.rotation.set(0,t,0),n.position.copy(h).add(this.xi);const e=Math.max(0,this.xi.length()-.1+.0125);n.scale.set(1,1,e),n.updateMatrix(),s.rotation.set(0,t,0),s.position.copy(h).add(this.xi),s.updateMatrix()}}else if(!o){const t=this.yi?Math.atan2(this.xi.x,this.xi.z):0;this.wi.modelRoots.rotation.set(0,t,0),this.wi.modelRoots.position.copy(i.position),this.ki()}}if(this.Mi===gv.Viewing){if(c&&this.Ui&&this.ji(),A){const e=180,i=this.wi.modelRoots.localToWorld(this.wi.modelsBoundingBox.getCenter(this.Xi)),n=this.Ki.makeRotationY(A*t*he.degToRad(e));this.wi.modelRoots.position.sub(i),this.wi.modelRoots.applyMatrix4(n),this.wi.modelRoots.position.add(i)}const i=(r.buttons[1]?.pressed??!1)||o;if(u){let n=this.Ji;if(i){const t=this.Ti.get(e);n.set(t.elements[8],t.elements[9],t.elements[10])}else this.$i.getWorldPosition(n).sub(this.wi.modelRoots.localToWorld(this.wi.modelsBoundingBox.getCenter(this.Xi)));this.wi.modelRoots.position.add(n.multiplyScalar(1-Math.pow(.95,u*t/.1)))}if(i){const t=this.Di.get(e);t&&this.wi.modelRoots.applyMatrix4(t)}}}return!1}async en(t){this.Ni(t),t.addEventListener("end",this.Oi);const e=tu.webglRenderer;e.xr.setReferenceSpaceType("local-floor"),await e.xr.setSession(t)}async requestSession(){const t=navigator.xr,e=await t.requestSession("immersive-ar",{requiredFeatures:["hit-test","local-floor"]});await this.en(e)}async offerSession(){const t=navigator.xr;if("offerSession"in t){const e=await(t.offerSession?.("immersive-ar",{requiredFeatures:["hit-test","local-floor"]}));await this.en(e)}}async endSession(){const t=tu.webglRenderer.xr.getSession();return t?.end()??Promise.resolve()}}const mv={0:"button",1:"auto-ar",2:"manual"},vv={0:"webxr",1:"native",2:"none"},bv=Symbol(),Ev=Symbol(),Cv=Symbol(),Iv=Symbol(),wv=Symbol(),_v=Symbol(),Bv=Symbol(),Sv=Symbol(),Mv=Symbol();
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const xv=2;class yv{constructor(t){}get _$AU(){return this._$AM._$AU}_$AT(t,e,i){this._$Ct=t,this._$AM=e,this._$Ci=i}_$AS(t,e){return this.update(t,e)}update(t,e){return this.render(...e)}}
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class Qv extends yv{constructor(t){if(super(t),this.it=jl,t.type!==xv)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(t){if(t===jl||null==t)return this._t=void 0,this.it=t;if(t===Wl)return t;if("string"!=typeof t)throw Error(this.constructor.directiveName+"() called with a non-string value");if(t===this.it)return this._t;this.it=t;const e=[t];return e.raw=e,this._t={_$litType$:this.constructor.resultType,strings:e,values:[]}}}Qv.directiveName="unsafeHTML",Qv.resultType=1;const Tv=(t=>(...e)=>({_$litDirective$:t,values:e}))(Qv);var Dv;const Lv={0:"help",1:"help",2:"ar",3:"error"};class Rv extends hA{constructor(){super(...arguments),this[Dv]=null,this.state=0,this.nn=()=>{this.state=2},this.sn=()=>{this.state=0}}connectedCallback(){super.connectedCallback(),this.state=0}disconnectedCallback(){super.disconnectedCallback(),this.state=0,this.dispatchEvent(new CustomEvent("disconnected"))}shouldUpdate(t){if(t.has(sm)){const e=t.get(sm);e!==this[sm]&&(e&&(e.removeEventListener("enter-ar",this.nn),e.removeEventListener("exit-ar",this.sn)),this[sm]&&(this[sm].addEventListener("enter-ar",this.nn),this[sm].addEventListener("exit-ar",this.sn)),this[sm]?.ar?.active?this.state=2:this.state=0)}return t.has("state")&&(this.dataset.layout=Lv[this.state]),!(!t.has(sm)&&!t.has("state"))}render(){if(this[sm])switch(this.state){case 0:case 1:return ql`
          <div part="modal">
            <div part="close-button" @click=${()=>{this.remove()}}>
            </div>

            <div part="header">
              XR Controls
            </div>

            <div part="text">
              ${Pv.map((t=>ql`
                <div class="xr-entry">
                  <div class="xr-image-container">
                    ${Tv(t.image)} 
                  </div>

                  <div class="xr-text-container">
                    <span class="xr-header">${t.title}</span>
                    <span class="xr-description">${t.description}</span>
                  </div>
                </div>
                ${t.details?Tv(`\n                  <div class="xr-details">\n                    ${t.details}\n                  </div>`):jl}
              `))}
            </div>

            ${0===this.state?ql`
              <button type="button" part="button" @click=${async()=>{const t=this[sm];if(!t.ar?.active)try{this.state=1,await t[Mv](0)}catch{this.state=3}}}>
                Start WebXR
              </div>
            `:ql`
              <div class="spinning-wheel"></div>
            `}
          </div>
        `;case 2:return ql`
            <div part="modal">
              <span part="header">XR Session in Progress</span>
              <span part="text">Click Resume or Quit within the toolbar to proceed.</span>
              <button type="button" part="button" @click=${()=>this[sm].stopAR()}>Exit XR</button>
            </div>
          `;case 3:return ql`
            <div part="modal">
              <div part="close-button" @click=${()=>{this.remove()}}>
              </div>

              <svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M30.0098 7.49999C33.2348 7.49999 36.1148 9.16499 37.7098 11.97L53.8048 39.845C54.5559 41.1115 54.9998 42.6368 54.9998 44.2658C54.9998 45.9104 54.5473 47.4494 53.7601 48.7649L53.7823 48.725C52.2314 51.4212 49.3668 53.2075 46.085 53.2075C46.0744 53.2075 46.0637 53.2075 46.0531 53.2075H46.0548H13.9048C13.8881 53.2076 13.8685 53.2076 13.8488 53.2076C10.6054 53.2076 7.77207 51.452 6.24729 48.8392L6.22479 48.7975C5.45516 47.5126 5 45.9629 5 44.3068C5 42.6716 5.44373 41.1401 6.21729 39.826L6.19473 39.8675L22.3097 11.96C23.8453 9.27784 26.6903 7.49976 29.9506 7.49976C29.9714 7.49976 29.9921 7.49981 30.0129 7.49999H30.0097H30.0098ZM30.0098 11.53C28.2423 11.53 26.6798 12.4325 25.8048 13.965L9.68984 41.86C9.27617 42.5602 9.03178 43.4029 9.03178 44.3027C9.03178 45.2095 9.27998 46.0583 9.71217 46.7849L9.69986 46.7625C10.5748 48.275 12.1449 49.1675 13.8924 49.1675H46.0424C47.8124 49.1675 49.3923 48.2525 50.2873 46.7125C50.7095 46.0124 50.9591 45.167 50.9591 44.2634C50.9591 43.3824 50.7218 42.5569 50.3076 41.8472L50.3199 41.87L34.2124 13.975C33.3756 12.5051 31.8195 11.5299 30.0356 11.5299C30.0266 11.5299 30.0175 11.5299 30.0085 11.53H30.0099L30.0098 11.53ZM29.9998 39.62C31.4073 39.62 32.5698 40.7799 32.5073 42.25C32.5698 43.5875 31.3448 44.7575 29.9998 44.7575C28.5998 44.7575 27.4298 43.5875 27.4298 42.19C27.4298 40.79 28.6023 39.62 29.9998 39.62ZM29.3623 21.58C30.5873 21.2925 31.8073 21.88 32.3323 23.03C32.5073 23.4425 32.5698 23.855 32.5698 24.315C32.5072 25.6001 32.3947 26.885 32.3323 28.1701C32.2198 30.1526 32.0948 32.1375 31.9823 34.1201C31.9223 34.7701 31.9223 35.3551 31.9223 35.9926C31.893 37.0315 31.0438 37.8626 30.0005 37.8626C29.9994 37.8626 29.9983 37.8626 29.9971 37.8626H29.9973C29.9858 37.8628 29.9721 37.863 29.9584 37.863C28.9441 37.863 28.1172 37.0608 28.0774 36.0562L28.0773 36.0526L27.5523 26.8325C27.4923 26.0225 27.4398 25.2 27.3773 24.3875C27.3773 23.04 28.1398 21.93 29.3623 21.58Z" fill="#CCCCCC" stroke="#CCCCCC" stroke-width="0.03125"/>
              </svg>

              <span part="text">We are having trouble loading the experience.</span>

              <button type="button" part="button" @click=${async()=>{const t=this[sm];if(!t.ar?.active)try{await t[Mv](0)}catch{this.state=3}}}>
                Try Again
              </div>
            </div>
          `}}}Dv=sm,Rv.styles=[cl(":host {\n  all: initial;\n\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 10000;\n\n  width: 100%;\n  height: 100%;\n\n  background-color: rgba(0, 0, 0, 0.7);\n\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n:host [part=modal] {\n  all: initial;\n  position: absolute;\n\n  max-width: 90%;\n\n  padding: 0;\n\n  box-sizing: border-box;\n  box-shadow: 0 4 4 0 rgba(0, 0, 0, 0.25);\n\n  color: black;\n  background-color: white;\n\n  font-family: 'Roboto';\n  font-size: 14px;\n  font-weight: 400;\n  line-height: 16.41px;\n  text-align: center;\n}\n\n:host [part=header] {\n  margin-left: auto;\n  margin-right: auto;\n\n  font-size: 16px;\n  font-weight: 700;\n  line-height: 18.75px;\n\n  overflow: hidden;\n}\n\n:host [part=text] {\n  margin-left: auto;\n  margin-right: auto;\n\n  overflow: hidden;\n}\n\n:host [part=button] {\n  appearance: none;\n\n  max-width: 100%;\n\n  margin-left: auto;\n  margin-right: auto;\n\n  color: white;\n  background-color: #4b61f9;\n\n  border: none;\n  border-radius: 20px;\n  box-sizing: border-box;\n\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n\n  overflow: hidden;\n\n  cursor: pointer;\n}\n\n:host [part=close-button] {\n  position: absolute;\n  top: 15.37px;\n  right: 15.37px;\n\n  width: 12px;\n  height: 12px;\n\n  padding: 0;\n  margin: 0;\n\n  background-image: var(--default-ar-overlay-close, url(\"data:image/svg+xml, %3Csvg width='11' height='11' viewBox='0 0 11 11' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 1L1 10.0118' stroke='black' stroke-width='2'/%3E%3Cpath d='M1 1L10 10.0118' stroke='black' stroke-width='2'/%3E%3C/svg%3E%0A\"));\n  background-color: white;\n  background-repeat: no-repeat;\n  background-position: center;\n  background-size: 100%;\n\n  cursor: pointer;\n}\n\n.spinning-wheel {\n  --neutral-200: #cccccc;\n  --primary: #4b61f9;\n\n  width: 20px;\n  height: 20px;\n  border-radius: 50%;\n  border-top: 2px solid var(--neutral-200);\n  border-right: 2px solid var(--neutral-200);\n  border-bottom: 2px solid var(--neutral-200);\n  border-left: 2px solid var(--primary);\n  animation: spinningWheelAnimation 2s infinite linear;\n}\n\n@keyframes spinningWheelAnimation {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n\n\n/** AR LAYOUT **/\n\n:host([data-layout=ar]) [part=modal] {\n  width: 346px;\n  height: 216px;\n\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  gap: 10px;\n}\n\n:host([data-layout=ar]) [part=header] {\n  max-width: 100%;\n  width: 186px;\n}\n\n:host([data-layout=ar]) [part=text] {\n  height: 48px;\n  width: 241px;\n  max-width: 100%;\n\n}\n\n:host([data-layout=ar]) [part=button] {\n  height: 34px;\n  width: 84px;\n}\n\n/** HELP LAYOUT **/\n\n:host([data-layout=help]) [part=modal] {\n  width: 360px;\n  height: 360px;\n}\n\n:host([data-layout=help]) [part=header] {\n  position: absolute;\n  top: 35px;\n  left: 0;\n  right: 0;\n}\n\n:host([data-layout=help]) [part=text] {\n  position: absolute;\n  top: 90px;\n  left: 0;\n  right: 0;\n\n  width: 284px;\n  max-width: 100%;\n\n  display: flex;\n  flex-direction: column;\n  align-items: start;\n  justify-content: start;\n}\n\n:host([data-layout=help]) [part=text] > :not(:first-child):not(.xr-details) {\n  margin-top: 15px;\n}\n\n.xr-entry {\n  display: flex;\n  flex-flow: row nowrap;\n  gap: 15px;\n}\n\n.xr-image-container {\n  flex: 0 0 25px;\n\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n}\n\n.xr-text-container {\n  flex: 1 0 246px;\n\n  display: flex;\n  flex-flow: row nowrap;\n  justify-content: start;\n  align-items: center;\n  gap: 6px;\n}\n\n.xr-header {\n  font-size: 12px;  \n  font-weight: 700;\n  line-height: 14.06px;\n}\n\n.xr-description {\n  font-size: 12px;\n  font-weight: 400;\n  line-height: 14.06px;\n  text-align: left;\n}\n\n.xr-details {\n  margin-left: 40px;\n  margin-top: 3px;\n\n  font-size: 10px;\n  font-weight: 400;\n  line-height: 11.72px;\n  text-align: left;\n}\n\n:host([data-layout=help]) [part=button] {\n  position: absolute;\n\n  width: 119px;\n  height: 30px;\n\n  top: 303px;\n  left: 0;\n  right: 0;\n}\n\n:host([data-layout=help]) .spinning-wheel {\n  position: absolute;\n\n  top: 303px;\n  left: 0;\n  right: 0;\n\n  margin-left: auto;\n  margin-right: auto;\n}\n\n/** ERROR LAYOUT **/\n\n:host([data-layout=error]) [part=modal] {\n  width: 300px;\n  height: 260px;\n\n  display: flex;\n  flex-flow: column nowrap;\n  align-items: center;\n  justify-content: center;\n  gap: 20px;\n}\n\n:host([data-layout=error]) [part=text] {\n  max-width: 150px;\n}\n\n:host([data-layout=error]) [part=button] {\n  width: 119px;\n  height: 30px;\n}\n")],up([Kp()],Rv.prototype,Dv,void 0),up([Kp()],Rv.prototype,"state",void 0);const Pv=[{title:"A/X Button",description:"Recenter the asset",image:'<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M11 20.625C8.44729 20.625 5.99913 19.6109 4.1941 17.8059C2.38906 16.0009 1.375 13.5527 1.375 11C1.375 8.44729 2.38906 5.99913 4.1941 4.1941C5.99913 2.38906 8.44729 1.375 11 1.375C13.5527 1.375 16.0009 2.38906 17.8059 4.1941C19.6109 5.99913 20.625 8.44729 20.625 11C20.625 13.5527 19.6109 16.0009 17.8059 17.8059C16.0009 19.6109 13.5527 20.625 11 20.625ZM11 22C13.9174 22 16.7153 20.8411 18.7782 18.7782C20.8411 16.7153 22 13.9174 22 11C22 8.08262 20.8411 5.28473 18.7782 3.22183C16.7153 1.15893 13.9174 0 11 0C8.08262 0 5.28473 1.15893 3.22183 3.22183C1.15893 5.28473 0 8.08262 0 11C0 13.9174 1.15893 16.7153 3.22183 18.7782C5.28473 20.8411 8.08262 22 11 22Z" fill="#1A1A1A"/>\n        <path d="M11 17.875C9.17664 17.875 7.42795 17.1507 6.13864 15.8614C4.84933 14.572 4.125 12.8234 4.125 11C4.125 9.17664 4.84933 7.42795 6.13864 6.13864C7.42795 4.84933 9.17664 4.125 11 4.125C12.8234 4.125 14.572 4.84933 15.8614 6.13864C17.1507 7.42795 17.875 9.17664 17.875 11C17.875 12.8234 17.1507 14.572 15.8614 15.8614C14.572 17.1507 12.8234 17.875 11 17.875ZM11 19.25C12.0834 19.25 13.1562 19.0366 14.1571 18.622C15.1581 18.2074 16.0675 17.5997 16.8336 16.8336C17.5997 16.0675 18.2074 15.1581 18.622 14.1571C19.0366 13.1562 19.25 12.0834 19.25 11C19.25 9.91659 19.0366 8.8438 18.622 7.84286C18.2074 6.84193 17.5997 5.93245 16.8336 5.16637C16.0675 4.40029 15.1581 3.7926 14.1571 3.37799C13.1562 2.96339 12.0834 2.75 11 2.75C8.81196 2.75 6.71354 3.61919 5.16637 5.16637C3.61919 6.71354 2.75 8.81196 2.75 11C2.75 13.188 3.61919 15.2865 5.16637 16.8336C6.71354 18.3808 8.81196 19.25 11 19.25Z" fill="#1A1A1A"/>\n        <path d="M11 15.125C9.90598 15.125 8.85677 14.6904 8.08318 13.9168C7.3096 13.1432 6.875 12.094 6.875 11C6.875 9.90598 7.3096 8.85677 8.08318 8.08318C8.85677 7.3096 9.90598 6.875 11 6.875C12.094 6.875 13.1432 7.3096 13.9168 8.08318C14.6904 8.85677 15.125 9.90598 15.125 11C15.125 12.094 14.6904 13.1432 13.9168 13.9168C13.1432 14.6904 12.094 15.125 11 15.125ZM11 16.5C12.4587 16.5 13.8576 15.9205 14.8891 14.8891C15.9205 13.8576 16.5 12.4587 16.5 11C16.5 9.54131 15.9205 8.14236 14.8891 7.11091C13.8576 6.07946 12.4587 5.5 11 5.5C9.54131 5.5 8.14236 6.07946 7.11091 7.11091C6.07946 8.14236 5.5 9.54131 5.5 11C5.5 12.4587 6.07946 13.8576 7.11091 14.8891C8.14236 15.9205 9.54131 16.5 11 16.5Z" fill="#1A1A1A"/>\n        <path d="M13.0625 11C13.0625 11.547 12.8452 12.0716 12.4584 12.4584C12.0716 12.8452 11.547 13.0625 11 13.0625C10.453 13.0625 9.92839 12.8452 9.54159 12.4584C9.1548 12.0716 8.9375 11.547 8.9375 11C8.9375 10.453 9.1548 9.92839 9.54159 9.54159C9.92839 9.1548 10.453 8.9375 11 8.9375C11.547 8.9375 12.0716 9.1548 12.4584 9.54159C12.8452 9.92839 13.0625 10.453 13.0625 11Z" fill="#1A1A1A"/>\n      </svg>'},{title:"B/Y Button",description:"Position the asset",details:"Point to the floor to position the asset, then hold the trigger button and drag to orient",image:'<svg width="18" height="18" viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M10.1413 4.25704C10.562 4.67862 10.7981 5.25007 10.7975 5.84568C10.7969 6.4413 10.5597 7.01228 10.1381 7.43302C9.71654 7.85377 9.14509 8.08981 8.54947 8.08922C7.95386 8.08863 7.38288 7.85145 6.96213 7.42987C6.7538 7.22113 6.58863 6.97339 6.47604 6.70081C6.36345 6.42823 6.30565 6.13615 6.30594 5.84123C6.30653 5.24562 6.5437 4.67463 6.96528 4.25389C7.38686 3.83315 7.95831 3.5971 8.55393 3.5977C8.84884 3.59799 9.14082 3.65637 9.41317 3.7695C9.68553 3.88263 9.93293 4.04829 10.1413 4.25704ZM7.06828 12.7788C7.08361 12.7986 7.09715 12.8196 7.10877 12.8418L8.5508 15.133L9.99463 12.8418C10.0055 12.8207 10.0182 12.8005 10.0324 12.7815L12.8418 8.32226C13.2758 7.56924 13.504 6.71528 13.5035 5.84616C13.503 4.97704 13.2738 4.12335 12.8389 3.37084C12.404 2.61832 11.7788 1.99348 11.0261 1.55907C10.2733 1.12466 9.41947 0.895965 8.55035 0.895965C7.68123 0.895965 6.8274 1.12466 6.07464 1.55907C5.32187 1.99348 4.69666 2.61832 4.2618 3.37084C3.82694 4.12335 3.59775 4.97704 3.59724 5.84616C3.59672 6.71528 3.82491 7.56924 4.25888 8.32226L7.06738 12.7797L7.06828 12.7788ZM6.46196 13.4985H3.40247L1.24167 17.0995H15.8581L13.6982 13.4994H10.6396L9.14543 15.8734C9.08227 15.9748 8.99395 16.0582 8.88904 16.1154L8.83327 16.1415C8.73481 16.1843 8.62785 16.204 8.52058 16.1992C8.41331 16.1944 8.30857 16.1651 8.21436 16.1136L8.19636 16.1037C8.09939 16.0474 8.01757 15.9684 7.95797 15.8734L6.46196 13.4985ZM11.2082 12.5989H13.951C14.0286 12.6 14.1046 12.6208 14.172 12.6593C14.2393 12.6979 14.2958 12.7529 14.336 12.8193L17.0168 17.2875C17.0651 17.3547 17.094 17.434 17.1002 17.5165C17.1064 17.5991 17.0897 17.6817 17.0519 17.7554C17.0142 17.8291 16.9568 17.8909 16.8862 17.934C16.8155 17.9772 16.7343 18 16.6516 18H0.449137C0.369655 18 0.291587 17.979 0.222911 17.939C0.154236 17.899 0.0974153 17.8414 0.0582574 17.7723C0.0190996 17.7031 -0.000991407 17.6248 3.76336e-05 17.5453C0.00106667 17.4658 0.0231788 17.388 0.0641144 17.3199L2.74488 12.8526C2.78165 12.7767 2.83902 12.7126 2.91044 12.6678C2.98186 12.6229 3.06445 12.5991 3.14879 12.5989H5.89523L3.48434 8.77386C2.97115 7.88452 2.70107 6.87579 2.70125 5.84901C2.70142 4.82223 2.97184 3.81358 3.48533 2.92443C3.99882 2.03527 4.73729 1.29692 5.62654 0.783586C6.51578 0.270248 7.52447 0 8.55125 0C9.57803 0 10.5867 0.270248 11.476 0.783586C12.3652 1.29692 13.1037 2.03527 13.6172 2.92443C14.1307 3.81358 14.4011 4.82223 14.4013 5.84901C14.4014 6.87579 14.1314 7.88452 13.6182 8.77386L11.2073 12.5989H11.2082ZM9.90018 5.8484C9.90018 5.49053 9.75801 5.14731 9.50495 4.89425C9.2519 4.64119 8.90868 4.49903 8.5508 4.49903C8.19292 4.49903 7.8497 4.64119 7.59665 4.89425C7.34359 5.14731 7.20142 5.49053 7.20142 5.8484C7.20142 6.20628 7.34359 6.5495 7.59665 6.80256C7.8497 7.05562 8.19292 7.19778 8.5508 7.19778C8.90868 7.19778 9.2519 7.05562 9.50495 6.80256C9.75801 6.5495 9.90018 6.20628 9.90018 5.8484Z" fill="#1A1A1A"/>\n      </svg>'},{title:"Thumbstick",description:"Rotate and move asset in/out",image:'<svg width="24" height="22" viewBox="0 0 24 22" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M10.3274 1.49575C10.5859 1.49575 10.7798 1.30878 10.7798 1.05949V0.436261C10.7798 0.186969 10.5859 0 10.3274 0C10.0689 0 9.875 0.186969 9.875 0.436261V1.05949C9.875 1.24646 10.1335 1.49575 10.3274 1.49575Z" fill="#1A1A1A"/>\n        <path d="M10.3274 4.48721C10.5859 4.48721 10.7798 4.30024 10.7798 4.05095V2.74217C10.7798 2.49288 10.5859 2.30591 10.3274 2.30591C10.0689 2.30591 9.875 2.49288 9.875 2.74217V4.05095C9.875 4.30024 10.1335 4.48721 10.3274 4.48721Z" fill="#1A1A1A"/>\n        <path d="M10.3274 7.54092C10.5859 7.54092 10.7798 7.35395 10.7798 7.10466V5.79588C10.7798 5.54659 10.5859 5.35962 10.3274 5.35962C10.0689 5.35962 9.875 5.54659 9.875 5.79588V7.10466C9.875 7.35395 10.1335 7.54092 10.3274 7.54092Z" fill="#1A1A1A"/>\n        <path d="M11.1033 9.22377L10.7802 9.16145V8.84983C10.7802 8.60054 10.5863 8.41357 10.3277 8.41357C10.0692 8.41357 9.87532 8.60054 9.87532 8.84983V9.22377L9.48753 9.41074C9.29363 9.53539 9.229 9.78468 9.35827 10.034C9.4229 10.1586 9.61679 10.2209 9.74605 10.2209C9.81068 10.2209 9.87532 10.2209 10.0046 10.1586L10.3924 9.90932L10.8448 10.034H10.974C11.1679 10.034 11.3618 9.90932 11.4265 9.72235C11.4911 9.53539 11.3618 9.28609 11.1033 9.22377Z" fill="#1A1A1A"/>\n        <path d="M17.4378 10.9689L16.0806 10.595C15.822 10.5327 15.5635 10.6573 15.4989 10.9066C15.4343 11.1559 15.5635 11.4052 15.822 11.4675L17.1793 11.8414H17.3086C17.5025 11.8414 17.6964 11.7168 17.761 11.5298C17.8256 11.2805 17.6964 11.0312 17.4378 10.9689Z" fill="#1A1A1A"/>\n        <path d="M14.2708 10.0964L12.9136 9.72242C12.6551 9.6601 12.3965 9.78475 12.3319 10.034C12.2673 10.2833 12.3965 10.5326 12.6551 10.5949L14.0123 10.9689H14.1416C14.3355 10.9689 14.5294 10.8442 14.594 10.6573C14.6586 10.408 14.5294 10.1587 14.2708 10.0964Z" fill="#1A1A1A"/>\n        <path d="M19.8929 11.6545L19.2466 11.4675C18.9881 11.4052 18.7295 11.5299 18.6649 11.7792C18.6003 12.0284 18.7295 12.2777 18.9881 12.3401L19.6344 12.527H19.7636C19.9575 12.527 20.1514 12.4024 20.2161 12.2154C20.2807 11.9661 20.1514 11.7168 19.8929 11.6545Z" fill="#1A1A1A"/>\n        <path d="M3.99401 12.6513L3.41233 12.9629C3.21844 13.0875 3.15381 13.3368 3.28307 13.5861C3.3477 13.7108 3.5416 13.7731 3.67086 13.7731C3.73549 13.7731 3.80012 13.7731 3.92938 13.7108L4.51106 13.3991C4.70496 13.2745 4.76959 13.0252 4.64033 12.7759C4.44643 12.589 4.18791 12.5266 3.99401 12.6513Z" fill="#1A1A1A"/>\n        <path d="M6.12674 11.4049L5.2219 11.9658C5.02801 12.0905 4.96338 12.3398 5.09264 12.5891C5.15727 12.7137 5.35117 12.776 5.48043 12.776C5.54506 12.776 5.60969 12.776 5.73895 12.7137L6.64379 12.1528C6.83768 12.0282 6.90231 11.7789 6.77305 11.5296C6.64379 11.3426 6.32063 11.2803 6.12674 11.4049Z" fill="#1A1A1A"/>\n        <path d="M8.32401 10.1588L7.41917 10.7197C7.22527 10.8443 7.16064 11.0936 7.28991 11.3429C7.35454 11.4676 7.54843 11.5299 7.67769 11.5299C7.74232 11.5299 7.80696 11.5299 7.93622 11.4676L8.84105 10.9067C9.03495 10.782 9.09958 10.5327 8.97032 10.2834C8.84105 10.0341 8.5179 10.0341 8.32401 10.1588Z" fill="#1A1A1A"/>\n        <path d="M20.2168 12.0907V2.55524C20.2168 2.55524 20.2168 2.55524 20.2168 2.49292V2.43059C20.2168 2.43059 20.2168 2.43059 20.2168 2.36827C20.1521 2.30595 20.0875 2.30595 20.0875 2.24363C20.0875 2.1813 20.0229 2.1813 19.9582 2.1813C19.9582 2.1813 19.9582 2.1813 19.8936 2.1813C19.8936 2.1813 19.8936 2.1813 19.829 2.1813L10.4574 0C10.3282 0 10.2636 8.8225e-08 10.1343 0.062323L3.41264 3.49009C3.34801 3.49009 3.34801 3.49008 3.34801 3.55241C3.28338 3.55241 3.21875 3.61473 3.21875 3.67705V3.73938V3.86402V13.3994C3.21875 13.5864 3.34801 13.7734 3.54191 13.8357L13.4305 16.4533H13.5597H13.689H13.7536H13.8183L20.0875 12.5892H20.1521L20.2168 12.5269L20.2814 12.4646C20.2814 12.4646 20.2814 12.4023 20.346 12.4023C20.2168 12.153 20.2168 12.153 20.2168 12.0907ZM13.9475 6.66855L19.3119 3.36544V11.8414L13.9475 15.1445V6.66855ZM10.3928 0.872521L18.601 2.74221L13.3658 5.983L4.83453 3.73938L10.3928 0.872521ZM4.05896 13.0255V4.42493L13.0427 6.7932V15.3938L4.05896 13.0255Z" fill="#1A1A1A"/>\n        <path d="M13.8829 20.2551C13.689 20.2551 13.4951 20.1305 13.4305 19.8812C13.3659 19.6319 13.5598 19.445 13.8183 19.3826C18.5364 18.6348 21.3155 17.2013 22.2203 15.1447C23.1898 12.7141 21.1862 10.1588 21.1862 10.1588C21.057 9.97186 21.057 9.72257 21.2509 9.5356C21.4448 9.41095 21.7033 9.41096 21.8972 9.59792C21.9618 9.72257 24.2239 12.5271 23.0606 15.394C22.0911 17.8246 19.0534 19.445 14.0122 20.1928C13.9475 20.2551 13.9475 20.2551 13.8829 20.2551Z" fill="#1A1A1A"/>\n        <path d="M12.396 19.5069L10.5864 17.7619C10.3925 17.5749 10.134 17.5749 9.94006 17.7619C9.74616 17.9488 9.74616 18.1981 9.94006 18.3851L10.9095 19.3199C5.93292 19.133 2.70136 17.9488 1.47337 15.8299C0.0514815 13.3993 1.73189 10.5947 1.73189 10.5324C1.86116 10.3454 1.79652 10.0338 1.538 9.9715C1.34411 9.84686 1.02095 9.90918 0.956319 10.1585C0.891687 10.2831 -0.982618 13.4616 0.697794 16.2661C2.11968 18.6967 5.60977 20.0055 11.0388 20.2548L10.0047 21.252C9.81079 21.4389 9.81079 21.6882 10.0047 21.8752C10.0693 21.9375 10.1986 21.9998 10.3278 21.9998C10.4571 21.9998 10.5864 21.9375 10.651 21.8752L12.4607 20.1301C12.5899 20.0055 12.5899 19.6939 12.396 19.5069Z" fill="#1A1A1A"/>\n      </svg>'},{title:"Trigger/Grip",description:"Hold the asset",image:'<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path fill-rule="evenodd" clip-rule="evenodd" d="M10.5135 0.200758C10.5774 0.136734 10.6532 0.0859374 10.7368 0.0512785C10.8203 0.0166197 10.9098 -0.0012207 11.0003 -0.0012207C11.0907 -0.0012207 11.1802 0.0166197 11.2637 0.0512785C11.3473 0.0859374 11.4231 0.136734 11.487 0.200758L14.237 2.95076C14.3009 3.01468 14.3516 3.09056 14.3862 3.17408C14.4208 3.2576 14.4386 3.34711 14.4386 3.43751C14.4386 3.52791 14.4208 3.61742 14.3862 3.70094C14.3516 3.78445 14.3009 3.86034 14.237 3.92426C14.1731 3.98818 14.0972 4.03888 14.0137 4.07348C13.9302 4.10807 13.8406 4.12588 13.7503 4.12588C13.6599 4.12588 13.5703 4.10807 13.4868 4.07348C13.4033 4.03888 13.3274 3.98818 13.2635 3.92426L11.6878 2.34713V7.56251C11.6878 7.74484 11.6153 7.91971 11.4864 8.04864C11.3575 8.17757 11.1826 8.25001 11.0003 8.25001C10.8179 8.25001 10.643 8.17757 10.5141 8.04864C10.3852 7.91971 10.3128 7.74484 10.3128 7.56251V2.34713L8.737 3.92426C8.60791 4.05335 8.43282 4.12588 8.25025 4.12588C8.06769 4.12588 7.8926 4.05335 7.7635 3.92426C7.63441 3.79516 7.56188 3.62007 7.56188 3.43751C7.56188 3.25494 7.63441 3.07985 7.7635 2.95076L10.5135 0.200758ZM11.0003 13.75C11.1826 13.75 11.3575 13.8224 11.4864 13.9514C11.6153 14.0803 11.6878 14.2552 11.6878 14.4375V19.6529L13.2635 18.0758C13.3926 17.9467 13.5677 17.8741 13.7503 17.8741C13.9328 17.8741 14.1079 17.9467 14.237 18.0758C14.3661 18.2049 14.4386 18.3799 14.4386 18.5625C14.4386 18.7451 14.3661 18.9202 14.237 19.0493L11.487 21.7993C11.4231 21.8633 11.3473 21.9141 11.2637 21.9487C11.1802 21.9834 11.0907 22.0012 11.0003 22.0012C10.9098 22.0012 10.8203 21.9834 10.7368 21.9487C10.6532 21.9141 10.5774 21.8633 10.5135 21.7993L7.7635 19.0493C7.69958 18.9853 7.64888 18.9095 7.61428 18.8259C7.57969 18.7424 7.56188 18.6529 7.56188 18.5625C7.56188 18.4721 7.57969 18.3826 7.61428 18.2991C7.64888 18.2156 7.69958 18.1397 7.7635 18.0758C7.8926 17.9467 8.06769 17.8741 8.25025 17.8741C8.34065 17.8741 8.43016 17.8919 8.51368 17.9265C8.5972 17.9611 8.67308 18.0118 8.737 18.0758L10.3128 19.6529V14.4375C10.3128 14.2552 10.3852 14.0803 10.5141 13.9514C10.643 13.8224 10.8179 13.75 11.0003 13.75ZM0.201002 11.4868C0.136978 11.4229 0.0861815 11.347 0.0515227 11.2635C0.0168638 11.18 -0.000976563 11.0904 -0.000976562 11C-0.000976563 10.9096 0.0168638 10.82 0.0515227 10.7365C0.0861815 10.653 0.136978 10.5771 0.201002 10.5133L2.951 7.76326C3.0801 7.63416 3.25519 7.56164 3.43775 7.56164C3.62032 7.56164 3.79541 7.63416 3.9245 7.76326C4.0536 7.89235 4.12612 8.06744 4.12612 8.25001C4.12612 8.43257 4.0536 8.60766 3.9245 8.73676L2.34738 10.3125H7.56275C7.74509 10.3125 7.91996 10.3849 8.04889 10.5139C8.17782 10.6428 8.25025 10.8177 8.25025 11C8.25025 11.1823 8.17782 11.3572 8.04889 11.4861C7.91996 11.6151 7.74509 11.6875 7.56275 11.6875H2.34738L3.9245 13.2633C4.0536 13.3924 4.12612 13.5674 4.12612 13.75C4.12612 13.9326 4.0536 14.1077 3.9245 14.2368C3.79541 14.3659 3.62032 14.4384 3.43775 14.4384C3.25519 14.4384 3.0801 14.3659 2.951 14.2368L0.201002 11.4868ZM13.7503 11C13.7503 10.8177 13.8227 10.6428 13.9516 10.5139C14.0805 10.3849 14.2554 10.3125 14.4378 10.3125H19.6531L18.076 8.73676C18.0121 8.67284 17.9614 8.59695 17.9268 8.51343C17.8922 8.42992 17.8744 8.34041 17.8744 8.25001C17.8744 8.15961 17.8922 8.0701 17.9268 7.98658C17.9614 7.90306 18.0121 7.82718 18.076 7.76326C18.2051 7.63416 18.3802 7.56164 18.5627 7.56164C18.6531 7.56164 18.7427 7.57944 18.8262 7.61404C18.9097 7.64863 18.9856 7.69934 19.0495 7.76326L21.7995 10.5133C21.8635 10.5771 21.9143 10.653 21.949 10.7365C21.9836 10.82 22.0015 10.9096 22.0015 11C22.0015 11.0904 21.9836 11.18 21.949 11.2635C21.9143 11.347 21.8635 11.4229 21.7995 11.4868L19.0495 14.2368C18.9856 14.3007 18.9097 14.3514 18.8262 14.386C18.7427 14.4206 18.6531 14.4384 18.5627 14.4384C18.4724 14.4384 18.3828 14.4206 18.2993 14.386C18.2158 14.3514 18.1399 14.3007 18.076 14.2368C18.0121 14.1728 17.9614 14.097 17.9268 14.0134C17.8922 13.9299 17.8744 13.8404 17.8744 13.75C17.8744 13.6596 17.8922 13.5701 17.9268 13.4866C17.9614 13.4031 18.0121 13.3272 18.076 13.2633L19.6531 11.6875H14.4378C14.2554 11.6875 14.0805 11.6151 13.9516 11.4861C13.8227 11.3572 13.7503 11.1823 13.7503 11Z" fill="black"/>\n      </svg>'},{title:"Menu",description:"Pause XR experience",image:'<svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M15.1277 7.33078C15.1277 7.39103 15.1158 7.45069 15.0928 7.50635C15.0697 7.56202 15.0359 7.61259 14.9933 7.6552C14.9507 7.6978 14.9002 7.73159 14.8445 7.75465C14.7888 7.77771 14.7292 7.78957 14.6689 7.78957C14.6087 7.78957 14.549 7.77771 14.4934 7.75465C14.4377 7.73159 14.3871 7.6978 14.3445 7.6552C14.3019 7.61259 14.2681 7.56202 14.2451 7.50635C14.222 7.45069 14.2101 7.39103 14.2101 7.33078V4.12043H3.20372V17.8797H14.212L14.2111 14.6695C14.2111 14.6095 14.2229 14.5501 14.2458 14.4947C14.2688 14.4392 14.3025 14.3888 14.3449 14.3464C14.3873 14.304 14.4377 14.2703 14.4931 14.2473C14.5486 14.2244 14.608 14.2126 14.668 14.2126C14.728 14.2126 14.7874 14.2244 14.8429 14.2473C14.8983 14.2703 14.9487 14.304 14.9911 14.3464C15.0336 14.3888 15.0672 14.4392 15.0902 14.4947C15.1131 14.5501 15.125 14.6095 15.125 14.6695L15.1277 18.3379C15.1277 18.3982 15.1158 18.4579 15.0927 18.5135C15.0696 18.5692 15.0357 18.6197 14.9931 18.6623C14.9504 18.7049 14.8998 18.7386 14.8441 18.7616C14.7884 18.7846 14.7287 18.7964 14.6685 18.7964H2.74447C2.62291 18.7963 2.50634 18.748 2.4204 18.662C2.33445 18.5761 2.28616 18.4595 2.28613 18.3379V3.66219C2.28616 3.54064 2.33446 3.42408 2.42041 3.33813C2.50636 3.25218 2.62292 3.20389 2.74447 3.20386H14.6685C14.7287 3.20378 14.7884 3.21557 14.8441 3.23856C14.8998 3.26156 14.9504 3.2953 14.9931 3.33787C15.0357 3.38043 15.0696 3.43098 15.0927 3.48663C15.1158 3.54228 15.1277 3.60194 15.1277 3.66219V7.33078ZM18.1481 11.4594H8.24813C8.18788 11.4594 8.12821 11.4475 8.07254 11.4244C8.01687 11.4014 7.96629 11.3676 7.92369 11.325C7.88108 11.2824 7.84728 11.2318 7.82422 11.1761C7.80116 11.1204 7.7893 11.0608 7.7893 11.0005C7.7893 10.9403 7.80116 10.8806 7.82422 10.8249C7.84728 10.7693 7.88108 10.7187 7.92369 10.6761C7.96629 10.6335 8.01687 10.5997 8.07254 10.5766C8.12821 10.5536 8.18788 10.5417 8.24813 10.5417H18.15L16.1791 8.57085C16.0936 8.48479 16.0457 8.36826 16.0461 8.2469C16.0464 8.12554 16.0949 8.00929 16.181 7.92373C16.2671 7.83816 16.3836 7.79029 16.505 7.79065C16.6263 7.791 16.7426 7.83955 16.8281 7.92561L19.5791 10.6765L19.601 10.7003L19.6029 10.7023L19.6084 10.7085C19.6319 10.7372 19.6519 10.7686 19.668 10.8021L19.6707 10.8075L19.6726 10.8123L19.6845 10.8379L19.6854 10.8423L19.6891 10.8534L19.6909 10.8589L19.6927 10.8644L19.6946 10.8698L19.6964 10.8754L19.6991 10.8864L19.7001 10.892L19.7019 10.8975L19.7037 10.9085L19.7055 10.9131L19.7065 10.9194L19.7074 10.924L19.7083 10.9314L19.7092 10.9351L19.7101 10.9423V10.9461L19.7111 10.9534L19.712 10.957V10.9681L19.7129 10.9771V10.9892L19.7138 10.9899V11.0112L19.7129 11.012V11.0249L19.712 11.033V11.0451L19.7111 11.0478L19.7101 11.0551V11.0589L19.7092 11.067L19.7083 11.0706L19.7074 11.0771L19.7065 11.0816L19.7055 11.0882L19.7037 11.0927L19.7019 11.1046L19.7001 11.1101L19.6991 11.1156L19.6964 11.1258L19.6946 11.1313L19.6927 11.1368L19.6909 11.1423L19.6891 11.1477L19.6854 11.1587L19.6845 11.1623L19.6726 11.1889L19.6707 11.1936L19.668 11.1998C19.6517 11.2329 19.6317 11.2641 19.6084 11.2926L19.6029 11.2989L19.601 11.3008L19.5791 11.3246L16.8272 14.0764C16.7412 14.1624 16.6245 14.2106 16.5029 14.2105C16.3813 14.2105 16.2647 14.1621 16.1787 14.076C16.0928 13.99 16.0445 13.8733 16.0446 13.7517C16.0447 13.6301 16.0931 13.5135 16.1791 13.4275L18.1481 11.4594Z" fill="#231F20"/>\n      </svg>'}];var Uv,Nv;const kv=Symbol();class Fv extends hA{constructor(){super(),this[Uv]=null,this[Nv]=!1,this.rn=null,this.Ei=()=>{"none"!==(this[sm]?.arMode??"none")?(this[kv]=!0,this.removeAttribute("data-hidden")):(this[kv]=!1,this.setAttribute("data-hidden",""))},this.an=()=>{this.rn=null},this.nn=t=>{"webxr"===t.detail.type&&this[sm]&&this.hn()},this.sn=()=>{this.cn()},this.addEventListener("click",(async()=>{"webxr"===(this[sm]?.arMode??"none")?this.hn():this[sm][Mv](0)}))}connectedCallback(){super.connectedCallback(),this[sm]=nm(this)}disconnectedCallback(){super.disconnectedCallback(),this[sm]=null,this.cn()}hn(){this.rn||(this.rn=document.createElement("vntana-ar-overlay"),this.rn[sm]=this[sm],this[sm]?.append(this.rn),this.rn.addEventListener("disconnected",this.an))}cn(){this.rn&&(this.rn.removeEventListener("disconnected",this.an),this.rn.remove(),this.rn=null)}get enabled(){return this[kv]}shouldUpdate(t){if(t.has(sm)){const e=t.get(sm);e!==this[sm]&&(e&&(e.removeEventListener("ar-mode-change",this.Ei),e.removeEventListener("enter-ar",this.nn),e.removeEventListener("exit-ar",this.sn)),this[sm]&&(this[sm].addEventListener("ar-mode-change",this.Ei),this[sm].addEventListener("enter-ar",this.nn),this[sm].addEventListener("exit-ar",this.sn)),this[sm]?.ar?.active?this.hn():this.cn())}return this.Ei(),!0}render(){return ql`
      <slot>
        <img part="default-icon" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAC8AAAA2CAQAAAD99wh0AAAAAmJLR0QA/4ePzL8AAATwSURBVFjDrZhdbBRVFMfPbltKKXbp7pbt3rmf06WCpfTrQR9MxIKJL4YosWpsNMb4YqJiTIwfkIgxPphieJAgLUiUJibyUKNQG0gkwVCM+mJC06gJwahVQcCkgPaDjufeWWy7nZm92/Y8TWbn/ubuvef+z/8MgHVsLpf7yYQ83LQClj/UfWyEeEmPeOy86lpWtNggTzie47FJhN/UV/yk27gsaJoUPVRjZ1S/6iee+kQdZfgCZ0rscxNLhTvssuNRTww3dOAC9SG+D6ChU35PcZnoL8maxbNjsLb6fueGGHMfx2uYxWPE1dP8V3Kh6m4g/m+lRg3cAW1AaHI2U+bg/58AtMJGqC0NvRJy0AEuFKTgAryOChD4bCNU2aHLwIF22ACrA5IzCK9jFdyOYwSUR661fJR/W/cabIJ08ANyL/Hk3pDRtdCceo4NinuDh7aKMxQTjg7g/EOCkfQeRkKnF6fH9JkQAy6fd78xLXrZNCbaTfEBTUb8vwpc5YqIky3EF0wn7A32JvX3ommFeiaf29/Ju4rsSxG8DnerHNWrwMbkCx2rgE5l9B/6XXVb5K8FXk9YvsyvOV4GRQQcr07jf3C3WGSVFR5iqltc1FziAcdlYZNmcQa5u3S8aBfDRjDGUfh8vPuQPKFvsX/UW7Rq8XgnJQ9pRaXTos/dQm/htVyJB8XPOq2cjyP2IBofY0NGts/KVpS9jnl4VMcq9w3+U93bERoSha+BprU9dFQ+5k9vAd5CQ8LwARoVho/SkCB8iEbl8WwKt7Y5WEOgBQU3FolP4TOBGqVaEI95vzPbB/FgDcFS0ZY9yof0VhXiGeFHyFdYTliIRpVlDzqvAiJyEalYRceJTrReJzWLz1WqnfQ63p9hGyPG5pBdBA+iTX5jNORv+TyeCcTLbfSCcQvn1QORJ8wGbw75E+IPAxxN72anTG6Py1dylUXGWeIxMtXubj6RRRuV1ZbkiKy3UCh7vF73NffUj6W87JXkdrCzgdb4vCPgHxGPfwhN2kGEZNsi8AmUCQ2M5Uu5/7JmSC0d7x936Wf7HKdQjvneXsR+aLyzK3sw7GAYxHqoDjEiWjr0q4PtR1n9IWeXEQXVErDaaXPcU0V8TgIXqRXqF4q4FgU2FSxptxkD6BRuX6CNiiO8Dbc7EShpBfgYVKKwduC6BSQfdiee2hco1BLHrMOdioXiczWqh09kDgQbQF8g6o/TTSEbWQ3rM31sQr3TtHohPu4+Jf7Ux532LroYAj9gBOM3+cg8fK5bfG1k66p8MdwCWjiFuHySXdKuQ57OPZzHI3aGeM40fz/SAFoaEV4r3qPaUE4bI0KM3RFnAyvW4mwUuM1i2OeC+DeTF1iLftUOXyaeZX8ZEzjhq/nFfHnoWjq+oZOfM7Srcsdm/zy7Cfkum9JbwoeUWJIBP25SZFLtkWsKWmNxUntzZzBCzaPxFfQ00V71c3ddcIeyTXyZfilczfFYDYq28IpQ97o41dBpUzoC1VyLgtwfVRHsusMQNQ+UtHkVwT5uGcGKCLxvAOdUhNIisbKTXOYjonMBPqa6+I+ZgcKKUOpXHMGvmyz+VMpZPHYgpkll5yIVyiYacvIz00xi5yIPI75fdyDaAAo7t2OhIVvFiJ6tc42YPszRTeqdy/lBCqWWXyLGpfErcoeFyyn9u5QaIjPqWK6ET0T/Ae/zy1FZSYKPAAAAAElFTkSuQmCC" />
        <span part="default-text" class="qr-button-text">View in Your Space</span>
      </slot>
    `}}var Ov,Gv,Hv;Uv=sm,Nv=kv,Fv.styles=[cl(cm),cl(Im)],up([Kp()],Fv.prototype,Uv,void 0),up([Kp()],Fv.prototype,Nv,void 0);class Vv extends hA{constructor(){super(),this[Ov]=null,this.addEventListener("click",(()=>{this[sm]?.controls.centerCamera()}))}connectedCallback(){super.connectedCallback(),this[sm]=nm(this)}disconnectedCallback(){super.disconnectedCallback(),this[sm]=null}get enabled(){return this[sm]}shouldUpdate(){return this.Ei(),!0}Ei(){this.enabled?this.removeAttribute("data-hidden"):this.setAttribute("data-hidden","")}render(){return ql`
      <slot>
        <svg part="default-icon" viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'><path d='M12 6c-3.309 0-6 2.691-6 6s2.691 6 6 6 6-2.691 6-6-2.691-6-6-6zm0 10c-2.206 0-4-1.794-4-4s1.794-4 4-4 4 1.794 4 4-1.794 4-4 4z'></path><path d='M12 2C6.579 2 2 6.579 2 12s4.579 10 10 10 10-4.579 10-10S17.421 2 12 2zm0 18c-4.337 0-8-3.663-8-8s3.663-8 8-8 8 3.663 8 8-3.663 8-8 8z'></path><path d='M12 10c-1.081 0-2 .919-2 2s.919 2 2 2 2-.919 2-2-.919-2-2-2z'></path></svg>
      </slot>
    `}}Ov=sm,Vv.styles=[cl(cm)],up([Kp()],Vv.prototype,Ov,void 0);const zv=new Map,qv=Symbol();class Wv extends hA{constructor(){super(),this[Hv]=null,this.factor=1,this[Gv]=null,this.addEventListener("pointerdown",this.Wt)}connectedCallback(){super.connectedCallback(),this[sm]=nm(this)}disconnectedCallback(){super.disconnectedCallback(),this[sm]=null}Wt(t){this[sm]&&!zv.has(this[sm])&&("mouse"===t.pointerType&&0!==t.button||(zv.set(this[sm],this),this[qv]={pointerId:t.pointerId,interval:setInterval((()=>{this[sm].controls.zoom(this.factor)}),100)},this[sm].controls.zoom(this.factor),this.addEventListener("pointerup",this.Jt),this.addEventListener("pointerleave",this.Jt),this.addEventListener("pointercancel",this.Jt),this.addEventListener("pointerout",this.Jt)))}Jt(t){this[qv]&&t.pointerId===this[qv].pointerId&&(this[sm]&&zv.delete(this[sm]),clearInterval(this[qv].interval),this[qv]=null),this.removeEventListener("pointerup",this.Jt),this.removeEventListener("pointerleave",this.Jt),this.removeEventListener("pointercancel",this.Jt),this.removeEventListener("pointerout",this.Jt)}shouldUpdate(t){if(t.has(sm)){if(this[sm]!==t.get(sm)){const e=t.get(sm);zv.get(e)===this&&(zv.delete(e),this[qv]&&(clearInterval(this[qv].interval),this[qv]=null))}this.updateVisibility()}return!0}updateVisibility(){this[sm]?this.removeAttribute("data-hidden"):this.setAttribute("data-hidden","")}render(){return ql`
      <slot>
      </slot>
    `}}Hv=sm,Gv=qv,Wv.styles=[cl(cm)],up([Kp()],Wv.prototype,Hv,void 0),up([Yp({attribute:!1,type:Number})],Wv.prototype,"factor",void 0);const jv=Symbol(),Jv=Symbol(),Yv=Symbol(),Kv=Symbol(),Xv=Symbol(),Zv=Symbol(),$v=Symbol(),tb=Symbol(),eb=["lazy","eager","hover"];const ib=["ssaa","msaa"],nb=["normal","depth-write"];const sb=new Zu;const rb=/^\s*(#[0-9a-fA-F]{6})\s*$/,ob=/^\s*radial-gradient\(\s*(#[0-9a-f]{6})\s*,\s*(#[0-9a-f]{6})\s*\)\s*$/i,ab=new Ne;function hb(t){console.group(" <"+t.type+"> "+t.name),t.children?.forEach(hb),console.groupEnd()}const cb=t=>t.isMesh;function lb(t){return Ab(t.scene.modelRoots)}function Ab(t){const e={type:t.type,name:t.name,visible:t.visible};if(cb(t)){const i=t.material;e.material={name:i.name,type:i.type}}return t.children?.length>0&&(e.children=t.children.map(Ab)),e}function ub(t,e){if(!e||0===Object.keys(e).length)return;let i=!1;t.scene.models.forEach((n=>{const{scene:s}=n;s.traverse((n=>{if(!cb(n))return;const s=e[n.name];s&&(void 0!==s.visible&&(n.visible=!!s.visible),void 0!==s.material&&(t.jewelry.setMeshMaterial(n.uuid,s.material),i=!0))}))})),i&&(t.jewelry.rebuild(),i=!1)}console.log("VNTANA Viewer v1.2.2");const db=function(t){var e;class i extends t{get background(){return dp(this,e,"f")}set background(t){fp(this,e,t)}constructor(...t){super(t),this.ln=null,this.An=null,this.un=[],e.set(this,void 0),this.background="",this.scene.addEventListener("models-bounding-box-update",(()=>{this.dispatchEvent(new CustomEvent("bounding-box-update"))})),tu.addEventListener("tick",(()=>{this.un.forEach((({width:t,height:e})=>tu.requestSize(t,e)))}))}connectedCallback(){super.connectedCallback()}[(e=new WeakMap,Gp)](){super[Gp](),this.requestUpdate("background")}updated(t){if(super.updated(t),t.has("background")&&this[Up]){const t=this.shadowRoot?.querySelector(".container");this.background?t.style.setProperty("background",this.background):t.style.removeProperty("background")}}async toDataURL(t={}){const{clamp:e}=he,i="number"==typeof t.width?e(t.width,1,1/0):1024,n="number"==typeof t.height?e(t.height,1,1/0):1024;let s=i,r=n;if(t.poster){const t=this.controls.calcVerticalFovAndAspectRatioForPoster().aspectRatio;r=Math.round(0!==t?Math.min(i/t,n):n),s=Math.round(r*t)}const o=this.camera.clone();o instanceof ts&&(o.aspect=s/r,o.updateProjectionMatrix());let a=new Ne;t.camera?.target?a.fromArray(t.camera.target):this.controls.getTarget(a);const h=this.controls.currentTargetSpherical.spherical,{dist:c}=this.controls._radiusToDistAndZoom(h.radius),l=new il;l.radius=t.camera?.spherical?.[0]??c,l.phi=t.camera?.spherical?.[1]??h.phi,l.theta=t.camera?.spherical?.[2]??h.theta;const A=a.clone().add((new Ne).setFromSpherical(l));o.position.copy(A),o.lookAt(a),o.updateMatrixWorld(),o.updateWorldMatrix(!1,!1);const{elements:u}=o.matrixWorld,d=ab.set(u[8],u[9],u[10]).normalize().negate(),f=this.scene.boundingBox,g=f.getSize(new Ne).multiply(d),p=d.dot(f.min),m=p+Math.min(0,g.x)+Math.min(0,g.y)+Math.min(0,g.z),v=p+Math.max(0,g.x)+Math.max(0,g.y)+Math.max(0,g.z),b=o.position.dot(d),E=(v-m)/1e3,C=v-b<=0?1:v-b+E,I=Math.max(m-b-E,C/200);o.near=I,o.far=C;const w=this.An??(this.An=document.createElement("canvas"));let _;const B=new Promise((e=>{_=()=>{w.width=Math.max(s,1),w.height=Math.max(r,1),this.rendering.setSize(s,r),this.rendering.update(!0);const i=this.camera.clone();this.camera.copy(o),tu.webglRenderer.setRenderTarget(null),tu.webglRenderer.setViewport(0,tu.canvas.height-r,s,r),tu.webglRenderer.setClearColor(0,0),tu.webglRenderer.outputColorSpace=Qt,tu.webglRenderer.clear();!!this.scene.shadow.parent?(tu.webglRenderer.shadowMap.enabled=!0,tu.webglRenderer.shadowMap.needsUpdate=this.scene.shadow.needsRepaint):tu.webglRenderer.shadowMap.enabled=!1,this.rendering.render(this.inspector.isActive()),tu.copyPixels(w,s,r),this.camera.copy(i),this.dn(w.width,w.height,t.background??this.background);const n=w,a=n.getContext("2d"),h=a.getImageData(0,0,w.width,w.height),c=h.data;if(this.ln){const t=this.ln.canvas.getContext("2d").getImageData(0,0,w.width,w.height).data;for(let e=0;e<c.length;e+=4){const i=c.slice(e,e+4),n=t.slice(e,e+4),s=i[3]/255,r=n[3]/255;c[e+3]=Math.round(i[3]+n[3]*(1-s));for(let t=0;t<3;++t)c[e+t]=i[t]*s+n[t]*r*(1-s),0!==c[e+3]&&(c[e+t]=Math.round(255*c[e+t]/c[e+3]))}a.putImageData(h,0,0)}e(n.toDataURL(t.mimeType,t.quality))}}));if(0===this.un.length){const t=async()=>{tu.removeEventListener("render",t);let e=null;for(let t=0;t<this.un.length;++t)await e,e=this.un[t].rendered,this.un[t].render();this.un.length=0};tu.addEventListener("render",t)}this.un.push({rendered:B,render:_,width:s,height:r});return await B}dn(t,e,i){if("string"!=typeof i)return void(this.ln=null);let n,s=null;if(n=i.match(rb),n?s={primary:n[1],secondary:null}:(n=i.match(ob),n&&(s={primary:n[1],secondary:n[2]})),!s)return void(this.ln=null);let r=!1;if(this.ln){const{canvas:i,type:n}=this.ln;i.width!==t||i.height!==e?(r=!0,i.width=t,i.height=e):n.primary==s.primary&&n.secondary==s.secondary||(r=!0,this.ln.type=s)}else r=!0,this.ln={canvas:document.createElement("canvas"),type:s},this.ln.canvas.width=t,this.ln.canvas.height=e;if(!r)return;const{canvas:o,type:a}=this.ln,h=o.getContext("2d");if(a.secondary){const t=Math.max(o.width,o.height),e=h.createRadialGradient(t/2,t/2,0,t/2,t/2,t/Math.sqrt(2));e.addColorStop(0,a.primary),e.addColorStop(1,a.secondary),h.fillStyle=e,h.setTransform(o.width/t,0,0,o.height/t,0,0),h.fillRect(0,0,t,t)}else h.fillStyle=this.ln.type.primary,h.fillRect(0,0,t,e)}getDimensions(){return this.scene.modelsBoundingBox.getSize(ab),ab.toArray()}}return up([Hm({update:function(t){const e=this.shadowRoot?.querySelector(".container");t?e.style.setProperty("background",t):e.style.removeProperty("background")}})],i.prototype,"background",null),i}(function(t){var e,i,n,s,r,o,a,h,c,l,A,u,d;class f extends t{get disableZoom(){return dp(this,e,"f")}set disableZoom(t){fp(this,e,t)}get disablePan(){return dp(this,i,"f")}set disablePan(t){fp(this,i,t)}get disableControls(){return dp(this,n,"f")}set disableControls(t){fp(this,n,t)}get enableAutoRotate(){return dp(this,s,"f")}set enableAutoRotate(t){fp(this,s,t)}get autoRotatePerSecond(){return dp(this,r,"f")}set autoRotatePerSecond(t){fp(this,r,t)}get autoRotateDelay(){return dp(this,o,"f")}set autoRotateDelay(t){fp(this,o,t)}get rotateSpeed(){return dp(this,a,"f")}set rotateSpeed(t){fp(this,a,t)}get cameraTarget(){return dp(this,h,"f")}set cameraTarget(t){fp(this,h,t)}get cameraSpherical(){return dp(this,c,"f")}set cameraSpherical(t){fp(this,c,t)}get minCameraSpherical(){return dp(this,l,"f")}set minCameraSpherical(t){fp(this,l,t)}get maxCameraSpherical(){return dp(this,A,"f")}set maxCameraSpherical(t){fp(this,A,t)}get legacyFov(){return dp(this,u,"f")}set legacyFov(t){fp(this,u,t)}constructor(...t){super(t),e.set(this,void 0),i.set(this,void 0),n.set(this,void 0),s.set(this,!1),r.set(this,void 0),o.set(this,void 0),a.set(this,void 0),h.set(this,void 0),c.set(this,void 0),l.set(this,void 0),A.set(this,void 0),u.set(this,void 0),this.disableZoom=!1,this.disablePan=!1,this.disableControls=!1,this.enableAutoRotate=!1,this.autoRotatePerSecond="auto",this.autoRotateDelay="auto",this.rotateSpeed="auto",this.cameraTarget="auto",this.cameraSpherical="auto",this.minCameraSpherical="auto",this.maxCameraSpherical="auto"}connectedCallback(){super.connectedCallback()}updated(t){super.updated(t)}[(e=new WeakMap,i=new WeakMap,n=new WeakMap,s=new WeakMap,r=new WeakMap,o=new WeakMap,a=new WeakMap,h=new WeakMap,c=new WeakMap,l=new WeakMap,A=new WeakMap,u=new WeakMap,Gp)](){super[Gp](),this.requestUpdate("disableZoom"),this.requestUpdate("disablePan"),this.requestUpdate("disableControls"),this.requestUpdate("enableAutoRotate"),this.requestUpdate("autoRotatePerSecond"),this.requestUpdate("autoRotateDelay"),this.requestUpdate("rotateSpeed"),this.requestUpdate("cameraTarget"),this.requestUpdate("cameraSpherical"),this.requestUpdate("minCameraSpherical"),this.requestUpdate("maxCameraSpherical")}[Hp](){if(super[Hp](),this.legacyFov){const t=he.clamp(Number(this.legacyFov),1,179);if(Number.isFinite(t)){const e=vd(this.controls._sceneIdealVerticalFov)/vd(t);this.controls.explicitDefaultSpherical.radius=this.controls._distAndZoomToRadius(this.controls.explicitDefaultSpherical.radius,e)}}this.controls.centerCamera(),this.controls.setFovToFitAllViews()}}return up([zm({update:function(t){this.controls.enableZoom=!t},attribute:"disable-zoom"})],f.prototype,"disableZoom",null),up([zm({update:function(t){this.controls.enablePan=!t},attribute:"disable-pan"})],f.prototype,"disablePan",null),up([zm({update:function(t){this.controls.enabled=!t},attribute:"disable-controls"})],f.prototype,"disableControls",null),up([zm({update:function(t){this.controls.enableAutoRotate=t},attribute:"enable-auto-rotate"})],f.prototype,"enableAutoRotate",null),up([Xm({evaluator:{auto:Math.PI/6},unit:"deg",update:function(t){this.controls.autoRotateDegreesPerSec=t},attribute:"auto-rotate-per-second"})],f.prototype,"autoRotatePerSecond",null),up([Ym({evaluator:{auto:5,lower:0},update:function(t){this.controls.autoRotateMinInactivityTime=t},attribute:"auto-rotate-delay"})],f.prototype,"autoRotateDelay",null),up([Ym({evaluator:{auto:1.5,lower:0},update:function(t){this.controls.rotateSpeed=t},attribute:"rotate-speed"})],f.prototype,"rotateSpeed",null),up([(d={evaluator:[{auto:function(){const t=this.scene.modelsBoundingBox,e=.5*(t.max.x+t.min.x);return Number.isFinite(e)?e:0}},{auto:function(){const t=this.scene.modelsBoundingBox,e=.5*(t.max.y+t.min.y);return Number.isFinite(e)?e:0}},{auto:function(){const t=this.scene.modelsBoundingBox,e=.5*(t.max.z+t.min.z);return Number.isFinite(e)?e:0}}],units:["m","m","m"],attribute:"camera-target",update:function(t){this.controls.explicitDefaultTarget||(this.controls.explicitDefaultTarget=new Ne),this.controls.explicitDefaultTarget.set(t[0],t[1],t[2])}},(t,e,i)=>(Nm(t,e,d.attribute),Um(t,e,sv(d.evaluator,e)),Om(t,e,d.update)))],f.prototype,"cameraTarget",null),up([rv({evaluator:[{auto:function(){this.controls.calcImplicitDefaultTargetAndSpherical(sb);const{radius:t}=sb.spherical;return t},lower:0},{auto:function(){this.controls.calcImplicitDefaultTargetAndSpherical(sb);const{phi:t}=sb.spherical;return t}},{auto:function(){this.controls.calcImplicitDefaultTargetAndSpherical(sb);const{theta:t}=sb.spherical;return t}}],units:["m","rad","rad"],update:function(t){this.controls.explicitDefaultSpherical||(this.controls.explicitDefaultSpherical=new il),this.controls.explicitDefaultSpherical.set(t[0],t[1],t[2])},attribute:"camera-spherical"})],f.prototype,"cameraSpherical",null),up([rv({evaluator:[{auto:function(){return 2*this.controls._sceneSphere.radius/5}},{auto:0},{auto:0}],units:["m","rad","rad"],update:function(t){this.controls.enableSphericalLimits=!0,this.controls.minSpherical.set(...t)},attribute:"min-camera-spherical"})],f.prototype,"minCameraSpherical",null),up([rv({evaluator:[{auto:function(){return 3*this.controls._sceneSphere.radius}},{auto:Math.PI},{auto:2*Math.PI}],units:["m","rad","rad"],update:function(t){this.controls.enableSphericalLimits=!0,this.controls.maxSpherical.set(...t)},attribute:"max-camera-spherical"})],f.prototype,"maxCameraSpherical",null),up([Hm({attribute:"legacy-fov"})],f.prototype,"legacyFov",null),f}(function(t){var e,i,n;class s extends t{get enableJewelry(){return dp(this,e,"f")}set enableJewelry(t){fp(this,e,t)}get gemAntiAliasing(){return dp(this,i,"f")}set gemAntiAliasing(t){fp(this,i,t)}get gemRayTracingDepth(){return dp(this,n,"f")}set gemRayTracingDepth(t){fp(this,n,t)}constructor(...t){super(t),e.set(this,void 0),i.set(this,void 0),n.set(this,void 0),this.enableJewelry=!1,this.gemAntiAliasing=!1,this.gemRayTracingDepth="auto"}connectedCallback(){super.connectedCallback()}updated(t){super.updated(t),t.has("enableJewelry")&&this[Up]&&(this.jewelry.enabled=this.enableJewelry)}[(e=new WeakMap,i=new WeakMap,n=new WeakMap,Gp)](){super[Gp](),this.requestUpdate("enableJewelry"),this.requestUpdate("gemRayTracingDepth"),this.requestUpdate("gemAntiAliasing")}}return up([zm({update:function(t){this.jewelry.enabled=t},attribute:"enable-jewelry"})],s.prototype,"enableJewelry",null),up([zm({update:function(t){this.jewelry.gemAntiAliasing=t},attribute:"gem-anti-aliasing"})],s.prototype,"gemAntiAliasing",null),up([Ym({evaluator:{auto:4,lower:1,upper:6,integer:!0},update:function(t){this.jewelry.rayTraceDepth=t},attribute:"gem-ray-tracing-depth"})],s.prototype,"gemRayTracingDepth",null),s}(function(t){var e,i,n,s,r,o,a,h,c,l,A,u,d,f,g,p;class m extends t{get exposure(){return dp(this,e,"f")}set exposure(t){fp(this,e,t)}get toneMapping(){return dp(this,i,"f")}set toneMapping(t){fp(this,i,t)}get antiAliasing(){return dp(this,n,"f")}set antiAliasing(t){fp(this,n,t)}get msaaSamples(){return dp(this,s,"f")}set msaaSamples(t){fp(this,s,t)}get ssaaSamples(){return dp(this,r,"f")}set ssaaSamples(t){fp(this,r,t)}get sharpenStrength(){return dp(this,o,"f")}set sharpenStrength(t){fp(this,o,t)}get bloomStrength(){return dp(this,a,"f")}set bloomStrength(t){fp(this,a,t)}get bloomRadius(){return dp(this,h,"f")}set bloomRadius(t){fp(this,h,t)}get bloomThreshold(){return dp(this,c,"f")}set bloomThreshold(t){fp(this,c,t)}get ssaoStrength(){return dp(this,l,"f")}set ssaoStrength(t){fp(this,l,t)}get ssaoRadius(){return dp(this,A,"f")}set ssaoRadius(t){fp(this,A,t)}get hueShift(){return dp(this,u,"f")}set hueShift(t){fp(this,u,t)}get saturation(){return dp(this,d,"f")}set saturation(t){fp(this,d,t)}get brightness(){return dp(this,f,"f")}set brightness(t){fp(this,f,t)}get contrast(){return dp(this,g,"f")}set contrast(t){fp(this,g,t)}get transparencyMode(){return dp(this,p,"f")}set transparencyMode(t){fp(this,p,t)}constructor(...t){super(t),e.set(this,void 0),i.set(this,void 0),n.set(this,void 0),s.set(this,void 0),r.set(this,void 0),o.set(this,void 0),a.set(this,void 0),h.set(this,void 0),c.set(this,void 0),l.set(this,void 0),A.set(this,void 0),u.set(this,void 0),d.set(this,void 0),f.set(this,void 0),g.set(this,void 0),p.set(this,void 0),this.exposure="auto",this.toneMapping="auto",this.antiAliasing="auto",this.msaaSamples="auto",this.ssaaSamples="auto",this.sharpenStrength="auto",this.bloomStrength="auto",this.bloomRadius="auto",this.bloomThreshold="auto",this.ssaoStrength="auto",this.ssaoRadius="auto",this.hueShift="auto",this.saturation="auto",this.brightness="auto",this.contrast="auto",this.transparencyMode="auto"}connectedCallback(){super.connectedCallback()}updated(t){super.updated(t)}[(e=new WeakMap,i=new WeakMap,n=new WeakMap,s=new WeakMap,r=new WeakMap,o=new WeakMap,a=new WeakMap,h=new WeakMap,c=new WeakMap,l=new WeakMap,A=new WeakMap,u=new WeakMap,d=new WeakMap,f=new WeakMap,g=new WeakMap,p=new WeakMap,Gp)](){super[Gp](),this.requestUpdate("exposure"),this.requestUpdate("toneMapping"),this.requestUpdate("antiAliasing"),this.requestUpdate("msaaSamples"),this.requestUpdate("ssaaSamples"),this.requestUpdate("sharpenStrength"),this.requestUpdate("bloomStrength"),this.requestUpdate("bloomRadius"),this.requestUpdate("bloomThreshold"),this.requestUpdate("ssaoStrength"),this.requestUpdate("ssaoRadius"),this.requestUpdate("hueShift"),this.requestUpdate("saturation"),this.requestUpdate("contrast"),this.requestUpdate("brightness"),this.requestUpdate("transparencyMode")}}return up([Ym({evaluator:{auto:1,lower:0},update:function(t){this.rendering.exposure=t}})],m.prototype,"exposure",null),up([qm({evaluator:{auto:"aces",values:[...Hu.keys()]},update:function(t){this.rendering.toneMapping=t},attribute:"tone-mapping"})],m.prototype,"toneMapping",null),up([qm({evaluator:{auto:"ssaa",values:ib},update:function(t){this.rendering.antiAliasing=t},attribute:"anti-aliasing"})],m.prototype,"antiAliasing",null),up([Ym({evaluator:{auto:8,lower:1,upper:8,integer:!0},update:function(t){this.rendering.msaaSamples=t},attribute:"msaa-samples"})],m.prototype,"msaaSamples",null),up([Ym({evaluator:{auto:0,lower:0,upper:4,integer:!0},update:function(t){this.rendering.ssaaSamples=1<<t},attribute:"ssaa-samples"})],m.prototype,"ssaaSamples",null),up([Ym({evaluator:{auto:0,lower:0,upper:1},update:function(t){this.rendering.sharpenStrength=t},attribute:"sharpen-strength"})],m.prototype,"sharpenStrength",null),up([Ym({evaluator:{auto:0,lower:0,upper:1},update:function(t){this.rendering.bloomStrength=t},attribute:"bloom-strength"})],m.prototype,"bloomStrength",null),up([Ym({evaluator:{auto:0,lower:0,upper:5},update:function(t){this.rendering.bloomRadius=t},attribute:"bloom-radius"})],m.prototype,"bloomRadius",null),up([Ym({evaluator:{auto:.85,lower:0},update:function(t){this.rendering.bloomThreshold=t},attribute:"bloom-threshold"})],m.prototype,"bloomThreshold",null),up([Ym({evaluator:{auto:4,lower:0,upper:20},update:function(t){this.rendering.ssaoStrength=t},attribute:"ssao-strength"})],m.prototype,"ssaoStrength",null),up([Ym({evaluator:{auto:1,lower:0,upper:3},update:function(t){this.rendering.ssaoRadius=t},attribute:"ssao-radius"})],m.prototype,"ssaoRadius",null),up([Xm({evaluator:{auto:0,lower:0,upper:2*Math.PI},unit:"rad",update:function(t){this.rendering.hueShift=t},attribute:"hue-shift"})],m.prototype,"hueShift",null),up([Ym({evaluator:{auto:1,lower:0},update:function(t){this.rendering.saturation=t}})],m.prototype,"saturation",null),up([Ym({evaluator:{auto:0,lower:-1,upper:1},update:function(t){this.rendering.brightness=t}})],m.prototype,"brightness",null),up([Ym({evaluator:{auto:1,lower:0,upper:2},update:function(t){this.rendering.contrast=t}})],m.prototype,"contrast",null),up([qm({evaluator:{auto:"normal",values:nb},update(t){this.rendering.transparencyMode="depth-write"===t?"depthWrite":"normal"},attribute:"transparency-mode"})],m.prototype,"transparencyMode",null),m}(function(t){var e,i,n,s,r,o,a,h,c,l;class A extends t{get loading(){return dp(this,e,"f")}set loading(t){fp(this,e,t)}get poster(){return dp(this,i,"f")}set poster(t){fp(this,i,t)}constructor(...t){super(t),e.set(this,void 0),i.set(this,void 0),this[n]=this.shadowRoot.querySelector("slot[name=poster]"),this[s]=this.shadowRoot.querySelector("[part=default-poster]"),this[r]=this.shadowRoot.querySelector("[part=default-progress-bar]"),this[o]=!1,this[a]=t=>{const e=t.value,i=t.source;1===e&&(this[Xv].flush(),this.loaded&&(this.hidePoster(),this[Pp]=0)),this[Xv](e,t.source),this.dispatchEvent(new CustomEvent("progress",{detail:{progress:e,source:i}}))},this[h]=function(t,e){let i=null,n=null;const s=(...r)=>{null===i?(t(...r),n=null,i=setTimeout((()=>{i=null,n&&s(...n)}),e)):n=r};return s.reset=()=>{null!=i&&(clearTimeout(i),i=null)},s.flush=()=>{null!==i&&(clearTimeout(i),i=null,n&&t(...n))},s}((t=>{this[jv].style.setProperty("--progress",String(t)),0===t&&requestAnimationFrame((()=>{const t=this[jv].parentNode;t.removeChild(this[jv]),t.appendChild(this[jv])})),1===t?this[jv].classList.add("hide"):this[jv].classList.remove("hide")}),200),this[c]=t=>{this[$v]||(this[$v]=!0,this[Np]())},this[l]=t=>{t.detail.visible||(this[$v]=!1)},this.loading="auto",this.poster=""}connectedCallback(){super.connectedCallback(),this.progressTracker.addEventListener("progress",this[Kv]),this.addEventListener("pointerenter",this[Zv]),this.addEventListener("visibility",this[tb]),this.loaded||this.showPoster()}disconnectedCallback(){super.disconnectedCallback(),this.progressTracker.removeEventListener("progress",this[Kv]),this.removeEventListener("pointerenter",this[Zv]),this.removeEventListener("visibility",this[tb])}updated(t){super.updated(t),t.has("loading")&&this[Np](),t.has("poster")&&(this.poster?this[Jv].style.setProperty("background-image",`url(${this.poster})`):this[Jv].style.removeProperty("background-image")),t.has("src")&&!this.src&&(this.canvasContainer.classList.add("hidden"),this.input.classList.add("hidden"),this.hotspots.classList.add("hidden"))}get[(e=new WeakMap,i=new WeakMap,n=Yv,s=Jv,r=jv,o=$v,Fp)](){return"eager"===this.loading||super[Fp]&&("lazy"===this.loading||"hover"===this.loading&&this[$v])}showPoster(){this.canvasContainer.classList.add("hidden"),this.input.classList.add("hidden"),this.hotspots.classList.add("hidden"),this[Yv].classList.remove("hidden")}hidePoster(){this.canvasContainer.classList.remove("hidden"),this.input.classList.remove("hidden"),this.hotspots.classList.remove("hidden"),this[Yv].classList.add("hidden")}static setModelRequestHeaders(t){Rg.setRequestHeaders(t)}static setModelRequestCredentials(t){Rg.withCredentials=!!t}static setEnvironmentRequestHeaders(t){yd.setRequestHeaders(t)}static setEnvironmentRequestCredentials(t){yd.withCredentials=!!t}}return a=Kv,h=Xv,c=Zv,l=tb,up([qm({evaluator:{auto:"lazy",values:eb}})],A.prototype,"loading",null),up([Hm()],A.prototype,"poster",null),A}(function(t){var e,i,n,s,r,o,a,h,c,l,A,u,d,f,g,p,m;class v extends t{get environmentSrc(){return dp(this,e,"f")}set environmentSrc(t){fp(this,e,t)}get environmentRotation(){return dp(this,i,"f")}set environmentRotation(t){fp(this,i,t)}get skybox(){return dp(this,n,"f")}set skybox(t){fp(this,n,t)}get shadowIntensity(){return dp(this,s,"f")}set shadowIntensity(t){fp(this,s,t)}get shadowRadius(){return dp(this,r,"f")}set shadowRadius(t){fp(this,r,t)}get shadowSamples(){return dp(this,o,"f")}set shadowSamples(t){fp(this,o,t)}get shadowResolution(){return dp(this,a,"f")}set shadowResolution(t){fp(this,a,t)}get shadowOffset(){return dp(this,h,"f")}set shadowOffset(t){fp(this,h,t)}get lightRigIntensity(){return dp(this,c,"f")}set lightRigIntensity(t){fp(this,c,t)}get lightRigColor(){return dp(this,l,"f")}set lightRigColor(t){fp(this,l,t)}get lightRig(){return dp(this,A,"f")}set lightRig(t){fp(this,A,t)}get hideModelLights(){return dp(this,u,"f")}set hideModelLights(t){fp(this,u,t)}get preferModelLights(){return dp(this,d,"f")}set preferModelLights(t){fp(this,d,t)}constructor(...t){super(t),e.set(this,void 0),i.set(this,void 0),n.set(this,void 0),s.set(this,void 0),r.set(this,void 0),o.set(this,void 0),a.set(this,void 0),h.set(this,void 0),c.set(this,void 0),l.set(this,void 0),A.set(this,void 0),u.set(this,void 0),d.set(this,void 0),this[f]=null,this[g]=null,this[p]=null,this.environmentSrc="",this.environmentRotation="auto",this.skybox=!1,this.shadowIntensity="auto",this.shadowRadius="auto",this.shadowSamples="auto",this.shadowResolution="auto",this.shadowOffset="auto",this.lightRigIntensity="auto",this.lightRigColor="auto",this.lightRig="auto",this.hideModelLights=!1,this.preferModelLights=!1,this.scene.addEventListener("models-bounding-box-update",(()=>{this.requestUpdate("shadowOffset")}))}connectedCallback(){super.connectedCallback()}updated(t){super.updated(t)}async[(e=new WeakMap,i=new WeakMap,n=new WeakMap,s=new WeakMap,r=new WeakMap,o=new WeakMap,a=new WeakMap,h=new WeakMap,c=new WeakMap,l=new WeakMap,A=new WeakMap,u=new WeakMap,d=new WeakMap,f=cv,g=lv,p=hv,ov)](){if(!this[Fp])return;const t=this.environmentSrc?yd.load(this.environmentSrc):null,e=this.environmentSrc?this.progressTracker.addActivity(t.progress,"environment"):null;t?.addEventListener("progress",(t=>e(.9*t.value))),this[hv]?.(),this[cv]=t;const i=new Promise(((i,n)=>{this[hv]=()=>{n(),t?.dispose(),e?.(1)}}));try{await Promise.race([t?.done,i])}catch(t){if(null!=t)throw this[hv]?.(),t;return}finally{e?.(1)}this[lv]?.dispose(),this[lv]=this[cv],this[cv]=null,this[hv]=null,this[kp]||this[av]()}[av](){const t=this[lv];this.scene.loadEnvironment(t),this.dispatchEvent(new CustomEvent("environment-change",{detail:{src:t?.url??""}}))}[Gp](){super[Gp](),this.requestUpdate("environmentRotation"),this.requestUpdate("skybox"),this.requestUpdate("shadowIntensity"),this.requestUpdate("shadowSamples"),this.requestUpdate("shadowRadius"),this.requestUpdate("shadowResolution"),this.requestUpdate("shadowOffset"),this.requestUpdate("lightRig"),this.requestUpdate("lightRigIntensity"),this.requestUpdate("lightRigColor"),this.requestUpdate("hideModelLights"),this.preferModelLights&&this.hasModelLights&&(this.hideModelLights=!1,this.lightRigIntensity=0)}get hasModelLights(){const t=this.scene.models[0];return!!t&&t.lights.length>0}}return up([Hm({update:function(t){this[ov]()},attribute:"environment-src"})],v.prototype,"environmentSrc",null),up([nv({evaluator:[{auto:0},{auto:0},{auto:0}],units:["rad","rad","rad"],update:function(t){this.scene.setEnvironmentRotation(...t)},attribute:"environment-rotation"})],v.prototype,"environmentRotation",null),up([zm({update:function(t){this.scene.skybox=t}})],v.prototype,"skybox",null),up([Ym({evaluator:{auto:0,lower:0,upper:1},update:function(t){this.scene.shadow.intensity=t},attribute:"shadow-intensity"})],v.prototype,"shadowIntensity",null),up([Ym({evaluator:{auto:2,lower:0,upper:20},update:function(t){this.scene.shadow.radius=t},attribute:"shadow-radius"})],v.prototype,"shadowRadius",null),up([Ym({evaluator:{auto:16,lower:1,integer:!0},update:function(t){this.scene.shadow.samples=t},attribute:"shadow-samples"})],v.prototype,"shadowSamples",null),up([Ym({evaluator:{auto:512,lower:1,integer:!0},update:function(t){this.scene.shadow.resolution=t},attribute:"shadow-resolution"})],v.prototype,"shadowResolution",null),up([(m={evaluator:{auto:0,baseline:function(){const t=this.scene.modelsBoundingBox;return t.max.y-t.min.y}},unit:"%",update:function(t){this.scene.shadow.offset=t/100},attribute:"shadow-offset"},(t,e,i)=>(Nm(t,e,m.attribute),Um(t,e,$m(m.evaluator,e)),Om(t,e,m.update,m.unit)))],v.prototype,"shadowOffset",null),up([Ym({evaluator:{auto:1,lower:0},update:function(t){this.scene.lightRigIntensity=t},attribute:"light-rig-intensity"})],v.prototype,"lightRigIntensity",null),up([jm({evaluator:{auto:null,nullable:!0},update:function(t){this.scene.lightRigOverrideColor=t},attribute:"light-rig-color"})],v.prototype,"lightRigColor",null),up([ev({evaluator:{auto:[],validate:t=>"object"==typeof t&&null!==t&&("directional"===t.type||"spot"===t.type||"point"===t.type)},update:function(t){const e=[];for(let i=0;i<t.length;++i){const n=uv.call(this,t[i]);if(null===n){console.warn("Invalid light definition"),e.length=0;break}"directional"===n.type?e.push(new yg(n)):"point"===n.type?e.push(new Qg(n)):"spot"===n.type&&e.push(new Tg(n))}[...this.scene.lightRig].forEach((t=>t.removeFromScene())),e.forEach((t=>t.addToScene(this.scene)))},attribute:"light-rig"})],v.prototype,"lightRig",null),up([zm({update:function(t){this.scene.showModelLights=!t},attribute:"hide-model-lights"})],v.prototype,"hideModelLights",null),up([zm({attribute:"prefer-model-lights"})],v.prototype,"preferModelLights",null),v}(function(t){var e,i,n,s,r,o,a,h,c,l,A,u;class d extends t{get src(){return dp(this,e,"f")}set src(t){fp(this,e,t)}get scale(){return dp(this,i,"f")}set scale(t){fp(this,i,t)}get rotation(){return dp(this,n,"f")}set rotation(t){fp(this,n,t)}get autoAR(){return dp(this,s,"f")}set autoAR(t){fp(this,s,t)}get usdzSrc(){return dp(this,r,"f")}set usdzSrc(t){fp(this,r,t)}constructor(...t){super(t),e.set(this,void 0),i.set(this,void 0),n.set(this,void 0),s.set(this,void 0),r.set(this,void 0),this[o]=null,this[a]=null,this[h]=null,this[c]=!1,this[l]=2,this[A]=2,this[u]=t=>{const e=t.detail.progress;"model"===t.detail.source&&(this.autoAR&&!this[wv]&&1===this[Sv]&&(this[wv]=!0,this[Mv](1)),1===e&&(this[wv]=!1))},this.src="",this.usdzSrc="",this.scale="auto",this.rotation="auto",this.autoAR=!1,this.addEventListener("progress",this[Iv]),this.jewelry.addEventListener("enabled",(()=>this[_v]()))}connectedCallback(){super.connectedCallback()}updated(t){super.updated(t),t.has("src")&&(this[Np](),this[_v]()),t.has("usdz-src")&&this[_v]()}async[(e=new WeakMap,i=new WeakMap,n=new WeakMap,s=new WeakMap,r=new WeakMap,o=bv,a=Ev,h=Cv,c=wv,l=Bv,A=Sv,Np)](){let t=!1;if(this[Ev]){if(t=!0,this[Ev].url===this.src)return;this[Cv]()}if(!this.src)return this.scene.models.forEach((t=>this.scene.removeModel(t))),this[Dp]=!1,this.needsRender=!0,this[hv]?.(),void(this[bv]&&(this[bv].dispose(),this[bv]=null));if(!this[Fp])return;if(this[bv]&&this[bv].url===this.src)return void(t&&this[Gp]());const e=performance.now();this[kp]=!0;const i=Rg.load(this.src),n=this.progressTracker.addActivity(0,"model");i.addEventListener("progress",(t=>n(.9*t.value))),this[Ev]=i;const s=new Promise(((t,e)=>{this[Cv]=()=>{e(),this[Cv]=null,this[Ev]?.dispose(),this[Ev]=null,this[kp]=!1,n(1)}}));for(;;){const t=this[ov]();try{await Promise.race([Promise.all([i.done,t]),s]);break}catch(t){if(null!=t)return this[Cv]?.(),this[hv]?.(),void this.dispatchEvent(new CustomEvent("error",{detail:{type:"load failed"}}));if(this[Ev]!==i)return}}this[bv]?.dispose(),this[bv]=this[Ev],this[Ev]=null,this[Cv]=null,this.scene.models.forEach((t=>this.scene.removeModel(t))),this.scene.addModel(this[bv].data),this[av](),this[kp]=!1,this[Dp]=!0,this[Up]=!1,this[Gp]();try{await Promise.race([this.updateComplete,s])}catch(t){if(null!=t)throw t;return}this[Hp](),this.dispatchEvent(new CustomEvent("scene-loaded"));const r=new Promise((t=>{requestAnimationFrame((()=>{requestAnimationFrame(t)}))}));try{await Promise.race([r,s])}catch(t){if(null!=t)throw t;return}const o=performance.now();n(1),this.dispatchEvent(new CustomEvent("load",{detail:{time:o-e}}))}get[Fp](){return!!this.src&&super[Fp]}[Gp](){super[Gp](),this.requestUpdate("scale"),this.requestUpdate("rotation"),this.requestUpdate("autoAR")}get arMode(){return vv[this[Sv]]}async[(u=Iv,_v)](){const t=this.jewelry.enabled,e=await KA,i=!!this.src&&zA&&!t,n=!!this.usdzSrc&&WA&&!t;let s;s=e?0:i||n?1:2,this[Sv]!==s&&(this[Sv]=s,this.dispatchEvent(new CustomEvent("ar-mode-change",{detail:{available:vv[this[Sv]]}})))}async[Mv](t=2){if(2!==this[Sv])try{if(0===this[Sv]){if(this.ar||(this.ar=new pv(this.scene,(()=>this.controls.currentTargetSpherical.spherical)),this.ar.addEventListener("start",(()=>{this.dispatchEvent(new CustomEvent("enter-ar",{detail:{source:mv[this[Bv]],type:this.arMode}}))})),this.ar.addEventListener("end",(()=>{this.dispatchEvent(new CustomEvent("exit-ar")),this.rendering.rebuild()}))),this.ar.active)return;this[Bv]=t;const e=()=>{this[Bv]=2,this.ar.removeEventListener("end",e)};this.ar.addEventListener("end",e);try{await this.ar.requestSession()}catch(t){console.warn(t)}return}if(1===this[Sv]){if(zA)!function(t,e=""){let i;try{i=new URL(t,self.location.href)}catch{throw new Error("Invalid GLB URL")}const n=new URLSearchParams;n.set("mode","ar_preferred"),n.set("disabled_occlusion","true"),n.set("file",i.toString());const s=e?`S.browser_fallback_url=${encodeURIComponent(new URL(e).toString())};`:"",r=`intent://arvr.google.com/scene-viewer/1.0?${n.toString()}#Intent;scheme=https;package=com.google.ar.core;action=android.intent.action.VIEW;${s}end;`,o=document.createElement("a");o.setAttribute("href",r),o.click()}(this.src);else if(WA){if(HA&&this[Ev])try{await this[Ev].done}catch{return}!function(t){let e;try{e=new URL(t,self.location.href),e.searchParams.set("download","true")}catch(t){throw new Error("Invalid USDZ URL")}const i=document.createElement("a");i.setAttribute("rel","ar"),i.setAttribute("href",e.toString());const n=document.createElement("img");i.appendChild(n),i.style.display="none",document.body.appendChild(i),i.click(),i.removeChild(n)}(this.usdzSrc)}this.dispatchEvent(new CustomEvent("enter-ar",{detail:{source:mv[t],type:this.arMode}}))}}catch(t){console.warn(t)}else console.warn("AR session not supported")}async startAR(){return this[Mv]()}async stopAR(){return this.ar?.endSession()??Promise.resolve()}}return up([Hm()],d.prototype,"src",null),up([iv({evaluator:[{auto:1},{auto:1},{auto:1}],update:function(t){this.scene.models[0].setScale(...t)}})],d.prototype,"scale",null),up([nv({evaluator:[{auto:0},{auto:0},{auto:0}],units:["rad","rad","rad"],update:function(t){this.scene.models[0].setRotation(...t)}})],d.prototype,"rotation",null),up([zm({attribute:"auto-ar"})],d.prototype,"autoAR",null),up([Hm({attribute:"usdz-src"})],d.prototype,"usdzSrc",null),d}(Wp)))))));customElements.define("vntana-viewer",db),customElements.define("vntana-hotspot",em),customElements.define("vntana-fs-button",gm),customElements.define("vntana-qr-button",xm),customElements.define("vntana-qr-overlay",Tm),customElements.define("vntana-ar-button",Fv),customElements.define("vntana-ar-overlay",Rv),customElements.define("vntana-center-button",Vv),customElements.define("vntana-zoom-in-button",class extends Wv{constructor(){super(),this.factor=1.1}render(){return ql`
      <slot>
        <svg part="default-icon" viewBox='0 0 18 18' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g stroke='none' stroke-width='1' fill='#212121' fill-rule='evenodd'><g transform='translate(-951, -889)' fill='#212121'><g transform='translate(940, 878)'><path d='M20.5,11 L20.5,19.499 L29,19.5 L29,20.5 L20.5,20.499 L20.5,29 L19.5,29 L19.5,20.499 L11,20.5 L11,19.5 L19.5,19.499 L19.5,11 L20.5,11 Z' id='Plus-Icon'></path></g></g></g></svg>
      </slot>
    `}}),customElements.define("vntana-zoom-out-button",class extends Wv{constructor(){super(),this.factor=1/1.1}render(){return ql`
      <slot>
        <svg part="default-icon" viewBox='0 0 18 1' version='1.1' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink'><g stroke='none' stroke-width='1' fill='#212121' fill-rule='evenodd'><g transform='translate(-951, -938.5)' fill='#212121'><g transform='translate(940, 878)'><g transform='translate(0, 40.5)'><rect x='11' y='20' width='18' height='1'></rect></g></g></g></g></svg>
      </slot>
    `}});export{em as VntanaHotspot,db as VntanaViewer,ub as configureModel,lb as getSceneGraph,cp as normalize,hb as printGraph};
//# sourceMappingURL=viewer.min.js.map
